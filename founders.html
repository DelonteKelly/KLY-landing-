<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SÃ³lCoin Founders Circle â€” Pre-Sale</title>
<meta name="description" content="Secure your SÃ³lCoin Founders spot for 100 KLY. Only 100 wallets. Lifetime perks, staking boosts, and exclusive Founders NFT.">
<meta name="theme-color" content="#0b0b0d">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:title" content="SÃ³lCoin Founders Circle â€” Pre-Sale">
<meta property="og:description" content="100 KLY â€¢ 1 SÃ³lCoin per wallet â€¢ Only 100 wallets â€¢ Lifetime perks.">
<meta property="og:image" content="https://example.com/solcoin-founders-og.jpg">
<meta property="og:url" content="https://example.com/founders">
<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="SÃ³lCoin Founders Circle â€” Pre-Sale">
<meta name="twitter:description" content="0.05 BNB â€¢ 1 SÃ³lCoin per wallet â€¢ Only 100 wallets â€¢ Lifetime perks.">
<meta name="twitter:image" content="https://example.com/solcoin-founders-og.jpg">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0b0d; --panel:#121216; --text:#f4f4f5; --muted:#b6b6b8;
    --gold:#e6c15a; --gold-2:#aa8b2d; --stroke:#232328; --ok:#3ddc97; --danger:#ff6b6b;
    --pulse: 0 0 10px 2px rgba(230, 193, 90, 0.3);
    --focus:#7dd3fc;
  }
  *{box-sizing:border-box; margin:0; padding:0}
  body{
    min-height:100vh;
    background:radial-gradient(1000px 600px at 50% -10%,#17171b 0%,#0b0b0d 45%,#050506 100%);
    color:var(--text);
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    line-height:1.5;
  }
  .wrap{ max-width:1120px; margin:0 auto; padding:24px; animation: fadeIn .6s ease-out }
  @keyframes fadeIn { from {opacity:0; transform:translateY(10px)} to {opacity:1; transform:translateY(0)} }

  .hero{ display:grid; grid-template-columns:1.1fr .9fr; gap:28px; align-items:center }
  .card{
    background:linear-gradient(180deg,#15151a,#0f0f12);
    border:1px solid var(--stroke);
    border-radius:18px;
    padding:28px;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
    transition: transform .3s ease, box-shadow .3s ease;
  }
  .card:hover { transform: translateY(-2px); box-shadow:0 12px 35px rgba(0,0,0,.45) }

  .badge{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border:1px solid var(--gold-2); border-radius:999px;
    color:var(--gold); font-weight:600; background:rgba(166,135,32,.08); font-size:14px;
  }
  h1{ font-size:clamp(32px, 4vw, 44px); line-height:1.08; margin:14px 0 10px; font-weight:800 }
  h2,h3{ font-weight:700 }
  p{ color:var(--muted); margin:8px 0 0; font-size:15px }

  .cta{ display:flex; gap:12px; margin-top:22px; flex-wrap:wrap; align-items:center }
  .btn{
    appearance:none; border:none; border-radius:14px; padding:14px 22px;
    font-weight:700; cursor:pointer; font-size:15px; transition:all .2s ease;
    display:inline-flex; align-items:center; gap:8px; text-decoration:none;
  }
  .btn:focus-visible{ outline:3px solid var(--focus); outline-offset:2px }
  .btn.primary{ background:linear-gradient(180deg,var(--gold),#caa43f); color:#1a1a1a; border:1px solid var(--gold-2) }
  .btn.primary:hover { transform: translateY(-2px); box-shadow: var(--pulse) }
  .btn.ghost{ background:transparent; color:var(--gold); border:1px solid var(--gold-2) }
  .btn.ghost:hover { background:rgba(166,135,32,.1) }
  .btn.disabled, .btn[aria-disabled="true"]{ opacity:.55; cursor:not-allowed; pointer-events:none; filter:grayscale(30%) }

  .pill{ padding:8px 14px; border-radius:999px; background:#0f0f13; border:1px solid var(--stroke);
    color:var(--muted); font-size:14px; display:inline-flex; align-items:center; gap:6px }
  .pill.active{ border-color:var(--gold); color:var(--gold) }

  .grid3{ display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-top:24px }
  .kpi{ padding:18px; border:1px solid var(--stroke); border-radius:14px;
    background:linear-gradient(180deg,#15151a,#101014); text-align:center; transition: transform .3s ease; }
  .kpi:hover { transform: translateY(-3px) }
  .kpi h3{ margin:6px 0 4px; font-size:22px; color:var(--gold) }
  .kpi span{ color:var(--muted); font-size:13px }

  .progress{ margin-top:18px; height:12px; background:#101015; border:1px solid var(--stroke); border-radius:999px; overflow:hidden }
  .bar{ height:100%; background:linear-gradient(90deg,#f7e08a,#e6c15a,#caa43f); transition: width .5s ease }

  .section{ margin-top:36px }
  .list{ display:grid; gap:12px }
  .list .row{ display:flex; gap:12px; align-items:flex-start }
  .dot{ width:10px; height:10px; border-radius:50%; background:var(--gold); margin-top:7px; flex:0 0 10px }

  .faq{ display:grid; gap:12px; margin-top:16px }
  .q{ padding:16px; border:1px solid var(--stroke); border-radius:12px; background:#111115; transition: transform .2s ease }
  .q:hover { transform: translateX(3px) }
  .q b{ color:var(--text) }

  .foot{ margin:40px 0 14px; text-align:center; color:#808087; font-size:13px; line-height:1.6 }

  .pulse { animation:pulse 2s infinite }
  @keyframes pulse { 0%{box-shadow:0 0 0 0 rgba(230,193,90,.4)} 70%{box-shadow:0 0 0 10px rgba(230,193,90,0)} 100%{box-shadow:0 0 0 0 rgba(230,193,90,0)} }

  .verify{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:999px; border:1px solid var(--stroke);
    background:#0f0f13; color:var(--muted); font-size:13px;
  }
  .verify svg{ flex:0 0 16px }
  .verify.ok{ border-color: rgba(61,220,151,.35); color:#bff8e3 }
  .verify.warn{ border-color: rgba(255,107,107,.35); color:#ffd6d6 }

  @media (prefers-reduced-motion: reduce){
    *{ animation:none !important; transition:none !important; scroll-behavior:auto !important }
  }
  @media (max-width:960px){
    .hero{grid-template-columns:1fr}
    .grid3{grid-template-columns:1fr 1fr}
    .kpi h3{font-size:20px}
  }
  @media (max-width:600px){
    .grid3{grid-template-columns:1fr}
    .wrap{padding:18px}
    .card{padding:20px}
    .cta{gap:10px}
  }
</style>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Product",
  "name":"SÃ³lCoin Founders Circle â€” Phase 1",
  "description":"Claim 1 SÃ³lCoin for 0.05 BNB or 100 KLY. 100 wallets max. Includes lifetime perks and Founders NFT.",
  "offers":{
    "@type":"Offer",
    "price":"0.05",
    "priceCurrency":"BNB",
    "availability":"https://schema.org/InStock",
    "url":"https://thirdweb.com/binance/0x7a732Ae6b2Db2ceACc3Ffe6F63F3B9B0Ce94A026/claim"
  }
}
</script>
</head>
<body>
  <div class="wrap">
    <!-- HERO -->
    <div class="hero">
      <div class="card" aria-labelledby="title">
        <span class="badge">ðŸ”‘ SÃ³lCoin Founders Circle â€” Phase 1</span>
        <h1 id="title">Secure your spot â€¢ <span style="color:var(--gold)">100 KLY</span> â€¢ Only 100 wallets</h1>
        <p>Founders get lifetime perks: staking boost, private academy access, and the first wave of SÃ³lCoin utility. Price is locked for this phase only.</p>

        <!-- Mode Switcher -->
        <div id="modeSwitcher" style="margin-top:14px; display:flex; gap:8px">
          <span id="tabThirdweb" class="pill active" role="button" tabindex="0" style="cursor:pointer">ðŸ”¶ Thirdweb (BNB)</span>
          <span id="tabFounders" class="pill" role="button" tabindex="0" style="cursor:pointer">ðŸŸ¡ Founders Launch (KLY)</span>
          <span class="pill" title="Current KLY reference price (manual)">$KLY â‰ˆ <b>$0.000111</b></span>
        </div>

        <!-- CTA Row -->
        <div class="cta" id="ctaRow">
          <!-- Thirdweb (BNB) -->
          <a class="btn primary pulse disabled" id="claimBtn"
             href="https://thirdweb.com/binance/0x7a732Ae6b2Db2ceACc3Ffe6F63F3B9B0Ce94A026/claim"
             target="_blank" rel="noopener noreferrer" aria-disabled="true">
            Claim on Thirdweb
          </a>

          <!-- Founders Launch (KLY) -->
          <a class="btn ghost disabled" id="foundersBtn" href="/launchpad.html" aria-disabled="true">
            Founders Launch (Pay 100 KLY)
          </a>

          <button class="btn ghost" id="copyBtn" type="button">Copy Claim Link</button>
          <span class="pill" id="countdown" aria-live="polite" aria-atomic="true">Ends soonâ€¦</span>

          <!-- Verification badges -->
          <span id="verifyBadge" class="verify" title="Thirdweb verification for BNB route">
            <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="8" fill="#b6b6b8"/></svg>
            <span class="small">Verifyingâ€¦</span>
          </span>

          <!-- KLY balance badge for Founders route -->
          <span id="klyBadge" class="verify" title="KLY balance check for Founders route">
            <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="8" fill="#b6b6b8"/></svg>
            <span class="small">KLY: not checked</span>
          </span>

          <!-- Connect button for KLY route -->
          <button class="btn ghost" id="connectKlyBtn" type="button">Connect Wallet</button>
        </div>

        <!-- DEX: Swap / Liquidity -->
        <div id="dexRow" class="cta" style="gap:10px; margin-top:10px">
          <a id="swapKlyBtn" class="btn ghost" href="#" target="_blank" rel="noopener">Swap KLY on PancakeSwap</a>
          <a id="addLiqBtn" class="btn ghost" href="#" target="_blank" rel="noopener">Add KLY/BNB Liquidity</a>
          <span class="pill">DEX Route (BNB â†” KLY)</span>
        </div>

        <div class="grid3" role="status" aria-live="polite" aria-atomic="true">
          <div class="kpi"><h3>100 KLY</h3><span>Cost per wallet (Founders)</span></div>
          <div class="kpi"><h3 id="tokensPerWallet">1 SÃ³lCoin</h3><span>Tokens per wallet</span></div>
          <div class="kpi"><h3 id="spotsLeft">100</h3><span>Spots remaining</span></div>
        </div>

        <div class="progress" title="Spots filled"><div class="bar" id="fillBar" style="width:0%"></div></div>
        <p style="margin-top:8px">Spots filled: <b id="filledText">0</b>/100 â€¢ Live while supplies last.</p>
      </div>

      <div class="card">
        <h2 style="margin:4px 0 12px;font-size:22px">Founders Perks</h2>
        <div class="list">
          <div class="row"><div class="dot"></div><div><b>Lifetime staking boost</b><br><span style="color:var(--muted);font-size:14px">Higher yields in SÃ³lCoin staking rewards</span></div></div>
          <div class="row"><div class="dot"></div><div><b>Private Academy access</b><br><span style="color:var(--muted);font-size:14px">Premium modules for holders</span></div></div>
          <div class="row"><div class="dot"></div><div><b>Priority mints</b> + early drops<br><span style="color:var(--muted);font-size:14px">First access to SÃ³lCoin ecosystem projects</span></div></div>
          <div class="row"><div class="dot"></div><div><b>OG role</b> in Discord<br><span style="color:var(--muted);font-size:14px">Gated channels & founder AMAs</span></div></div>
          <div class="row"><div class="dot"></div><div><b>Exclusive Founders NFT</b><br><span style="color:var(--muted);font-size:14px">Digital collectible proving your status</span></div></div>
        </div>

        <div class="section">
          <h2 style="margin:0 0 12px;font-size:22px">How it works</h2>
          <div class="list">
            <div class="row"><div class="dot"></div><div>Option A: <b>Claim on Thirdweb (BNB)</b> â€” connect wallet, select <b>1 token</b>, pay in BNB</div></div>
            <div class="row"><div class="dot"></div><div>Option B: <b>Founders Launch (KLY)</b> â€” connect wallet here, ensure you have <b>â‰¥100 KLY</b>, continue to Founders page</div></div>
            <div class="row"><div class="dot"></div><div>Or use <b>DEX Route</b> â€” swap KLY on PancakeSwap or add KLY/BNB liquidity</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- FAQ -->
    <div class="section">
      <div class="card">
        <h2 style="margin:0 0 12px;font-size:22px">FAQ</h2>
        <div class="faq">
          <div class="q"><b>What blockchain is this on?</b><br><span style="color:var(--muted);font-size:14px">BNB Smart Chain (BEP-20). Make sure your wallet is connected to BNB network.</span></div>
          <div class="q"><b>How many wallets in Phase 1?</b><br><span style="color:var(--muted);font-size:14px">100 maximum. Each wallet can claim exactly 1 SÃ³lCoin.</span></div>
          <div class="q"><b>Where does the purchase happen?</b><br><span style="color:var(--muted);font-size:14px">Either on Thirdweb (BNB) or via Founders Launch (KLY). You may also use PancakeSwap for KLY liquidity.</span></div>
          <div class="q"><b>When do benefits unlock?</b><br><span style="color:var(--muted);font-size:14px">Immediately after claiming; the Founders NFT airdrops within 7 days.</span></div>
        </div>
      </div>
    </div>

    <p class="foot">
      Never trust DMs. We will never ask for your seed phrase.<br>
      Always verify contract addresses before connecting your wallet.<br>
      Â© SÃ³lCoin Legacy â€¢ Not financial advice
    </p>
  </div>

<!-- ethers UMD -->
<script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js" crossorigin="anonymous"></script>
<script>
  // ================= CONFIG =================
  const TOTAL_SPOTS = 100;
  const TOKENS_PER_WALLET = 1;
  const CLAIM_URL = "https://thirdweb.com/binance/0x7a732Ae6b2Db2ceACc3Ffe6F63F3B9B0Ce94A026/claim";

  // Thirdweb ERC20Drop contract (BNB route)
  const CONTRACT_ADDRESS = "0x7a732Ae6b2Db2ceACc3Ffe6F63F3B9B0Ce94A026";
  const RPC_URL = "https://bsc-dataseed.binance.org/";
  const CHAIN_ID = 56;

  // KLY token (KLY route)
  const KLY_ADDRESS = "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52";
  const KLY_REQUIRED = "100";

  // PancakeSwap quick links (DEX route)
  const PANCAKE_SWAP_URL = `https://pancakeswap.finance/swap?inputCurrency=BNB&outputCurrency=${KLY_ADDRESS}`;
  const PANCAKE_ADD_LIQ_URL = `https://pancakeswap.finance/add/BNB/${KLY_ADDRESS}`;
  // After you create the pool, you can add:
  // const PAIR_URL = "https://pancakeswap.finance/info/pairs/<PAIR_ADDRESS>";

  // ABIs
  const ERC20_DROP_ABI = [
    "function getActiveClaimConditionId() view returns (uint256)",
    "function getClaimConditionById(uint256) view returns (tuple(uint256 startTimestamp,uint256 maxClaimableSupply,uint256 supplyClaimed,uint256 quantityLimitPerTransaction,bytes32 merkleRoot,uint256 pricePerToken,address currency))",
    "function decimals() view returns (uint8)"
  ];
  const ERC20_ABI_MIN = [
    "function balanceOf(address) view returns (uint256)",
    "function decimals() view returns (uint8)"
  ];
  // ==========================================

  // DOM
  const spotsLeftEl = document.getElementById('spotsLeft');
  const filledText  = document.getElementById('filledText');
  const bar         = document.getElementById('fillBar');
  const claimBtn    = document.getElementById('claimBtn');
  const countdownEl = document.getElementById('countdown');
  const tokensPerWalletEl = document.getElementById('tokensPerWallet');

  const verifyBadge = document.getElementById('verifyBadge');

  const tabThirdweb = document.getElementById('tabThirdweb');
  const tabFounders = document.getElementById('tabFounders');
  const foundersBtn = document.getElementById('foundersBtn');
  const klyBadge    = document.getElementById('klyBadge');
  const connectKlyBtn = document.getElementById('connectKlyBtn');

  const swapKlyBtn = document.getElementById('swapKlyBtn');
  const addLiqBtn  = document.getElementById('addLiqBtn');

  // Attach DEX links
  swapKlyBtn.href = PANCAKE_SWAP_URL;
  addLiqBtn.href  = PANCAKE_ADD_LIQ_URL;

  // Mode switch
  let currentMode = 'thirdweb';
  function setActiveTab(mode){
    currentMode = mode;
    tabThirdweb.classList.toggle('active', mode==='thirdweb');
    tabFounders.classList.toggle('active', mode==='founders');

    // button emphasis
    if (mode==='thirdweb'){
      claimBtn.classList.add('primary','pulse'); claimBtn.classList.remove('ghost');
      foundersBtn.classList.add('ghost'); foundersBtn.classList.remove('primary','pulse');
      verifyBadge.style.opacity = '1';
      klyBadge.style.opacity = '.45';
    } else {
      foundersBtn.classList.add('primary','pulse'); foundersBtn.classList.remove('ghost');
      claimBtn.classList.add('ghost'); claimBtn.classList.remove('primary','pulse');
      verifyBadge.style.opacity = '.45';
      klyBadge.style.opacity = '1';
    }
  }
  tabThirdweb.addEventListener('click', ()=>setActiveTab('thirdweb'));
  tabFounders.addEventListener('click', ()=>setActiveTab('founders'));
  tabThirdweb.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') setActiveTab('thirdweb') });
  tabFounders.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') setActiveTab('founders') });
  setActiveTab('thirdweb');

  // Claim link + guard until verified
  let verified = false;
  claimBtn.addEventListener('click', (e) => {
    if (!verified){
      e.preventDefault();
      alert("Hold on â€” verifying the contract and network before opening the claim page.");
    }
  });
  claimBtn.href = CLAIM_URL;

  // Verify Thirdweb (BNB route)
  function setVerifyState(state, msg){
    verifyBadge.classList.remove('ok','warn');
    if (state === 'ok'){
      verifyBadge.classList.add('ok');
      verifyBadge.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#103b33" stroke="#3ddc97" stroke-width="2"/><path d="M8.5 12.5l2.5 2.5 4.5-5" fill="none" stroke="#3ddc97" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span class="small">${msg || "Verified on BNB â€¢ Address matches"}</span>`;
    } else if (state === 'warn'){
      verifyBadge.classList.add('warn');
      verifyBadge.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#3b0f0f" stroke="#ff6b6b" stroke-width="2"/><path d="M12 7v6M12 16.5v.5" stroke="#ff6b6b" stroke-width="2" stroke-linecap="round"/></svg>
        <span class="small">${msg || "Verification failed"}</span>`;
    } else {
      verifyBadge.classList.remove('ok','warn');
      verifyBadge.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" fill="#b6b6b8"/></svg>
        <span class="small">${msg || "Verifyingâ€¦"}</span>`;
    }
  }
  function enableClaim(){ verified = true; claimBtn.classList.remove('disabled'); claimBtn.setAttribute('aria-disabled','false'); }
  function disableClaim(){ verified = false; claimBtn.classList.add('disabled'); claimBtn.setAttribute('aria-disabled','true'); }

  async function verifyEverything(){
    try{
      setVerifyState('loading','Verifyingâ€¦'); disableClaim();
      const u = new URL(CLAIM_URL);
      const parts = u.pathname.split('/').filter(Boolean);
      if (parts[0] !== 'binance') throw new Error('Expected Thirdweb network slug "binance"');
      const urlAddress = (parts[1] || '').toLowerCase();
      if (!urlAddress || urlAddress !== CONTRACT_ADDRESS.toLowerCase()) throw new Error('Thirdweb URL contract address mismatch');

      const provider = new ethers.providers.JsonRpcProvider(RPC_URL, { name:'bnb', chainId: CHAIN_ID });
      const net = await provider.getNetwork();
      if (net.chainId !== CHAIN_ID) throw new Error(`Unexpected chain id ${net.chainId}`);
      const code = await provider.getCode(CONTRACT_ADDRESS);
      if (!code || code === '0x') throw new Error('No contract code found');

      // Probe interface
      const c = new ethers.Contract(CONTRACT_ADDRESS, ERC20_DROP_ABI, provider);
      await Promise.all([
        c.getActiveClaimConditionId().then(()=>true).catch(()=>true),
        c.decimals().then(()=>true).catch(()=>true)
      ]);

      setVerifyState('ok','Verified on BNB â€¢ Address matches');
      enableClaim();
    } catch(err){
      console.error('Verify failed:', err);
      setVerifyState('warn', err?.message || 'Verification failed');
      disableClaim();
    }
  }

  // Spots / countdown (same as before, trimmed)
  let spotsClaimed = 0; let tokenDecimals = 18;
  function renderSpots(){
    const left = Math.max(0, TOTAL_SPOTS - spotsClaimed);
    const pct  = Math.min(100, (spotsClaimed / TOTAL_SPOTS) * 100);
    spotsLeftEl.textContent = left.toString();
    filledText.textContent  = spotsClaimed.toString();
    bar.style.width = pct + "%";
  }
  async function fetchLivePhase(){
    try {
      const provider = new ethers.providers.JsonRpcProvider(RPC_URL, { name:'bnb', chainId: CHAIN_ID });
      const c = new ethers.Contract(CONTRACT_ADDRESS, ERC20_DROP_ABI, provider);
      try { tokenDecimals = await c.decimals(); } catch(_){}
      const id   = await c.getActiveClaimConditionId();
      const cond = await c.getClaimConditionById(id);
      const claimedHuman  = Number(ethers.utils.formatUnits(cond.supplyClaimed, tokenDecimals));
      const walletsClaimed = Math.floor(claimedHuman / TOKENS_PER_WALLET);
      spotsClaimed = Math.max(0, Math.min(TOTAL_SPOTS, walletsClaimed));
      renderSpots();
    } catch(e){ console.warn(e); }
  }
  function tick(){ countdownEl.textContent = "â³ Closing soon"; }

  // Copy link
  document.getElementById('copyBtn').addEventListener('click', async () => {
    const btn = document.getElementById('copyBtn');
    try {
      await navigator.clipboard.writeText(CLAIM_URL);
      btn.innerHTML = `âœ… Copied!`;
    } catch(e){
      window.prompt("Copy the claim link:", CLAIM_URL);
    } finally {
      setTimeout(()=>{ btn.innerHTML = `Copy Claim Link`; }, 1800);
    }
  });

  // ======== KLY route: connect + balance check ========
  let injectedProvider = null, web3Provider = null, userAddress = null;

  function setKlyBadge(state, msg){
    klyBadge.classList.remove('ok','warn');
    if (state==='ok'){
      klyBadge.classList.add('ok');
      klyBadge.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#103b33" stroke="#3ddc97" stroke-width="2"/></svg>
        <span class="small">${msg || "KLY ready"}</span>`;
    } else if (state==='warn'){
      klyBadge.classList.add('warn');
      klyBadge.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#3b0f0f" stroke="#ff6b6b" stroke-width="2"/></svg>
        <span class="small">${msg || "Not enough KLY"}</span>`;
    } else {
      klyBadge.classList.remove('ok','warn');
      klyBadge.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" fill="#b6b6b8"/></svg>
        <span class="small">${msg || "KLY: not checked"}</span>`;
    }
  }

  function enableFounders(){ foundersBtn.classList.remove('disabled'); foundersBtn.setAttribute('aria-disabled','false'); }
  function disableFounders(){ foundersBtn.classList.add('disabled'); foundersBtn.setAttribute('aria-disabled','true'); }

  async function connectWalletForKLY(){
    try{
      setKlyBadge('loading','Connectingâ€¦');
      if (!window.ethereum){ setKlyBadge('warn','No wallet'); alert('Open in MetaMask/Trust Wallet'); return; }
      injectedProvider = window.ethereum;
      await injectedProvider.request({ method:'eth_requestAccounts' });
      web3Provider = new ethers.providers.Web3Provider(injectedProvider, 'any');
      userAddress  = await web3Provider.getSigner().getAddress();
      await checkKlyBalance();
    }catch(e){ console.error(e); setKlyBadge('warn','Connect failed'); }
  }

  async function checkKlyBalance(){
    try{
      setKlyBadge('loading','Checking KLYâ€¦');
      const kly = new ethers.Contract(KLY_ADDRESS, ERC20_ABI_MIN, web3Provider);
      let dec = 18; try { dec = await kly.decimals(); } catch(_){}
      const raw = await kly.balanceOf(userAddress);
      const need = ethers.utils.parseUnits(KLY_REQUIRED, dec);
      const human = Number(ethers.utils.formatUnits(raw, dec));
      if (raw.gte(need)){ setKlyBadge('ok', `KLY OK â€¢ ${human.toFixed(2)}`); enableFounders(); }
      else { setKlyBadge('warn', `Need ${KLY_REQUIRED} KLY â€¢ You have ${human.toFixed(2)}`); disableFounders(); }
    }catch(e){ console.error(e); setKlyBadge('warn','Balance failed'); disableFounders(); }
  }

  connectKlyBtn.addEventListener('click', connectWalletForKLY);
  foundersBtn.addEventListener('click', (e) => {
    if (currentMode!=='founders') return;
    if (foundersBtn.getAttribute('aria-disabled')==='true'){
      e.preventDefault();
      alert(`You need at least ${KLY_REQUIRED} KLY to join the Founders Launch.`);
    }
  });
  if (window.ethereum?.selectedAddress){ connectWalletForKLY(); }

  // ======== Init ========
  tokensPerWalletEl.textContent = `${TOKENS_PER_WALLET} SÃ³lCoin`;
  renderSpots(); fetchLivePhase(); tick(); verifyEverything();
</script>
</body>
</html>
