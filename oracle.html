<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Oracle Scrolls — AURORA VAULT</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800;900&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#07080b; --ink:#efe9dd; --muted:#bfb7a3;
    --gold1:#fdeab3; --gold2:#e7c874; --gold3:#b68836; --gold4:#6a4a16;
    --glow:#a9e0ff; --emerald:#79eeb5; --glass:rgba(255,255,255,.06); --brd:rgba(231,200,116,.22);
    --ring: rgba(231,200,116,.45);
    --r:18px; --w:1200px;
    --success: rgba(121,238,178,.46);
    --warning: rgba(238,190,121,.46);
    --error: rgba(238,121,121,.46);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; overflow-x:hidden;
  }

  /* ===== BACKGROUND AURORA SHADER + GRAIN ===== */
  #aurora, #grain { position:fixed; inset:0; z-index:-3; display:block }
  #grain{ pointer-events:none; mix-blend-mode:overlay; opacity:.35; background-image:
    radial-gradient(1px 1px at 15% 20%, rgba(255,255,255,.06) 0, transparent 45%),
    radial-gradient(1px 1px at 70% 60%, rgba(255,255,255,.04) 0, transparent 50%); }
  .vignette{ position:fixed; inset:0; z-index:-2; pointer-events:none; box-shadow:inset 0 0 280px 90px #000; }
  .topglow{ position:fixed; left:50%; top:-8%; width:1600px; height:700px; transform:translateX(-50%);
    background:radial-gradient(50% 50% at 50% 50%, rgba(169,224,255,.18), transparent 70%); filter:blur(10px); opacity:.35; z-index:-2; }

  /* ===== NAV ===== */
  .nav{
    position:sticky; top:0; z-index:20; display:flex; align-items:center; justify-content:space-between; gap:16px;
    padding:12px 22px; background:rgba(10,11,13,.38); backdrop-filter:blur(12px) saturate(140%);
    border-bottom:1px solid var(--brd); transition: all 0.3s ease;
  }
  .nav.scrolled {
    background: rgba(10,11,13,.85);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  }
  .brand{display:flex; align-items:center; gap:.75rem}
  .mark{width:32px; height:32px; filter:drop-shadow(0 0 12px rgba(231,200,116,.28)); transition: transform 0.3s ease;}
  .brand:hover .mark { transform: rotate(15deg); }
  .brand__text{font-family:Cinzel,serif; font-weight:900; letter-spacing:.14em; text-transform:uppercase; color:#f5ead4; font-size:.98rem}
  .nav__links{display:flex; gap:18px}
  .nav__link{color:#e1d7c2; text-decoration:none; opacity:.9; position: relative; padding: 8px 0; transition: all 0.2s ease;}
  .nav__link:hover{opacity:1; color: var(--gold2);}
  .nav__link::after {
    content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 1px;
    background: var(--gold2); transition: width 0.3s ease;
  }
  .nav__link:hover::after { width: 100%; }
  .btn{
    padding:12px 18px; border-radius:999px; border:1px solid var(--brd); background:rgba(255,255,255,.04); color:#f7f3e8; font-weight:700; letter-spacing:.02em; cursor:pointer;
    transition:transform .15s ease, box-shadow .2s ease, background .2s ease; outline:none; position: relative; overflow: hidden;
  }
  .btn:focus-visible{box-shadow:0 0 0 4px var(--ring)}
  .btn:hover{transform:translateY(-1px)}
  .btn--gold{position:relative; background:linear-gradient(180deg,var(--gold1),var(--gold2)); border-color:rgba(0,0,0,.12); color:#1b1206; text-shadow:0 1px 0 rgba(255,255,255,.35)}
  .btn--gold::after{
    content:""; position:absolute; inset:0; background:linear-gradient(120deg, transparent 10%, rgba(255,255,255,.6) 45%, transparent 65%);
    transform:skewX(-20deg) translateX(-120%); mix-blend-mode:screen; opacity:.35; animation:shine 2.8s ease-in-out infinite;
  }
  @keyframes shine{ 60%{transform:skewX(-20deg) translateX(120%)} 100%{transform:skewX(-20deg) translateX(120%)} }
  
  /* Loading spinner */
  .spinner {
    display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,.3);
    border-radius: 50%; border-top-color: var(--gold2); animation: spin 1s ease-in-out infinite;
    margin-right: 8px; vertical-align: middle;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* ===== HERO ===== */
  .wrap{width:min(var(--w),92%); margin:0 auto}
  .hero{position:relative; padding: clamp(36px,6vw,72px) 0 10px; text-align:center}
  .halo{position:absolute; inset:-20px 0 auto; height:280px; pointer-events:none; background:
      radial-gradient(60% 60% at 50% 40%, rgba(231,200,116,.22), transparent 70%); filter:blur(8px); opacity:.6}
  .sigils{position:absolute; inset:0; pointer-events:none}
  .sigil{position:absolute; width:120px; height:120px; opacity:.2; filter:drop-shadow(0 0 12px rgba(231,200,116,.2)); transition: all 0.5s ease;}
  .sigil--l{left:4%; top:18%; transform:rotate(-8deg)}
  .sigil--r{right:6%; top:34%; transform:rotate(12deg)}
  .display{
    font-family:Cinzel,serif; font-weight:900; letter-spacing:.14em; text-transform:uppercase;
    font-size: clamp(30px,7vw,68px); margin:0 0 14px; line-height:1.05;
    background: linear-gradient(90deg, var(--gold4), var(--gold3), var(--gold2), var(--gold1), var(--gold2), var(--gold3));
    background-size: 220% auto; color:transparent; -webkit-background-clip:text; background-clip:text; animation:foil 9s linear infinite;
    text-shadow:0 0 24px rgba(231,200,116,.12);
  }
  @keyframes foil{0%{background-position:0% 50%}100%{background-position:200% 50%}}
  .sub{color:#e6ddc8; font-size:clamp(14px,2.4vw,18px); margin:0 0 18px}
  .hero__cta{display:flex; justify-content:center; gap:12px; flex-wrap:wrap}

  /* ===== ACCESS BANNER (glass) ===== */
  .access{
    margin:18px auto 10px; padding:14px 16px; width:min(var(--w),92%);
    display:grid; grid-template-columns:auto 1fr auto; gap:14px; align-items:center;
    border-radius:var(--r); border:1px solid var(--brd);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    backdrop-filter: blur(10px) saturate(130%);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 18px 60px rgba(0,0,0,.32);
    transition: all 0.3s ease;
  }
  .access__icon{font-size:20px; transition: transform 0.3s ease;}
  .access__text{font-weight:800}
  .access__meta{color:var(--muted); font-size:.96rem}
  .badge{display:inline-block; padding:.26rem .6rem; border-radius:999px; border:1px solid var(--brd); background:linear-gradient(180deg, rgba(231,200,116,.18), rgba(182,136,54,.08)); color:#f0e6d3}
  .access--ok{border-color: var(--success); animation: pulse 2s infinite;}
  .access--warn{border-color: var(--warning)}
  .access--error{border-color: var(--error)}
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(121,238,178,0.4); }
    70% { box-shadow: 0 0 0 10px rgba(121,238,178,0); }
    100% { box-shadow: 0 0 0 0 rgba(121,238,178,0); }
  }

  /* ===== GRID ===== */
  .main{width:min(var(--w),92%); margin:26px auto 90px}
  .rule{display:flex; align-items:center; gap:14px; color:#d6cfbf; margin:10px 0 18px;
    font-family:Cinzel,serif; letter-spacing:.14em; text-transform:uppercase; font-size:.98rem}
  .rule::before,.rule::after{content:""; height:1px; flex:1; background:linear-gradient(90deg, transparent, rgba(231,200,116,.38), transparent)}
  .grid{display:grid; grid-template-columns: repeat(12,1fr); gap:18px}
  .col-7{grid-column: span 7}
  .col-5{grid-column: span 5}
  @media (max-width:980px){ .col-7,.col-5{grid-column:1/-1} }

  /* ===== SCROLL CARD (glass + foil edge + depth) ===== */
  .card{
    position:relative; border-radius:22px; overflow:hidden;
    border:1px solid var(--brd); background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    backdrop-filter: blur(8px) saturate(130%);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.1), 0 22px 80px rgba(0,0,0,.45);
    transform-style:preserve-3d; perspective:1000px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .card::before{ /* animated border glow */
    content:""; position:absolute; inset:-2px; pointer-events:none; border-radius:22px;
    background: conic-gradient(from 0deg, rgba(231,200,116,.0), rgba(231,200,116,.22), rgba(231,200,116,.0) 30%);
    filter: blur(16px); opacity:.35; animation:ring 12s linear infinite;
  }
  @keyframes ring{to{transform:rotate(360deg)}}
  .card__in{padding:22px 18px}
  .pills{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px}
  .pill{font-size:.8rem; padding:.3rem .68rem; border-radius:999px; border:1px solid var(--brd); background:rgba(231,200,116,.1)}
  .pill--rare{background:linear-gradient(180deg, rgba(231,200,116,.24), rgba(182,136,54,.08)); color:#1a1208; border-color:rgba(0,0,0,.18)}
  .title{font-family:Cinzel,serif; font-weight:800; font-size:clamp(18px,3.6vw,28px); letter-spacing:.02em; margin:4px 0 8px}
  .tease{color:#eadfc8; margin:0 0 10px}
  .meta{display:flex; gap:14px; color:#c7bfae; font-size:.95rem}
  .lock{display:flex; align-items:center; gap:8px; margin:12px 0 14px; color:#f2e6cd}
  .actions{display:flex; gap:10px; flex-wrap:wrap}
  .callout{margin-top:12px; border-radius:16px; border:1px dashed var(--brd); padding:14px; color:#efe2c8; background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03)); display:none}
  
  /* Card hover effects */
  .card[data-tilt="1"]:hover{
    transform:translateY(-6px) rotateX(2deg);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.1), 0 30px 100px rgba(0,0,0,.6);
  }
  .card[data-tilt="1"]{transition: transform .15s ease}

  /* Scroll content reveal */
  .scroll-content {
    max-height: 0; overflow: hidden; transition: max-height 0.5s ease;
    background: rgba(0,0,0,0.2); border-radius: 12px; margin-top: 16px;
  }
  .scroll-content.revealed {
    max-height: 500px; padding: 20px;
  }
  .scroll-content p { margin: 0 0 16px; line-height: 1.6; }
  .scroll-content p:last-child { margin-bottom: 0; }

  /* ===== FOOTER ===== */
  .footer{display:flex; justify-content:center; align-items:center; gap:.7rem; padding:40px 12px 64px; color:#d2c9b4; border-top:1px solid var(--brd)}

  /* ===== MODAL ===== */
  .modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(7,8,11,0.9); backdrop-filter: blur(8px);
    display: flex; align-items: center; justify-content: center;
    z-index: 100; opacity: 0; visibility: hidden; transition: all 0.3s ease;
  }
  .modal.active {
    opacity: 1; visibility: visible;
  }
  .modal-content {
    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    border: 1px solid var(--brd); border-radius: var(--r);
    padding: 30px; max-width: 500px; width: 90%;
    backdrop-filter: blur(12px) saturate(130%);
    box-shadow: 0 20px 80px rgba(0,0,0,0.5);
    transform: translateY(20px); transition: transform 0.3s ease;
  }
  .modal.active .modal-content {
    transform: translateY(0);
  }
  .modal-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 20px; border-bottom: 1px solid var(--brd); padding-bottom: 15px;
  }
  .modal-title {
    font-family: Cinzel, serif; font-weight: 800; font-size: 1.5rem;
    margin: 0;
  }
  .modal-close {
    background: none; border: none; color: var(--muted); font-size: 1.5rem;
    cursor: pointer; transition: color 0.2s ease;
  }
  .modal-close:hover { color: var(--ink); }

  /* ===== MOBILE ===== */
  @media (max-width:780px){
    .nav__links{display:none}
    .access{grid-template-columns:24px 1fr; gap:10px}
    .access__meta{grid-column:1 / -1}
    .modal-content { padding: 20px; }
  }

  /* Mobile menu */
  .mobile-menu-btn {
    display: none; background: none; border: none; color: var(--ink);
    font-size: 1.5rem; cursor: pointer; padding: 5px;
  }
  @media (max-width: 780px) {
    .mobile-menu-btn { display: block; }
    .nav__links {
      position: absolute; top: 100%; left: 0; width: 100%;
      background: rgba(10,11,13,.95); backdrop-filter: blur(12px);
      flex-direction: column; padding: 20px; display: none;
      border-bottom: 1px solid var(--brd);
    }
    .nav__links.active { display: flex; }
    .nav__link { padding: 12px 0; }
  }
</style>
</head>
<body>
<canvas id="aurora" aria-hidden="true"></canvas>
<div id="grain" aria-hidden="true"></div>
<div class="vignette" aria-hidden="true"></div>
<div class="topglow" aria-hidden="true"></div>

<header class="nav">
  <div class="brand">
    <!-- Gold seal -->
    <svg class="mark" viewBox="0 0 64 64" aria-hidden="true">
      <defs><radialGradient id="mk" cx="50%" cy="50%" r="60%">
        <stop offset="0%" stop-color="#fdeab3"/><stop offset="55%" stop-color="#e7c874"/><stop offset="100%" stop-color="#6a4a16"/></radialGradient></defs>
      <circle cx="32" cy="32" r="30" fill="url(#mk)" stroke="#000" stroke-opacity=".22" stroke-width="1.5"/>
      <g fill="#1d1408" fill-opacity=".5" transform="translate(32,32)">
        <circle r="2.2" cx="0" cy="-20"/><circle r="2.2" cx="17.3" cy="-10"/><circle r="2.2" cx="20" cy="0"/>
        <circle r="2.2" cx="17.3" cy="10"/><circle r="2.2" cx="0" cy="20"/><circle r="2.2" cx="-17.3" cy="10"/>
        <circle r="2.2" cx="-20" cy="0"/><circle r="2.2" cx="-17.3" cy="-10"/>
      </g>
    </svg>
    <span class="brand__text">Oracle • Scrolls</span>
  </div>
  <button class="mobile-menu-btn" aria-label="Toggle menu">☰</button>
  <nav class="nav__links" aria-label="Primary">
    <a class="nav__link" href="#">Oracle</a>
    <a class="nav__link" href="#">Scrolls</a>
    <a class="nav__link" href="#">Vault</a>
    <a class="nav__link" href="#">Academy</a>
  </nav>
  <div class="nav__cta">
    <button id="walletBtn" class="btn">Connect Wallet</button>
  </div>
</header>

<section class="hero wrap">
  <div class="halo" aria-hidden="true"></div>
  <div class="sigils" aria-hidden="true">
    <svg class="sigil sigil--l" viewBox="0 0 256 256">
      <circle cx="128" cy="128" r="118" fill="none" stroke="#e7c874" stroke-opacity=".35" stroke-width="2"/>
      <g stroke="#e7c874" stroke-opacity=".9" stroke-width="3" fill="none" transform="translate(128,128)">
        <polygon points="0,-60 52,30 -52,30"/>
        <circle r="42"/>
      </g>
    </svg>
    <svg class="sigil sigil--r" viewBox="0 0 256 256">
      <circle cx="128" cy="128" r="118" fill="none" stroke="#a9e0ff" stroke-opacity=".35" stroke-width="2"/>
      <g stroke="#a9e0ff" stroke-opacity=".9" stroke-width="3" fill="none" transform="translate(128,128)">
        <polygon points="0,-60 52,30 -52,30"/>
        <circle r="42"/>
      </g>
    </svg>
  </div>
  <h1 class="display">Oracle Scrolls</h1>
  <p class="sub">Transmissions for those who answer the call.</p>
  <div class="hero__cta">
    <button id="primaryCta" class="btn btn--gold">Connect Wallet</button>
    <button id="publicCta" class="btn">Browse Public Scrolls</button>
  </div>
</section>

<section id="accessBanner" class="access wrap" role="status" aria-live="polite">
  <div class="access__icon" aria-hidden="true">🔒</div>
  <div class="access__text"><strong>Access Locked.</strong> Connect wallet to check gate status.</div>
  <div class="access__meta">
    Chain: <span class="badge">BNB Smart Chain</span> • Gate: <span class="badge">Diamond Core NFT (ID 3)</span>
  </div>
</section>

<main class="main">
  <div class="rule">Latest Transmission</div>
  <div class="grid">
    <article class="card col-7" data-tilt="1" id="cardPrimary">
      <div class="card__in">
        <div class="pills"><span class="pill pill--rare">Diamond</span><span class="pill">12 min</span><span class="pill">Drop #07</span></div>
        <h3 class="title">Keys of Sovereignty: The Unsealing</h3>
        <p class="tease">Not for the curious—only the called.</p>
        <div class="meta"><span>Updated: 2025-09-18</span><span>Category: Prophecy</span></div>
        <div class="lock"><span aria-hidden="true">🗝️</span><span>Gate required: Diamond Core NFT</span></div>
        <div class="actions">
          <button class="btn btn--gold" disabled aria-disabled="true" id="unsealBtn">Unseal the Scroll</button>
          <button class="btn" id="mintInfoBtn">Learn How to Mint</button>
        </div>
        <div class="scroll-content" id="scrollContent">
          <p>Within the silent chambers of the heart, the keys await. They are not forged of metal, but of intention. Not held in hand, but in consciousness.</p>
          <p>The first key is remembrance—the recognition of your eternal nature beyond the veil of forgetting.</p>
          <p>The second key is sovereignty—the unwavering claim to your divine authority as a creator being.</p>
          <p>The third key is alignment—the harmonious resonance with the cosmic frequencies that guide your path.</p>
          <p>These keys unlock not doors, but dimensions of being. They are the legacy of the Anunna, the star-born architects who seeded this reality.</p>
        </div>
      </div>
    </article>

    <aside class="col-5">
      <article class="card" data-tilt="1">
        <div class="card__in">
          <div class="pills"><span class="pill">Public</span><span class="pill">Audio</span></div>
          <h3 class="title">Invocation • "The Call Within"</h3>
          <p class="tease">A luminous preview to tune your field.</p>
          <div class="actions"><button class="btn" id="audioPreviewBtn">Play Preview</button></div>
        </div>
      </article>
      <article class="card" data-tilt="1" style="margin-top:18px">
        <div class="card__in">
          <div class="pills"><span class="pill">Public</span><span class="pill">Scroll</span></div>
          <h3 class="title">Anunna Archives: Blood of the Builders</h3>
          <p class="tease">Symbols and timelines for the returning ones.</p>
          <div class="actions"><button class="btn" id="publicScrollBtn">Read</button></div>
        </div>
      </article>
    </aside>
  </div>
</main>

<footer class="footer">
  <span>© Tamaquah Nation • KLY • The Call Continues</span>
</footer>

<!-- Modal Structure -->
<div class="modal" id="infoModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Diamond Core NFT</h3>
      <button class="modal-close" aria-label="Close modal">&times;</button>
    </div>
    <p>To access the Diamond-tier scrolls, you need to own the Diamond Core NFT (Token ID: 3).</p>
    <p>This NFT serves as your key to the highest level transmissions within the Oracle Scrolls vault.</p>
    <p>You can mint this NFT directly on the BNB Smart Chain by interacting with the contract.</p>
    <div class="actions" style="margin-top: 20px;">
      <button class="btn btn--gold" id="mintDirectBtn">Mint Diamond Core</button>
      <button class="btn" id="viewContractBtn">View Contract</button>
    </div>
  </div>
</div>

<!-- ===== LIBS ===== -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<script>
/* ===================== AURORA FRAGMENT SHADER ===================== */
const aurora = document.getElementById('aurora');
const gl = aurora.getContext('webgl');
function resizeAurora(){
  const dpr = Math.min(2, window.devicePixelRatio || 1);
  const w = innerWidth * dpr, h = innerHeight * dpr;
  if(aurora.width!==w || aurora.height!==h){ aurora.width=w; aurora.height=h; }
  gl.viewport(0,0,aurora.width, aurora.height);
}
const vert = `
attribute vec2 p; void main(){ gl_Position = vec4(p,0.,1.); }`;
const frag = `
precision highp float;
uniform vec2 r; uniform float t;
float noise(vec2 v){ return fract(sin(dot(v, vec2(127.1,311.7))) * 43758.5453123); }
float fbm(vec2 p){ float v=0.0; float a=0.5; for(int i=0;i<6;i++){ v+=a*noise(p); p*=2.02; a*=0.5; } return v; }
void main(){
  vec2 uv = (gl_FragCoord.xy / r.xy);
  vec2 q = uv * vec2(r.x/r.y,1.);
  float m = fbm(q*2.0 + vec2(t*0.03, -t*0.02));
  float n = fbm(q*3.5 + vec2(-t*0.02, t*0.025));
  float band = smoothstep(.25,.75, m) * smoothstep(.95,.55, n);
  vec3 col = mix(vec3(0.02,0.05,0.1), vec3(0.1,0.4,0.65), band);
  col += vec3(0.15,0.55,0.4) * smoothstep(.6,1., m*n);
  col += vec3(0.9,0.82,0.55) * pow(band, 6.0) * 0.45;
  gl_FragColor = vec4(col, 1.0);
}`;
function shader(gl, vsrc, fsrc){
  function C(t,src){ const s=gl.createShader(t); gl.shaderSource(s,src); gl.compileShader(s); if(!gl.getShaderParameter(s, gl.COMPILE_STATUS)) throw gl.getShaderInfoLog(s); return s;}
  const pr = gl.createProgram(); gl.attachShader(pr, C(gl.VERTEX_SHADER,vsrc)); gl.attachShader(pr, C(gl.FRAGMENT_SHADER,fsrc)); gl.linkProgram(pr);
  if(!gl.getProgramParameter(pr, gl.LINK_STATUS)) throw gl.getProgramInfoLog(pr); return pr;
}
const pr = shader(gl, vert, frag);
const buf = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, buf); gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, 1,1]), gl.STATIC_DRAW);
const locP = gl.getAttribLocation(pr, 'p'); gl.enableVertexAttribArray(locP); gl.vertexAttribPointer(locP, 2, gl.FLOAT, false, 0, 0);
const uR = gl.getUniformLocation(pr, 'r'); const uT = gl.getUniformLocation(pr, 't');
resizeAurora(); window.addEventListener('resize', resizeAurora);
let st = performance.now();
(function loop(){
  gl.useProgram(pr);
  gl.uniform2f(uR, aurora.width, aurora.height);
  gl.uniform1f(uT, (performance.now()-st)/1000.0);
  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
  requestAnimationFrame(loop);
})();
</script>

<script>
/* ===================== ENHANCED INTERACTIVITY ===================== */

// Mobile menu toggle
document.querySelector('.mobile-menu-btn').addEventListener('click', function() {
  document.querySelector('.nav__links').classList.toggle('active');
});

// Nav scroll effect
window.addEventListener('scroll', function() {
  const nav = document.querySelector('.nav');
  if (window.scrollY > 50) {
    nav.classList.add('scrolled');
  } else {
    nav.classList.remove('scrolled');
  }
});

// Modal functionality
const modal = document.getElementById('infoModal');
const modalClose = document.querySelector('.modal-close');

function openModal() {
  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  modal.classList.remove('active');
  document.body.style.overflow = '';
}

modalClose.addEventListener('click', closeModal);
modal.addEventListener('click', function(e) {
  if (e.target === modal) closeModal();
});

// Audio preview simulation
document.getElementById('audioPreviewBtn').addEventListener('click', function() {
  const btn = this;
  const originalText = btn.textContent;
  btn.innerHTML = '<span class="spinner"></span>Loading...';
  
  setTimeout(() => {
    btn.textContent = 'Playing...';
    // In a real implementation, you would play audio here
    setTimeout(() => {
      btn.textContent = originalText;
    }, 3000);
  }, 1000);
});

// Public scroll simulation
document.getElementById('publicScrollBtn').addEventListener('click', function() {
  const btn = this;
  const originalText = btn.textContent;
  btn.innerHTML = '<span class="spinner"></span>Opening...';
  
  setTimeout(() => {
    btn.textContent = 'Opened';
    // In a real implementation, you would show the scroll content here
    setTimeout(() => {
      btn.textContent = originalText;
    }, 2000);
  }, 1000);
});

/* ===================== PARALLAX + CARD TILT ===================== */
const sigL = document.querySelector('.sigil--l');
const sigR = document.querySelector('.sigil--r');
window.addEventListener('mousemove', (e)=>{
  const x = (e.clientX / innerWidth - .5), y = (e.clientY / innerHeight - .5);
  sigL.style.transform = `translate(${x*-10}px, ${y*-6}px) rotate(-8deg)`;
  sigR.style.transform = `translate(${x*12}px, ${y*8}px) rotate(12deg)`;
});
document.querySelectorAll('.card[data-tilt="1"]').forEach(card=>{
  const r=12;
  card.addEventListener('mousemove', e=>{
    const b=card.getBoundingClientRect(), dx=(e.clientX-b.left)/b.width-.5, dy=(e.clientY-b.top)/b.height-.5;
    card.style.transform = `rotateX(${(-dy*r)}deg) rotateY(${(dx*r)}deg) translateY(-6px)`;
  });
  card.addEventListener('mouseleave', ()=> card.style.transform = '');
});

/* ===================== WEB3 GATING (BNB MAINNET) ===================== */
const CONFIG = {
  chainIdHex:'0x38', chainName:'BNB Smart Chain', rpcUrl:'https://bsc-dataseed.binance.org/', blockExplorer:'https://bscscan.com',
  klyErc20:'0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52',
  diamondNft721:'0xDA76d35742190283E340dbeE2038ecc978a56950',
  diamondTokenId:'3'
};
const ERC20_ABI = [
  "function balanceOf(address) view returns (uint256)",
  "function decimals() view returns (uint8)",
  "function symbol() view returns (string)"
];
const ERC721_ABI = [
  "function ownerOf(uint256) view returns (address)",
  "function balanceOf(address) view returns (uint256)"
];
const els = {
  walletBtn:document.getElementById('walletBtn'),
  primaryCta:document.getElementById('primaryCta'),
  accessBanner:document.getElementById('accessBanner'),
  unsealBtn:document.getElementById('unsealBtn'),
  mintInfoBtn:document.getElementById('mintInfoBtn'),
  scrollContent: document.getElementById('scrollContent')
};
let state = { connected:false, account:null, hasDiamondCore:false, kly:{balance:null, symbol:'KLY', decimals:18} };
function short(a){ return a ? a.slice(0,6)+'…'+a.slice(-4) : ''; }
function setStatus(icon, html, cls){
  els.accessBanner.className = 'access wrap ' + (cls||'');
  els.accessBanner.querySelector('.access__icon').textContent = icon;
  els.accessBanner.querySelector('.access__text').innerHTML = html;
  
  // Add animation to icon when status changes
  const iconEl = els.accessBanner.querySelector('.access__icon');
  iconEl.style.transform = 'scale(1.2)';
  setTimeout(() => { iconEl.style.transform = 'scale(1)'; }, 300);
}
function assertEth(){ if(!window.ethereum){ alert('No wallet found. Install MetaMask or use a Web3 browser.'); return false } return true }
async function ensureBsc(){
  const cur = await ethereum.request({ method:'eth_chainId' });
  if(cur.toLowerCase() !== '0x38'){
    try{
      await ethereum.request({ method:'wallet_switchEthereumChain', params:[{ chainId:'0x38' }] });
    }catch(e){
      if(e.code===4902){
        await ethereum.request({ method:'wallet_addEthereumChain', params:[{ chainId:'0x38', chainName:CONFIG.chainName,
          nativeCurrency:{ name:'BNB', symbol:'BNB', decimals:18 }, rpcUrls:[CONFIG.rpcUrl], blockExplorerUrls:[CONFIG.blockExplorer] }] });
      }else{ throw e; }
    }
  }
}
function provider(){ return new ethers.providers.Web3Provider(window.ethereum); }

async function connect(){
  if(!assertEth()) return;
  
  // Show loading state
  els.walletBtn.innerHTML = '<span class="spinner"></span>Connecting...';
  
  try {
    await ensureBsc();
    const accs = await ethereum.request({ method:'eth_requestAccounts' });
    state.account = accs[0]; state.connected = true;
    ethereum.removeAllListeners && ethereum.removeAllListeners('accountsChanged');
    ethereum.on && ethereum.on('accountsChanged', a=>{ if(a.length===0){disconnect()} else {state.account=a[0]; refresh()}});
    ethereum.on && ethereum.on('chainChanged', ()=> location.reload());
    await refresh();
  } catch (error) {
    console.error('Connection error:', error);
    setStatus('❌', '<strong>Connection Failed.</strong> Please try again.', 'access--error');
    els.walletBtn.textContent = 'Connect Wallet';
  }
}
async function disconnect(){ 
  state={connected:false,account:null,hasDiamondCore:false,kly:{balance:null,symbol:'KLY',decimals:18}}; 
  render(); 
}
async function refresh(){ 
  try{ 
    await Promise.all([checkNFT(), readKLY()]); 
  } catch(e){ 
    console.error(e);
    setStatus('⚠️', `<strong>Error checking status.</strong> Please try again.`, 'access--warn');
  } 
  render(); 
}

async function checkNFT(){
  try{
    const c = new ethers.Contract(CONFIG.diamondNft721, ERC721_ABI, provider());
    const owner = await c.ownerOf(CONFIG.diamondTokenId);
    state.hasDiamondCore = owner.toLowerCase() === state.account.toLowerCase();
  }catch(e){
    try{
      const c = new ethers.Contract(CONFIG.diamondNft721, ERC721_ABI, provider());
      const bal = await c.balanceOf(state.account);
      state.hasDiamondCore = bal && bal.gt(0);
    }catch(err){ state.hasDiamondCore=false; }
  }
}
async function readKLY(){
  try{
    const c = new ethers.Contract(CONFIG.klyErc20, ERC20_ABI, provider());
    const [raw,dec,sym] = await Promise.all([c.balanceOf(state.account), c.decimals(), c.symbol().catch(()=> 'KLY')]);
    state.kly.decimals=dec; state.kly.symbol=sym||'KLY'; state.kly.balance = Number(ethers.utils.formatUnits(raw, dec));
  }catch(e){ state.kly.balance=null; }
}
function render(){
  // buttons
  const wbtn = document.getElementById('walletBtn');
  wbtn.textContent = state.connected ? `Disconnect (${short(state.account)})` : 'Connect Wallet';
  document.getElementById('primaryCta').textContent = state.connected ? 'Check Access' : 'Connect Wallet';

  // banner
  if(!state.connected){
    setStatus('🔒','<strong>Access Locked.</strong> Connect wallet to check gate status.');
  } else if(!state.hasDiamondCore){
    setStatus('🗝️', `<strong>Connected ${short(state.account)}.</strong> Gate required: Diamond Core NFT (ID 3).`, 'access--warn');
  } else {
    setStatus('✅', `<strong>Access Granted.</strong> Diamond Core verified for ${short(state.account)}.`, 'access--ok');
  }

  // card
  const lock = document.querySelector('.lock');
  if(state.connected && state.hasDiamondCore){
    if(lock) lock.style.display='none';
    els.unsealBtn.disabled=false; els.unsealBtn.removeAttribute('aria-disabled');
    els.scrollContent.classList.add('revealed');
  }else{
    if(lock) lock.style.display='flex';
    els.unsealBtn.disabled=true; els.unsealBtn.setAttribute('aria-disabled','true');
    els.unsealBtn.textContent = state.connected ? 'Locked (Need Diamond Core)' : 'Unseal the Scroll';
    els.scrollContent.classList.remove('revealed');
  }

  // KLY badge
  const meta = document.querySelector('.access__meta');
  let badge = document.getElementById('klyBadge');
  if(state.connected){
    if(!badge){ badge = document.createElement('span'); badge.className='badge'; badge.id='klyBadge'; meta.append(' • ', badge); }
    badge.textContent = 'KLY: ' + (state.kly.balance==null ? '—' : `${state.kly.balance.toFixed(2)} ${state.kly.symbol}`);
  }else if(badge){ badge.remove(); }
}

// Event listeners
document.getElementById('walletBtn').addEventListener('click', async ()=> state.connected ? disconnect() : connect());
document.getElementById('primaryCta').addEventListener('click', async ()=> !state.connected ? connect() : refresh());
document.getElementById('mintInfoBtn').addEventListener('click', ()=> openModal());
document.getElementById('viewContractBtn').addEventListener('click', ()=> window.open('https://bscscan.com/address/0xDA76d35742190283E340dbeE2038ecc978a56950#writeContract','_blank'));
document.getElementById('mintDirectBtn').addEventListener('click', function() {
  this.innerHTML = '<span class="spinner"></span>Minting...';
  // In a real implementation, you would initiate the minting process here
  setTimeout(() => {
    this.textContent = 'Transaction Sent';
    setTimeout(() => {
      closeModal();
      this.textContent = 'Mint Diamond Core';
    }, 2000);
  }, 2000);
});
document.getElementById('unsealBtn').addEventListener('click', function(){
  if(this.disabled) return;
  this.innerHTML = '<span class="spinner"></span>Unsealing...';
  setTimeout(() => {
    this.textContent = 'Unsealed ✨';
    // Show scroll content with animation
    els.scrollContent.classList.add('revealed');
  }, 1500);
});

// Initialize
render();
</script>
</body>
</html>
