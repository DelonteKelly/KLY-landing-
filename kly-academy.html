<!DOCTYPE html>
<html lang="en">
<head> 
  <!-- Meta -->
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="theme-color" content="#060713">
  <title>KLY Academy — Status Correction Path • Private</title>
  <meta name="description" content="Token-gated KLY Academy walking you through the full status correction journey from corporate fiction to living man/woman." />

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        integrity="sha512-1ycn6IcaQQ40/J6MdG8V1bZK1FQ6VZb6T1Zr3S9e8T+1iFqPq+M3e0r4c5pXb9qN9oC3m5p4hZQf1YFqZlAK2g=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Motion & FX -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
        integrity="sha512-b7nE5n+ZV4QpQv0uQeQmLw8m1zj3G0Yp3w0k4s2X3kQmY0m8Cw+vQk8dQ1lD3gUQn0kQ8zH1H8f2wT2QDs2F2Q=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" defer></script>

  <!-- ✅ Ethers v5 UMD (global window.ethers, no defer/async) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js" data-cfasync="false"></script>
  <script>
    // Fallback if the first CDN fails
    if (!window.ethers) {
      document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"><\/script>');
    }
  </script>

  <style>
    :root{
      /* Neon + Gold palette */
      --bg:#060713; --bg2:#0a0c1f;
      --panel:rgba(255,255,255,.06); --panel2:rgba(255,255,255,.08);
      --border:rgba(132,255,255,.18);
      --txt:#E9EEFF; --muted:#B9C3E5;
      --cyn:#00eaff; --pnk:#ff3bff; --vio:#9333ff; --sun:#ffb300; --lime:#00ff95;
      --gold:#FFD98A; --gold2:#FFB74A; --danger:#ff3d3d;

      --glow-cyn:0 0 24px rgba(0,234,255,.35);
      --glow-pnk:0 0 24px rgba(255,59,255,.35);
      --glow-vio:0 0 24px rgba(147,51,255,.35);

      --radius:16px; --radius-sm:12px;
    }

    /* Base */
    *{ box-sizing:border-box }
    html,body{ height:100% }
    html{ scroll-behavior:smooth }
    body{
      margin:0; color:var(--txt);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(1100px 700px at 12% -8%, rgba(0,234,255,.10), transparent 60%),
        radial-gradient(900px 600px at 100% -10%, rgba(255,59,255,.10), transparent 60%),
        linear-gradient(180deg,#050611, #0a0c1f 60%, #07081a);
      overflow-x:hidden;
    }

    /* Subtle aurora + grain */
    body::before{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
      background:
        radial-gradient(50% 35% at 70% -10%, rgba(255,217,138,.15), transparent 60%),
        conic-gradient(from 230deg at 20% 10%, rgba(0,234,255,.08), transparent 45%);
      filter: blur(18px);
      animation: drift 18s ease-in-out infinite alternate;
    }
    body::after{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Cfilter id='n'%3E%3CfeTurbulence baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='table' tableValues='0 0 0 .08 0'/%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
      opacity:.7; mix-blend-mode:overlay;
    }
    @keyframes drift{
      0%{ transform:translateY(-2%) scale(1); }
      100%{ transform:translateY(2%) scale(1.04); }
    }

    a{ color:var(--cyn); text-decoration:none }
    a:hover{ opacity:.9 }
    .container{ max-width:1200px; margin:0 auto; padding:20px }

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter:blur(10px) saturate(1.2);
      background:linear-gradient(180deg, rgba(6,7,19,.88), rgba(6,7,19,.52));
      border-bottom:1px solid var(--border);
      box-shadow:var(--glow-cyn);
      padding-top: env(safe-area-inset-top);
    }
    .topbar-inner{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:14px 20px;
    }
    .brand{ display:flex; align-items:center; gap:8px; font-weight:700; font-family:"Space Grotesk", Inter }
    .brand .text{ font-weight:800; letter-spacing:.6px }
    .brand i.fa-graduation-cap{
      color:#00eaff; font-size:1.1em; margin-right:2px;
      text-shadow:0 0 8px rgba(0,234,255,.6);
      transition: transform .4s ease, filter .4s ease, text-shadow .4s ease;
    }
    /* Connected glow */
    .brand i.fa-graduation-cap.celebrate{
      transform: rotate(-10deg) scale(1.08);
      text-shadow: 0 0 14px rgba(0,234,255,1), 0 0 26px rgba(0,234,255,.8);
      filter: drop-shadow(0 0 12px rgba(0,234,255,.6));
    }

    .ribbon{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 12px; border-radius:8px; margin-left:10px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)),
        linear-gradient(90deg, rgba(255,183,74,.20), rgba(255,217,138,.12));
      border:1px solid rgba(255,217,138,.25);
      color:#ffeac0; font-weight:600; font-size:.9em;
      box-shadow:0 0 0 1px rgba(255,183,74,.15);
    }
    .ribbon i{ color:#ffd98a }

    /* Chips & Buttons */
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px;
      border:1px solid var(--border);
      background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
      color:var(--muted); font-size:13px;
      box-shadow:0 0 0 1px rgba(147,51,255,.15), var(--glow-vio);
      backdrop-filter: blur(6px);
    }
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px; border-radius:12px; cursor:pointer;
      border:1px solid var(--border); color:var(--txt);
      background: linear-gradient(90deg, rgba(0,234,255,.18), rgba(255,59,255,.18));
      box-shadow:var(--glow-cyn);
      transition: transform .2s, box-shadow .2s;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:var(--glow-pnk) }
    .btn-ghost{ background:transparent }

    /* Hero */
    .grid-hero{ display:grid; grid-template-columns:1.2fr .8fr; gap:18px; margin-top:20px }
    @media (max-width:1100px){ .grid-hero{ grid-template-columns:1fr } }
    .card{
      position:relative; overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--border); border-radius:var(--radius); padding:24px;
      box-shadow:var(--glow-cyn);
    }
    .card::after{
      content:""; position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
      background:linear-gradient(120deg, rgba(255,255,255,.06), transparent 35%, rgba(255,255,255,.07) 50%, transparent 65%);
      transform:translateX(-30%); transition:transform .9s ease;
    }
    .card:hover::after{ transform:translateX(0%) }

    h1{ margin:0 0 10px; font-family:"Space Grotesk"; font-size:36px; letter-spacing:.2px }
    .grad{ background:linear-gradient(90deg,var(--cyn),var(--pnk)); -webkit-background-clip:text; background-clip:text; color:transparent }
    p{ color:var(--muted) }

    .mini{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:14px }
    .stat{
      border:1px solid var(--border); border-radius:12px; padding:12px;
      background:rgba(255,255,255,.04); display:flex; gap:10px; align-items:center
    }
    .stat i{ color:var(--cyn); text-shadow:0 0 10px rgba(0,234,255,.7) }

    /* KPI ring */
    .ring{
      --p:0; --size:90px; width:var(--size); height:var(--size); border-radius:50%;
      background:
        radial-gradient(closest-side,#0000 78%,#0000 0 99%,#0000 0),
        conic-gradient(var(--cyn) var(--p), #202442 0);
      position:relative;
    }
    .ring::before{
      content:attr(data-label); position:absolute; inset:8px; border-radius:50%;
      display:grid; place-items:center; color:#a8f9ff; font-weight:800;
      border:1px solid var(--border);
      background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
    }

    /* Main grid */
    .grid-main{ display:grid; grid-template-columns:300px 1fr 320px; gap:18px; margin-top:18px }
    @media (max-width:1100px){ .grid-main{ grid-template-columns:1fr } }

    /* Sidebar */
    .profile{ display:flex; gap:12px; align-items:center }
    .avatar{
      width:54px; height:54px; border-radius:50%; display:grid; place-items:center; font-weight:800;
      background: radial-gradient(circle at 30% 30%, #fff3, #0000 40%), linear-gradient(135deg,var(--cyn),var(--pnk));
      box-shadow:var(--glow-cyn);
    }
    .addr{ font-family:ui-monospace,monospace; color:var(--muted); font-size:13px }
    .menu{ display:flex; flex-direction:column; gap:10px; margin-top:14px }
    .menu button{
      border:1px solid var(--border); border-radius:12px; padding:12px;
      background:rgba(255,255,255,.03); color:var(--txt); text-align:left; cursor:pointer;
      display:flex; gap:10px; align-items:center
    }
    .menu button.active{ box-shadow:var(--glow-pnk) }
    .badge{
      margin-left:auto; background:linear-gradient(90deg,var(--pnk),var(--vio));
      padding:2px 8px; border-radius:999px; font-size:12px; font-weight:800
    }

    /* Lessons */
    .acc{ border:1px solid var(--border); border-radius:14px; overflow:hidden; background:rgba(255,255,255,.04) }
    .acc + .acc{ margin-top:12px }
    .acc-sum{ display:flex; justify-content:space-between; gap:10px; padding:14px 16px; cursor:pointer; user-select:none }
    .acc-sum .left{ display:flex; gap:12px; align-items:center }
    .num{
      width:36px; height:36px; border-radius:10px; display:grid; place-items:center; font-weight:800;
      background:linear-gradient(135deg,var(--cyn),var(--pnk)); box-shadow:var(--glow-cyn)
    }
    .acc-body{ display:none; padding:0 16px 16px }
    .acc.open .acc-body{ display:block }
    .callout{
      border-left:3px solid var(--cyn); background:rgba(0,234,255,.08);
      padding:12px; border-radius:0 12px 12px 0; margin:12px 0
    }
    .two{ display:grid; grid-template-columns:1fr 1fr; gap:14px }
    @media (max-width:900px){ .two{ grid-template-columns:1fr } }
    .code{
      font-family:ui-monospace, Menlo, Consolas, monospace; font-size:12px; color:#a5ffcf;
      background:linear-gradient(180deg, rgba(0,0,0,.5), rgba(0,0,0,.25));
      border:1px solid rgba(0,255,149,.25); border-radius:10px; padding:10px;
      box-shadow:0 0 12px rgba(0,255,149,.1); overflow:auto
    }
    .pill{ border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-size:12px; color:var(--muted) }
    .btn-mark{
      background:linear-gradient(90deg,var(--cyn),var(--pnk));
      border:0; color:#06101a; border-radius:10px; padding:10px 14px; font-weight:800
    }

    /* Certificate sizing */
    .cert-img{
      position:relative; overflow:hidden; border:1px solid var(--border); border-radius:12px; box-shadow:var(--glow-vio);
      max-height:320px; height:320px; background:#0b0f1c;
    }
    .cert-img img{
      display:block; width:100%; height:100%; object-fit:contain; object-position:center; background:transparent;
    }
    .cert-img .seal{ z-index:2 }

    /* Utilities */
    [hidden]{ display:none !important }

    /* Members-only overlay */
    .lock-wrap{ position:relative }
    .locked .lock-blur{ filter:blur(4px); pointer-events:none; user-select:none }
    .lock-overlay{
      position:absolute; inset:0; display:none; place-items:center; text-align:center;
      background:linear-gradient(180deg, rgba(6,7,19,.78), rgba(6,7,19,.82));
      border:1px dashed rgba(255,217,138,.35); border-radius:var(--radius);
    }
    .locked .lock-overlay{ display:grid }
    .overlay-card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,217,138,.35); border-radius:16px;
      padding:16px; box-shadow:0 0 0 1px rgba(255,183,74,.15), 0 16px 50px rgba(0,0,0,.55);
      max-width:560px;
    }
    .overlay-card h3{ margin:6px 0 8px }
    .vip-input{
      display:flex; gap:8px; margin-top:8px;
      background:rgba(255,255,255,.05); border:1px solid rgba(255,217,138,.25);
      padding:8px; border-radius:12px;
    }
    .vip-input input{
      flex:1; background:transparent; border:0; color:var(--txt); outline:none;
      font-family:ui-monospace,Menlo,Consolas,monospace; letter-spacing:.6px;
    }
    .vip-btn{ background:linear-gradient(90deg,#FFB74A,#FFD98A); color:#17120B; font-weight:800 }

    /* Toast */
    .toast{
      position:fixed; right:max(16px, env(safe-area-inset-right));
      bottom:max(16px, env(safe-area-inset-bottom)); z-index:60;
      padding:14px 16px; max-width:min(92vw, 520px);
      border:1px solid var(--border); border-left:4px solid var(--cyn);
      border-radius:14px; background:rgba(255,255,255,.06);
      backdrop-filter:blur(6px); display:flex; gap:10px; align-items:flex-start;
      box-shadow:var(--glow-cyn); touch-action:pan-y;
    }
    .toast .x{ background:transparent; border:0; color:var(--muted); cursor:pointer }
    .toast.good{ border-left-color:var(--lime) }
    .toast.bad{ border-left-color:var(--danger) }
    .toast.warn{ border-left-color:var(--sun) }

    /* Responsive */
    @media (max-width:680px){
      .container{ padding:14px }
      .topbar-inner{ padding:12px 14px; gap:10px }
      .brand .text{ font-size:14px; letter-spacing:.4px }
      .chip{ padding:6px 10px; font-size:12px }
      .btn{ padding:8px 12px; border-radius:10px }
      h1{ font-size:28px; line-height:1.15 }
      .grid-hero{ gap:12px; margin-top:14px }
      .card{ padding:16px; border-radius:14px }
      .mini{ grid-template-columns:1fr; gap:10px }
      .stat{ padding:10px; gap:8px }
      .ring{ --size:72px }
      .grid-main{ grid-template-columns:1fr; gap:12px; margin-top:12px }
      .menu button{ padding:10px }
      .num{ width:32px; height:32px }
      .acc-sum{ padding:12px }
      .acc-body{ padding:0 12px 12px }
      .two{ grid-template-columns:1fr }
    }
    @media (max-width:480px){
      .ribbon{ font-size:.85em; padding:4px 8px }
      .topbar-inner{ gap:8px }
    }
  </style>
</head>
<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="container topbar-inner">
      <div class="brand">
        <i class="fa-solid fa-graduation-cap"></i>
        <div class="text">KLY ACADEMY</div>
        <span class="ribbon"><i class="fa-solid fa-lock"></i> Private Cohort</span>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <span id="chip-progress" class="chip"><i class="fa-solid fa-chart-simple"></i> <span id="chip-text">0/9 Complete</span></span>
        <button id="btn-connect" class="btn"><i class="fa-solid fa-wallet"></i> Connect Wallet</button>
        <span id="pill-addr" class="chip" hidden><i class="fa-solid fa-user-astronaut"></i> <span id="addr-short">0x…</span></span>
        <button id="btn-about" class="btn btn-ghost" title="About Membership"><i class="fa-regular fa-gem"></i></button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Hero -->
    <section class="grid-hero">
      <div class="card animate__animated animate__fadeInUp">
        <h1><span class="grad">Reclaim</span> Your Status</h1>
        <p>Invitation-only, step-by-step curriculum for status correction and sovereign living. Spiritual first, educational only — complete the path and mint your on-chain credential.</p>
        <div class="mini">
          <div class="stat"><i class="fa-solid fa-user-shield"></i><div><strong>Self-Ownership</strong><br><small>From fiction to living man/woman</small></div></div>
          <div class="stat"><i class="fa-solid fa-route"></i><div><strong>Clear Path</strong><br><small>Phase-by-phase structure</small></div></div>
          <div class="stat"><i class="fa-solid fa-certificate"></i><div><strong>On-Chain Proof</strong><br><small>Status course certificate</small></div></div>
        </div>
      </div>
      <div class="card animate__animated animate__fadeInUp" style="--animate-delay:.06s">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 style="margin:0">Access Gate</h3>
          <div class="ring" id="ring" data-label="0%"></div>
        </div>
        <p class="muted">Unlock with <strong>≥ 100 KLY</strong> on <strong>BNB Chain</strong> <em>or</em> an <strong>Invite Code</strong>.</p>
        <div style="display:flex;gap:14px;align-items:center;margin-top:8px">
          <i class="fa-solid fa-coins" style="color:var(--cyn)"></i>
          <div><div class="muted">Your KLY balance</div><strong id="kly-balance">—</strong></div>
        </div>
        <div style="display:flex;gap:14px;align-items:center;margin-top:8px">
          <i class="fa-solid fa-network-wired" style="color:var(--pnk)"></i>
          <div><div class="muted">Network</div><strong id="net-name">Not connected</strong></div>
        </div>
        <div class="vip-input" style="margin-top:12px">
          <input id="invite-code" inputmode="latin" placeholder="Enter Invite Code (e.g., STATUS-777)" aria-label="Invite Code">
          <button id="btn-redeem" class="btn vip-btn"><i class="fa-solid fa-key"></i> Redeem</button>
        </div>
        <small class="muted">Educational access only. Codes are single-use per wallet.</small>
      </div>
    </section>

    <!-- Main -->
    <section class="grid-main">
      <!-- Sidebar -->
      <aside class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);padding-bottom:12px;margin-bottom:12px">
          <h3 style="margin:0">Profile</h3>
          <button id="btn-disconnect" class="btn btn-ghost" hidden><i class="fa-solid fa-right-from-bracket"></i> Disconnect</button>
        </div>
        <div class="profile">
          <div class="avatar" id="avatar">KA</div>
          <div>
            <div style="font-weight:800">Learner</div>
            <div id="addr-full" class="addr">Not connected</div>
          </div>
        </div>

        <div style="margin-top:16px;border-top:1px solid var(--border);padding-top:14px">
          <div class="muted" style="margin-bottom:8px">Foundation</div>
          <div id="menu-beginner" class="menu"></div>
          <div class="muted" style="margin:16px 0 8px">Documents & Trusts</div>
          <div id="menu-master" class="menu"></div>
          <div class="muted" style="margin:16px 0 8px">Operation & Enforcement</div>
          <div id="menu-right" class="menu"></div>
        </div>
      </aside>

      <!-- Lessons (locked until access) -->
      <main id="curriculum-wrap" class="card lock-wrap locked">
        <div class="lock-blur">
          <div style="border-bottom:1px solid var(--border);padding-bottom:12px;margin-bottom:12px; display:flex; align-items:center; gap:8px">
            <h3 style="margin:0">Status Correction Curriculum</h3>
            <span class="chip" title="Members Only"><i class="fa-solid fa-lock"></i> Members Only</span>
          </div>
          <div id="accordion"></div>
        </div>
        <div class="lock-overlay">
          <div class="overlay-card">
            <h3 style="margin:0"><i class="fa-solid fa-gem" style="color:var(--gold2)"></i> Inner Circle Access</h3>
            <p class="muted" style="margin:6px 0 10px">
              Connect a wallet with ≥ 100 KLY or redeem your invite to unlock the full spiritual and educational walkthrough of status correction.
              This academy is for study and empowerment — not legal advice.
            </p>
            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <button id="btn-overlay-connect" class="btn"><i class="fa-solid fa-plug-circle-bolt"></i> Connect Wallet</button>
              <a href="#apply" id="btn-waitlist" class="btn btn-ghost"><i class="fa-regular fa-envelope"></i> Request Invite</a>
            </div>
          </div>
        </div>
      </main>

      <!-- Certificate -->
      <aside class="card">
        <div style="border-bottom:1px solid var(--border);padding-bottom:12px;margin-bottom:12px; position:relative">
          <h3 style="margin:0">Sovereign Certificate</h3>
        </div>
        <div class="cert-img">
          <span class="seal">Founder’s Seal</span>
          <img src="https://blush-worthy-ape-39.mypinata.cloud/ipfs/bafybeidmaskps5ouvljx7li667xnvalle566d577vixhtj5rejphrx5bua/Key%20of%20Ascension.PNG" alt="Status Correction Certificate">
        </div>
        <p class="muted">Finish all modules to mint your on-chain Status Correction Academy certificate (educational credential).</p>
        <div style="display:grid;grid-template-columns:auto 1fr;gap:6px 10px;margin:10px 0 14px">
          <div>Progress</div><strong id="cert-progress">0 / 9</strong>
          <div>Status</div><strong id="cert-status">Locked</strong>
        </div>
        <button id="btn-mint" class="btn" disabled><i class="fa-solid fa-certificate"></i> Mint Certificate</button>
        <div id="mint-status" class="muted" style="margin-top:10px"></div>
      </aside>
    </section>

    <footer class="container" style="opacity:.7; text-align:center; margin-top:20px">
      <small>© <span id="year"></span> KLY Academy • Status Correction Cohort</small>
    </footer>
  </div>

  <!-- About Membership Modal -->
  <div id="modal" class="topbar" style="display:none; position:fixed; inset:0; z-index:1000; background:rgba(6,7,19,.85); backdrop-filter:blur(10px)">
    <div class="container" style="max-width:820px; margin-top:60px">
      <div class="card" style="position:relative">
        <button id="modal-close" class="btn btn-ghost" style="position:absolute; top:10px; right:10px"><i class="fa-solid fa-xmark"></i></button>
        <h3 style="margin:0 0 6px"><i class="fa-solid fa-gem" style="color:var(--gold2)"></i> Membership</h3>
        <p class="muted">
          This is a private educational cohort focused on spiritual and sovereignty education. Nothing here is legal advice.
          Access requires a qualifying on-chain balance or an invite code issued by the team.
        </p>
        <div class="vip-input" style="margin-top:10px">
          <input id="invite-code-2" placeholder="Enter Invite Code" aria-label="Invite Code">
          <button id="btn-redeem-2" class="btn vip-btn"><i class="fa-solid fa-key"></i> Redeem</button>
        </div>
        <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap">
          <button id="btn-modal-connect" class="btn"><i class="fa-solid fa-plug-circle-bolt"></i> Connect Wallet</button>
          <a href="#apply" class="btn btn-ghost"><i class="fa-regular fa-envelope"></i> Join Waitlist</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" hidden>
    <i id="toast-icon" class="fa-solid fa-circle-info"></i>
    <div>
      <div id="toast-title" style="font-weight:800;margin-bottom:4px">Info</div>
      <div id="toast-msg" class="muted">Message</div>
    </div>
    <button class="x" onclick="hideToast()"><i class="fa-solid fa-xmark"></i></button>
  </div>

<script>
/* ==============================
   CONFIG
============================== */
const KLY_TOKEN_ADDRESS   = "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52";
const NFT_CONTRACT_ADDRESS= "0xDA76d35742190283E340dbeE2038ecc978a56950"; // Thirdweb ERC-721 you control

const KLY_TOKEN_ABI = [
  "function balanceOf(address) view returns (uint256)",
  "function decimals() view returns (uint8)",
  "function symbol() view returns (string)"
];
const NFT_CONTRACT_ABI = [
  "function mintTo(address to, string uri) public returns (uint256)"
];

const REQUIRED_KLY = 100; // match UI: ≥ 100 KLY

const BSC = {
  idDec: 56,
  idHex: "0x38",
  name: "BNB Smart Chain",
  rpc:  "https://bsc-dataseed.binance.org/",
  explorer: "https://bscscan.com"
};

/* WalletConnect v2 (UMD) */
const WC_PROJECT_ID = "df8063092ef3c627437d698df0977bc1";

/* Invite codes (client-side demo only) */
const INVITES = new Set(["STATUS-777", "STATUS-888", "KLY-STATUS", "TAMAQUAH-KEY"]);

/* ==============================
   STATE
============================== */
let provider   = null;
let signer     = null;
let account    = null;
let wcProvider = null;

let completed = JSON.parse(localStorage.getItem("kly_completed_status") || "[]");
let opened    = localStorage.getItem("kly_open_status") || null;
let inviteUnlocked = localStorage.getItem("kly_invite_status_unlocked")==="1";

let modules = window.modules || [];
let TOTAL_MODULES = modules.length || 9;

/* ==============================
   DOM (safe getters)
============================== */
const el = (id)=>document.getElementById(id);
const btnConnect         = el("btn-connect");
const btnDisconnect      = el("btn-disconnect");
const btnAbout           = el("btn-about");
const modal              = el("modal");
const modalClose         = el("modal-close");
const btnModalConn       = el("btn-modal-connect");
const pillAddr           = el("pill-addr");
const addrShort          = el("addr-short");
const addrFull           = el("addr-full");
const avatar             = el("avatar");
const ring               = el("ring");
const klyBalanceEl       = el("kly-balance");
const netNameEl          = el("net-name");
const chipText           = el("chip-text");
const certProgress       = el("cert-progress");
const certStatus         = el("cert-status");
const btnMint            = el("btn-mint");
const mintStatus         = el("mint-status");
const toast              = el("toast");
const toastIcon          = el("toast-icon");
const toastTitle         = el("toast-title");
const toastMsg           = el("toast-msg");
const inviteInput        = el("invite-code");
const inviteInput2       = el("invite-code-2");
const btnRedeem          = el("btn-redeem");
const btnRedeem2         = el("btn-redeem-2");
const btnOverlayConnect  = el("btn-overlay-connect");
const curriculumWrap     = el("curriculum-wrap");
const accordionRoot      = el("accordion");
const menuBeginner       = el("menu-beginner");
const menuMaster         = el("menu-master");
const menuRight          = el("menu-right");

/* ==============================
   UTIL
============================== */
const short = (addr)=> addr ? `${addr.slice(0,6)}…${addr.slice(-4)}` : "";
const fmt = (n, d=2)=> Number(n).toLocaleString(undefined,{maximumFractionDigits:d});
function toUnits(bn, decimals){ return Number(ethers.utils.formatUnits(bn, decimals)); }

/* Toast */
function notify(title, msg, kind="info", icon="fa-circle-info"){
  const safeTitle = (title && String(title).trim()) || "Notice";
  const safeMsg   = (msg   && String(msg).trim())   || "All set.";
  if (!toast) return alert(`${safeTitle}: ${safeMsg}`);

  toastTitle && (toastTitle.textContent = safeTitle);
  toastMsg   && (toastMsg.textContent   = safeMsg);
  if (toastIcon) toastIcon.className = `fa-solid ${icon || "fa-circle-info"}`;

  toast.classList.remove("good","bad","warn");
  if(kind==="good") toast.classList.add("good");
  else if(kind==="bad") toast.classList.add("bad");
  else if(kind==="warn") toast.classList.add("warn");

  toast.hidden = false;
  clearTimeout(notify._timer); notify._timer = setTimeout(hideToast, 4800);
}
function hideToast(){ clearTimeout(notify._timer); toast && (toast.hidden = true); }

/* Focus outline for keyboard users (A11y) */
document.addEventListener("keydown", e=>{
  if(e.key==="Tab") document.body.classList.add("kbd");
});

/* ==============================
   PROGRESS
============================== */
function markComplete(id){
  if(!completed.includes(id)){
    completed.push(id);
    localStorage.setItem("kly_completed_status", JSON.stringify(completed));
  }
  notify("Saved","Module marked complete","good","fa-circle-check");
  renderAccordion();
  updateProgress();
  if(typeof confetti==="function"){
    confetti({particleCount:90, spread:60, origin:{y:.8}, colors:["#00eaff","#ff3bff","#9333ff"]});
  }
}
function updateProgress(){
  if (!chipText || !certProgress || !ring || !certStatus || !btnMint) return;
  const validIds = new Set((modules||[]).map(m=>m.id));
  const unique = [...new Set(completed)].filter(id => validIds.has(id));
  const done = unique.length;
  TOTAL_MODULES = (modules && modules.length) ? modules.length : TOTAL_MODULES;
  const pct  = Math.min(100, Math.round(done / TOTAL_MODULES * 100));
  chipText.textContent     = `${done}/${TOTAL_MODULES} Complete`;
  certProgress.textContent = `${done} / ${TOTAL_MODULES}`;
  ring.style.setProperty("--p", pct + "%");
  ring.setAttribute("data-label", pct + "%");
  if(done >= TOTAL_MODULES){
    certStatus.textContent = "Ready to Mint";
    btnMint.disabled = false;
  }else{
    certStatus.textContent = "Locked";
    btnMint.disabled = true;
  }
}

/* ==============================
   ACCESS: Token OR Invite
============================== */
function hasTokenAccess(bal){ return bal >= REQUIRED_KLY; }
function hasInviteAccess(){ return inviteUnlocked === true; }
function updateAccessState(balanceNum){
  const access = hasTokenAccess(balanceNum) || hasInviteAccess();
  curriculumWrap?.classList.toggle('locked', !access);
  if(access){ notify("Welcome","Access granted. Walk the path with wisdom.","good","fa-unlock"); }
}
function redeemInvite(codeRaw){
  const code = (codeRaw||"").trim().toUpperCase();
  if(!code){ return notify("Missing Code","Enter your invite code.","warn","fa-key"); }
  if(!INVITES.has(code)){ return notify("Invalid Code","Please check your invite.","bad","fa-circle-xmark"); }
  inviteUnlocked = true;
  localStorage.setItem("kly_invite_status_unlocked","1");
  INVITES.delete(code);
  notify("Invite Accepted","Your status curriculum access is activated.","good","fa-gem");
  curriculumWrap?.classList.remove('locked');
  if(typeof confetti==="function"){
    confetti({particleCount:120, spread:70, origin:{y:.7}, colors:["#FFD98A","#00eaff","#ff3bff"]});
  }
}

const ETHERS_UMD_URLS = [
  "https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js",
  "https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js",
  "https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"
];

async function ensureEthersUMD(){
  if (window.ethers && window.ethers.providers) return;
  await new Promise((res, rej)=>{
    const s=document.createElement("script");
    s.src=ETHERS_UMD_URLS[0];
    s.onload=res; s.onerror=()=>rej(new Error("ethers load failed"));
    document.head.appendChild(s);
  });
  if (!(window.ethers && window.ethers.providers)) {
    throw new Error("Ethers (UMD) failed to load.");
  }
}

/* ==============================
   WalletConnect v2 + ethers v5 (UMD)
============================== */
const WC_UMD_URLS = {
  modal: [
    "https://unpkg.com/@walletconnect/modal@2.6.2/dist/index.umd.js",
    "https://cdn.jsdelivr.net/npm/@walletconnect/modal@2.6.2/dist/index.umd.js",
    "https://cdnjs.cloudflare.com/ajax/libs/@walletconnect/modal/2.6.2/index.umd.min.js"
  ],
  ethereumProvider: [
    "https://unpkg.com/@walletconnect/ethereum-provider@2.12.1/dist/umd/index.min.js",
    "https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.12.1/dist/umd/index.min.js",
    "https://cdnjs.cloudflare.com/ajax/libs/@walletconnect/ethereum-provider/2.12.1/index.umd.min.js"
  ]
};

function getWCEGlobal(){
  return (
    window.EthereumProvider ||
    window.WalletConnectEthereumProvider ||
    window.WalletConnectProvider || null
  );
}
function loadScriptOnce(src){
  return new Promise((resolve, reject)=>{
    if ([...document.scripts].some(s => s.src === src)) return resolve();
    const s = document.createElement("script");
    s.src = src; s.async = true; s.crossOrigin="anonymous"; s.referrerPolicy="no-referrer";
    s.onload = resolve; s.onerror = ()=>reject(new Error(`Failed to load ${src}`));
    document.head.appendChild(s);
  });
}
async function loadFromAny(urls){
  let lastErr;
  for(const u of urls){ try{ await loadScriptOnce(u); return; } catch(e){ lastErr=e; } }
  throw lastErr || new Error("All CDN URLs failed");
}
async function ensureWalletConnectUMD(){
  if (getWCEGlobal()?.init) return;
  try { await loadFromAny(WC_UMD_URLS.modal); } catch(_) { /* optional */ }
  await loadFromAny(WC_UMD_URLS.ethereumProvider);
  if (!getWCEGlobal()?.init){
    const keys = Object.keys(window).filter(k=>k.toLowerCase().includes("walletconnect")).slice(0,20);
    throw new Error(`WalletConnect UMD not available (found: ${keys.join(", ")||"none"})`);
  }
}

/* Prefer injected; fallback to WC v2 QR */
async function getProviderInjectedOrWC(){
  if (window.ethereum) {
    await window.ethereum.request({ method:"eth_requestAccounts" });
    return new ethers.providers.Web3Provider(window.ethereum, "any");
  }
  await ensureWalletConnectUMD();
  const WCE = getWCEGlobal();
  wcProvider = await WCE.init({
    projectId: WC_PROJECT_ID,
    chains: [BSC.idDec],
    rpcMap: { [BSC.idDec]: BSC.rpc },
    showQrModal: true,
    methods: [
      "eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign",
      "eth_signTypedData","wallet_switchEthereumChain","wallet_addEthereumChain"
    ],
    events: ["chainChanged","accountsChanged","disconnect"],
    metadata: {
      name: "KLY Status Academy",
      description: "KLY — Status Correction & Sovereignty Curriculum",
      url: location.origin,
      icons: [location.origin + "/favicon.ico"]
    }
  });
  wcProvider.removeAllListeners?.();
  wcProvider.on?.("accountsChanged", async (accs)=>{
    if(!accs?.length) return window.disconnect();
    account = accs[0];
    await window.afterConnect();
  });
  wcProvider.on?.("chainChanged", async ()=>{
    provider = new ethers.providers.Web3Provider(wcProvider, "any");
    signer   = provider.getSigner();
    account  = await signer.getAddress().catch(()=>account);
    await window.afterConnect();
  });
  wcProvider.on?.("disconnect", ()=> window.disconnect());

  return new ethers.providers.Web3Provider(wcProvider, "any");
}

/* Ensure BSC network */
async function ensureBsc(providerLike){
  const net = await providerLike.getNetwork().catch(()=>({ chainId:0 }));
  if (Number(net.chainId) === Number(BSC.idDec)) return;

  const eip1193 = providerLike.provider || providerLike;
  try{
    await eip1193.request({ method:"wallet_switchEthereumChain", params:[{ chainId: BSC.idHex }] });
  }catch(e){
    if(e?.code === 4902){
      await eip1193.request({ method:"wallet_addEthereumChain", params:[{
        chainId: BSC.idHex, chainName: BSC.name,
        nativeCurrency:{ name:"BNB", symbol:"BNB", decimals:18 },
        rpcUrls:[BSC.rpc], blockExplorerUrls:[BSC.explorer]
      }]});
    }else{ throw e; }
  }
}

/* ==============================
   CONNECT / DISCONNECT (globals)
============================== */
window.connect = async function(){
  window.setConnectUI?.('connecting');
  try{
    const isSecure = location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
    if(!isSecure){ throw new Error('Wallets require HTTPS or localhost.'); }

    await ensureEthersUMD();

    provider = await getProviderInjectedOrWC();
    await ensureBsc(provider);

    signer  = provider.getSigner();
    account = await signer.getAddress();

    await window.afterConnect?.();
    window.setConnectUI?.('connected');
  }catch(err){
    console.error('[connect] failed:', err);
    notify?.("Connection Failed", err?.message || "Unable to connect", "bad", "fa-circle-xmark");
    window.setConnectUI?.('idle');
  }
};

if (window.ethereum && window.ethereum.on) {
  window.ethereum.removeAllListeners?.('accountsChanged');
  window.ethereum.removeAllListeners?.('chainChanged');

  window.ethereum.on('accountsChanged', async (accs)=>{
    if(!accs?.length) return window.disconnect();
    account = accs[0];
    await window.afterConnect();
  });

  window.ethereum.on('chainChanged', async ()=>{
    provider = new ethers.providers.Web3Provider(window.ethereum, 'any');
    signer   = provider.getSigner();
    account  = await signer.getAddress().catch(()=>account);
    await window.afterConnect();
  });
}

window.disconnect = async function(){
  try{ await wcProvider?.disconnect?.(); }catch{}
  wcProvider = null;
  provider   = null;
  signer     = null;
  account    = null;

  addrFull && (addrFull.textContent = "Not connected");
  addrShort && (addrShort.textContent = "");
  avatar   && (avatar.textContent   = "KA");
  netNameEl&& (netNameEl.textContent= "Not connected");
  klyBalanceEl && (klyBalanceEl.textContent = "—");
  if (ring){ ring.style.setProperty("--p","0%"); ring.setAttribute("data-label","0%"); }
  updateAccessState(0);
  window.setConnectUI('idle');
  notify("Disconnected","Wallet disconnected","good","fa-right-from-bracket");
};

window.setConnectUI = function(state){
  const isConn = state === "connected";
  const isBusy = state === "connecting";

  btnConnect && (btnConnect.disabled = isBusy,
    btnConnect.innerHTML = isBusy
      ? '<i class="fa-solid fa-spinner fa-spin"></i> Connecting'
      : (isConn
          ? '<i class="fa-solid fa-wallet"></i> Connected'
          : '<i class="fa-solid fa-wallet"></i> Connect Wallet'));

  btnDisconnect && (btnDisconnect.hidden = !isConn);
  pillAddr && (pillAddr.hidden = !isConn);

  document.querySelector('.fa-graduation-cap')?.classList.toggle('celebrate', isConn);
};

window.afterConnect = async function(){
  try{
    const addr = await signer.getAddress();
    const net  = await provider.getNetwork();

    addrFull  && (addrFull.textContent  = addr);
    addrShort && (addrShort.textContent = short(addr));
    pillAddr  && (pillAddr.hidden = false);
    avatar    && (avatar.textContent = (addr.slice(2,4)+addr.slice(-2)).toUpperCase());
    netNameEl && (netNameEl.textContent = (Number(net.chainId)===Number(BSC.idDec) ? BSC.name : `Chain ${net.chainId}`));

    const erc20 = new ethers.Contract(KLY_TOKEN_ADDRESS, KLY_TOKEN_ABI, provider);
    const [raw, dec] = await Promise.all([
      erc20.balanceOf(addr),
      erc20.decimals().catch(()=>18)
    ]);
    const bal = Number(ethers.utils.formatUnits(raw, dec));
    klyBalanceEl && (klyBalanceEl.textContent = `${fmt(bal, 4)} KLY`);
    updateAccessState(bal);
  }catch(e){
    console.error("[afterConnect]", e);
    notify("Wallet Error", e?.message || "Could not read wallet state", "bad", "fa-circle-xmark");
  }
};

/* ==============================
   MINT
============================== */
async function mint(){
  if(!signer) return notify("Connect Wallet","Please connect your wallet first.","warn","fa-wallet");

  modules = window.modules || modules || [];
  TOTAL_MODULES = modules.length || TOTAL_MODULES;

  const validIds = new Set((modules||[]).map(m=>m.id));
  const unique   = [...new Set(completed)].filter(id => validIds.has(id));
  if(unique.length < TOTAL_MODULES) return notify("Finish Modules","Complete all modules first.","warn","fa-list-check");

  try{
    btnMint && (btnMint.disabled=true, btnMint.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Minting…');

    const to = await signer.getAddress();
    const nft = new ethers.Contract(NFT_CONTRACT_ADDRESS, NFT_CONTRACT_ABI, signer);
    const tokenURI = "ipfs://bafybeihkmkaf2mgx7xkrnkhmzd2uvhr6ddgj6z3vkqcgnvlaa3z7x263r4";

    const gas = await nft.estimateGas.mintTo(to, tokenURI).catch(()=>null);
    const opts = gas ? { gasLimit: gas.mul(120).div(100) } : {};
    const tx = await nft.mintTo(to, tokenURI, opts);

    mintStatus && (mintStatus.innerHTML = `Tx submitted: <a target="_blank" rel="noopener" href="${BSC.explorer}/tx/${tx.hash}">view on BscScan</a>`);
    await tx.wait();
    notify("Minted","Status certificate minted successfully!","good","fa-certificate");
    btnMint && (btnMint.innerHTML = '<i class="fa-solid fa-circle-check"></i> Minted');
    if(typeof confetti==="function"){
      confetti({particleCount:160, spread:70, origin:{y:.7}, colors:["#00eaff","#ff3bff","#9333ff"]});
    }
  }catch(e){
    console.error("[mint]", e);
    notify("Mint Failed", e?.data?.message || e?.reason || e?.message || "Unknown error", "bad", "fa-circle-xmark");
    btnMint && (btnMint.disabled=false, btnMint.innerHTML='<i class="fa-solid fa-certificate"></i> Mint Certificate');
  }
}

/* ==============================
   CONTENT RENDERERS
============================== */
function renderMenus(){
  if(!Array.isArray(modules)) return;
  const groups = { Beginner:[], Master:[], Right:[] };
  modules.forEach(m => groups[m.level]?.push(m));

  const mkBtn = (m)=> {
    const b = document.createElement("button");
    b.innerHTML = `<i class="fa-solid fa-book-open"></i> ${m.num}. ${m.title}`;
    b.onclick = ()=> openModule(m.id, true);
    if(opened===m.id) b.classList.add("active");
    return b;
  };

  if(menuBeginner) menuBeginner.innerHTML = "";
  if(menuMaster)   menuMaster.innerHTML   = "";
  if(menuRight)    menuRight.innerHTML    = "";

  groups.Beginner.forEach(m => menuBeginner?.appendChild(mkBtn(m)));
  groups.Master.forEach(m   => menuMaster?.appendChild(mkBtn(m)));
  groups.Right.forEach(m    => menuRight?.appendChild(mkBtn(m)));
}

function renderAccordion(){
  if(!accordionRoot) return;
  accordionRoot.innerHTML = "";

  (modules||[]).forEach(m => {
    const acc = document.createElement("div");
    acc.className = "acc";
    if(opened===m.id) acc.classList.add("open");

    const sum = document.createElement("div");
    sum.className = "acc-sum";
    sum.innerHTML = `
      <div class="left">
        <div class="num">${m.num}</div>
        <div><strong>${m.title}</strong><br><small>${m.level}</small></div>
      </div>
      <button class="btn btn-ghost" aria-label="Mark complete"><i class="fa-solid fa-check"></i></button>
    `;

    const body = document.createElement("div");
    body.className = "acc-body";
    body.innerHTML = (m.sections||[]).map(s => `
      <h4 style="margin:12px 0 6px">${s.label}</h4>
      <div>${s.html}</div>
    `).join("");

    sum.addEventListener("click", (e)=>{
      if(e.target.closest("button")) return;
      opened = (opened===m.id)? null : m.id;
      localStorage.setItem("kly_open_status", opened || "");
      renderAccordion();
    });

    sum.querySelector("button")?.addEventListener("click", (e)=>{
      e.stopPropagation();
      markComplete(m.id);
    });

    acc.appendChild(sum);
    acc.appendChild(body);
    accordionRoot.appendChild(acc);
  });
}

function openModule(id, scrollIntoView=false){
  opened = id;
  localStorage.setItem("kly_open_status", opened || "");
  renderMenus();
  renderAccordion();
  if(scrollIntoView){
    accordionRoot?.querySelector(".acc.open")?.scrollIntoView({behavior:"smooth", block:"start"});
  }
}

/* ==============================
   EVENT WIRING
============================== */
btnConnect        && btnConnect.addEventListener("click", window.connect);
btnModalConn      && btnModalConn.addEventListener("click", window.connect);
btnOverlayConnect && btnOverlayConnect.addEventListener("click", window.connect);
btnDisconnect     && btnDisconnect.addEventListener("click", window.disconnect);

btnMint && btnMint.addEventListener("click", mint);
if(btnRedeem)  btnRedeem.addEventListener("click", ()=> redeemInvite(inviteInput?.value));
if(btnRedeem2) btnRedeem2.addEventListener("click",()=> redeemInvite(inviteInput2?.value));

/* ==============================
   LESSON CONTENT — STATUS CORRECTION PATH
   (Educational & spiritual framing, not legal advice)
============================== */
const M = (id, level, num, title, sections) => ({id, level, num, title, sections});

modules = [
  /* ========= FOUNDATION (Beginner) ========= */
  M("sc-1","Beginner",1,"The Awakening: What Was Done to You",[
    {label:"Intent of This Module", html:`<p>
      This is spiritual and educational orientation only — not legal advice.
      You’ll see the bigger pattern of how names, documents, and jurisdictions were used to move you from
      <strong>living man/woman</strong> to a managed corporate identity.
    </p>`},
    {label:"History of Paper Genocide & Reclassification", html:`<ul>
      <li>Labels like <em>“Negro” → “Colored” → “Black” → “African American”</em> and how they tracked policy shifts.</li>
      <li>How census categories, birth records, and school systems helped erase Indigenous identity over time.</li>
      <li>The difference between a <strong>political label</strong> and an <strong>ancestral people</strong>.</li>
    </ul>`},
    {label:"Living Soul vs. Corporate Person", html:`<ul>
      <li><strong>Living man/woman:</strong> breath, blood, consciousness, responsibility.</li>
      <li><strong>Legal person:</strong> an artificial construct used to hold obligations, contracts, and accounts.</li>
      <li>Why understanding this distinction is the foundation of any status work.</li>
    </ul>`},
    {label:"Reflection Practice", html:`<ol>
      <li>Write every label the system has ever put on you (race, status, citizenship).</li>
      <li>Next to each, write: “Who benefits from me accepting this?”</li>
      <li>Circle the labels that feel <strong>false</strong> to your spirit.</li>
    </ol>`}
  ]),

  M("sc-2","Beginner",2,"Birth Certificates & the Estate Story",[
    {label:"What You’ll Learn", html:`<ul>
      <li>How a birth event gets turned into a record and a certificate.</li>
      <li>The difference between <strong>record</strong>, <strong>certificate</strong>, and <strong>your physical body</strong>.</li>
      <li>Why people talk about “estate” and “trust” when they mention birth certificates.</li>
    </ul>`},
    {label:"Key Concepts (High Level)", html:`<ul>
      <li><strong>Registration:</strong> recording a birth with a state office.</li>
      <li><strong>Certificate:</strong> certified copy of data, not the child itself.</li>
      <li><strong>Estate talk:</strong> theories around how that record is used in finance.
        We treat these theories as <em>claims to investigate</em>, not automatic fact.
      </li>
    </ul>`},
    {label:"Educational Notes", html:`<div class="callout">
      <strong>Important:</strong> Many status-correction teachings share interpretations that are not recognized by courts or governments.
      This academy is to help you understand those ideas, question them, and build your own informed path.
      Always consult qualified professionals before acting.
    </div>`},
    {label:"Journal Prompt", html:`<p>
      Write out in your own words how you currently understand your birth certificate.
      What do you believe it is? What do you believe it does? What do you <em>not</em> know yet?
    </p>`}
  ]),

  M("sc-3","Beginner",3,"Jurisdiction, Contracts & the “Strawman” Idea",[
    {label:"Jurisdiction Basics", html:`<ul>
      <li><strong>Jurisdiction</strong> = the scope of a court’s or authority’s power.</li>
      <li>Territory, subject-matter, and personal jurisdiction — three different pieces.</li>
      <li>Why “land vs. sea,” “public vs. private,” and similar phrases show up in sovereignty teachings.</li>
    </ul>`},
    {label:"The Strawman Concept (Educational Overview)", html:`<div class="callout">
      Many teachers describe a separate “strawman” or corporate shell with your ALL CAPS NAME.
      Some claims about this are debated or rejected in mainstream law.
      We will treat the strawman as a <strong>teaching metaphor</strong> to help you think through:
      <ul>
        <li>What is attached to the NAME on paper vs. your living being.</li>
        <li>How contracts are signed, assumed, or implied.</li>
      </ul>
    </div>`},
    {label:"Contracts & Consent", html:`<ul>
      <li>Written contracts vs. clickwrap vs. implied consent.</li>
      <li>Why reading, understanding, and negotiating terms is a core sovereign skill.</li>
      <li>The danger of thinking “no contract exists” when one clearly does.</li>
    </ul>`},
    {label:"Exercise", html:`<ol>
      <li>List 5 places you have consented to terms (banking, social media, phone, etc.).</li>
      <li>Highlight how many times you said “I accept” without reading.</li>
      <li>Write one promise: how will you approach contracts differently going forward?</li>
    </ol>`}
  ]),

  /* ========= DOCUMENTS & TRUSTS (Master) ========= */
  M("sc-4","Master",4,"Claiming the Living Man/Woman (Declarations)",[
    {label:"Scope of This Module", html:`<p>
      We are not drafting legal documents for you.
      Instead, you’ll learn the <strong>types of declarations</strong> people use in status work so you can study them
      and decide — with counsel if you choose — what fits your path.
    </p>`},
    {label:"Common Declaration Types (Educational Overview)", html:`<ul>
      <li><strong>Live Life Claim:</strong> statement that you are a living man/woman, not a corporate fiction.</li>
      <li><strong>Affidavit of Truth:</strong> sworn statement of facts as you understand them.</li>
      <li><strong>Declaration of Nationality:</strong> declaring your chosen nation/tribal identity.</li>
      <li><strong>Name/Appellation Notice:</strong> stating how you are to be addressed going forward.</li>
    </ul>`},
    {label:"Key Principles When Drafting (High-Level)", html:`<ul>
      <li>Clarity: write in simple, direct language.</li>
      <li>Truthfulness: only state what you can stand on and, if needed, prove.</li>
      <li>Notice: understand who you are addressing and why.</li>
      <li>Respect: avoid threats, fantasies, or hostile language that undermines your credibility.</li>
    </ul>`},
    {label:"Reflection / Drafting Practice", html:`<ol>
      <li>Write one paragraph beginning “I, [Your Appellation], am…” describing yourself as a living soul in plain language.</li>
      <li>Write one paragraph on the nation/tribe you identify with and why.</li>
      <li>These are <strong>drafts for your eyes only</strong>, not final legal documents.</li>
    </ol>`}
  ]),

  M("sc-5","Master",5,"Ecclesiastical Trusts & Tribal Nationhood",[
    {label:"Why Trusts Show Up in Status Work", html:`<ul>
      <li>Trusts separate <strong>control</strong>, <strong>benefit</strong>, and <strong>legal title</strong>.</li>
      <li>Many sovereign teachings encourage moving property and rights into a spiritual or ecclesiastical trust.</li>
      <li>Again: this is educational. The details need real legal and tax advice.</li>
    </ul>`},
    {label:"High-Level Trust Roles", html:`<ul>
      <li><strong>Grantor/Settlor:</strong> the one who creates the trust.</li>
      <li><strong>Trustee:</strong> the one who manages the trust property.</li>
      <li><strong>Beneficiary:</strong> the one who benefits from the trust.</li>
    </ul>`},
    {label:"Tribal Nationhood Overview", html:`<p>
      Many Indigenous and Moorish people feel called to operate as a <strong>nation within a nation</strong>, honoring
      ancestral law and spiritual authority. This path may involve:
    </p>
    <ul>
      <li>Choosing a tribal name and appellation format.</li>
      <li>Creating internal governance documents (constitutions, councils, declarations).</li>
      <li>Keeping a private record of members, oaths, and decisions.</li>
    </ul>`},
    {label:"Journal / Design Prompts", html:`<ol>
      <li>Describe in one page what your ideal spiritual/tribal nation feels like: values, culture, responsibilities.</li>
      <li>List 3 ways a trust or nation framework could protect your <em>future generations</em>, not just you.</li>
    </ol>`}
  ]),

  M("sc-6","Master",6,"Secured Party Creditor & UCC (Overview Only)",[
    {label:"Important Disclaimer", html:`<div class="callout">
      Secured Party Creditor (SPC) processes and UCC filings are controversial and interpreted in very different ways.
      Misusing these ideas can have serious consequences.
      This module is <strong>educational overview only</strong>. It is not instructions, not legal advice, and not a promise of outcomes.
    </div>`},
    {label:"What the UCC Is (Conceptually)", html:`<ul>
      <li><strong>Uniform Commercial Code (UCC):</strong> a model set of rules states use for commercial transactions.</li>
      <li>Articles cover things like sales, negotiable instruments, secured transactions, etc.</li>
      <li>Some status teachings use UCC language to describe private security interests in the “strawman.”</li>
    </ul>`},
    {label:"General SPC Ideas (as Taught in the Movement)", html:`<ul>
      <li>“Securing” a claim over the ALL CAPS NAME and related property.</li>
      <li>Filing notices that <em>you</em> are the main creditor and others are secondary.</li>
      <li>Using private agreements (security agreements, hold harmless, power of attorney) as a framework.</li>
    </ul>`},
    {label:"Critical Thinking Questions", html:`<ol>
      <li>What claims do SPC teachers make that you can actually verify with public law?</li>
      <li>What parts seem more symbolic or spiritual than legally accepted?</li>
      <li>What type of professional would you consult before filing anything (if you ever choose to)?</li>
    </ol>`}
  ]),

  /* ========= OPERATION & ENFORCEMENT (Right) ========= */
  M("sc-7","Right",7,"Right to Travel & Interacting with Authorities",[
    {label:"Right to Travel — Conceptual View", html:`<ul>
      <li>Many constitutions and human-rights documents recognize a general right to move and travel.</li>
      <li>Modern states regulate driving, licensing, and vehicles for safety and commerce.</li>
      <li>Tension: teachings that say “I need no license” vs. the reality of how police and courts operate.</li>
    </ul>`},
    {label:"Educational Focus (Not Evasion)", html:`<div class="callout">
      This academy does <strong>not</strong> teach you how to avoid tickets, hide from obligations, or resist lawful authority.
      The focus is: know your rights, stay calm, stay safe, and <strong>reduce harm</strong>.
    </div>`},
    {label:"Practical Wisdom for Encounters", html:`<ul>
      <li>Stay calm, breathe, and speak respectfully even when you disagree.</li>
      <li>You can usually ask: “Am I being detained or am I free to go?”</li>
      <li>You can ask for a lawyer and choose not to answer questions beyond basic ID where required by law.</li>
      <li>Document incidents afterward while details are fresh.</li>
    </ul>`},
    {label:"Reflection", html:`<ol>
      <li>Write how you <em>want</em> to show up energetically during police or authority encounters.</li>
      <li>Describe one boundary phrase you can use that is firm but respectful.</li>
    </ol>`}
  ]),

  M("sc-8","Right",8,"Recording, Publishing & Notice",[
    {label:"Why Recording Matters", html:`<ul>
      <li>Your declarations and documents don’t just exist — they can be <strong>recorded</strong> or <strong>witnessed</strong> in different ways.</li>
      <li>Private records (tribal registries, private notaries, internal ledgers).</li>
      <li>Public records (where permitted and appropriate, often via official offices).</li>
    </ul>`},
    {label:"Notice & Opportunity to Cure (Concept Level)", html:`<ul>
      <li>Many templates use a sequence: <strong>Notice → Reminder → Default</strong>.</li>
      <li>The idea is to give others a fair chance to respond before claiming harm or default.</li>
      <li>Real legal effect of such notices can vary widely — do not assume magic power.</li>
    </ul>`},
    {label:"Documentation Habits", html:`<ul>
      <li>Keep a clean folder structure for all your writings, dates, and signings.</li>
      <li>Log who received what, when, and how (mail, email, in-person).</li>
      <li>Use <strong>simple language</strong> to describe what happened instead of emotional rants.</li>
    </ul>`},
    {label:"Practice", html:`<ol>
      <li>Create a folder structure on your device or in physical binders for: Identity, Trust, Notices, Evidence.</li>
      <li>Write a sample “Notice of Concern” to a fictional agency in neutral, respectful tone.</li>
    </ol>`}
  ]),

  M("sc-9","Right",9,"Living as a Tribal National Day-to-Day",[
    {label:"From Theory to Lifestyle", html:`<p>
      Status correction is not just paperwork — it’s a way of walking.
      This module is about <strong>how you live</strong>: spiritually, financially, relationally, and ethically.
    </p>`},
    {label:"Core Lifestyles Shifts", html:`<ul>
      <li>Moving from victim mindset → responsible creator mindset.</li>
      <li>Keeping commitments you make, especially inside your nation/tribe.</li>
      <li>Building skills and value so you can support yourself and your people.</li>
    </ul>`},
    {label:"Community, Tribe & Governance", html:`<ul>
      <li>Nationhood is more than a document — it’s shared values and mutual aid.</li>
      <li>Healthy tribes have structure: councils, processes, and conflict resolution.</li>
      <li>Your word becomes law in your life; guard it.</li>
    </ul>`},
    {label:"Final Assignment", html:`<ol>
      <li>Write a 1–2 page “Living Constitution” for yourself: who you are, what you stand on, and how you will conduct commerce and relationships.</li>
      <li>Write one page on how you will use what you learned here to uplift others, not just escape systems.</li>
    </ol>`}
  ])
];

(function finalizeModules(){
  try{
    TOTAL_MODULES = (typeof modules !== "undefined" ? modules.length : TOTAL_MODULES);
  }catch{}
})();

/* ==============================
   INIT
============================== */
function initUI(){
  renderMenus();
  renderAccordion();
  updateProgress();
  if (modules && modules[0]) openModule(opened || modules[0].id, false);

  const y = el("year");
  if (y) y.textContent = new Date().getFullYear();

  if (inviteUnlocked && curriculumWrap) {
    curriculumWrap.classList.remove('locked');
  }

  if (toast) {
    toast.setAttribute("role","status");
    toast.setAttribute("aria-live","polite");
  }
}

btnAbout          && btnAbout.addEventListener("click", ()=> { if (modal) modal.style.display="block"; });
modalClose        && modalClose.addEventListener("click", ()=> { if (modal) modal.style.display="none"; });

window.addEventListener("beforeunload", ()=> {
  if (opened) localStorage.setItem("kly_open_status", opened);
});

window.addEventListener("load", async ()=>{
  initUI();
  try { await ensureWalletConnectUMD(); } catch (e) { console.warn("WC preload failed", e); }
});
</script>
</body>
</html>
