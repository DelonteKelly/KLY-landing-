<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KLY Launchpad - BNB Chain</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="KLY Launchpad - The premier platform for initial DEX offerings on BNB Chain">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #00ffe7;
      --secondary: #ff00aa;
      --bg-dark: #0b0b0b;
      --text-light: #e0e0e0;
      --success: #00ff88;
      --error: #ff3860;
      --warning: #ffaa00;
      --bnb-yellow: #F0B90B;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Rajdhani', sans-serif;
      background: linear-gradient(135deg, #050505, #0f0f0f);
      color: var(--text-light);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .card {
      background: rgba(15, 15, 15, 0.8);
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0, 255, 231, 0.3);
      text-align: center;
      width: 100%;
      max-width: 500px;
      border: 1px solid rgba(0, 255, 231, 0.1);
    }
    h1 {
      font-family: 'Orbitron', sans-serif;
      color: var(--primary);
      text-shadow: 0 0 10px var(--primary);
      margin-bottom: 0.5rem;
    }
    .network-badge {
      display: inline-block;
      background: rgba(240, 185, 11, 0.1);
      color: var(--bnb-yellow);
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      border: 1px solid var(--bnb-yellow);
    }
    .subtitle {
      color: var(--text-light);
      margin-bottom: 1.5rem;
      opacity: 0.9;
    }
    button {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      color: #000;
      font-weight: bold;
      padding: 12px 24px;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 1rem;
      width: 100%;
      font-size: 1rem;
      transition: all 0.2s ease;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 255, 231, 0.4);
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }
    #walletStatus {
      margin: 1rem 0;
      font-family: 'Orbitron', sans-serif;
      color: var(--primary);
      word-break: break-all;
      padding: 0.8rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
    }
    .token-info {
      margin-top: 1.5rem;
      text-align: left;
      background: rgba(0, 0, 0, 0.3);
      padding: 1rem;
      border-radius: 8px;
    }
    .token-balance {
      font-family: 'Orbitron', sans-serif;
      color: var(--primary);
      margin-top: 0.5rem;
    }
    .action-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(20, 20, 20, 0.95);
      padding: 1rem;
      border-left: 4px solid var(--primary);
      color: white;
      max-width: 300px;
      border-radius: 0 5px 5px 0;
      transform: translateX(110%);
      transition: transform 0.3s ease;
      z-index: 1000;
    }
    .notification.show {
      transform: translateX(0);
    }
    .notification.error {
      border-left-color: var(--error);
    }
    .notification.success {
      border-left-color: var(--success);
    }
    .notification.warning {
      border-left-color: var(--warning);
    }
    @media (max-width: 600px) {
      .card {
        padding: 1.5rem;
      }
      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>KLY LAUNCHPAD</h1>
    <div class="network-badge">
      <i class="fab fa-btc"></i> BNB Chain
    </div>
    <p class="subtitle">The premier platform for token launches on BNB Chain</p>
    
    <button id="connectWallet">
      <i class="fas fa-wallet"></i> <span id="buttonText">Connect Wallet</span>
    </button>
    <div id="walletStatus">Not connected</div>
    
    <div class="token-info" id="tokenInfo" style="display: none;">
      <h3>KLY Token Information</h3>
      <p>Contract: <span id="contractAddress">0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52</span></p>
      <div class="token-balance" id="tokenBalance">Balance: Loading...</div>
    </div>
    
    <div class="action-buttons" id="actionButtons" style="display: none;">
      <button id="getTokensButton"><i class="fas fa-coins"></i> Mint Tokens</button>
      <button id="viewExplorer"><i class="fas fa-external-link-alt"></i> View on Explorer</button>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    // Configuration
    const CONTRACT_ADDRESS = "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52";
    const BSC_CHAIN_ID = 56;
    const RPC_URLS = [
      "https://bsc-dataseed.binance.org/",
      "https://bsc-dataseed1.defibit.io/",
      "https://bsc-dataseed1.ninicoin.io/"
    ];
    
    // Enhanced ABI with common ERC-20 functions
    const TOKEN_ABI = [
      "function name() view returns (string)",
      "function symbol() view returns (string)",
      "function decimals() view returns (uint8)",
      "function totalSupply() view returns (uint256)",
      "function balanceOf(address) view returns (uint256)",
      "function transfer(address to, uint256 amount)",
      "function mintTo(address to, uint256 amount)"
    ];

    // DOM Elements
    const connectBtn = document.getElementById("connectWallet");
    const buttonText = document.getElementById("buttonText");
    const walletStatus = document.getElementById("walletStatus");
    const tokenInfo = document.getElementById("tokenInfo");
    const tokenBalance = document.getElementById("tokenBalance");
    const getTokensButton = document.getElementById("getTokensButton");
    const actionButtons = document.getElementById("actionButtons");
    const viewExplorer = document.getElementById("viewExplorer");
    const notification = document.getElementById("notification");
    const contractAddressEl = document.getElementById("contractAddress");

    // State
    let provider, signer, contract, userAddress;

    // Initialize
    window.addEventListener('DOMContentLoaded', init);

    async function init() {
      setupEventListeners();
      
      // Check if wallet is already connected
      if (window.ethereum && window.ethereum.selectedAddress) {
        await connectWallet();
      }
    }

    function setupEventListeners() {
      connectBtn.addEventListener('click', connectWallet);
      getTokensButton.addEventListener('click', mintTokens);
      viewExplorer.addEventListener('click', viewOnExplorer);
      
      if (window.ethereum) {
        window.ethereum.on('accountsChanged', handleAccountsChanged);
        window.ethereum.on('chainChanged', handleChainChanged);
      }
    }

    async function connectWallet() {
      if (!window.ethereum) {
        return showNotification("Please install MetaMask or a Web3 wallet", "error");
      }

      try {
        showNotification("Connecting wallet...", "warning");
        connectBtn.disabled = true;
        
        // Initialize provider
        provider = new ethers.providers.Web3Provider(window.ethereum);
        
        // Request account access
        await provider.send("eth_requestAccounts", []);
        
        // Check/switch network
        const network = await provider.getNetwork();
        if (network.chainId !== BSC_CHAIN_ID) {
          const switched = await switchToBSC();
          if (!switched) {
            connectBtn.disabled = false;
            return showNotification("Please switch to BNB Chain", "error");
          }
          // Reload after network switch
          window.location.reload();
          return;
        }

        // Get signer and address
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        
        // Update UI
        walletStatus.textContent = `${userAddress.substring(0, 6)}...${userAddress.substring(38)}`;
        buttonText.textContent = "Connected";
        connectBtn.disabled = true;
        
        // Initialize contract
        contract = new ethers.Contract(CONTRACT_ADDRESS, TOKEN_ABI, signer);
        
        // Verify contract exists
        const code = await provider.getCode(CONTRACT_ADDRESS);
        if (code === '0x') {
          tokenInfo.style.display = "none";
          actionButtons.style.display = "none";
          return showNotification("Contract not found at this address", "error");
        }

        // Load token info
        await loadTokenInfo();
        
        showNotification("Wallet connected successfully", "success");

      } catch (error) {
        console.error("Connection error:", error);
        connectBtn.disabled = false;
        
        let errorMsg = "Connection failed";
        if (error.code === 4001) {
          errorMsg = "Connection rejected by user";
        } else if (error.message.includes("User denied")) {
          errorMsg = "Connection cancelled";
        }
        
        showNotification(errorMsg, "error");
      }
    }

    async function switchToBSC() {
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0x38' }], // 0x38 = 56 in decimal (BSC)
        });
        return true;
      } catch (switchError) {
        // If chain not added, add it
        if (switchError.code === 4902) {
          try {
            await window.ethereum.request({
              method: 'wallet_addEthereumChain',
              params: [{
                chainId: '0x38',
                chainName: 'BNB Smart Chain',
                nativeCurrency: {
                  name: 'BNB',
                  symbol: 'BNB',
                  decimals: 18
                },
                rpcUrls: RPC_URLS,
                blockExplorerUrls: ['https://bscscan.com/']
              }]
            });
            return true;
          } catch (addError) {
            console.error("Error adding BSC:", addError);
            return false;
          }
        }
        return false;
      }
    }

    async function loadTokenInfo() {
      try {
        showNotification("Loading token information...", "warning");
        
        // Get token details
        const [symbol, decimals, balance] = await Promise.all([
          contract.symbol(),
          contract.decimals(),
          contract.balanceOf(userAddress)
        ]);
        
        // Update UI
        tokenBalance.textContent = `Balance: ${ethers.utils.formatUnits(balance, decimals)} ${symbol}`;
        tokenInfo.style.display = "block";
        actionButtons.style.display = "flex";
        
      } catch (error) {
        console.error("Token info error:", error);
        tokenBalance.textContent = "Balance: Error loading";
        showNotification("Could not load token information", "error");
      }
    }

    async function mintTokens() {
      if (!signer) {
        return showNotification("Please connect your wallet first", "error");
      }

      try {
        showNotification("Preparing mint transaction...", "warning");
        getTokensButton.disabled = true;
        getTokensButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        
        // Mint 100 tokens
        const tx = await contract.mintTo(
          userAddress,
          ethers.utils.parseUnits("100", 18),
          { gasLimit: 250000 }
        );
        
        showNotification(`Transaction submitted: ${tx.hash}`, "warning");
        
        // Wait for transaction to complete
        await tx.wait();
        
        // Refresh balance
        await loadTokenInfo();
        
        showNotification("Tokens minted successfully!", "success");
        
      } catch (error) {
        console.error("Minting error:", error);
        
        let errorMsg = "Mint failed";
        if (error.code === 4001) {
          errorMsg = "Transaction rejected by user";
        } else if (error.message.includes("revert")) {
          errorMsg = "Transaction reverted (not authorized?)";
        } else if (error.message.includes("mintTo")) {
          errorMsg = "Minting function not available";
        }
        
        showNotification(errorMsg, "error");
      } finally {
        getTokensButton.disabled = false;
        getTokensButton.innerHTML = '<i class="fas fa-coins"></i> Mint Tokens';
      }
    }

    function viewOnExplorer() {
      window.open(`https://bscscan.com/token/${CONTRACT_ADDRESS}`, "_blank");
    }

    function handleAccountsChanged(accounts) {
      if (accounts.length === 0) {
        // Wallet disconnected
        walletStatus.textContent = "Not connected";
        buttonText.textContent = "Connect Wallet";
        connectBtn.disabled = false;
        tokenInfo.style.display = "none";
        actionButtons.style.display = "none";
        showNotification("Wallet disconnected", "error");
      } else {
        // Account changed
        userAddress = accounts[0];
        walletStatus.textContent = `${userAddress.substring(0, 6)}...${userAddress.substring(38)}`;
        loadTokenInfo();
      }
    }

    function handleChainChanged(chainId) {
      // Reload when network changes
      window.location.reload();
    }

    function showNotification(message, type = "info") {
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      setTimeout(() => {
        notification.classList.remove("show");
      }, 5000);
    }
  </script>
</body>
</html>
