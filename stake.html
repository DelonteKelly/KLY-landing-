<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/GlitchPass.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/BloomPass.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.2/chroma.min.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ascension Portal | KLY Token</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
:root {
  --neon-green: #00ffe7;
  --neon-pink: #ff00aa;
  --neon-purple: #aa00ff;
  --neon-blue: #00aaff;
  --neon-orange: #ff6b00;
  --neon-yellow: #fff000;
  --dark-bg: #000000;
  --darker-bg: #0a0a0a;
  --panel-bg: rgba(0, 0, 0, 0.85);
  --text-primary: #e0e0e0;
  --text-secondary: #888888;
  --glow-green: 0 0 10px var(--neon-green);
  --glow-pink: 0 0 10px var(--neon-pink);
  --glow-purple: 0 0 10px var(--neon-purple);
  --glow-blue: 0 0 10px var(--neon-blue);
  --glow-orange: 0 0 10px var(--neon-orange);
  --transition-medium: 0.3s;
  --transition-slow: 0.6s;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Orbitron', 'Rajdhani', sans-serif;
  background: var(--dark-bg);
  color: var(--text-primary);
  margin: 0;
  padding: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
  background-image: 
    radial-gradient(circle at 20% 30%, rgba(0, 255, 231, 0.05) 0%, transparent 20%),
    radial-gradient(circle at 80% 70%, rgba(170, 0, 255, 0.05) 0%, transparent 20%),
    linear-gradient(to bottom, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.95));
}

/* Quantum Energy Grid Background */
.quantum-grid {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    linear-gradient(rgba(0, 255, 231, 0.02) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 255, 231, 0.02) 1px, transparent 1px);
  background-size: 50px 50px;
  z-index: -2;
  animation: gridMove 120s linear infinite;
}

@keyframes gridMove {
  0% { background-position: 0 0; }
  100% { background-position: 1000px 1000px; }
}

/* Animated background elements */
.background-element {
  position: fixed;
  border-radius: 50%;
  filter: blur(60px);
  opacity: 0.15;
  z-index: -1;
  animation: float 15s infinite ease-in-out;
}

.background-element:nth-child(1) {
  width: 300px;
  height: 300px;
  background: var(--neon-green);
  top: 10%;
  left: 10%;
  animation-delay: 0s;
}

.background-element:nth-child(2) {
  width: 400px;
  height: 400px;
  background: var(--neon-purple);
  top: 60%;
  left: 70%;
  animation-delay: 3s;
}

.background-element:nth-child(3) {
  width: 200px;
  height: 200px;
  background: var(--neon-pink);
  top: 30%;
  left: 80%;
  animation-delay: 6s;
}

@keyframes float {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  25% { transform: translate(20px, 20px) rotate(5deg); }
  50% { transform: translate(0, 30px) rotate(0deg); }
  75% { transform: translate(-20px, 20px) rotate(-5deg); }
}

/* Particle effects */
.particles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  pointer-events: none;
}

.particle {
  position: absolute;
  background: var(--neon-green);
  border-radius: 50%;
  opacity: 0.3;
  animation: particle-float linear infinite;
}

@keyframes particle-float {
  to { transform: translateY(-100vh); }
}

/* Holographic Interface Elements */
.holographic-line {
  position: absolute;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--neon-green), transparent);
  box-shadow: 0 0 10px var(--neon-green);
  transform-origin: left center;
  z-index: 1;
}

/* Main Header */
header {
  background: rgba(0, 0, 0, 0.7);
  border-bottom: 1px solid var(--neon-green);
  box-shadow: var(--glow-green);
  padding: 1rem 2rem;
  position: relative;
  z-index: 100;
  display: flex;
  justify-content: space-between;
  align-items: center;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.logo {
  font-size: 1.8rem;
  font-weight: 900;
  color: var(--neon-green);
  text-shadow: var(--glow-green);
  letter-spacing: 2px;
  display: flex;
  align-items: center;
  gap: 10px;
  position: relative;
}

.logo::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(90deg, var(--neon-green), var(--neon-purple));
  box-shadow: var(--glow-green);
  transform: scaleX(0);
  transform-origin: right;
  transition: transform 0.5s ease;
}

.logo:hover::after {
  transform: scaleX(1);
  transform-origin: left;
}

.logo-icon {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.nav-links {
  display: flex;
  gap: 1.5rem;
}

.nav-links a {
  color: var(--text-primary);
  text-decoration: none;
  font-weight: 700;
  font-size: 1rem;
  letter-spacing: 1.5px;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  background-color: rgba(0, 0, 0, 0.8);
  box-shadow: 
    0 0 8px var(--neon-green),
    inset 0 0 4px var(--neon-green),
    0 0 0 1px rgba(0, 255, 231, 0.3);
  transition: all var(--transition-medium) ease;
  position: relative;
  overflow: hidden;
  text-transform: uppercase;
}

.nav-links a::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    to bottom right,
    rgba(0, 255, 231, 0) 0%,
    rgba(0, 255, 231, 0) 30%,
    rgba(0, 255, 231, 0.3) 45%,
    rgba(0, 255, 231, 0) 60%,
    rgba(0, 255, 231, 0) 100%
  );
  transform: rotate(30deg);
  transition: all var(--transition-slow) ease;
}

.nav-links a:hover::before {
  animation: shine 1.5s infinite;
}

@keyframes shine {
  0% { left: -100%; top: -100%; }
  100% { left: 100%; top: 100%; }
}

.nav-links a:hover {
  color: var(--neon-green);
  text-shadow: 0 0 8px var(--neon-green);
  transform: translateY(-3px);
  box-shadow: 
    0 3px 15px var(--neon-green),
    inset 0 0 8px var(--neon-green),
    0 0 0 2px rgba(0, 255, 231, 0.5);
}

/* Hero Section with 3D Portal */
.hero {
  position: relative;
  padding: 4rem 2rem;
  text-align: center;
  overflow: hidden;
  height: 80vh;
  min-height: 600px;
  display: flex;
  align-items: center;
  justify-content: center;
  isolation: isolate;
}

.hero::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at center, rgba(0, 255, 231, 0.1) 0%, transparent 70%),
    linear-gradient(to bottom, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.2));
  z-index: -1;
}

.hero-content {
  max-width: 1200px;
  margin: 0 auto;
  position: relative;
  z-index: 2;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#portal3d-container {
  position: relative;
  width: 600px;
  height: 600px;
  margin: 0 auto;
  z-index: 1;
}

#portal3d {
  width: 100%;
  height: 100%;
  position: relative;
}

.portal-overlay-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  z-index: 10;
  pointer-events: none;
  width: 100%;
}

.portal-overlay-text h2 {
  font-size: 3rem;
  color: var(--neon-green);
  text-shadow: 0 0 20px var(--neon-green);
  margin-bottom: 1rem;
  letter-spacing: 5px;
  text-transform: uppercase;
  font-weight: 900;
  animation: textGlow 3s ease-in-out infinite alternate;
}

@keyframes textGlow {
  0% { text-shadow: 0 0 10px var(--neon-green); }
  100% { text-shadow: 0 0 30px var(--neon-green), 0 0 50px var(--neon-purple); }
}

.portal-overlay-text p {
  font-size: 1.2rem;
  color: var(--text-primary);
  text-shadow: 0 0 10px var(--neon-green);
  letter-spacing: 2px;
}

.portal-header {
  margin-top: 2rem;
  text-align: center;
}

.portal-header h1 {
  font-size: 4rem;
  background: linear-gradient(45deg, var(--neon-green), var(--neon-purple));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-shadow: 0 0 20px rgba(0, 255, 231, 0.3);
  letter-spacing: 5px;
  margin-bottom: 1rem;
  animation: titleGlow 5s ease infinite;
}

@keyframes titleGlow {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

.portal-header p {
  font-size: 1.2rem;
  color: var(--text-primary);
  max-width: 800px;
  margin: 0 auto;
  line-height: 1.6;
  text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

/* Main Content Grid */
.portal-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  max-width: 1400px;
  margin: 0 auto;
  padding: 2rem;
  position: relative;
}

/* Glassmorphism Panels */
.gradient-border {
  position: relative;
  border-radius: 16px;
  overflow: hidden;
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 8px 32px rgba(0, 255, 231, 0.1);
  transition: all 0.5s ease;
}

.gradient-border::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: linear-gradient(
    45deg,
    var(--neon-green),
    var(--neon-purple),
    var(--neon-pink),
    var(--neon-green)
  );
  background-size: 400% 400%;
  z-index: -1;
  border-radius: 18px;
  animation: gradient-border 6s ease infinite;
  opacity: 0.7;
}

@keyframes gradient-border {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.stake-panel, .nft-panel {
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid rgba(0, 255, 231, 0.2);
  border-radius: 16px;
  padding: 2rem;
  transition: all var(--transition-medium) ease;
  position: relative;
  overflow: hidden;
}

.stake-panel:hover, .nft-panel:hover {
  transform: translateY(-5px) scale(1.01);
  box-shadow: 0 10px 30px rgba(0, 255, 231, 0.3);
}

.panel-title {
  font-size: 1.5rem;
  color: var(--neon-green);
  margin-bottom: 1.5rem;
  position: relative;
  display: inline-block;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.panel-title::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--neon-green);
  box-shadow: var(--glow-green);
  transform: scaleX(0);
  transform-origin: right;
  transition: transform 0.5s ease;
}

.panel-title:hover::after {
  transform: scaleX(1);
  transform-origin: left;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 2rem;
}

.stat-item {
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid var(--neon-green);
  border-radius: 8px;
  padding: 1rem;
  transition: all var(--transition-medium) ease;
  position: relative;
  overflow: hidden;
}

.stat-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    135deg,
    rgba(0, 255, 231, 0.05) 0%,
    rgba(170, 0, 255, 0.05) 50%,
    rgba(0, 255, 231, 0.05) 100%
  );
  z-index: 0;
}

.stat-item:hover {
  transform: translateY(-3px);
  box-shadow: var(--glow-green);
}

.stat-label {
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 5px;
  position: relative;
  z-index: 1;
}

.stat-value {
  font-size: 1.2rem;
  color: var(--neon-green);
  font-weight: bold;
  text-shadow: 0 0 5px var(--neon-green);
  position: relative;
  z-index: 1;
}

/* Interactive Buttons */
.wallet-btn {
  width: 100%;
  padding: 1rem;
  background: linear-gradient(135deg, var(--neon-green), var(--neon-purple));
  color: #000;
  border: none;
  border-radius: 8px;
  font-family: 'Orbitron', sans-serif;
  font-weight: bold;
  cursor: pointer;
  transition: all var(--transition-medium) ease;
  margin-bottom: 1.5rem;
  box-shadow: 0 0 15px var(--neon-green);
  position: relative;
  overflow: hidden;
  text-transform: uppercase;
  letter-spacing: 1px;
  z-index: 1;
}

.wallet-btn::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    to right,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0.2) 50%,
    rgba(255, 255, 255, 0) 100%
  );
  transform: translateX(-100%);
  transition: all var(--transition-slow) ease;
}

.wallet-btn:hover::after {
  transform: translateX(100%);
}

.wallet-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 0 25px var(--neon-purple);
}

/* Form Elements */
.stake-form {
  margin-top: 1.5rem;
}

.input-group {
  margin-bottom: 1.5rem;
  position: relative;
}

.input-group label {
  display: block;
  margin-bottom: 0.5rem;
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.input-group input, .input-group textarea {
  width: 100%;
  padding: 0.8rem;
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid var(--neon-green);
  border-radius: 8px;
  color: var(--text-primary);
  font-family: 'Orbitron', sans-serif;
  transition: all var(--transition-medium) ease;
}

.input-group input:focus, .input-group textarea:focus {
  outline: none;
  border-color: var(--neon-purple);
  box-shadow: 0 0 10px var(--neon-purple);
}

.input-group textarea {
  min-height: 100px;
  resize: vertical;
}

.input-group .max-btn {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0, 255, 231, 0.2);
  color: var(--neon-green);
  border: 1px solid var(--neon-green);
  border-radius: 4px;
  padding: 0.2rem 0.5rem;
  font-size: 0.7rem;
  cursor: pointer;
  transition: all var(--transition-medium) ease;
}

.input-group .max-btn:hover {
  background: rgba(0, 255, 231, 0.4);
}

.action-btn {
  width: 100%;
  padding: 1rem;
  background: linear-gradient(135deg, var(--neon-green), var(--neon-pink));
  color: #000;
  border: none;
  border-radius: 8px;
  font-family: 'Orbitron', sans-serif;
  font-weight: bold;
  cursor: pointer;
  transition: all var(--transition-medium) ease;
  margin-top: 1rem;
  box-shadow: 0 0 15px var(--neon-green);
  position: relative;
  overflow: hidden;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.action-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 0 25px var(--neon-pink);
}

.action-btn.secondary {
  background: linear-gradient(135deg, var(--neon-purple), var(--neon-blue));
  box-shadow: 0 0 15px var(--neon-purple);
}

.action-btn.secondary:hover {
  box-shadow: 0 0 25px var(--neon-blue);
}

/* NFT Display */
.nft-display {
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid var(--neon-green);
  border-radius: 8px;
  padding: 1.5rem;
  text-align: center;
  margin-bottom: 2rem;
  min-height: 200px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
  overflow: hidden;
}

.nft-display::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    linear-gradient(
      135deg,
      rgba(0, 255, 231, 0.05) 0%,
      rgba(170, 0, 255, 0.05) 50%,
      rgba(0, 255, 231, 0.05) 100%
    );
  z-index: 0;
}

.nft-image {
  max-width: 150px;
  border-radius: 8px;
  margin-bottom: 1rem;
  box-shadow: 0 0 15px var(--neon-green);
  transition: all var(--transition-medium) ease;
  position: relative;
  z-index: 1;
  border: 2px solid var(--neon-green);
}

.nft-image:hover {
  transform: scale(1.05);
  box-shadow: 0 0 25px var(--neon-purple);
}

.nft-name {
  font-size: 1.2rem;
  color: var(--neon-green);
  text-shadow: 0 0 5px var(--neon-green);
  position: relative;
  z-index: 1;
}

.nft-attributes {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  justify-content: center;
  margin-top: 1rem;
  position: relative;
  z-index: 1;
}

.nft-attribute {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid var(--neon-green);
  border-radius: 4px;
  padding: 0.3rem 0.6rem;
  font-size: 0.8rem;
}

/* Transaction Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  backdrop-filter: blur(5px);
  opacity: 0;
  visibility: hidden;
  transition: all var(--transition-medium) ease;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: var(--panel-bg);
  border: 1px solid var(--neon-green);
  border-radius: 16px;
  padding: 2rem;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 0 30px var(--neon-green);
  transform: translateY(20px);
  transition: all var(--transition-medium) ease;
  position: relative;
  overflow: hidden;
}

.modal-overlay.active .modal-content {
  transform: translateY(0);
}

.modal-content::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    linear-gradient(
      135deg,
      rgba(0, 255, 231, 0.05) 0%,
      rgba(170, 0, 255, 0.05) 50%,
      rgba(0, 255, 231, 0.05) 100%
    );
  z-index: -1;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.modal-title {
  font-size: 1.5rem;
  color: var(--neon-green);
  margin: 0;
  text-shadow: var(--glow-green);
}

.modal-close {
  background: none;
  border: none;
  color: var(--text-primary);
  font-size: 1.5rem;
  cursor: pointer;
  transition: all var(--transition-medium) ease;
}

.modal-close:hover {
  color: var(--neon-green);
  transform: rotate(90deg);
}

.tx-details {
  margin-bottom: 1.5rem;
}

.tx-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.8rem;
  padding-bottom: 0.8rem;
  border-bottom: 1px solid rgba(0, 255, 231, 0.2);
}

.tx-label {
  color: var(--text-secondary);
}

.tx-value {
  color: var(--text-primary);
  font-weight: bold;
}

.tx-fee {
  color: var(--neon-orange);
}

.tx-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
}

.tx-btn {
  flex: 1;
  padding: 0.8rem;
  border: none;
  border-radius: 8px;
  font-family: 'Orbitron', sans-serif;
  font-weight: bold;
  cursor: pointer;
  transition: all var(--transition-medium) ease;
}

.tx-btn-cancel {
  background: rgba(255, 0, 0, 0.2);
  color: #ff5555;
  border: 1px solid #ff5555;
}

.tx-btn-confirm {
  background: linear-gradient(135deg, var(--neon-green), var(--neon-purple));
  color: #000;
}

.tx-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 255, 231, 0.3);
}

/* Loading spinner */
.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(0, 255, 231, 0.3);
  border-radius: 50%;
  border-top-color: var(--neon-green);
  animation: spin 1s ease-in-out infinite;
  margin-right: 10px;
  vertical-align: middle;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Progress bar */
.progress-container {
  width: 100%;
  background: rgba(0, 0, 0, 0.5);
  border-radius: 8px;
  margin: 1rem 0;
  overflow: hidden;
  border: 1px solid var(--neon-green);
}

.progress-bar {
  height: 10px;
  background: linear-gradient(90deg, var(--neon-green), var(--neon-purple));
  width: 0%;
  transition: width 0.3s ease;
}

/* Toast notifications */
.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1100;
}

.toast {
  background: var(--panel-bg);
  border: 1px solid var(--neon-green);
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 0 20px rgba(0, 255, 231, 0.3);
  display: flex;
  align-items: center;
  gap: 10px;
  transform: translateX(120%);
  transition: all 0.3s ease;
  max-width: 300px;
}

.toast.show {
  transform: translateX(0);
}

.toast.success {
  border-color: var(--neon-green);
}

.toast.error {
  border-color: #ff5555;
}

.toast-icon {
  font-size: 1.2rem;
}

.toast.success .toast-icon {
  color: var(--neon-green);
}

.toast.error .toast-icon {
  color: #ff5555;
}

.toast-message {
  flex: 1;
}

.toast-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
}

/* Analytics Section */
.analytics-panel {
  grid-column: 1 / -1;
  background: var(--panel-bg);
  border: 1px solid rgba(0, 255, 231, 0.2);
  border-radius: 16px;
  padding: 2rem;
  margin-top: 2rem;
}

.analytics-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
}

.analytics-item {
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid var(--neon-green);
  border-radius: 8px;
  padding: 1rem;
  text-align: center;
  transition: all var(--transition-medium) ease;
}

.analytics-item:hover {
  transform: translateY(-5px);
  box-shadow: var(--glow-green);
}

.analytics-value {
  font-size: 1.5rem;
  color: var(--neon-green);
  font-weight: bold;
  margin: 0.5rem 0;
}

.analytics-label {
  color: var(--text-secondary);
  font-size: 0.9rem;
}

/* Tier system */
.tiers-container {
  display: flex;
  justify-content: space-between;
  margin: 2rem 0;
  gap: 1rem;
}

.tier {
  flex: 1;
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid var(--neon-green);
  border-radius: 8px;
  padding: 1.5rem;
  text-align: center;
  transition: all var(--transition-medium) ease;
  position: relative;
  overflow: hidden;
}

.tier:hover {
  transform: translateY(-5px);
  box-shadow: var(--glow-green);
}

.tier::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: var(--neon-green);
  box-shadow: var(--glow-green);
}

.tier.tier-1::before {
  background: var(--neon-green);
}

.tier.tier-2::before {
  background: var(--neon-blue);
}

.tier.tier-3::before {
  background: var(--neon-purple);
}

.tier.tier-4::before {
  background: var(--neon-pink);
}

.tier-name {
  font-size: 1.2rem;
  color: var(--neon-green);
  margin-bottom: 1rem;
  text-transform: uppercase;
}

.tier-requirement {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin-bottom: 1rem;
}

.tier-benefits {
  text-align: left;
  font-size: 0.9rem;
  margin-top: 1rem;
}

.tier-benefits li {
  margin-bottom: 0.5rem;
  position: relative;
  padding-left: 1.5rem;
}

.tier-benefits li::before {
  content: '✓';
  position: absolute;
  left: 0;
  color: var(--neon-green);
}

/* Achievement System */
.achievements-panel {
  grid-column: 1 / -1;
  background: var(--panel-bg);
  border: 1px solid rgba(0, 255, 231, 0.2);
  border-radius: 16px;
  padding: 2rem;
  margin-top: 2rem;
}

.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.achievement-badge {
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid var(--neon-green);
  border-radius: 8px;
  padding: 1rem;
  text-align: center;
  transition: all var(--transition-medium) ease;
  position: relative;
  overflow: hidden;
}

.achievement-badge::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    135deg,
    rgba(0, 255, 231, 0.05) 0%,
    rgba(170, 0, 255, 0.05) 50%,
    rgba(0, 255, 231, 0.05) 100%
  );
  z-index: 0;
}

.achievement-badge i {
  font-size: 2rem;
  color: var(--neon-green);
  margin-bottom: 0.5rem;
  display: block;
}

.achievement-badge h4 {
  margin: 0.5rem 0;
  color: var(--neon-green);
}

.achievement-badge p {
  font-size: 0.8rem;
  color: var(--text-secondary);
  margin: 0;
}

.achievement-badge.locked {
  opacity: 0.5;
  filter: grayscale(80%);
}

.achievement-badge.locked i {
  color: var(--text-secondary);
}

.achievement-badge.locked h4 {
  color: var(--text-secondary);
}

/* Disconnect Button */
.disconnect-btn {
  background: rgba(255, 0, 0, 0.2);
  color: #ff5555;
  border: 1px solid #ff5555;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-family: 'Orbitron', sans-serif;
  cursor: pointer;
  transition: all var(--transition-medium) ease;
  margin-left: 1rem;
  display: flex;
  align-items: center;
  gap: 5px;
}

.disconnect-btn:hover {
  background: rgba(255, 0, 0, 0.3);
  transform: translateY(-2px);
}

/* Metamask Fallback */
.metamask-fallback {
  display: none;
  background: rgba(255, 165, 0, 0.1);
  border: 1px solid var(--neon-orange);
  border-radius: 8px;
  padding: 1rem;
  margin-top: 1rem;
  text-align: center;
}

.metamask-fallback p {
  color: var(--neon-orange);
  margin-bottom: 1rem;
}

.metamask-btn {
  background: linear-gradient(135deg, #f6851b, #e2761b);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 0.8rem 1.5rem;
  font-family: 'Orbitron', sans-serif;
  font-weight: bold;
  cursor: pointer;
  transition: all var(--transition-medium) ease;
}

.metamask-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 0 15px #f6851b;
}

/* Status Messages */
.status-message {
  margin: 1rem 0;
  font-weight: bold;
  transition: all 0.3s ease;
  text-align: center;
}

.status-success {
  color: var(--neon-green);
  text-shadow: 0 0 5px var(--neon-green);
}

.status-error {
  color: #ff5555;
  text-shadow: 0 0 5px #ff5555;
}

/* Responsive Design */
@media (max-width: 1024px) {
  .analytics-grid {
    grid-template-columns: 1fr 1fr;
  }
  
  .tiers-container {
    flex-wrap: wrap;
  }
  
  .tier {
    min-width: calc(50% - 0.5rem);
  }
  
  #portal3d-container {
    width: 500px;
    height: 500px;
  }
}

@media (max-width: 768px) {
  .portal-container {
    grid-template-columns: 1fr;
    padding: 1rem;
  }
  
  .portal-header h1 {
    font-size: 2.5rem;
  }
  
  .nav-links {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    background: var(--panel-bg);
    flex-direction: column;
    padding: 1rem;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
    z-index: 99;
  }
  
  .nav-links.active {
    display: flex;
  }
  
  .mobile-menu-btn {
    display: block;
  }
  
  .analytics-grid {
    grid-template-columns: 1fr;
  }
  
  #portal3d-container {
    width: 400px;
    height: 400px;
  }
  
  .portal-overlay-text h2 {
    font-size: 2rem;
  }
}

@media (max-width: 480px) {
  .portal-header h1 {
    font-size: 2rem;
  }
  
  .tx-actions {
    flex-direction: column;
  }
  
  .tier {
    min-width: 100%;
  }
  
  header {
    padding: 1rem;
  }
  
  .logo {
    font-size: 1.5rem;
  }
  
  #portal3d-container {
    width: 300px;
    height: 300px;
  }
  
  .portal-overlay-text h2 {
    font-size: 1.5rem;
  }
  
  .portal-overlay-text p {
    font-size: 1rem;
  }
  
  .hero {
    height: 70vh;
  }
}

/* Holographic Data Visualization */
.data-visualization {
  position: relative;
  height: 200px;
  margin: 2rem 0;
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid var(--neon-green);
  border-radius: 8px;
  overflow: hidden;
}

.data-line {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--neon-green);
  box-shadow: 0 0 10px var(--neon-green);
}

.data-point {
  position: absolute;
  width: 8px;
  height: 8px;
  background: var(--neon-green);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  box-shadow: 0 0 10px var(--neon-green);
}

/* Energy Pulse Effect */
@keyframes pulseEnergy {
  0% { transform: scale(0.95); opacity: 0.7; }
  50% { transform: scale(1.05); opacity: 1; }
  100% { transform: scale(0.95); opacity: 0.7; }
}

.pulse {
  animation: pulseEnergy 2s infinite ease-in-out;
}

/* Digital Rain Effect (for future use) */
.digital-rain {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  opacity: 0.1;
  pointer-events: none;
}

/* Floating UI Elements */
.floating-element {
  position: absolute;
  animation: float 8s ease-in-out infinite;
}

/* Special Effects for Large Stakes */
.mega-stake-effect {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle, rgba(0, 255, 231, 0.2) 0%, transparent 70%);
  z-index: 1001;
  pointer-events: none;
  opacity: 0;
  transition: opacity 1s ease;
}

/* 3D Card Flip Effect */
.card-3d {
  transform-style: preserve-3d;
  transition: transform 1s;
}

.card-3d:hover {
  transform: rotateY(15deg) rotateX(10deg);
}

/* Advanced Glow Effects */
.glow-text {
  text-shadow: 0 0 10px currentColor;
}

.glow-box {
  box-shadow: 0 0 20px currentColor;
}

/* Cyberpunk Scanlines Overlay */
.scanlines {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    linear-gradient(
      rgba(0, 255, 231, 0.03) 1px, 
      transparent 1px
    );
  background-size: 100% 2px;
  z-index: 9999;
  pointer-events: none;
  opacity: 0.3;
  animation: scanline 8s linear infinite;
}

@keyframes scanline {
  from { background-position: 0 0; }
  to { background-position: 0 100%; }
}
  </style>
</head>
<body>
  <!-- Quantum Energy Grid Background -->
  <div class="quantum-grid"></div>
  
  <!-- Background elements -->
  <div class="background-element"></div>
  <div class="background-element"></div>
  <div class="background-element"></div>
  
  <!-- Particle effects -->
  <div class="particles" id="particles"></div>
  
  <!-- Cyberpunk Scanlines Effect -->
  <div class="scanlines"></div>
  
  <!-- Toast notifications container -->
  <div class="toast-container" id="toastContainer"></div>

  <header>
    <div class="logo">
      <i class="fas fa-cubes logo-icon"></i>
      <span>KLY TOKEN</span>
    </div>
    <button class="mobile-menu-btn" id="mobileMenuBtn">
      <i class="fas fa-bars"></i>
    </button>
    <div class="nav-links" id="navLinks">
      <a href="/portal.html"><i class="fas fa-door-open"></i> Portal</a>
      <a href="/kly-academy.html"><i class="fas fa-graduation-cap"></i> Academy</a>
      <a href="/oracle.html"><i class="fas fa-eye"></i> Oracle</a>
    </div>
  </header>

  <main>
    <div class="hero">
      <div id="portal3d-container">
        <div id="portal3d"></div>
        <div class="portal-overlay-text">
          <h2>ENTER THE ASCENSION</h2>
          <p>Stake to activate the portal</p>
        </div>
      </div>
      <div class="hero-content">
        <div class="portal-header">
          <h1>ASCENSION PORTAL</h1>
          <p>Stake KLY tokens, mint Ascenders NFTs, and unlock exclusive rewards in our decentralized ecosystem. Earn passive income while participating in the future of digital assets.</p>
        </div>
      </div>
    </div>

    <div class="portal-container">
      <div class="stake-panel gradient-border">
        <h2 class="panel-title"><i class="fas fa-lock"></i> STAKING VAULT</h2>
        
        <div class="wallet-connect-container">
          <button class="wallet-btn" id="connectWallet">
            <i class="fas fa-wallet"></i> CONNECT WALLET
          </button>
          <button class="disconnect-btn" id="disconnectWallet" style="display: none;">
            <i class="fas fa-power-off"></i> DISCONNECT
          </button>
        </div>
        
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-label"><i class="fas fa-chart-line"></i> TVL</div>
            <div class="stat-value" id="tvlValue">1,250,000 KLY</div>
          </div>
          <div class="stat-item">
            <div class="stat-label"><i class="fas fa-coins"></i> Your Staked</div>
            <div class="stat-value" id="stakedValue">0 KLY</div>
          </div>
          <div class="stat-item">
            <div class="stat-label"><i class="fas fa-gift"></i> Daily Reward</div>
            <div class="stat-value" id="rewardValue">12.5 KLY</div>
          </div>
          <div class="stat-item">
            <div class="stat-label"><i class="fas fa-percentage"></i> APY</div>
            <div class="stat-value" id="apyValue">365%</div>
          </div>
        </div>
        
        <div class="stake-form">
          <div class="input-group">
            <label for="stakeAmount"><i class="fas fa-arrow-up"></i> Amount to Stake</label>
            <input type="number" id="stakeAmount" placeholder="Enter KLY amount">
            <button class="max-btn" id="maxBtn">MAX</button>
          </div>
          <button class="action-btn" id="stakeBtn">
            <i class="fas fa-lock"></i> STAKE KLY
          </button>
          <button class="action-btn secondary" id="claimBtn" style="display: none;">
            <i class="fas fa-hand-holding-usd"></i> CLAIM REWARDS
          </button>
          <button class="action-btn secondary" id="unstakeBtn" style="display: none;">
            <i class="fas fa-unlock"></i> UNSTAKE KLY
          </button>
        </div>
      </div>

      <div id="transactionStatus" class="status-message"></div>

      <div class="nft-panel gradient-border">
        <h2 class="panel-title"><i class="fas fa-crown"></i> ASCENDERS NFT</h2>
        
        <div class="nft-display">
          <img src="https://via.placeholder.com/150/000000/00ffe7?text=KLY+NFT" alt="Ascender NFT" class="nft-image" id="nftImage">
          <div class="nft-name" id="nftName">Connect Wallet to View</div>
          <div class="nft-attributes" id="nftAttributes">
            <!-- Attributes will be added dynamically -->
          </div>
        </div>
        
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-label"><i class="fas fa-layer-group"></i> Total Minted</div>
            <div class="stat-value">1,025</div>
          </div>
          <div class="stat-item">
            <div class="stat-label"><i class="fas fa-tag"></i> Mint Price</div>
            <div class="stat-value">500 KLY</div>
          </div>
          <div class="stat-item">
            <div class="stat-label"><i class="fas fa-fire"></i> Rarity</div>
            <div class="stat-value" id="nftRarity">Common</div>
          </div>
          <div class="stat-item">
            <div class="stat-label"><i class="fas fa-star"></i> Tier</div>
            <div class="stat-value" id="nftTier">1</div>
          </div>
        </div>
        
        <button class="action-btn" id="mintBtn">
          <i class="fas fa-plus-circle"></i> MINT ASCENDER
        </button>
        
        <div class="metamask-fallback" id="metamaskFallback">
          <p><i class="fas fa-exclamation-triangle"></i> Having trouble with WalletConnect? Try MetaMask directly:</p>
          <button class="metamask-btn" id="metamaskBtn">
            <i class="fab fa-ethereum"></i> Connect with MetaMask
          </button>
        </div>
      </div>
      
      <!-- Achievement System -->
      <div class="achievements-panel">
        <h2 class="panel-title"><i class="fas fa-trophy"></i> ACHIEVEMENTS</h2>
        <div class="achievements-grid" id="achievementsContainer">
          <div class="achievement-badge">
            <i class="fas fa-seedling"></i>
            <h4>First Stake</h4>
            <p>Make your first KLY stake</p>
          </div>
          <div class="achievement-badge locked">
            <i class="fas fa-medal"></i>
            <h4>KLY Veteran</h4>
            <p>Stake for 30+ days</p>
          </div>
          <div class="achievement-badge locked">
            <i class="fas fa-trophy"></i>
            <h4>Top 100 Staker</h4>
            <p>Reach top 100 by TVL</p>
          </div>
          <div class="achievement-badge locked">
            <i class="fas fa-gem"></i>
            <h4>NFT Collector</h4>
            <p>Mint 5+ Ascenders</p>
          </div>
        </div>
      </div>
      
      <!-- Tier System -->
      <div class="analytics-panel">
        <h2 class="panel-title"><i class="fas fa-medal"></i> TIER SYSTEM</h2>
        <div class="tiers-container">
          <div class="tier tier-1">
            <h3 class="tier-name">Initiate</h3>
            <div class="tier-requirement">Stake 1,000+ KLY</div>
            <ul class="tier-benefits">
              <li>Basic rewards (365% APY)</li>
              <li>Access to community</li>
              <li>Monthly airdrops</li>
            </ul>
          </div>
          <div class="tier tier-2">
            <h3 class="tier-name">Adept</h3>
            <div class="tier-requirement">Stake 5,000+ KLY</div>
            <ul class="tier-benefits">
              <li>Enhanced rewards (400% APY)</li>
              <li>Exclusive NFT drops</li>
              <li>Governance voting rights</li>
            </ul>
          </div>
          <div class="tier tier-3">
            <h3 class="tier-name">Ascendant</h3>
            <div class="tier-requirement">Stake 25,000+ KLY</div>
            <ul class="tier-benefits">
              <li>Premium rewards (450% APY)</li>
              <li>VIP event access</li>
              <li>Early product access</li>
            </ul>
          </div>
          <div class="tier tier-4">
            <h3 class="tier-name">Archon</h3>
            <div class="tier-requirement">Stake 100,000+ KLY</div>
            <ul class="tier-benefits">
              <li>Elite rewards (500% APY)</li>
              <li>1-on-1 with team</li>
              <li>Revenue share</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="analytics-panel">
        <h2 class="panel-title"><i class="fas fa-chart-pie"></i> STAKING ANALYTICS</h2>
        <div class="analytics-grid">
          <div class="analytics-item">
            <div class="analytics-label">Total Value Locked</div>
            <div class="analytics-value" id="analyticsTvl">1,250,000 KLY</div>
            <div class="analytics-label">Across all vaults</div>
          </div>
          <div class="analytics-item">
            <div class="analytics-label">Current APY</div>
            <div class="analytics-value" id="analyticsApy">365%</div>
            <div class="analytics-label">Annual Percentage Yield</div>
          </div>
          <div class="analytics-item">
            <div class="analytics-label">Total Stakers</div>
            <div class="analytics-value" id="analyticsStakers">1,842</div>
            <div class="analytics-label">Active participants</div>
          </div>
          <div class="analytics-item">
            <div class="analytics-label">Daily Rewards</div>
            <div class="analytics-value" id="analyticsRewards">45,000 KLY</div>
            <div class="analytics-label">Distributed to stakers</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Transaction Modal -->
  <div class="modal-overlay" id="txModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-file-signature"></i> TRANSACTION CONFIRMATION</h3>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      <div class="tx-details">
        <div class="tx-row">
          <span class="tx-label">Network:</span>
          <span class="tx-value" id="txNetwork">BNB Smart Chain</span>
        </div>
        <div class="tx-row">
          <span class="tx-label">Request from:</span>
          <span class="tx-value">kellylegacyestates.com</span>
        </div>
        <div class="tx-row">
          <span class="tx-label">Transaction Type:</span>
          <span class="tx-value" id="txType">NFT Mint</span>
        </div>
        <div class="tx-row">
          <span class="tx-label">Network Fee:</span>
          <span class="tx-value tx-fee" id="txFee">0.0262 BNB ($20.67)</span>
        </div>
        <div class="tx-row">
          <span class="tx-label">Speed:</span>
          <span class="tx-value">Site suggested</span>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="txProgress"></div>
        </div>
      </div>
      <div class="tx-actions">
        <button class="tx-btn tx-btn-cancel" id="cancelTx"><i class="fas fa-times"></i> CANCEL</button>
        <button class="tx-btn tx-btn-confirm" id="confirmTx"><i class="fas fa-check"></i> CONFIRM</button>
      </div>
    </div>
  </div>

  <!-- Mega Stake Effect (hidden by default) -->
  <div class="mega-stake-effect" id="megaStakeEffect"></div>

<script>
  // Enhanced 3D Portal with Advanced Effects
  let portalScene, portalCamera, portalRenderer, portal, composer;
  let isMouseOver = false;
  let mouseX = 0, mouseY = 0;
  let particleSystem;
  
  function initPortal() {
    // Scene setup
    portalScene = new THREE.Scene();
    portalScene.background = null;
    
    // Camera setup
    portalCamera = new THREE.PerspectiveCamera(60, 1, 0.1, 1000);
    portalCamera.position.z = 30;
    
    // Renderer setup with enhanced settings
    portalRenderer = new THREE.WebGLRenderer({ 
      antialias: true,
      alpha: true,
      powerPreference: "high-performance"
    });
    portalRenderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    portalRenderer.setSize(600, 600);
    portalRenderer.domElement.style.width = '100%';
    portalRenderer.domElement.style.height = '100%';
    document.getElementById('portal3d').appendChild(portalRenderer.domElement);
    
    // Create complex portal geometry
    const geometry = new THREE.TorusKnotGeometry(8, 3, 256, 32);
    
    // Advanced material with multiple effects
    const material = new THREE.MeshPhongMaterial({
      color: 0x000000,
      emissive: 0x00ff00,
      emissiveIntensity: 0.5,
      specular: 0x00ffaa,
      shininess: 100,
      transparent: true,
      opacity: 0.9,
      wireframe: true,
      wireframeLinewidth: 2
    });
    
    portal = new THREE.Mesh(geometry, material);
    portalScene.add(portal);
    
    // Enhanced lighting setup
    const ambientLight = new THREE.AmbientLight(0x00ff00, 0.3);
    portalScene.add(ambientLight);
    
    const directionalLight1 = new THREE.DirectionalLight(0x00ff88, 1);
    directionalLight1.position.set(1, 1, 1);
    portalScene.add(directionalLight1);
    
    const directionalLight2 = new THREE.DirectionalLight(0xaa00ff, 0.5);
    directionalLight2.position.set(-1, -1, 1);
    portalScene.add(directionalLight2);
    
    // Create particle system with more complexity
    const particleCount = 2000;
    const particles = new THREE.BufferGeometry();
    const posArray = new Float32Array(particleCount * 3);
    const colorArray = new Float32Array(particleCount * 3);
    const sizeArray = new Float32Array(particleCount);
    
    for(let i = 0; i < particleCount * 3; i++) {
      posArray[i] = (Math.random() - 0.5) * 20;
      
      // Color particles based on position
      if(i % 3 === 0) {
        colorArray[i] = 0.2 + Math.random() * 0.8; // R
        colorArray[i+1] = 0.5 + Math.random() * 0.5; // G
        colorArray[i+2] = 0.7 + Math.random() * 0.3; // B
      }
      
      if(i % 3 === 0) {
        sizeArray[i/3] = 0.1 + Math.random() * 0.3;
      }
    }
    
    particles.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
    particles.setAttribute('color', new THREE.BufferAttribute(colorArray, 3));
    particles.setAttribute('size', new THREE.BufferAttribute(sizeArray, 1));
    
    const particleMaterial = new THREE.PointsMaterial({
      size: 0.2,
      vertexColors: true,
      transparent: true,
      opacity: 0.8,
      blending: THREE.AdditiveBlending,
      sizeAttenuation: true
    });
    
    particleSystem = new THREE.Points(particles, particleMaterial);
    portal.add(particleSystem);
    
    // Post-processing effects with more intensity
    composer = new THREE.EffectComposer(portalRenderer);
    const renderPass = new THREE.RenderPass(portalScene, portalCamera);
    composer.addPass(renderPass);
    
    const bloomPass = new THREE.BloomPass(
      2.0,    // increased strength
      25,     // kernel size
      5,      // increased sigma 
      512     // increased blur scale
    );
    composer.addPass(bloomPass);
    
    // Add glitch effect that activates during interactions
    const glitchPass = new THREE.GlitchPass();
    glitchPass.goWild = false;
    glitchPass.enabled = false;
    composer.addPass(glitchPass);
    
    // Mouse move interaction with more responsive feedback
    document.addEventListener('mousemove', (event) => {
      mouseX = (event.clientX / window.innerWidth) * 2 - 1;
      mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
      
      // Make particles react to mouse movement
      const positions = particleSystem.geometry.attributes.position.array;
      for(let i = 0; i < positions.length; i += 3) {
        const distFromMouse = Math.sqrt(
          Math.pow(positions[i] - mouseX * 10, 2) + 
          Math.pow(positions[i+1] - mouseY * 10, 2)
        );
        
        if(distFromMouse < 5) {
          positions[i] += (Math.random() - 0.5) * 0.5;
          positions[i+1] += (Math.random() - 0.5) * 0.5;
        }
      }
      particleSystem.geometry.attributes.position.needsUpdate = true;
    });
    
    document.getElementById('portal3d-container').addEventListener('mouseenter', () => {
      isMouseOver = true;
      glitchPass.enabled = true;
      gsap.to(portal.material, { 
        emissiveIntensity: 1.5, 
        duration: 0.5 
      });
    });
    
    document.getElementById('portal3d-container').addEventListener('mouseleave', () => {
      isMouseOver = false;
      glitchPass.enabled = false;
      gsap.to(portal.material, { 
        emissiveIntensity: 0.5, 
        duration: 0.5 
      });
    });
    
    // Handle window resize
    window.addEventListener('resize', onWindowResize);
    
    // Start animation loop
    animatePortal();
  }
  
  function onWindowResize() {
    portalCamera.aspect = 1;
    portalCamera.updateProjectionMatrix();
    portalRenderer.setSize(600, 600);
  }
  
  function animatePortal() {
    requestAnimationFrame(animatePortal);
    
    // Rotate portal with dynamic speed based on interaction
    const rotationSpeed = isMouseOver ? 0.015 : 0.007;
    portal.rotation.x += rotationSpeed;
    portal.rotation.y += rotationSpeed * 1.2;
    
    // Interactive response to mouse with more natural movement
    if(isMouseOver) {
      portal.rotation.z = THREE.MathUtils.lerp(portal.rotation.z, mouseX * 0.3, 0.1);
      portal.rotation.x = THREE.MathUtils.lerp(portal.rotation.x, mouseY * 0.2, 0.1);
    } else {
      portal.rotation.z = THREE.MathUtils.lerp(portal.rotation.z, 0, 0.05);
      portal.rotation.x = THREE.MathUtils.lerp(portal.rotation.x, 0, 0.05);
    }
    
    // Animate particles for more organic movement
    const positions = particleSystem.geometry.attributes.position.array;
    const time = Date.now() * 0.001;
    
    for(let i = 0; i < positions.length; i += 3) {
      // Add subtle noise-based movement
      positions[i] += Math.sin(time + i) * 0.01;
      positions[i+1] += Math.cos(time + i * 0.5) * 0.01;
      positions[i+2] += Math.sin(time * 0.5 + i * 0.1) * 0.01;
      
      // Keep particles within bounds
      if(Math.abs(positions[i]) > 15) positions[i] *= -0.95;
      if(Math.abs(positions[i+1]) > 15) positions[i+1] *= -0.95;
      if(Math.abs(positions[i+2]) > 15) positions[i+2] *= -0.95;
    }
    particleSystem.geometry.attributes.position.needsUpdate = true;
    
    // Dynamic pulsing effect based on time
    const pulseIntensity = 1 + Math.sin(time * 2) * 0.1;
    portal.scale.setScalar(pulseIntensity);
    
    // Render with effects
    composer.render();
  }
  
  // Initialize when page loads
  window.addEventListener('load', initPortal);
  
  // Enhanced staking event effects
  function onStakeEvent(amount) {
    // Flash effect with color variation based on amount
    const flashColor = amount > 5000 ? 0xaa00ff : 0x00ffe7;
    
    gsap.to(portal.material, {
      emissive: flashColor,
      emissiveIntensity: 3.0,
      duration: 0.3,
      ease: "power2.out",
      yoyo: true,
      repeat: 1,
      onComplete: () => {
        portal.material.emissive.setHex(0x00ff00);
      }
    });
    
    // Add particles explosion with amount-based intensity
    const explosionCount = Math.min(1000, amount / 10);
    const explosionGeometry = new THREE.BufferGeometry();
    const explosionArray = new Float32Array(explosionCount * 3);
    const explosionColors = new Float32Array(explosionCount * 3);
    
    for(let i = 0; i < explosionCount * 3; i++) {
      explosionArray[i] = (Math.random() - 0.5) * 10;
      
      if(i % 3 === 0) {
        explosionColors[i] = 0.0; // R
        explosionColors[i+1] = 1.0; // G
        explosionColors[i+2] = amount > 5000 ? 0.5 + Math.random() * 0.5 : 0.7 + Math.random() * 0.3; // B
      }
    }
    
    explosionGeometry.setAttribute('position', new THREE.BufferAttribute(explosionArray, 3));
    explosionGeometry.setAttribute('color', new THREE.BufferAttribute(explosionColors, 3));
    
    const explosionMaterial = new THREE.PointsMaterial({
      size: amount > 5000 ? 0.4 : 0.2,
      vertexColors: true,
      transparent: true,
      opacity: 1,
      blending: THREE.AdditiveBlending,
      sizeAttenuation: true
    });
    
    const explosion = new THREE.Points(explosionGeometry, explosionMaterial);
    explosion.position.copy(portal.position);
    portalScene.add(explosion);
    
    // Animate explosion with physics-like behavior
    const explosionAnim = {
      scale: 1,
      opacity: 1,
      speed: amount > 5000 ? 2 : 1
    };
    
    gsap.to(explosionAnim, {
      scale: 5,
      opacity: 0,
      duration: explosionAnim.speed,
      ease: "power2.out",
      onUpdate: () => {
        explosion.scale.set(explosionAnim.scale, explosionAnim.scale, explosionAnim.scale);
        explosionMaterial.opacity = explosionAnim.opacity;
      },
      onComplete: () => portalScene.remove(explosion)
    });
    
    // Special effect for large stakes
    if(amount > 10000) {
      const megaEffect = document.getElementById('megaStakeEffect');
      megaEffect.style.opacity = '1';
      megaEffect.style.background = `radial-gradient(circle, rgba(${
        amount > 50000 ? '170, 0, 255' : '0, 255, 231'
      }, 0.3) 0%, transparent 70%)`;
      
      setTimeout(() => {
        megaEffect.style.opacity = '0';
      }, 1000);
    }
  }

  // Staking Contract Configuration
  const CONFIG = {
    KLY_TOKEN: "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52",
    STAKE_CONTRACT: "0xe9417Fbe4e1D1E70aaE00b76e9B54599707c49e0",
    MIN_STAKE: 100,
    stakingABI: [
      "function stake(uint256 amount) external",
      "function unstake(uint256 amount) external",
      "function claim() external",
      "function getUserStake(address user) external view returns (uint256)",
      "function getPendingRewards(address user) external view returns (uint256)",
      "function totalValueLocked() external view returns (uint256)"
    ],
    erc20ABI: [
      "function balanceOf(address) view returns (uint256)",
      "function approve(address spender, uint256 amount) returns (bool)",
      "function decimals() view returns (uint8)"
    ]
  };

  const state = {
    provider: null,
    signer: null,
    contract: null,
    tokenContract: null,
    address: null,
    decimals: 18,
    tokenBalance: 0
  };

  const elements = {
    connectWallet: document.getElementById("connectWallet"),
    disconnectWallet: document.getElementById("disconnectWallet"),
    stakeAmount: document.getElementById("stakeAmount"),
    stakeBtn: document.getElementById("stakeBtn"),
    unstakeBtn: document.getElementById("unstakeBtn"),
    claimBtn: document.getElementById("claimBtn"),
    stakedValue: document.getElementById("stakedValue"),
    rewardValue: document.getElementById("rewardValue"),
    tvlValue: document.getElementById("tvlValue"),
    maxBtn: document.getElementById("maxBtn"),
    transactionStatus: document.getElementById("transactionStatus"),
    mintBtn: document.getElementById("mintBtn"),
    nftImage: document.getElementById("nftImage"),
    nftName: document.getElementById("nftName"),
    nftAttributes: document.getElementById("nftAttributes"),
    nftRarity: document.getElementById("nftRarity"),
    nftTier: document.getElementById("nftTier"),
    mobileMenuBtn: document.getElementById("mobileMenuBtn"),
    navLinks: document.getElementById("navLinks"),
    txModal: document.getElementById("txModal"),
    closeModal: document.getElementById("closeModal"),
    cancelTx: document.getElementById("cancelTx"),
    confirmTx: document.getElementById("confirmTx"),
    txNetwork: document.getElementById("txNetwork"),
    txType: document.getElementById("txType"),
    txFee: document.getElementById("txFee"),
    txProgress: document.getElementById("txProgress"),
    metamaskFallback: document.getElementById("metamaskFallback"),
    metamaskBtn: document.getElementById("metamaskBtn"),
    megaStakeEffect: document.getElementById("megaStakeEffect")
  };

  // Enhanced Achievements system with more details
  const achievements = [
    { 
      id: 1, 
      name: "First Stake", 
      icon: "fa-seedling", 
      earned: false, 
      condition: (stakeAmount) => stakeAmount > 0,
      reward: "100 KLY bonus"
    },
    { 
      id: 2, 
      name: "KLY Veteran", 
      icon: "fa-medal", 
      earned: false, 
      condition: (_, stakingDays) => stakingDays >= 30,
      reward: "Exclusive NFT"
    },
    { 
      id: 3, 
      name: "Top 100 Staker", 
      icon: "fa-trophy", 
      earned: false, 
      condition: (stakeAmount) => stakeAmount >= 50000,
      reward: "VIP Access"
    },
    { 
      id: 4, 
      name: "NFT Collector", 
      icon: "fa-gem", 
      earned: false, 
      condition: (_, __, nftCount) => nftCount >= 5,
      reward: "Rare NFT Mint"
    }
  ];

  async function connectWallet() {
    try {
      if (!window.ethereum) {
        elements.metamaskFallback.style.display = "block";
        throw new Error("No Ethereum provider found");
      }

      // Animate wallet connection
      gsap.fromTo(elements.connectWallet, 
        { scale: 1 },
        { scale: 0.9, duration: 0.2, yoyo: true, repeat: 1 }
      );

      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      state.address = accounts[0];
      state.provider = new ethers.providers.Web3Provider(window.ethereum);
      state.signer = state.provider.getSigner();
      state.tokenContract = new ethers.Contract(CONFIG.KLY_TOKEN, CONFIG.erc20ABI, state.signer);
      state.contract = new ethers.Contract(CONFIG.STAKE_CONTRACT, CONFIG.stakingABI, state.signer);

      state.decimals = await state.tokenContract.decimals();

      // Animate wallet connected state
      gsap.to(elements.connectWallet, {
        opacity: 0,
        duration: 0.3,
        onComplete: () => {
          elements.connectWallet.style.display = "none";
          elements.disconnectWallet.style.display = "inline-block";
          gsap.fromTo(elements.disconnectWallet,
            { opacity: 0, y: 10 },
            { opacity: 1, y: 0, duration: 0.5 }
          );
        }
      });

      elements.metamaskFallback.style.display = "none";

      await updateStakingData();
      checkAchievements();
      
      showToast("Wallet connected successfully!", "success");
      
      // Add holographic effect to connected wallet
      addHolographicEffect(elements.disconnectWallet);
    } catch (err) {
      showError("Wallet connection failed: " + err.message);
      showToast("Wallet connection failed", "error");
    }
  }

  // Add holographic effect to elements
  function addHolographicEffect(element) {
    const lines = [];
    
    // Create 4 holographic lines
    for(let i = 0; i < 4; i++) {
      const line = document.createElement('div');
      line.className = 'holographic-line';
      line.style.width = '0%';
      line.style.top = `${i * 25}%`;
      element.appendChild(line);
      lines.push(line);
    }
    
    // Animate lines
    gsap.to(lines, {
      width: '100%',
      duration: 0.5,
      stagger: 0.1,
      ease: 'power2.out',
      onComplete: () => {
        gsap.to(lines, {
          opacity: 0,
          duration: 0.3,
          onComplete: () => {
            lines.forEach(line => line.remove());
          }
        });
      }
    });
  }

  async function updateStakingData() {
    try {
      const [balance, staked, rewards, tvl] = await Promise.all([
        state.tokenContract.balanceOf(state.address),
        state.contract.getUserStake(state.address),
        state.contract.getPendingRewards(state.address),
        state.contract.totalValueLocked()
      ]);

      state.tokenBalance = ethers.utils.formatUnits(balance, state.decimals);
      const stakedAmount = ethers.utils.formatUnits(staked, state.decimals);
      const rewardAmount = ethers.utils.formatUnits(rewards, state.decimals);
      const tvlAmount = ethers.utils.formatUnits(tvl, state.decimals);

      // Animate value changes
      animateValueChange(elements.stakedValue, stakedAmount + " KLY");
      animateValueChange(elements.rewardValue, rewardAmount + " KLY");
      animateValueChange(elements.tvlValue, tvlAmount + " KLY");

      // Show/hide buttons based on staked amount with animations
      if (parseFloat(stakedAmount) > 0) {
        gsap.to([elements.claimBtn, elements.unstakeBtn], {
          display: "block",
          opacity: 1,
          y: 0,
          duration: 0.5,
          stagger: 0.1
        });
        elements.stakeBtn.textContent = "ADD TO STAKE";
      } else {
        gsap.to([elements.claimBtn, elements.unstakeBtn], {
          display: "none",
          opacity: 0,
          y: 10,
          duration: 0.3
        });
        elements.stakeBtn.textContent = "STAKE KLY";
      }

      return {
        stakedAmount: parseFloat(stakedAmount),
        rewardAmount: parseFloat(rewardAmount),
        tvlAmount: parseFloat(tvlAmount)
      };
    } catch (err) {
      showError("Failed to update staking data: " + err.message);
      return null;
    }
  }

  // Animate value changes with counting effect
  function animateValueChange(element, newValue) {
    const oldValue = element.textContent;
    if (oldValue === newValue) return;

    gsap.to(element, {
      opacity: 0.5,
      y: -5,
      duration: 0.2,
      onComplete: () => {
        element.textContent = newValue;
        gsap.to(element, {
          opacity: 1,
          y: 0,
          duration: 0.3
        });
      }
    });
  }

  async function stakeTokens() {
    const amount = parseFloat(elements.stakeAmount.value);
    if (!amount || amount < CONFIG.MIN_STAKE) {
      return showError(`Minimum stake is ${CONFIG.MIN_STAKE} KLY`);
    }

    try {
      showStatus("Approving KLY...", "status-success");
      
      // Show enhanced transaction modal
      showTransactionModal("Token Approval", "Approve KLY tokens for staking", "0.0012 BNB ($0.95)");
      
      const amountWei = ethers.utils.parseUnits(amount.toString(), state.decimals);
      
      // Animate button during approval
      gsap.to(elements.stakeBtn, {
        background: "linear-gradient(135deg, var(--neon-purple), var(--neon-blue))",
        duration: 0.3
      });
      
      const approval = await state.tokenContract.approve(CONFIG.STAKE_CONTRACT, amountWei);
      
      // Update modal with transaction hash
      updateTransactionModal("Approval Pending", `Transaction: ${approval.hash.slice(0, 10)}...`, "0.0012 BNB ($0.95)");
      
      await approval.wait();

      showStatus("Staking tokens...", "status-success");
      updateTransactionModal("Staking", "Staking KLY tokens", "0.0035 BNB ($2.80)");
      
      const tx = await state.contract.stake(amountWei);
      
      // Update modal with staking transaction hash
      updateTransactionModal("Staking Pending", `Transaction: ${tx.hash.slice(0, 10)}...`, "0.0035 BNB ($2.80)");
      
      await tx.wait();

      showToast("Staked successfully!", "success");
      
      // Enhanced stake event animation
      onStakeEvent(amount);
      
      await updateStakingData();
      checkAchievements();
      hideTransactionModal();
      
      // Reset button animation
      gsap.to(elements.stakeBtn, {
        background: "linear-gradient(135deg, var(--neon-green), var(--neon-pink))",
        duration: 0.3
      });
    } catch (err) {
      showToast("Staking failed: " + err.message, "error");
      hideTransactionModal();
      
      // Error animation
      gsap.to(elements.stakeBtn, {
        x: [-5, 5, -5, 5, 0],
        duration: 0.5,
        ease: "power1.inOut"
      });
    }
  }

  async function unstakeTokens() {
    const amount = parseFloat(elements.stakeAmount.value);
    if (!amount || amount <= 0) {
      return showError("Enter a valid unstake amount.");
    }

    try {
      showStatus("Unstaking...", "status-success");
      showTransactionModal("Unstaking", "Unstaking KLY tokens", "0.0035 BNB ($2.80)");
      
      const amountWei = ethers.utils.parseUnits(amount.toString(), state.decimals);
      
      // Animate unstake button
      gsap.to(elements.unstakeBtn, {
        background: "linear-gradient(135deg, #ff5555, #ff0000)",
        duration: 0.3
      });
      
      const tx = await state.contract.unstake(amountWei);
      
      // Update modal with transaction hash
      updateTransactionModal("Unstaking Pending", `Transaction: ${tx.hash.slice(0, 10)}...`, "0.0035 BNB ($2.80)");
      
      await tx.wait();
      
      showToast("Unstaked successfully!", "success");
      await updateStakingData();
      checkAchievements();
      hideTransactionModal();
      
      // Reset button animation
      gsap.to(elements.unstakeBtn, {
        background: "linear-gradient(135deg, var(--neon-purple), var(--neon-blue))",
        duration: 0.3
      });
    } catch (err) {
      showToast("Unstaking failed: " + err.message, "error");
      hideTransactionModal();
      
      // Error animation
      gsap.to(elements.unstakeBtn, {
        x: [-5, 5, -5, 5, 0],
        duration: 0.5,
        ease: "power1.inOut"
      });
    }
  }

  async function claimRewards() {
    try {
      showStatus("Claiming rewards...", "status-success");
      showTransactionModal("Claim Rewards", "Claiming staking rewards", "0.0035 BNB ($2.80)");
      
      // Animate claim button
      gsap.to(elements.claimBtn, {
        background: "linear-gradient(135deg, var(--neon-yellow), var(--neon-orange))",
        duration: 0.3
      });
      
      const tx = await state.contract.claim();
      
      // Update modal with transaction hash
      updateTransactionModal("Claim Pending", `Transaction: ${tx.hash.slice(0, 10)}...`, "0.0035 BNB ($2.80)");
      
      await tx.wait();
      
      showToast("Rewards claimed!", "success");
      
      // Celebration effect
      createConfettiEffect(elements.claimBtn);
      
      await updateStakingData();
      hideTransactionModal();
      
      // Reset button animation
      gsap.to(elements.claimBtn, {
        background: "linear-gradient(135deg, var(--neon-purple), var(--neon-blue))",
        duration: 0.3
      });
    } catch (err) {
      showToast("Claim failed: " + err.message, "error");
      hideTransactionModal();
    }
  }

  // Create confetti celebration effect
  function createConfettiEffect(element) {
    const rect = element.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    const colors = [
      '#00ffe7', '#ff00aa', '#aa00ff', 
      '#00aaff', '#ff6b00', '#fff000'
    ];
    
    for(let i = 0; i < 50; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'particle';
      confetti.style.position = 'fixed';
      confetti.style.width = '8px';
      confetti.style.height = '8px';
      confetti.style.left = `${centerX}px`;
      confetti.style.top = `${centerY}px`;
      confetti.style.borderRadius = '50%';
      confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.zIndex = '1000';
      document.body.appendChild(confetti);
      
      const angle = Math.random() * Math.PI * 2;
      const velocity = 5 + Math.random() * 5;
      const x = Math.cos(angle) * velocity;
      const y = Math.sin(angle) * velocity;
      
      gsap.to(confetti, {
        x: x * 50,
        y: y * 50,
        opacity: 0,
        duration: 1 + Math.random(),
        ease: 'power1.out',
        onComplete: () => confetti.remove()
      });
    }
  }

  async function mintNFT() {
    try {
      showStatus("Minting NFT...", "status-success");
      showTransactionModal("Mint NFT", "Minting Ascender NFT", "0.005 BNB ($4.00)");
      
      // Animate mint button
      gsap.to(elements.mintBtn, {
        background: "linear-gradient(135deg, var(--neon-purple), var(--neon-pink))",
        duration: 0.3
      });
      
      // Simulate NFT minting (replace with actual contract call)
      await new Promise(resolve => setTimeout(resolve, 3000));
      
      // Generate random NFT attributes with weighted probabilities
      const rarities = [
        { name: "Common", weight: 60 },
        { name: "Uncommon", weight: 25 },
        { name: "Rare", weight: 10 },
        { name: "Epic", weight: 4 },
        { name: "Legendary", weight: 1 }
      ];
      
      const tiers = ["1", "2", "3", "4", "5"];
      
      const randomRarity = weightedRandom(rarities);
      const randomTier = tiers[Math.floor(Math.random() * tiers.length)];
      
      // Update UI with new NFT
      elements.nftName.textContent = `Ascender #${Math.floor(Math.random() * 10000)}`;
      elements.nftRarity.textContent = randomRarity.name;
      elements.nftTier.textContent = randomTier;
      
      // Generate color based on rarity
      let color;
      switch(randomRarity.name) {
        case "Common": color = "00ffe7"; break;
        case "Uncommon": color = "00aaff"; break;
        case "Rare": color = "aa00ff"; break;
        case "Epic": color = "ff00aa"; break;
        case "Legendary": color = "fff000"; break;
        default: color = "00ffe7";
      }
      
      elements.nftImage.src = `https://via.placeholder.com/150/000000/${color}?text=${randomRarity.name.toUpperCase()}`;
      
      // Generate random attributes with rarity bonuses
      elements.nftAttributes.innerHTML = '';
      const attributes = ["Power", "Speed", "Intelligence", "Luck", "Charisma"];
      attributes.forEach(attr => {
        let baseValue = Math.floor(Math.random() * 50);
        
        // Apply rarity bonus
        switch(randomRarity.name) {
          case "Uncommon": baseValue += 10; break;
          case "Rare": baseValue += 20; break;
          case "Epic": baseValue += 30; break;
          case "Legendary": baseValue += 50; break;
        }
        
        const value = Math.min(100, baseValue);
        const attributeEl = document.createElement('div');
        attributeEl.className = 'nft-attribute';
        attributeEl.textContent = `${attr}: ${value}`;
        elements.nftAttributes.appendChild(attributeEl);
      });
      
      showToast("NFT minted successfully!", "success");
      
      // Special effect for rare NFTs
      if(randomRarity.name !== "Common") {
        const rarityColor = {
          "Uncommon": "#00aaff",
          "Rare": "#aa00ff",
          "Epic": "#ff00aa",
          "Legendary": "#fff000"
        }[randomRarity.name];
        
        gsap.to(elements.nftImage, {
          boxShadow: `0 0 30px ${rarityColor}`,
          duration: 0.5,
          yoyo: true,
          repeat: 3
        });
      }
      
      checkAchievements();
      hideTransactionModal();
      
      // Reset button animation
      gsap.to(elements.mintBtn, {
        background: "linear-gradient(135deg, var(--neon-green), var(--neon-pink))",
        duration: 0.3
      });
    } catch (err) {
      showToast("Minting failed: " + err.message, "error");
      hideTransactionModal();
    }
  }

  // Weighted random selection for NFT rarity
  function weightedRandom(items) {
    let total = items.reduce((sum, item) => sum + item.weight, 0);
    let random = Math.random() * total;
    
    for(let item of items) {
      if(random < item.weight) return item;
      random -= item.weight;
    }
    
    return items[0];
  }

  function checkAchievements() {
    // In a real app, you would check on-chain data for these conditions
    const stakedAmount = parseFloat(elements.stakedValue.textContent) || 0;
    const stakingDays = Math.floor(Math.random() * 60); // Simulate random staking days
    const nftCount = Math.floor(Math.random() * 10); // Simulate random NFT count
    
    achievements.forEach(ach => {
      if (!ach.earned && ach.condition(stakedAmount, stakingDays, nftCount)) {
        ach.earned = true;
        unlockAchievement(ach);
      }
    });
  }

  function unlockAchievement(achievement) {
    const badges = document.querySelectorAll('.achievement-badge');
    const badge = badges[achievement.id - 1];
    
    if (badge) {
      badge.classList.remove('locked');
      badge.querySelector('i').style.color = "var(--neon-green)";
      badge.querySelector('h4').style.color = "var(--neon-green)";
      
      // Add reward text
      const rewardText = document.createElement('p');
      rewardText.textContent = `Reward: ${achievement.reward}`;
      rewardText.style.color = "var(--neon-green)";
      rewardText.style.marginTop = "0.5rem";
      rewardText.style.fontSize = "0.7rem";
      badge.appendChild(rewardText);
      
      showToast(`Achievement Unlocked: ${achievement.name} - ${achievement.reward}`, "success");
      
      // Enhanced animation sequence
      gsap.fromTo(badge, 
        { scale: 0.8, opacity: 0.5, y: 20 },
        { 
          scale: 1.1, 
          opacity: 1, 
          y: 0,
          duration: 0.5, 
          ease: "back.out" 
        }
      );
      
      gsap.to(badge, {
        boxShadow: "0 0 20px var(--neon-green)",
        duration: 0.5,
        yoyo: true,
        repeat: 1
      });
      
      // Add particle effect
      createConfettiEffect(badge);
    }
  }

  function showTransactionModal(type, description, fee) {
    elements.txType.textContent = type;
    elements.txFee.textContent = fee;
    elements.txModal.classList.add('active');
    
    // Enhanced modal animation
    gsap.fromTo(elements.txModal, 
      { opacity: 0, y: 50 },
      { opacity: 1, y: 0, duration: 0.5 }
    );
    
    // Simulate progress with more realistic steps
    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.random() * 10;
      elements.txProgress.style.width = `${Math.min(progress, 90)}%`;
      if (progress >= 90) clearInterval(interval);
    }, 200);
  }

  function updateTransactionModal(type, description, fee) {
    elements.txType.textContent = type;
    elements.txFee.textContent = fee;
    elements.txProgress.style.width = "0%";
    
    // Animate the update
    gsap.fromTo(elements.txProgress,
      { width: "0%" },
      { width: "90%", duration: 2, ease: "power1.out" }
    );
  }

  function hideTransactionModal() {
    gsap.to(elements.txModal, {
      opacity: 0,
      y: 50,
      duration: 0.3,
      onComplete: () => {
        elements.txModal.classList.remove('active');
        elements.txProgress.style.width = "0%";
      }
    });
  }

  // Enhanced Toast helper with animations
  function showToast(message, type = "success") {
    const container = document.getElementById("toastContainer");
    const toast = document.createElement("div");
    toast.className = `toast ${type}`;
    toast.innerHTML = `
      <span class="toast-icon"><i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle'}"></i></span>
      <span class="toast-message">${message}</span>
      <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
    `;
    container.appendChild(toast);
    
    // Animate in
    gsap.fromTo(toast,
      { x: 100, opacity: 0 },
      { x: 0, opacity: 1, duration: 0.3 }
    );
    
    // Auto-remove after delay
    setTimeout(() => {
      gsap.to(toast, {
        x: 100,
        opacity: 0,
        duration: 0.3,
        onComplete: () => toast.remove()
      });
    }, 5000);
  }

  function showStatus(msg, type = "status-success") {
    elements.transactionStatus.textContent = msg;
    elements.transactionStatus.className = `status-message ${type}`;
    
    // Animate status change
    gsap.fromTo(elements.transactionStatus,
      { y: -10, opacity: 0 },
      { y: 0, opacity: 1, duration: 0.3 }
    );
  }

  function showError(msg) {
    elements.transactionStatus.textContent = msg;
    elements.transactionStatus.className = "status-message status-error";
    
    // Error animation
    gsap.fromTo(elements.transactionStatus,
      { x: [-5, 5, -5, 5, 0], opacity: 0 },
      { x: 0, opacity: 1, duration: 0.5 }
    );
  }

  function setupListeners() {
    // Wallet connection
    elements.connectWallet.addEventListener("click", connectWallet);
    elements.disconnectWallet.addEventListener("click", () => {
      gsap.to(elements.disconnectWallet, {
        opacity: 0,
        duration: 0.3,
        onComplete: () => window.location.reload()
      });
    });
    elements.metamaskBtn.addEventListener("click", connectWallet);
    
    // Staking actions
    elements.stakeBtn.addEventListener("click", stakeTokens);
    elements.unstakeBtn.addEventListener("click", unstakeTokens);
    elements.claimBtn.addEventListener("click", claimRewards);
    
    // NFT actions
    elements.mintBtn.addEventListener("click", mintNFT);
    
    // Max button with animation
    elements.maxBtn.addEventListener("click", () => {
      elements.stakeAmount.value = state.tokenBalance;
      gsap.fromTo(elements.maxBtn,
        { scale: 1 },
        { scale: 1.2, duration: 0.2, yoyo: true, repeat: 1 }
      );
    });
    
    // Mobile menu with animation
    elements.mobileMenuBtn.addEventListener("click", () => {
      elements.navLinks.classList.toggle('active');
      
      if(elements.navLinks.classList.contains('active')) {
        gsap.fromTo(elements.navLinks.querySelectorAll('a'),
          { y: 20, opacity: 0 },
          { y: 0, opacity: 1, stagger: 0.1, duration: 0.3 }
        );
      }
    });
    
    // Transaction modal
    elements.closeModal.addEventListener("click", hideTransactionModal);
    elements.cancelTx.addEventListener("click", hideTransactionModal);
    elements.confirmTx.addEventListener("click", () => {
      gsap.to(elements.txProgress, {
        width: "100%",
        duration: 0.5,
        onComplete: hideTransactionModal
      });
    });
    
    // Close modal when clicking outside
    elements.txModal.addEventListener("click", (e) => {
      if (e.target === elements.txModal) {
        hideTransactionModal();
      }
    });
    
    // Add hover effects to all buttons
    document.querySelectorAll('button').forEach(btn => {
      btn.addEventListener('mouseenter', () => {
        gsap.to(btn, {
          scale: 1.05,
          duration: 0.2
        });
      });
      
      btn.addEventListener('mouseleave', () => {
        gsap.to(btn, {
          scale: 1,
          duration: 0.2
        });
      });
    });
  }

  // Initialize particles with more variety
  function initParticles() {
    const container = document.getElementById('particles');
    const particleCount = 150;
    
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      
      // Random properties with more variation
      const size = Math.random() * 5 + 1;
      const posX = Math.random() * 100;
      const delay = Math.random() * 15;
      const duration = Math.random() * 25 + 15;
      const opacity = Math.random() * 0.5 + 0.1;
      
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      particle.style.left = `${posX}%`;
      particle.style.animationDelay = `${delay}s`;
      particle.style.animationDuration = `${duration}s`;
      particle.style.opacity = opacity;
      
      // Random neon color with chroma.js for better color manipulation
      const colors = [
        chroma('#00ffe7').brighten(1).hex(),
        chroma('#ff00aa').brighten(0.5).hex(),
        chroma('#aa00ff').brighten(0.7).hex(),
        chroma('#00aaff').brighten(0.8).hex()
      ];
      const randomColor = colors[Math.floor(Math.random() * colors.length)];
      particle.style.background = randomColor;
      
      // Random shape (circle or square)
      if(Math.random() > 0.7) {
        particle.style.borderRadius = '0';
      }
      
      container.appendChild(particle);
    }
  }

  window.addEventListener("load", () => {
    initParticles();
    setupListeners();
    
    // Add holographic lines to main panels
    document.querySelectorAll('.gradient-border').forEach(panel => {
      setTimeout(() => {
        addHolographicEffect(panel);
      }, 1000);
    });
    
    if (window.ethereum) {
      // Check if wallet is already connected
      window.ethereum.request({ method: 'eth_accounts' })
        .then(accounts => {
          if (accounts.length > 0) {
            connectWallet();
          }
        });
      
      // Handle account changes
      window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length === 0) {
          // Wallet disconnected
          window.location.reload();
        } else {
          // Account changed
          state.address = accounts[0];
          updateStakingData();
        }
      });
      
      // Handle chain changes
      window.ethereum.on('chainChanged', () => {
        window.location.reload();
      });
    } else {
      showError("MetaMask or Web3 wallet not detected.");
      elements.metamaskFallback.style.display = "none";
    }
  });
</script>
</body>
</html>
