<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KLY Staking Dashboard | Kelly Legacy Estates</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Stake your KLY tokens and earn rewards with Kelly Legacy Estates">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <style>
    :root {
      --bg: #0d0b1f;
      --bg-dark: #070614;
      --card: #1c1935;
      --card-light: #252240;
      --accent: #8a2be2;
      --accent-light: #9b4fff;
      --accent-dark: #7a1fd9;
      --text: #ffffff;
      --text-muted: #c5c5c5;
      --text-dark: #a0a0a0;
      --success: #4ade80;
      --error: #f87171;
      --warning: #fbbf24;
      --radius: 16px;
      --radius-sm: 8px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-accent: 0 0 20px rgba(138, 43, 226, 0.3);
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      --sidebar-width: 80px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(138, 43, 226, 0.1) 0%, transparent 50%);
      background-attachment: fixed;
    }

    .dashboard-container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: var(--sidebar-width);
      background: var(--card);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 30px;
      border-right: 1px solid rgba(138, 43, 226, 0.2);
    }

    .sidebar-icon {
      color: var(--text-muted);
      font-size: 1.5rem;
      margin-bottom: 30px;
      cursor: pointer;
      transition: var(--transition);
      padding: 10px;
      border-radius: var(--radius-sm);
    }

    .sidebar-icon:hover {
      color: var(--accent);
      background: rgba(138, 43, 226, 0.1);
    }

    .sidebar-icon.active {
      color: var(--accent);
      background: rgba(138, 43, 226, 0.2);
    }

    .dashboard {
      flex: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(138, 43, 226, 0.2);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
      text-decoration: none;
    }

    .logo img {
      height: 40px;
      width: 40px;
    }

    .wallet-btn {
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      padding: 12px 24px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow);
    }

    .wallet-btn:hover {
      background: linear-gradient(135deg, var(--accent-dark), var(--accent));
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .wallet-btn.connected {
      background: transparent;
      border: 1px solid var(--accent);
      color: var(--accent);
    }

    .wallet-btn.connected:hover {
      background: rgba(138, 43, 226, 0.1);
    }

    .wallet-address {
      font-family: monospace;
      background: rgba(138, 43, 226, 0.1);
      padding: 8px 12px;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .card {
      background: var(--card);
      padding: 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(to bottom, var(--accent), var(--accent-light));
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-accent);
    }

    .card h2 {
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card .value {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .card .change {
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .positive {
      color: var(--success);
    }

    .negative {
      color: var(--error);
    }

    .chart-container {
      background: var(--card);
      padding: 24px;
      border-radius: var(--radius);
      margin-bottom: 40px;
      box-shadow: var(--shadow);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .chart-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .chart-timeframe {
      display: flex;
      gap: 8px;
    }

    .timeframe-btn {
      background: var(--card-light);
      border: none;
      color: var(--text-muted);
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .timeframe-btn.active {
      background: var(--accent);
      color: white;
    }

    .stake-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 768px) {
      .stake-container {
        grid-template-columns: 1fr;
      }
    }

    .stake-box {
      background: var(--card);
      padding: 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .stake-box-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      background: var(--card-light);
      padding: 4px;
      border-radius: var(--radius-sm);
    }

    .tab-btn {
      flex: 1;
      padding: 10px;
      background: transparent;
      border: none;
      border-radius: var(--radius-sm);
      color: var(--text-muted);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
    }

    .tab-btn.active {
      background: var(--accent);
      color: white;
    }

    .input-group {
      margin-bottom: 16px;
    }

    .input-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-muted);
    }

    .input-wrapper {
      position: relative;
    }

    .input-field {
      width: 100%;
      padding: 14px;
      background: var(--bg);
      border: 1px solid rgba(138, 43, 226, 0.3);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-size: 1rem;
      transition: var(--transition);
    }

    .input-field:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(138, 43, 226, 0.2);
    }

    .max-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(138, 43, 226, 0.1);
      color: var(--accent);
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .max-btn:hover {
      background: var(--accent);
      color: white;
    }

    .select-field {
      width: 100%;
      padding: 14px;
      background: var(--bg);
      border: 1px solid rgba(138, 43, 226, 0.3);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-size: 1rem;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23c5c5c5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 16px;
    }

    .action-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .action-btn:hover {
      background: linear-gradient(135deg, var(--accent-dark), var(--accent));
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .action-btn:disabled {
      background: var(--card-light);
      color: var(--text-muted);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .stats-box {
      background: var(--card);
      padding: 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .stats-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(138, 43, 226, 0.1);
    }

    .stats-label {
      color: var(--text-muted);
      font-weight: 500;
    }

    .stats-value {
      font-weight: 600;
      font-family: monospace;
    }

    .status {
      padding: 12px;
      border-radius: var(--radius-sm);
      margin-top: 16px;
      font-weight: 500;
      display: none;
    }

    .status.success {
      background: rgba(74, 222, 128, 0.1);
      color: var(--success);
      border: 1px solid var(--success);
      display: block;
    }

    .status.error {
      background: rgba(248, 113, 113, 0.1);
      color: var(--error);
      border: 1px solid var(--error);
      display: block;
    }

    .status.warning {
      background: rgba(251, 191, 36, 0.1);
      color: var(--warning);
      border: 1px solid var(--warning);
      display: block;
    }

    .status.info {
      background: rgba(138, 43, 226, 0.1);
      color: var(--accent);
      border: 1px solid var(--accent);
      display: block;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .tooltip {
      position: relative;
      display: inline-block;
      cursor: pointer;
    }

    .tooltip .tooltip-text {
      visibility: hidden;
      width: 200px;
      background-color: var(--card);
      color: var(--text);
      text-align: center;
      border-radius: var(--radius-sm);
      padding: 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      border: 1px solid var(--accent);
      font-size: 0.8rem;
      box-shadow: var(--shadow-lg);
    }

    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    .badge {
      display: inline-block;
      background: var(--accent);
      color: white;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 600;
      margin-left: 8px;
    }

    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: block;
      }
      
      .wallet-btn span {
        display: none;
      }
      
      .wallet-address {
        display: none;
      }
      
      .sidebar {
        display: none;
      }
    }

    /* Animation classes */
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(138, 43, 226, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(138, 43, 226, 0); }
      100% { box-shadow: 0 0 0 0 rgba(138, 43, 226, 0); }
    }

    /* Gauge section from second design */
    .gauge-section {
      background: var(--card);
      padding: 20px;
      border-radius: var(--radius);
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }

    .gauge-label {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .gauge-value {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .gauge-progress {
      height: 8px;
      background: var(--bg);
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .gauge-progress::after {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 65%;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
      border-radius: 4px;
    }

    /* Price chart from second design */
    .price-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .token-label {
      font-weight: 600;
    }

    .token-price {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent);
    }

    .chart-time-select {
      display: flex;
      gap: 5px;
    }

    .chart-time-select button {
      background: var(--card-light);
      border: none;
      color: var(--text-muted);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
      cursor: pointer;
    }

    .chart-time-select button.active {
      background: var(--accent);
      color: white;
    }

    .buy-button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .buy-button:hover {
      background: var(--accent-dark);
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <aside class="sidebar">
      <i class="fas fa-home sidebar-icon active"></i>
      <i class="fas fa-chart-line sidebar-icon"></i>
      <i class="fas fa-wallet sidebar-icon"></i>
      <i class="fas fa-cog sidebar-icon"></i>
    </aside>

    <div class="dashboard">
      <header>
        <a href="#" class="logo">
          <i class="fas fa-key"></i>
          <span>KLY Staking</span>
        </a>
        <div>
          <button id="connectWallet" class="wallet-btn">
            <i class="fas fa-wallet"></i>
            <span>Connect Wallet</span>
          </button>
          <span id="walletAddress" class="wallet-address"></span>
        </div>
      </header>

      <div class="grid">
        <div class="card">
          <h2><i class="fas fa-coins"></i> Total Staked</h2>
          <div class="value" id="totalStaked">$557,507</div>
          <div class="change positive">
            <i class="fas fa-arrow-up"></i> 5.2% from last week
          </div>
        </div>
        <div class="card">
          <h2><i class="fas fa-percentage"></i> APY Rate</h2>
          <div class="value">16.60%</div>
          <div class="change positive">
            <i class="fas fa-arrow-up"></i> 1.2% from last month
          </div>
        </div>
        <div class="card">
          <h2><i class="fas fa-rocket"></i> Moon Points</h2>
          <div class="value">18,432</div>
          <div class="change negative">
            <i class="fas fa-arrow-down"></i> 2.1% from yesterday
          </div>
        </div>
        <div class="card">
          <h2><i class="fas fa-users"></i> Active Stakers</h2>
          <div class="value">2,451</div>
          <div class="change positive">
            <i class="fas fa-arrow-up"></i> 12.5% from last month
          </div>
        </div>
      </div>

      <div class="chart-container">
        <div class="price-header">
          <span class="token-label">KLY Price</span>
          <span class="token-price">$0.18</span>
          <div class="chart-timeframe">
            <button class="timeframe-btn active">1W</button>
            <button class="timeframe-btn">1M</button>
            <button class="timeframe-btn">3M</button>
            <button class="timeframe-btn">1Y</button>
            <button class="timeframe-btn">All</button>
          </div>
          <button class="buy-button">Buy KLY</button>
        </div>
        <div id="apexChart"></div>
      </div>

      <div class="stake-container">
        <div class="stake-box">
          <h3 class="stake-box-title"><i class="fas fa-coins"></i> Stake KLY</h3>
          
          <div class="tab-buttons">
            <button class="tab-btn active" data-tab="stake">Stake</button>
            <button class="tab-btn" data-tab="withdraw">Withdraw</button>
            <button class="tab-btn" data-tab="claim">Claim</button>
          </div>

          <div id="stake-tab" class="tab-content active">
            <div class="input-group">
              <label class="input-label">Amount to Stake (KLY)</label>
              <div class="input-wrapper">
                <input type="number" id="stakeAmount" class="input-field" placeholder="0.0" min="0" step="0.1" />
                <button class="max-btn" id="maxStakeBtn">MAX</button>
              </div>
            </div>
            
            <div class="input-group">
              <label class="input-label">Lockup Period</label>
              <select id="lockupPeriod" class="select-field">
                <option value="30">30 days (+5% bonus)</option>
                <option value="60">60 days (+10% bonus)</option>
                <option value="90">90 days (+15% bonus)</option>
                <option value="180">180 days (+25% bonus)</option>
              </select>
            </div>
            
            <button id="stakeBtn" class="action-btn" disabled>
              <i class="fas fa-lock"></i> Stake KLY
            </button>
            
            <div id="stakeStatus" class="status"></div>
          </div>

          <div id="withdraw-tab" class="tab-content">
            <div class="input-group">
              <label class="input-label">Amount to Withdraw (KLY)</label>
              <div class="input-wrapper">
                <input type="number" id="withdrawAmount" class="input-field" placeholder="0.0" min="0" step="0.1" />
                <button class="max-btn" id="maxWithdrawBtn">MAX</button>
              </div>
            </div>
            
            <button id="withdrawBtn" class="action-btn" disabled>
              <i class="fas fa-unlock"></i> Withdraw
            </button>
            
            <div id="withdrawStatus" class="status"></div>
          </div>

          <div id="claim-tab" class="tab-content">
            <div class="stats-item">
              <span class="stats-label">Available Rewards:</span>
              <span class="stats-value" id="rewardAmount">-- KLY</span>
            </div>
            
            <div class="stats-item">
              <span class="stats-label">Next Reward:</span>
              <span class="stats-value" id="nextReward">--</span>
            </div>
            
            <button id="claimBtn" class="action-btn" disabled>
              <i class="fas fa-gift"></i> Claim Rewards
            </button>
            
            <div id="claimStatus" class="status"></div>
          </div>
        </div>

        <div class="stats-box">
          <h3 class="stake-box-title"><i class="fas fa-chart-pie"></i> Your Staking Stats</h3>
          
          <div class="stats-item">
            <span class="stats-label">Wallet Balance:</span>
            <span class="stats-value" id="walletBalance">-- KLY</span>
          </div>
          
          <div class="stats-item">
            <span class="stats-label">Currently Staked:</span>
            <span class="stats-value" id="currentStake">-- KLY</span>
          </div>
          
          <div class="stats-item">
            <span class="stats-label">Total Rewards Earned:</span>
            <span class="stats-value" id="totalRewards">-- KLY</span>
          </div>
          
          <div class="stats-item">
            <span class="stats-label">Your Share:</span>
            <span class="stats-value" id="userShare">--%</span>
          </div>
          
          <div class="stats-item">
            <span class="stats-label">Lockup Period:</span>
            <span class="stats-value" id="userLockup">-- days</span>
          </div>
          
          <div class="stats-item">
            <span class="stats-label">Staking Since:</span>
            <span class="stats-value" id="stakingSince">--</span>
          </div>
          
          <div class="stats-item">
            <span class="stats-label">Estimated Daily Rewards:</span>
            <span class="stats-value" id="dailyRewards">-- KLY</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const CONFIG = {
      tokenAddress: "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52",
      stakingAddress: "0xe9417Fbe4e1D1E70aaE00b76e9B54599707c49e0",
      abi: [
        "function balanceOf(address) view returns (uint)",
        "function approve(address, uint) returns (bool)",
        "function allowance(address, address) view returns (uint)",
        "function stake(uint amount, uint lockupDays)",
        "function withdraw(uint amount)",
        "function claim()",
        "function getStakeInfo(address) view returns (uint, uint, uint, uint)",
        "function getTotalStaked() view returns (uint)",
        "function getAPY() view returns (uint)"
      ]
    };

    // State
    let provider, signer, walletAddress, tokenContract, stakingContract;
    let currentTab = "stake";

    // DOM Elements
    const connectWalletBtn = document.getElementById("connectWallet");
    const walletAddressEl = document.getElementById("walletAddress");
    const totalStakedEl = document.getElementById("totalStaked");
    const stakeAmountInput = document.getElementById("stakeAmount");
    const withdrawAmountInput = document.getElementById("withdrawAmount");
    const lockupPeriodSelect = document.getElementById("lockupPeriod");
    const stakeBtn = document.getElementById("stakeBtn");
    const withdrawBtn = document.getElementById("withdrawBtn");
    const claimBtn = document.getElementById("claimBtn");
    const maxStakeBtn = document.getElementById("maxStakeBtn");
    const maxWithdrawBtn = document.getElementById("maxWithdrawBtn");
    const rewardAmountEl = document.getElementById("rewardAmount");
    const nextRewardEl = document.getElementById("nextReward");
    const walletBalanceEl = document.getElementById("walletBalance");
    const currentStakeEl = document.getElementById("currentStake");
    const totalRewardsEl = document.getElementById("totalRewards");
    const userShareEl = document.getElementById("userShare");
    const userLockupEl = document.getElementById("userLockup");
    const stakingSinceEl = document.getElementById("stakingSince");
    const dailyRewardsEl = document.getElementById("dailyRewards");
    const stakeStatusEl = document.getElementById("stakeStatus");
    const withdrawStatusEl = document.getElementById("withdrawStatus");
    const claimStatusEl = document.getElementById("claimStatus");
    const tabButtons = document.querySelectorAll(".tab-btn");
    const tabContents = document.querySelectorAll(".tab-content");
    const timeframeButtons = document.querySelectorAll(".timeframe-btn");

    // Initialize
    document.addEventListener("DOMContentLoaded", async () => {
      initEventListeners();
      initChart();
      
      // Check if wallet is already connected
      if (window.ethereum && window.ethereum.selectedAddress) {
        await connectWallet();
      }
    });

    // Initialize event listeners
    function initEventListeners() {
      // Wallet connection
      connectWalletBtn.addEventListener("click", connectWallet);
      
      // Tab switching
      tabButtons.forEach(button => {
        button.addEventListener("click", () => {
          const tabId = button.getAttribute("data-tab");
          switchTab(tabId);
        });
      });
      
      // Timeframe switching
      timeframeButtons.forEach(button => {
        button.addEventListener("click", () => {
          timeframeButtons.forEach(btn => btn.classList.remove("active"));
          button.classList.add("active");
          updateChart(button.textContent);
        });
      });
      
      // Stake actions
      stakeBtn.addEventListener("click", stakeKLY);
      withdrawBtn.addEventListener("click", withdrawKLY);
      claimBtn.addEventListener("click", claimRewards);
      
      // Max buttons
      maxStakeBtn.addEventListener("click", setMaxStake);
      maxWithdrawBtn.addEventListener("click", setMaxWithdraw);
    }

    // Connect wallet
    async function connectWallet() {
      if (!window.ethereum) {
        showStatus(stakeStatusEl, "Please install MetaMask or another Web3 wallet", "error");
        return;
      }

      try {
        showStatus(stakeStatusEl, "Connecting wallet...", "info");
        
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        walletAddress = await signer.getAddress();
        
        // Initialize contracts
        tokenContract = new ethers.Contract(CONFIG.tokenAddress, CONFIG.abi, signer);
        stakingContract = new ethers.Contract(CONFIG.stakingAddress, CONFIG.abi, signer);
        
        // Update UI
        connectWalletBtn.classList.add("connected");
        connectWalletBtn.innerHTML = '<i class="fas fa-wallet"></i> Connected';
        walletAddressEl.textContent = `${walletAddress.substring(0, 6)}...${walletAddress.substring(walletAddress.length - 4)}`;
        
        // Enable buttons
        stakeBtn.disabled = false;
        withdrawBtn.disabled = false;
        claimBtn.disabled = false;
        
        // Load data
        await loadData();
        
        showStatus(stakeStatusEl, "Wallet connected successfully", "success");
        setTimeout(() => hideStatus(stakeStatusEl), 3000);
        
      } catch (error) {
        console.error("Wallet connection error:", error);
        showStatus(stakeStatusEl, "Failed to connect wallet", "error");
        setTimeout(() => hideStatus(stakeStatusEl), 3000);
      }
    }

    // Load all data
    async function loadData() {
      if (!walletAddress) return;
      
      try {
        // Get token decimals
        const decimals = await tokenContract.decimals();
        
        // Get wallet balance
        const balance = await tokenContract.balanceOf(walletAddress);
        const balanceFormatted = ethers.utils.formatUnits(balance, decimals);
        walletBalanceEl.textContent = parseFloat(balanceFormatted).toFixed(2);
        
        // Get staking info
        const [stakedAmount, rewards, lockupDays, stakingTimestamp] = await stakingContract.getStakeInfo(walletAddress);
        
        const stakedFormatted = ethers.utils.formatUnits(stakedAmount, decimals);
        currentStakeEl.textContent = parseFloat(stakedFormatted).toFixed(2);
        
        const rewardsFormatted = ethers.utils.formatUnits(rewards, decimals);
        rewardAmountEl.textContent = parseFloat(rewardsFormatted).toFixed(2);
        totalRewardsEl.textContent = parseFloat(rewardsFormatted).toFixed(2);
        
        userLockupEl.textContent = lockupDays.toString();
        
        // Calculate daily rewards
        const apy = await stakingContract.getAPY();
        const dailyRate = (Math.pow(1 + (apy / 100), 1/365) - 1) * 100;
        const dailyRewards = (parseFloat(stakedFormatted) * dailyRate / 100).toFixed(4);
        dailyRewardsEl.textContent = dailyRewards;
        
        // Calculate user share
        const totalStaked = await stakingContract.getTotalStaked();
        const totalStakedFormatted = ethers.utils.formatUnits(totalStaked, decimals);
        totalStakedEl.textContent = parseFloat(totalStakedFormatted).toFixed(2);
        
        if (totalStaked.gt(0)) {
          const share = (stakedAmount.mul(10000).div(totalStaked).toNumber() / 100;
          userShareEl.textContent = share.toFixed(2);
        }
        
        // Format staking since date
        if (stakingTimestamp.gt(0)) {
          const date = new Date(stakingTimestamp * 1000);
          stakingSinceEl.textContent = date.toLocaleDateString();
        }
        
        // Set next reward time
        const now = Math.floor(Date.now() / 1000);
        const nextRewardTime = now + (86400 - (now % 86400)); // Next midnight
        nextRewardEl.textContent = new Date(nextRewardTime * 1000).toLocaleTimeString();
        
      } catch (error) {
        console.error("Error loading data:", error);
        showStatus(stakeStatusEl, "Error loading data", "error");
        setTimeout(() => hideStatus(stakeStatusEl), 3000);
      }
    }

    // Stake KLY
    async function stakeKLY() {
      const amount = stakeAmountInput.value;
      const lockupDays = lockupPeriodSelect.value;
      
      if (!amount || isNaN(amount) || Number(amount) <= 0) {
        showStatus(stakeStatusEl, "Please enter a valid amount", "error");
        return;
      }

      try {
        showStatus(stakeStatusEl, "Processing transaction...", "info");
        stakeBtn.disabled = true;
        stakeBtn.innerHTML = '<span class="spinner"></span> Processing...';
        
        const decimals = await tokenContract.decimals();
        const parsedAmount = ethers.utils.parseUnits(amount, decimals);
        
        // Check allowance
        const allowance = await tokenContract.allowance(walletAddress, CONFIG.stakingAddress);
        if (allowance.lt(parsedAmount)) {
          showStatus(stakeStatusEl, "Approving tokens...", "info");
          const approveTx = await tokenContract.approve(CONFIG.stakingAddress, parsedAmount);
          await approveTx.wait();
        }
        
        // Stake tokens
        showStatus(stakeStatusEl, "Staking tokens...", "info");
        const stakeTx = await stakingContract.stake(parsedAmount, lockupDays);
        await stakeTx.wait();
        
        showStatus(stakeStatusEl, "Tokens staked successfully!", "success");
        stakeBtn.disabled = false;
        stakeBtn.innerHTML = '<i class="fas fa-lock"></i> Stake KLY';
        
        // Refresh data
        await loadData();
        
        setTimeout(() => hideStatus(stakeStatusEl), 5000);
        
      } catch (error) {
        console.error("Staking error:", error);
        showStatus(stakeStatusEl, "Staking failed", "error");
        stakeBtn.disabled = false;
        stakeBtn.innerHTML = '<i class="fas fa-lock"></i> Stake KLY';
        setTimeout(() => hideStatus(stakeStatusEl), 5000);
      }
    }

    // Withdraw KLY
    async function withdrawKLY() {
      const amount = withdrawAmountInput.value;
      
      if (!amount || isNaN(amount) || Number(amount) <= 0) {
        showStatus(withdrawStatusEl, "Please enter a valid amount", "error");
        return;
      }

      try {
        showStatus(withdrawStatusEl, "Processing withdrawal...", "info");
        withdrawBtn.disabled = true;
        withdrawBtn.innerHTML = '<span class="spinner"></span> Processing...';
        
        const decimals = await tokenContract.decimals();
        const parsedAmount = ethers.utils.parseUnits(amount, decimals);
        
        const withdrawTx = await stakingContract.withdraw(parsedAmount);
        await withdrawTx.wait();
        
        showStatus(withdrawStatusEl, "Withdrawal successful!", "success");
        withdrawBtn.disabled = false;
        withdrawBtn.innerHTML = '<i class="fas fa-unlock"></i> Withdraw';
        
        // Refresh data
        await loadData();
        
        setTimeout(() => hideStatus(withdrawStatusEl), 5000);
        
      } catch (error) {
        console.error("Withdrawal error:", error);
        showStatus(withdrawStatusEl, "Withdrawal failed", "error");
        withdrawBtn.disabled = false;
        withdrawBtn.innerHTML = '<i class="fas fa-unlock"></i> Withdraw';
        setTimeout(() => hideStatus(withdrawStatusEl), 5000);
      }
    }

    // Claim rewards
    async function claimRewards() {
      try {
        showStatus(claimStatusEl, "Processing claim...", "info");
        claimBtn.disabled = true;
        claimBtn.innerHTML = '<span class="spinner"></span> Processing...';
        
        const claimTx = await stakingContract.claim();
        await claimTx.wait();
        
        showStatus(claimStatusEl, "Rewards claimed successfully!", "success");
        claimBtn.disabled = false;
        claimBtn.innerHTML = '<i class="fas fa-gift"></i> Claim Rewards';
        
        // Refresh data
        await loadData();
        
        setTimeout(() => hideStatus(claimStatusEl), 5000);
        
      } catch (error) {
        console.error("Claim error:", error);
        showStatus(claimStatusEl, "Claim failed", "error");
        claimBtn.disabled = false;
        claimBtn.innerHTML = '<i class="fas fa-gift"></i> Claim Rewards';
        setTimeout(() => hideStatus(claimStatusEl), 5000);
      }
    }

    // Set max stake amount
    async function setMaxStake() {
      try {
        const balance = await tokenContract.balanceOf(walletAddress);
        const decimals = await tokenContract.decimals();
        const balanceFormatted = ethers.utils.formatUnits(balance, decimals);
        stakeAmountInput.value = parseFloat(balanceFormatted).toFixed(2);
      } catch (error) {
        console.error("Error getting balance:", error);
      }
    }

    // Set max withdraw amount
    async function setMaxWithdraw() {
      try {
        const [stakedAmount] = await stakingContract.getStakeInfo(walletAddress);
        const decimals = await tokenContract.decimals();
        const stakedFormatted = ethers.utils.formatUnits(stakedAmount, decimals);
        withdrawAmountInput.value = parseFloat(stakedFormatted).toFixed(2);
      } catch (error) {
        console.error("Error getting staked amount:", error);
      }
    }

    // Switch tabs
    function switchTab(tabId) {
      currentTab = tabId;
      
      // Update buttons
      tabButtons.forEach(button => {
        button.classList.remove("active");
        if (button.getAttribute("data-tab") === tabId) {
          button.classList.add("active");
        }
      });
      
      // Update content
      tabContents.forEach(content => {
        content.classList.remove("active");
        if (content.id === `${tabId}-tab`) {
          content.classList.add("active");
        }
      });
    }

    // Show status message
    function showStatus(element, message, type) {
      element.textContent = message;
      element.className = `status ${type}`;
    }

    // Hide status message
    function hideStatus(element) {
      element.className = "status";
      element.textContent = "";
    }

    // Initialize chart
    function initChart() {
      const options = {
        series: [{
          name: "KLY Price",
          data: [0.12, 0.14, 0.13, 0.15, 0.16, 0.17, 0.18]
        }],
        chart: {
          height: 350,
          type: 'line',
          zoom: {
            enabled: false
          },
          toolbar: {
            show: false
          }
        },
        colors: ['#8a2be2'],
        dataLabels: {
          enabled: false
        },
        stroke: {
          curve: 'smooth',
          width: 3
        },
        grid: {
          borderColor: 'rgba(138, 43, 226, 0.1)',
          strokeDashArray: 4
        },
        xaxis: {
          categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
          labels: {
            style: {
              colors: '#c5c5c5'
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#c5c5c5'
            },
            formatter: function(value) {
              return '$' + value.toFixed(2);
            }
          }
        },
        tooltip: {
          theme: 'dark'
        }
      };

      const chart = new ApexCharts(document.querySelector("#apexChart"), options);
      chart.render();
    }

    // Update chart data based on timeframe
    function updateChart(timeframe) {
      // In a real app, you would fetch new data based on the timeframe
      console.log(`Updating chart for timeframe: ${timeframe}`);
    }
  </script>
</body>
</html>
