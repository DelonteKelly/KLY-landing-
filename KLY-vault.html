<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The KLY Vault | Chamber of Secrets</title>
  <meta name="description" content="Unlock the sacred artifacts of the KLY Legacy with your Key of Ascension NFT">
  <meta property="og:title" content="The KLY Vault | Chamber of Secrets">
  <meta property="og:description" content="Unlock the sacred artifacts of the KLY Legacy with your Key of Ascension NFT">
  <meta property="og:image" content="https://yourdomain.com/images/vault-social-preview.jpg">
  <meta property="og:url" content="https://yourdomain.com/vault.html">
  <meta name="twitter:card" content="summary_large_image">
  
  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="image" href="vault-door.png">
  <link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js">
  <link rel="preload" as="script" href="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png">
  
  <style>
    :root {
      --gold-primary: #ffd700;
      --gold-secondary: #c5a042;
      --gold-dark: #8a6d0b;
      --bg-dark: #0a0a0a;
      --bg-darker: #050505;
      --text-light: #f5f5f5;
      --text-dim: #aaaaaa;
      --accent-glow: 0 0 15px rgba(255, 215, 0, 0.7);
      --transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    }
    
    /* Reset & global */
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html {
      scroll-behavior: smooth;
    }
    
    body {
      background: var(--bg-dark);
      color: var(--text-light);
      font-family: "Montserrat", sans-serif;
      overflow-x: hidden;
      position: relative;
    }
    
    a {
      cursor: pointer;
    }
    
    /* Loading overlay */
    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-darker);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.8s ease-out;
    }
    
    .loader-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 215, 0, 0.3);
      border-radius: 50%;
      border-top-color: var(--gold-primary);
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }
    
    .loader-text {
      color: var(--gold-primary);
      font-family: "Cinzel Decorative", serif;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    
    /* Layout and header */
    .vault-header {
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px;
      background: rgba(10, 10, 10, 0.85);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--gold-secondary);
      transition: var(--transition);
    }
    
    .vault-header.scrolled {
      background: rgba(5, 5, 5, 0.95);
      box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
    }
    
    .vault-logo {
      font-family: "Cinzel Decorative", serif;
      font-size: 1.8rem;
      color: var(--gold-primary);
      text-shadow: var(--accent-glow);
      letter-spacing: 2px;
      transition: var(--transition);
    }
    
    .vault-logo:hover {
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.9);
    }
    
    .vault-nav {
      display: flex;
      align-items: center;
    }
    
    .vault-nav a {
      color: var(--text-dim);
      text-decoration: none;
      margin-left: 25px;
      font-size: 0.9rem;
      transition: var(--transition);
      position: relative;
      font-family: "Cinzel Decorative", serif;
      letter-spacing: 1px;
    }
    
    .vault-nav a:hover {
      color: var(--gold-primary);
      text-shadow: 0 0 5px var(--gold-primary);
    }
    
    .vault-nav a::after {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 1px;
      background: var(--gold-primary);
      transition: width 0.3s ease;
    }
    
    .vault-nav a:hover::after {
      width: 100%;
    }
    
    #connectWalletBtn {
      border: 1px solid var(--gold-secondary);
      padding: 8px 16px;
      border-radius: 20px;
      background: transparent;
      color: var(--text-light);
      transition: var(--transition);
      font-family: "Cinzel Decorative", serif;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    #connectWalletBtn:hover {
      background: rgba(255, 215, 0, 0.1);
      border-color: var(--gold-primary);
      transform: translateY(-2px);
    }
    
    #connectWalletBtn.connected {
      background: rgba(255, 215, 0, 0.1);
      border-color: var(--gold-primary);
    }
    
    #walletAddress {
      margin-left: 1rem;
      font-size: 0.85rem;
      color: var(--gold-primary);
      font-family: "Montserrat", sans-serif;
    }
    
    /* Content & visuals */
    #threejs-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      opacity: 0.5;
    }
    
    .vault-content {
      position: relative;
      z-index: 5;
      text-align: center;
      max-width: 1200px;
      padding: 100px 20px;
      margin: auto;
    }
    
    .vault-title {
      font-family: "Cinzel Decorative", serif;
      font-size: clamp(2.5rem, 5vw, 4rem);
      color: var(--gold-primary);
      margin-bottom: 20px;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      letter-spacing: 3px;
      position: relative;
    }
    
    .vault-title::after {
      content: "";
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 2px;
      background: var(--gold-primary);
    }
    
    .vault-subtitle {
      font-size: clamp(1rem, 2vw, 1.2rem);
      color: var(--text-dim);
      margin-bottom: 40px;
      line-height: 1.6;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .enhanced-door {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 60px auto;
      z-index: 3;
      transition: var(--transition);
      transform: translateY(0);
    }
    
    .enhanced-door:hover {
      transform: translateY(-5px);
    }
    
    .vault-image {
      width: 100%;
      border: 2px solid var(--gold-secondary);
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
      border-radius: 10px;
      transition: var(--transition);
    }
    
    .enhanced-door:hover .vault-image {
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.5);
    }
    
    .door-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(3px);
      background: rgba(0, 0, 0, 0.5);
      text-align: center;
      border-radius: 8px;
      transition: var(--transition);
    }
    
    .vault-door-title {
      font-family: "Cinzel Decorative", serif;
      font-size: clamp(1.5rem, 3vw, 1.8rem);
      color: var(--gold-primary);
      margin-bottom: 20px;
      text-shadow: var(--accent-glow);
    }
    
    .unlock-btn {
      background: transparent;
      color: var(--gold-primary);
      border: 1px solid var(--gold-secondary);
      padding: 12px 30px;
      font-family: "Cinzel Decorative", serif;
      font-size: 1.1rem;
      letter-spacing: 1px;
      border-radius: 30px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: var(--transition);
    }
    
    .unlock-btn:hover {
      background: rgba(197, 160, 66, 0.2);
      box-shadow: 0 0 20px rgba(197, 160, 66, 0.4);
      transform: translateY(-2px);
    }
    
    .unlock-btn::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 215, 0, 0.3),
        transparent
      );
      transition: all 0.8s ease;
    }
    
    .unlock-btn:hover::before {
      left: 100%;
    }
    
    .vault-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 30px;
      margin-top: 80px;
      padding: 0 20px;
      opacity: 0;
      transform: translateY(20px);
      transition: var(--transition);
    }
    
    .vault-items.visible {
      opacity: 1;
      transform: translateY(0);
    }
    
    .vault-item {
      background: linear-gradient(145deg, #1a1a1a, #0a0a0a);
      border: 1px solid rgba(197, 160, 66, 0.3);
      border-radius: 8px;
      padding: 30px;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      opacity: 0;
      transform: translateY(20px);
    }
    
    .vault-item.visible {
      opacity: 1;
      transform: translateY(0);
    }
    
    .vault-item:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 15px 40px rgba(197, 160, 66, 0.3);
      border-color: var(--gold-primary);
    }
    
    .vault-item::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(
        to right,
        transparent,
        var(--gold-primary),
        transparent
      );
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .vault-item:hover::before {
      opacity: 1;
    }
    
    .item-icon {
      font-size: 2.5rem;
      color: var(--gold-primary);
      margin-bottom: 20px;
      transition: var(--transition);
    }
    
    .vault-item:hover .item-icon {
      transform: scale(1.2);
    }
    
    .item-title {
      font-family: "Cinzel Decorative", serif;
      font-size: 1.3rem;
      margin-bottom: 15px;
      color: var(--gold-primary);
    }
    
    .item-desc {
      font-size: 0.9rem;
      color: var(--text-dim);
      line-height: 1.6;
    }
    
    .vault-footer {
      position: relative;
      z-index: 10;
      text-align: center;
      padding: 50px 30px;
      margin-top: 50px;
      color: var(--text-dim);
      font-size: 0.8rem;
      border-top: 1px solid rgba(197, 160, 66, 0.1);
    }
    
    /* Particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none;
    }
    
    .particle {
      position: absolute;
      background: var(--gold-primary);
      border-radius: 50%;
      opacity: 0.6;
      filter: blur(1px);
    }
    
    /* Status overlay */
    .status-overlay {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(10, 10, 10, 0.95);
      color: var(--gold-primary);
      padding: 25px 50px;
      border: 1px solid var(--gold-secondary);
      font-family: "Cinzel Decorative", serif;
      z-index: 9999;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      opacity: 0;
      transition: var(--transition);
      pointer-events: none;
    }
    
    .status-overlay.visible {
      opacity: 1;
    }
    
    .status-icon {
      font-size: 2rem;
    }
    
    .status-text {
      font-size: 1.1rem;
      letter-spacing: 1px;
    }
    
    /* Progress bar */
    .progress-bar {
      width: 100%;
      height: 3px;
      background: rgba(255, 215, 0, 0.2);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 15px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(to right, var(--gold-dark), var(--gold-primary));
      width: 0;
      transition: width 0.3s ease;
    }
    
    /* Door animation */
    @keyframes doorOpen {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      100% {
        transform: scale(0.8) rotateY(90deg);
        opacity: 0;
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .vault-header {
        flex-direction: column;
        padding: 15px;
      }
      
      .vault-logo {
        margin-bottom: 15px;
      }
      
      .vault-nav {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .vault-nav a {
        margin: 0 10px 10px;
      }
      
      .vault-content {
        padding: 80px 20px;
      }
      
      .enhanced-door {
        margin: 30px auto;
      }
      
      .vault-items {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 480px) {
      .vault-title {
        font-size: 2rem;
      }
      
      .unlock-btn {
        padding: 10px 20px;
        font-size: 1rem;
      }
      
      .status-overlay {
        width: 90%;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Loading overlay -->
  <div class="loader" id="pageLoader">
    <div class="loader-spinner"></div>
    <div class="loader-text">Entering the Vault...</div>
  </div>

  <header class="vault-header" id="mainHeader">
    <div class="vault-logo">THE KLY VAULT</div>
    <nav class="vault-nav">
      <a href="/portal.html">Portal</a>
      <a href="/kly-academy.html">Academy</a>
      <a href="/oracle.html">Oracle</a>
      <button id="connectWalletBtn">
        <i class="fas fa-wallet"></i>
        <span>Connect Wallet</span>
      </button>
      <span id="walletAddress" class="hidden"></span>
    </nav>
  </header>

  <div id="vault-container">
    <canvas id="threejs-canvas"></canvas>
    <div class="particles" id="particles"></div>
    <div class="vault-content">
      <h1 class="vault-title">CHAMBER OF SECRETS</h1>
      <p class="vault-subtitle">WHAT IS SOUGHT<br />IS FOUND WITHIN</p>
      <div class="enhanced-door">
        <img
          src="vault-door.png"
          alt="Ancient Vault Door with intricate carvings"
          class="vault-image"
          loading="lazy"
        />
        <div class="door-overlay">
          <h2 class="vault-door-title">Key of Ascension Required</h2>
          <button
            class="unlock-btn"
            id="unlockBtn"
            aria-label="Enter the vault after verification"
          >
            <i class="fas fa-key"></i>
            Enter the Vault
          </button>
        </div>
      </div>
      <div class="vault-items" id="vaultItems">
        <div class="vault-item">
          <div class="item-icon">üóùÔ∏è</div>
          <h3 class="item-title">Keys of Sovereignty</h3>
          <p class="item-desc">
            Ancient digital keys that unlock governance rights within the
            Tamaquah Nation's blockchain protocols.
          </p>
        </div>
        <div class="vault-item">
          <div class="item-icon">üìú</div>
          <h3 class="item-title">Scrolls of Creation</h3>
          <p class="item-desc">
            The original smart contracts that birthed the Kelly Legacy
            ecosystem, etched permanently on-chain.
          </p>
        </div>
        <div class="vault-item">
          <div class="item-icon">üíé</div>
          <h3 class="item-title">Diamond Sigils</h3>
          <p class="item-desc">
            Rare NFTs representing ownership stakes in the physical Kelly
            Legacy estates and artifacts.
          </p>
        </div>
        <div class="vault-item">
          <div class="item-icon">üîÆ</div>
          <h3 class="item-title">Oracle Crystals</h3>
          <p class="item-desc">
            Predictive algorithms and AI models passed down through
            generations of digital seers.
          </p>
        </div>
        <div class="vault-item">
          <div class="item-icon">‚öîÔ∏è</div>
          <h3 class="item-title">Weapons of Light</h3>
          <p class="item-desc">
            Cryptographic tools for defending the network against malicious
            actors and bad faith intrusions.
          </p>
        </div>
        <div class="vault-item">
          <div class="item-icon">üè∫</div>
          <h3 class="item-title">Vessels of Memory</h3>
          <p class="item-desc">
            Immutable storage containing the complete history and lore of the
            Kelly bloodline.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Status overlay -->
  <div class="status-overlay" id="statusOverlay">
    <div class="status-icon" id="statusIcon">üîç</div>
    <div class="status-text" id="statusText">Verifying access...</div>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <footer class="vault-footer">
    ¬© 2025 Kelly Legacy Estates ‚Äî Tamaquah Nation ‚Ä¢ Cycle 42 of the Great Alignment
  </footer>

  <!-- Font Awesome for icons -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  
  <script type="module">
    import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js";
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js';

    // Constants
    const CONTRACT_ADDRESS = "0xDA76d35742190283E340dbeE2038ecc978a56950";
    const CONTRACT_ABI = [
      {
        inputs: [{ internalType: "address", name: "owner", type: "address" }],
        name: "balanceOf",
        outputs: [{ internalType: "uint256", name: "", type: "uint256" }],
        stateMutability: "view",
        type: "function",
      },
    ];
    const BNB_CHAIN_ID = "0x38";
    
    // DOM elements
    const walletButton = document.getElementById("connectWalletBtn");
    const walletAddress = document.getElementById("walletAddress");
    const unlockBtn = document.getElementById("unlockBtn");
    const vaultItems = document.getElementById("vaultItems");
    const statusOverlay = document.getElementById("statusOverlay");
    const statusIcon = document.getElementById("statusIcon");
    const statusText = document.getElementById("statusText");
    const progressFill = document.getElementById("progressFill");
    const pageLoader = document.getElementById("pageLoader");
    const mainHeader = document.getElementById("mainHeader");
    const particlesContainer = document.getElementById("particles");

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      // Simulate loading (remove this in production)
      setTimeout(() => {
        pageLoader.style.opacity = '0';
        setTimeout(() => {
          pageLoader.style.display = 'none';
          initScrollHandler();
          createParticles();
          initThreeJS();
          
          // Check if wallet is already connected
          if (window.ethereum && window.ethereum.selectedAddress) {
            updateWalletButton(true, shortenAddress(window.ethereum.selectedAddress));
          }
        }, 800);
      }, 1500);
      
      // Add event listeners
      walletButton.addEventListener('click', connectWallet);
      unlockBtn.addEventListener('click', verifyNFTAccess);
    });

    // Create floating particles
    function createParticles() {
      const particleCount = window.innerWidth < 768 ? 30 : 60;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // Random properties
        const size = Math.random() * 4 + 1;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        const duration = Math.random() * 15 + 10;
        const delay = Math.random() * 10;
        const opacity = Math.random() * 0.5 + 0.1;
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}%`;
        particle.style.top = `${posY}%`;
        particle.style.opacity = opacity;
        
        // Animate particle
        animateParticle(particle, duration, delay);
        
        particlesContainer.appendChild(particle);
      }
    }

    // Animate individual particle
    function animateParticle(particle, duration, delay) {
      let start = null;
      const initialX = parseFloat(particle.style.left);
      const initialY = parseFloat(particle.style.top);
      
      function step(timestamp) {
        if (!start) start = timestamp;
        const progress = (timestamp - start) / (duration * 1000);
        
        if (progress < 1) {
          // Move in gentle waves
          const newX = initialX + Math.sin(progress * Math.PI * 2) * 5;
          const newY = initialY - progress * 100;
          const opacity = 0.1 + 0.4 * (1 - progress);
          
          particle.style.left = `${newX}%`;
          particle.style.top = `${newY}%`;
          particle.style.opacity = opacity;
          
          // Reset particle when it goes off screen
          if (newY < -5) {
            particle.style.top = '105%';
            particle.style.left = `${initialX}%`;
            particle.style.opacity = '0.1';
            start = timestamp - delay * 1000;
          }
          
          requestAnimationFrame(step);
        } else {
          // Restart animation
          particle.style.top = '105%';
          particle.style.left = `${initialX}%`;
          particle.style.opacity = '0.1';
          start = null;
          setTimeout(() => {
            start = timestamp;
            requestAnimationFrame(step);
          }, delay * 1000);
        }
      }
      
      setTimeout(() => {
        requestAnimationFrame(step);
      }, delay * 1000);
    }

    // Initialize Three.js scene
    function initThreeJS() {
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      const renderer = new THREE.WebGLRenderer({
        canvas: document.getElementById("threejs-canvas"),
        alpha: true,
        antialias: true
      });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth, window.innerHeight);
      
      // Create torus knot geometry
      const geometry = new THREE.TorusKnotGeometry(12, 3, 256, 32);
      const material = new THREE.MeshBasicMaterial({
        color: 0xd4af37,
        wireframe: true,
        transparent: true,
        opacity: 0.2
      });
      const knot = new THREE.Mesh(geometry, material);
      scene.add(knot);
      
      // Add ambient glow
      const glowGeometry = new THREE.SphereGeometry(15, 32, 32);
      const glowMaterial = new THREE.MeshBasicMaterial({
        color: 0xd4af37,
        transparent: true,
        opacity: 0.05,
        wireframe: false
      });
      const glow = new THREE.Mesh(glowGeometry, glowMaterial);
      scene.add(glow);
      
      camera.position.z = 30;

      // Animation loop
      function animate() {
        requestAnimationFrame(animate);
        knot.rotation.x += 0.001;
        knot.rotation.y += 0.002;
        glow.rotation.x += 0.0005;
        glow.rotation.y += 0.0005;
        renderer.render(scene, camera);
      }
      animate();

      // Handle window resize
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }

    // Initialize scroll handler for header effect
    function initScrollHandler() {
      window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
          mainHeader.classList.add('scrolled');
        } else {
          mainHeader.classList.remove('scrolled');
        }
      });
    }

    // Wallet connection functions
    async function connectWallet() {
      try {
        if (typeof window.ethereum === 'undefined') {
          showStatus('‚ö†Ô∏è MetaMask not found', 'error');
          setTimeout(() => {
            window.open('https://metamask.io/download.html', '_blank');
          }, 2000);
          return;
        }

        // Request account access
        showStatus('üîì Connecting wallet...', 'info');
        const accounts = await window.ethereum.request({ 
          method: 'eth_requestAccounts' 
        });
        
        // Verify network
        await verifyNetwork();
        
        updateWalletButton(true, shortenAddress(accounts[0]));
        showStatus('‚úÖ Wallet connected', 'success');
        
        // Set up event listeners
        window.ethereum.on('accountsChanged', handleAccountsChanged);
        window.ethereum.on('chainChanged', handleChainChanged);
        
      } catch (error) {
        console.error('Wallet connection error:', error);
        showStatus('‚ö†Ô∏è Connection failed', 'error');
      }
    }

    async function verifyNetwork() {
      const currentChainId = await window.ethereum.request({ method: 'eth_chainId' });
      
      if (currentChainId !== BNB_CHAIN_ID) {
        showStatus('üåê Switching to BSC...', 'info');
        
        try {
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: BNB_CHAIN_ID }],
          });
        } catch (switchError) {
          // This error code indicates that the chain has not been added to MetaMask
          if (switchError.code === 4902) {
            try {
              await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [{
                  chainId: BNB_CHAIN_ID,
                  chainName: 'Binance Smart Chain',
                  nativeCurrency: {
                    name: 'BNB',
                    symbol: 'BNB',
                    decimals: 18
                  },
                  rpcUrls: ['https://bsc-dataseed.binance.org/'],
                  blockExplorerUrls: ['https://bscscan.com']
                }]
              });
            } catch (addError) {
              showStatus('‚ö†Ô∏è Please switch to BSC', 'error');
              throw addError;
            }
          } else {
            showStatus('‚ö†Ô∏è Please switch to BSC', 'error');
            throw switchError;
          }
        }
      }
    }

    function handleAccountsChanged(accounts) {
      if (accounts.length === 0) {
        // Wallet disconnected
        updateWalletButton(false);
        showStatus('‚ö†Ô∏è Wallet disconnected', 'warning');
      } else {
        // Account changed
        updateWalletButton(true, shortenAddress(accounts[0]));
      }
    }

    function handleChainChanged() {
      window.location.reload();
    }

    function updateWalletButton(connected, address = '') {
      if (connected) {
        walletButton.innerHTML = `<i class="fas fa-check-circle"></i><span>${address}</span>`;
        walletButton.classList.add('connected');
        walletAddress.textContent = address;
        walletAddress.classList.remove('hidden');
      } else {
        walletButton.innerHTML = '<i class="fas fa-wallet"></i><span>Connect Wallet</span>';
        walletButton.classList.remove('connected');
        walletAddress.classList.add('hidden');
      }
    }

    function shortenAddress(address) {
      return `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
    }

    // NFT verification
    async function verifyNFTAccess() {
      if (!window.ethereum || !window.ethereum.selectedAddress) {
        showStatus('üîë Connect wallet first', 'warning');
        return;
      }

      try {
        showStatus('üîç Verifying NFT...', 'info');
        simulateProgress();
        
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();
        const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
        
        const balance = await contract.balanceOf(await signer.getAddress());
        
        if (balance.gt(0)) {
          showStatus('‚úÖ Access granted!', 'success');
          unlockVault();
        } else {
          showStatus('‚õî Key of Ascension required', 'error');
        }
      } catch (error) {
        console.error('NFT verification error:', error);
        showStatus('‚ö†Ô∏è Verification failed', 'error');
      }
    }

    function simulateProgress() {
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress >= 100) {
          clearInterval(interval);
          progressFill.style.width = '100%';
        } else {
          progressFill.style.width = `${progress}%`;
        }
      }, 200);
    }

    function unlockVault() {
      // Animate door opening
      const doorOverlay = document.querySelector('.door-overlay');
      doorOverlay.style.animation = 'doorOpen 1s forwards';
      
      // Show vault items with staggered animation
      setTimeout(() => {
        doorOverlay.style.display = 'none';
        vaultItems.classList.add('visible');
        
        // Animate each item individually
        const items = document.querySelectorAll('.vault-item');
        items.forEach((item, index) => {
          setTimeout(() => {
            item.classList.add('visible');
          }, index * 100);
        });
        
        // Scroll to items
        setTimeout(() => {
          vaultItems.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 500);
      }, 1000);
    }

    // Status message functions
    function showStatus(message, type = 'info') {
      // Set icon based on type
      let icon;
      switch(type) {
        case 'success':
          icon = '‚úÖ';
          break;
        case 'error':
          icon = '‚ùå';
          break;
        case 'warning':
          icon = '‚ö†Ô∏è';
          break;
        default:
          icon = 'üîç';
      }
      
      statusIcon.textContent = icon;
      statusText.textContent = message;
      progressFill.style.width = '0';
      
      // Show overlay
      statusOverlay.classList.add('visible');
      
      // Auto-hide after delay for non-error messages
      if (type !== 'error') {
        setTimeout(() => {
          statusOverlay.classList.remove('visible');
        }, type === 'success' ? 2000 : 3000);
      }
    }
  </script>
</body>
</html>
