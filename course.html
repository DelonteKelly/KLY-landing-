<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Transformational 7-module course on self-realization">
  <title>Path of Awakening</title>
  
  <!-- Preconnect to CDNs for better performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://unpkg.com">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;700&family=EB+Garamond:ital@0;1&family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  
  <!-- Libraries (loaded asynchronously where possible) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.0/aframe/build/aframe-ar.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" defer></script>
  <script src="https://unpkg.com/@web3modal/ethers@2.6.1/dist/index.js" defer></script>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚òØ</text></svg>">
  
  <style>
    :root {
      --gold-light: #f9e076;
      --gold-primary: #d4af37;
      --gold-dark: #8a6d0b;
      --teal-light: #00ffe7;
      --teal-dark: #007a6d;
      --bg-dark: #0a0a0f;
      --bg-darker: #050508;
      --text-light: #f0f0f0;
      --text-muted: rgba(200, 200, 200, 0.6);
      --module-bg: rgba(20, 20, 30, 0.8);
      --module-complete: rgba(212, 175, 55, 0.1);
      --nft-glow: rgba(0, 255, 231, 0.3);
      --transition-base: 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0; padding: 0; background-color: var(--bg-dark); color: var(--text-light);
      font-family: 'EB Garamond', serif; overflow-x: hidden; line-height: 1.6;
      text-rendering: optimizeLegibility; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .cosmic-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.15; pointer-events: none; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; position: relative; }
    h1, h2, h3, h4, h5, h6 { font-weight: 400; line-height: 1.2; }
    .wisdom-hero {
      min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
      position: relative; padding: 4rem 2rem; background: radial-gradient(ellipse at center, var(--bg-dark) 0%, var(--bg-darker) 100%);
    }
    .kly-logo { position: absolute; top: 2rem; left: 2rem; width: 120px; height: auto; opacity: 0.8; transition: opacity var(--transition-base); z-index: 10; }
    .kly-logo:hover { opacity: 1; }
    .title-container { text-align: center; position: relative; margin-bottom: 4rem; max-width: 90%; }
    .title-decoration { position: absolute; left: 50%; transform: translateX(-50%); width: 60%; height: 1px;
      background: linear-gradient(90deg, transparent 0%, var(--gold-primary) 15%, var(--gold-primary) 85%, transparent 100%); }
    .title-decoration.top { top: -2rem; } .title-decoration.bottom { bottom: -2rem; }
    h1 {
      font-family: 'Cormorant Garamond', serif; font-weight: 300; font-size: clamp(2.5rem, 5vw, 5rem);
      letter-spacing: 0.5rem; margin: 0; text-transform: uppercase; position: relative;
    }
    .gold-gradient { background: linear-gradient(135deg, var(--gold-light), var(--gold-primary), var(--gold-dark));
      -webkit-background-clip: text; background-clip: text; color: transparent; font-weight: 400; }
    .subtitle { font-size: clamp(1rem, 1.5vw, 1.2rem); color: var(--text-muted); letter-spacing: 0.1rem; margin-top: 1.5rem; max-width: 600px; line-height: 1.6; }
    .serif-italic { font-style: italic; color: var(--gold-primary); }
    .cta-container { position: relative; margin-top: 3rem; text-align: center; display: flex; flex-direction: column; gap: 1rem; align-items: center; }
    .wisdom-cta {
      background: transparent; color: var(--gold-primary); border: 1px solid rgba(200, 160, 100, 0.3); padding: 1.2rem 3rem;
      font-family: 'Cormorant Garamond', serif; font-size: 1.1rem; letter-spacing: 0.2rem; position: relative; overflow: hidden;
      transition: all var(--transition-base); backdrop-filter: blur(5px); cursor: pointer; border-radius: 2px; min-width: 280px;
    }
    .wisdom-cta:hover { border-color: rgba(200, 160, 100, 0.6); background: rgba(20, 15, 5, 0.3); box-shadow: 0 0 20px rgba(212, 175, 55, 0.2); }
    .wisdom-cta::before {
      content: ""; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(200,160,100,0.1), transparent); transition: 0.7s;
    }
    .wisdom-cta:hover::before { left: 100%; }
    .cta-icon { margin-left: 0.8rem; font-size: 1.2rem; display: inline-block; transition: transform var(--transition-base); }
    .wisdom-cta:hover .cta-icon { transform: rotate(45deg); }
    .disclaimer { font-size: 0.8rem; color: var(--text-muted); margin-top: 1.5rem; letter-spacing: 0.05rem; opacity: 0.7; max-width: 500px; }
    .triquetra { position: absolute; width: 120px; height: 120px; opacity: 0.7; transition: opacity 1s ease; pointer-events: none; }
    .triquetra path { stroke: var(--gold-primary); stroke-width: 1.5; fill: none; stroke-dasharray: 300; stroke-dashoffset: 300; animation: draw 8s infinite alternate; }
    @keyframes draw { 0%{stroke-dashoffset:300;opacity:.3} 50%{stroke-dashoffset:0;opacity:.7} 100%{stroke-dashoffset:-300;opacity:.3} }
    #courseContent { text-align: left; max-width: 900px; margin: 4rem auto; opacity: 1; height: auto; overflow: hidden; }
    h2 { font-family:'Cormorant Garamond',serif; font-weight:400; font-size:2.5rem; color:var(--gold-primary); margin:3rem 0 1.5rem; position:relative; }
    h2::after { content:""; display:block; width:100px; height:1px; background:linear-gradient(90deg,var(--gold-primary),transparent); margin-top:1rem; }
    h3 { font-family:'Cormorant Garamond',serif; font-weight:400; font-size:1.8rem; color:var(--teal-light); margin:2rem 0 1rem; }
    h4 { font-family:'EB Garamond',serif; font-style:italic; font-size:1.2rem; color:var(--gold-primary); margin:1.5rem 0 .5rem; }
    article {
      background: var(--module-bg); border-left: 2px solid var(--gold-primary); padding: 2rem; margin-bottom: 3rem;
      border-radius: 0 8px 8px 0; transition: all var(--transition-base); position: relative; overflow: hidden; backdrop-filter: blur(5px);
    }
    article:hover { transform: translateX(5px); box-shadow: 0 5px 25px rgba(0,0,0,.5); }
    article.completed { border-left-color: var(--teal-light); background: var(--module-complete); }
    article.completed::after { content:'‚úì'; position:absolute; top:1rem; right:1rem; color:var(--teal-light); font-weight:bold; font-size:1.5rem; }
    p { margin: 1rem 0; font-size: 1.1rem; line-height: 1.7; }
    ul, ol { margin: 1.5rem 0; padding-left: 1.5rem; }
    li { margin-bottom: 1rem; position: relative; font-size: 1.1rem; line-height: 1.7; }
    li:before { content:'‚Ä¢'; color:var(--gold-primary); position:absolute; left:-1.2rem; }
    strong { color: var(--gold-primary); font-weight: 400; }
    em { color: var(--teal-light); font-style: italic; }
    .practice-box { background: rgba(0,255,231,0.05); border-left: 2px solid var(--teal-light); padding: 1.5rem; margin: 2rem 0; border-radius: 0 8px 8px 0; }
    .practice-box h4 { color: var(--teal-light); }
    .bonus-section { background: rgba(212,175,55,0.05); border: 1px solid rgba(212,175,55,0.2); padding: 2rem; border-radius: 8px; margin: 4rem 0; }
    .bonus-section h3 { color: var(--gold-primary); }
    .module-complete { display:flex; align-items:center; gap:.8rem; margin-top:2rem; color:var(--gold-primary); }
    .module-complete input { cursor:pointer; width:20px; height:20px; accent-color:var(--gold-primary); }
    .module-complete label { font-family:'EB Garamond',serif; font-size:1.1rem; cursor:pointer; }
    .key-quote { font-style: italic; color: var(--gold-primary); border-left: 2px solid var(--gold-primary); padding-left: 1.5rem; margin: 2rem 0; }

    /* Progress */
    .progress-container { width:100%; background-color:rgba(255,255,255,0.05); border-radius:10px; margin:3rem 0; overflow:hidden; position:relative; height:6px; }
    .progress-bar { height:100%; background:linear-gradient(90deg,var(--gold-primary),var(--teal-light)); width:0%; transition:width 1s ease; position:relative; }
    .progress-text { position:absolute; right:0; top:-2rem; font-size:.9rem; color:var(--text-muted); }

    /* Wallet */
    #walletStatus { margin-top:.5rem; font-size:.9rem; color:var(--gold-primary); min-height:1.5rem; }

    /* AR */
    .ar-marker {
      position: fixed; bottom: 2rem; right: 2rem; width: 300px; height: 300px; z-index: 100; border: 1px solid var(--gold-primary);
      border-radius: 8px; overflow: hidden; display: none; box-shadow: 0 0 30px rgba(212,175,55,0.3);
    }

    /* NFT Certificate */
    .nft-certificate { max-width:400px; margin:2rem auto; padding:2rem;
      background:linear-gradient(135deg,rgba(20,20,30,0.8),rgba(5,5,8,0.9)); border:1px solid var(--gold-primary);
      border-radius:8px; text-align:center; box-shadow:0 0 30px var(--nft-glow); display:none; }
    .nft-certificate h3 { color:var(--gold-primary); margin-bottom:1rem; }
    .nft-image { width:150px; height:150px; margin:1rem auto; background:radial-gradient(circle,var(--teal-light) 0%, var(--gold-primary) 100%);
      border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:3rem; color:var(--bg-darker); }

    /* Loading */
    .loading { position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-darker);
      display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999; transition:opacity .5s ease; }
    .loading-spinner { width:50px; height:50px; border:3px solid rgba(212,175,55,0.3); border-radius:50%; border-top-color:var(--gold-primary); animation: spin 1s ease-in-out infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Responsive */
    @media (max-width:768px){
      .container{padding:0 1.5rem}
      .kly-logo{width:80px; top:1.5rem; left:1.5rem}
      h1{font-size:2.2rem; letter-spacing:.3rem}
      h2{font-size:2rem} h3{font-size:1.5rem} article{padding:1.5rem}
      .ar-marker{width:200px;height:200px;bottom:1rem;right:1rem}
      .title-container{margin-bottom:2rem}
      .title-decoration.top{top:-1.5rem} .title-decoration.bottom{bottom:-1.5rem}
    }
    @media (max-width:480px){
      .wisdom-hero{padding:6rem 1.5rem 4rem}
      h1{font-size:1.8rem} .subtitle{font-size:.9rem}
      .wisdom-cta{padding:.8rem 1.5rem; font-size:.9rem; min-width:200px}
      article{padding:1.2rem}
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading" id="loadingScreen">
    <div class="loading-spinner"></div>
    <p style="margin-top: 1rem; color: var(--gold-primary);">Initializing Wisdom Journey...</p>
  </div>
  
  <!-- 3D Sacred Geometry Background -->
  <div id="cosmicContainer" class="cosmic-canvas"></div>
  
  <!-- AR Meditation Marker -->
  <div class="ar-marker" id="arMarker">
    <a-scene embedded arjs>
      <a-entity 
        geometry="primitive: torusKnot; radius: 0.5; radiusTubular: 0.1"
        material="color: #D4AF37; metalness: 0.8; roughness: 0.2"
        rotation="0 45 0"
        animation="property: rotation; to: 0 405 0; loop: true; dur: 10000">
      </a-entity>
      <a-marker-camera preset="hiro"></a-marker-camera>
    </a-scene>
  </div>
  
  <div class="container">
    <!-- Hero Section -->
    <section class="wisdom-hero">
      <img src="https://raw.githubusercontent.com/DelonteKelly/KLY-landing-/main/KLY-logo.png" alt="KLY Logo" class="kly-logo" loading="lazy">
      
      <div class="title-container">
        <div class="title-decoration top"></div>
        <h1>The Path of <span class="gold-gradient">Awakening</span></h1>
        <div class="title-decoration bottom"></div>
        <p class="subtitle">A <span class="serif-italic">transformational</span> journey into self-realization, presence, and embodied truth.</p>
      </div>
      
      <div class="cta-container">
        <button id="startCourseBtn" class="wisdom-cta">
          <span class="cta-text">Begin Journey</span>
          <span class="cta-icon">‚åæ</span>
        </button>

        <button id="connectWallet" class="wisdom-cta">Connect Wallet to Unlock</button>
        <p id="walletStatus"></p>

        <p class="disclaimer">‚úß For those who grasp the alchemical keys ‚Äî the veil parts but for a moment. ‚úß</p>

        <svg class="triquetra" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <path d="M50,15 L65,50 L50,85 L35,50 L50,15 M20,65 L50,50 L80,65 L65,50 L80,35 L50,50 L20,35 L35,50 L20,65"/>
        </svg>
      </div>
    </section>

    <!-- Progress Tracking -->
    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar"></div>
      <span class="progress-text" id="progressText">0 / 14 (0%)</span>
    </div>
    
    <div id="courseContent" style="display: none;"></div>
  
    <!-- NFT Certificate (hidden by default) -->
    <div class="nft-certificate" id="nftCertificate">
      <div class="nft-image">‚òØ</div>
      <h3>Certificate of Awakening</h3>
      <p>Presented to</p>
      <p id="certificateAddress"></p>
      <p>For completing the Path of Awakening + SWC</p>
      <p>Issued on <span id="certificateDate"></span></p>
      <button id="mintNFTBtn" class="wisdom-cta" style="margin-top: 1.5rem;">
        Mint as NFT
      </button>
    </div>

<script>
/** ================================
 *  Unified Courses App (14 modules)
 *  ================================
 */
const CONFIG = {
  KLY_CONTRACT: "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52",
  MIN_BALANCE: 500,
  erc20ABI: [
    "function balanceOf(address) view returns (uint256)",
    "function decimals() view returns (uint8)"
  ],
  COURSE_URL: "course-modules.html",
  TOTAL_UNITS: 14
};

const state = {
  provider: null,
  signer: null,
  address: null,
  // store keys like "awakening-1" ‚Ä¶ "awakening-7", "swc-1" ‚Ä¶ "swc-7"
  completed: JSON.parse(localStorage.getItem('completedUnits') || '[]'),
  pct: parseInt(localStorage.getItem('progressPct') || '0', 10)
};

const el = {
  loadingScreen: document.getElementById("loadingScreen"),
  courseContent: document.getElementById("courseContent"),
  progressBar: document.getElementById("progressBar"),
  progressText: document.getElementById("progressText"),
  walletStatus: document.getElementById("walletStatus"),
  connectWallet: document.getElementById("connectWallet"),
  startCourseBtn: document.getElementById("startCourseBtn"),
  arMarker: document.getElementById("arMarker"),
  nftCertificate: document.getElementById("nftCertificate"),
  certificateAddress: document.getElementById("certificateAddress"),
  certificateDate: document.getElementById("certificateDate"),
  mintNFTBtn: document.getElementById("mintNFTBtn")
};

document.addEventListener("DOMContentLoaded", initApp);

async function initApp() {
  try {
    init3DBackground();
    bindShellListeners();
    if (window.ethereum && window.ethereum.selectedAddress) { await connectWallet(); }
    updateProgress(readPct());
    fadeOutLoader();
  } catch (err) {
    console.error("Initialization error:", err);
    el.loadingScreen.innerHTML = `
      <p style="color: var(--gold-primary);">Initialization failed. Please refresh the page.</p>
      <button onclick="window.location.reload()" class="wisdom-cta" style="margin-top: 1rem;">
        Refresh Page
      </button>`;
  }
}

function bindShellListeners() {
  el.connectWallet.addEventListener("click", connectWallet);
  el.startCourseBtn?.addEventListener("click", () => scrollToElement("#courseContent"));
  el.mintNFTBtn?.addEventListener("click", mintCertificateNFT);

  // delegate: AR toggle lives inside injected content
  document.addEventListener("click", (e) => {
    if (e.target && e.target.id === "arToggleBtn") toggleAR();
  });

  // delegate: any checkbox with data-track
  document.addEventListener("change", (e) => {
    const t = e.target;
    if (t && t.matches("input[type='checkbox'][data-track]")) {
      const key = t.getAttribute("data-track");
      setCompletion(key, t.checked, t);
    }
  });
}

function fadeOutLoader(){
  setTimeout(() => { el.loadingScreen.style.opacity = '0';
    setTimeout(() => { el.loadingScreen.style.display = 'none'; }, 500);
  }, 1200);
}

/** ================
 *  Wallet + Gating
 *  ================
 */
async function connectWallet() {
  try {
    if (!window.ethereum) { alert("Please install MetaMask or another Ethereum wallet to continue"); return; }
    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    state.address = accounts[0];
    state.provider = new ethers.providers.Web3Provider(window.ethereum);
    state.signer = state.provider.getSigner();
    el.walletStatus.textContent = `Connected: ${state.address.slice(0, 6)}...${state.address.slice(-4)}`;
    el.connectWallet.textContent = "Wallet Connected";

    await checkKLYBalance();
    window.ethereum.on('accountsChanged', (newAccounts) => {
      if (!newAccounts.length) {
        state.address = null;
        el.walletStatus.textContent = "";
        el.connectWallet.textContent = "Connect Wallet to Unlock";
        el.courseContent.style.display = "none";
        hideCertificate();
      } else {
        state.address = newAccounts[0];
        el.walletStatus.textContent = `Connected: ${state.address.slice(0,6)}...${state.address.slice(-4)}`;
        checkKLYBalance();
      }
    });
  } catch (error) {
    console.error("Wallet connection error:", error);
    el.walletStatus.textContent = "‚ùå Wallet connection failed";
    el.walletStatus.style.color = "#ff6b6b";
  }
}

async function checkKLYBalance() {
  try {
    const token = new ethers.Contract(CONFIG.KLY_CONTRACT, CONFIG.erc20ABI, state.provider);
    const rawBalance = await token.balanceOf(state.address);
    const decimals = await token.decimals();
    const balance = parseFloat(ethers.utils.formatUnits(rawBalance, decimals));

    if (balance >= CONFIG.MIN_BALANCE) {
      el.walletStatus.textContent += ` | ‚úÖ ${balance.toFixed(2)} KLY ‚Äî Access Granted`;
      if (!el.courseContent.innerHTML) { await loadCourse(); }
      el.courseContent.style.display = "block";
      restoreChecks();
      updateProgress(readPct());
      showCertificateIfDone();
    } else {
      el.courseContent.style.display = "none";
      el.walletStatus.textContent += ` | ‚ùå ${balance.toFixed(2)} KLY ‚Äî Minimum ${CONFIG.MIN_BALANCE} KLY required`;
      hideCertificate();
    }
  } catch (error) {
    console.error("Balance check failed:", error);
    el.walletStatus.textContent += " | Error checking balance";
  }
}

/** =====================
 *  Content & SWC Tabs
 *  =====================
 */
async function loadCourse(){
  const res = await fetch(CONFIG.COURSE_URL, { cache: "no-store" });
  const html = await res.text();
  // Inject
  el.courseContent.innerHTML = html;
  // expose for SWC buttons
  window.showModule = showModule;
}

function showModule(moduleId) {
  const cards = document.querySelectorAll("#spiritual-wealth .module-card");
  cards.forEach(c => c.style.display = "none");
  const target = document.getElementById(moduleId);
  if (target) target.style.display = "block";

  const buttons = document.querySelectorAll("#spiritual-wealth .nav-button");
  buttons.forEach(b => b.classList.remove("active"));
  const active = Array.from(buttons).find(b => b.getAttribute('onclick')?.includes(moduleId));
  if (active) active.classList.add("active");

  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/** =========================
 *  Progress + Persistence
 *  =========================
 */
function setCompletion(key, done, checkboxEl){
  if (done) {
    if (!state.completed.includes(key)) state.completed.push(key);
  } else {
    state.completed = state.completed.filter(k => k !== key);
  }
  localStorage.setItem('completedUnits', JSON.stringify(state.completed));
  // visual
  const article = checkboxEl.closest("article");
  const swcCard = checkboxEl.closest(".module-card");
  if (article) article.classList.toggle("completed", done);
  if (swcCard) swcCard.classList.toggle("completed", done);
  updateProgress(readPct());
  showCertificateIfDone();
}

function restoreChecks(){
  document.querySelectorAll("input[type='checkbox'][data-track]").forEach(cb => {
    const key = cb.getAttribute("data-track");
    cb.checked = state.completed.includes(key);
    const done = cb.checked;
    const article = cb.closest("article");
    const swcCard = cb.closest(".module-card");
    if (article) article.classList.toggle("completed", done);
    if (swcCard) swcCard.classList.toggle("completed", done);
  });
}

function readPct(){
  const n = state.completed.length;
  const pct = Math.round((n / CONFIG.TOTAL_UNITS) * 100);
  state.pct = pct;
  localStorage.setItem('progressPct', String(pct));
  return pct;
}

function updateProgress(pct){
  const n = state.completed.length;
  el.progressBar.style.width = `${pct}%`;
  el.progressText.textContent = `${n} / ${CONFIG.TOTAL_UNITS} (${pct}%)`;
}

/** =================
 *  Certificate + AR
 *  =================
 */
function showCertificateIfDone(){
  if (state.completed.length === CONFIG.TOTAL_UNITS && state.address){
    el.certificateAddress.textContent = `${state.address.slice(0, 6)}...${state.address.slice(-4)}`;
    el.certificateDate.textContent = new Date().toLocaleDateString();
    el.nftCertificate.style.display = "block";
    scrollToElement("#nftCertificate");
  }
}
function hideCertificate(){ el.nftCertificate.style.display = "none"; }

async function mintCertificateNFT(){
  if (!state.signer || !state.address){ alert("Please connect your wallet first"); return; }
  if (state.completed.length !== CONFIG.TOTAL_UNITS){ alert("Complete all 14 modules first"); return; }
  try {
    el.mintNFTBtn.textContent = "Minting..."; el.mintNFTBtn.disabled = true;
    const nftContractAddress = "0xDA76d35742190283E340dbeE2038ecc978a56950";
    const mintABI = ["function mintTo(address recipient, string uri) public"];
    const metadataURI = "ipfs://bafybeifssvwf74gv25c3r76cxfdqraerll7l4kgruqaox6cskrqsu2e2by";
    const nft = new ethers.Contract(nftContractAddress, mintABI, state.signer);
    const tx = await nft.mintTo(state.address, metadataURI);
    await tx.wait();
    alert("üéâ Certificate NFT minted successfully!");
  } catch (error) {
    console.error("Minting error:", error);
    alert("‚ùå Failed to mint NFT. Please check your wallet and try again.");
  } finally {
    el.mintNFTBtn.textContent = "Mint as NFT"; el.mintNFTBtn.disabled = false;
  }
}

function toggleAR() {
  el.arMarker.style.display = el.arMarker.style.display === "none" ? "block" : "none";
}

function scrollToElement(selector) {
  const node = document.querySelector(selector);
  if (node) node.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

/** ==============
 *  3D Background
 *  ==============
 */
function init3DBackground() {
  const container = document.getElementById("cosmicContainer");
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  container.appendChild(renderer.domElement);

  const geometry = new THREE.IcosahedronGeometry(2, 1);
  const material = new THREE.MeshBasicMaterial({ color: 0xD4AF37, wireframe: true, transparent: true, opacity: 0.3 });
  const mesh = new THREE.Mesh(geometry, material);
  scene.add(mesh);

  // simple particles
  const particles = new THREE.BufferGeometry();
  const particleCount = 1000;
  const pos = new Float32Array(particleCount * 3);
  for (let i = 0; i < particleCount; i++) {
    pos[i*3] = (Math.random()-0.5)*100;
    pos[i*3+1] = (Math.random()-0.5)*100;
    pos[i*3+2] = (Math.random()-0.5)*100;
  }
  particles.setAttribute('position', new THREE.BufferAttribute(pos, 3));
  const particleMaterial = new THREE.PointsMaterial({ size: 0.2, color: 0xD4AF37, transparent:true, opacity:0.5 });
  const points = new THREE.Points(particles, particleMaterial);
  scene.add(points);

  camera.position.z = 5;

  function animate(){
    requestAnimationFrame(animate);
    mesh.rotation.x += 0.001; mesh.rotation.y += 0.002; points.rotation.y += 0.0005;
    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
}
</script>
</body>
</html>
