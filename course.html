<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Transformational 7-module course on self-realization">
  <title>Path of Awakening</title>
  
  <!-- Preconnect to CDNs for better performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://unpkg.com">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;700&family=EB+Garamond:ital@0;1&family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  
  <!-- Libraries (loaded asynchronously where possible) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.0/aframe/build/aframe-ar.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" defer></script>
  <script src="https://unpkg.com/@web3modal/ethers@2.6.1/dist/index.js" defer></script>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚òØ</text></svg>">
  
  <style>
    :root {
      --gold-light: #f9e076;
      --gold-primary: #d4af37;
      --gold-dark: #8a6d0b;
      --teal-light: #00ffe7;
      --teal-dark: #007a6d;
      --bg-dark: #0a0a0f;
      --bg-darker: #050508;
      --text-light: #f0f0f0;
      --text-muted: rgba(200, 200, 200, 0.6);
      --module-bg: rgba(20, 20, 30, 0.8);
      --module-complete: rgba(212, 175, 55, 0.1);
      --nft-glow: rgba(0, 255, 231, 0.3);
      --transition-base: 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    
    /* Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html {
      scroll-behavior: smooth;
    }
    
    body {
      margin: 0;
      padding: 0;
      background-color: var(--bg-dark);
      color: var(--text-light);
      font-family: 'EB Garamond', serif;
      overflow-x: hidden;
      line-height: 1.6;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* 3D Sacred Geometry Background */
    .cosmic-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.15;
      pointer-events: none;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      position: relative;
    }
    
    /* Typography */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 400;
      line-height: 1.2;
    }
    
    /* Hero Section */
    .wisdom-hero {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      padding: 4rem 2rem;
      background: radial-gradient(ellipse at center, var(--bg-dark) 0%, var(--bg-darker) 100%);
    }
    
    .kly-logo {
      position: absolute;
      top: 2rem;
      left: 2rem;
      width: 120px;
      height: auto;
      opacity: 0.8;
      transition: opacity var(--transition-base);
      z-index: 10;
    }
    
    .kly-logo:hover {
      opacity: 1;
    }
    
    .title-container {
      text-align: center;
      position: relative;
      margin-bottom: 4rem;
      max-width: 90%;
    }
    
    .title-decoration {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, var(--gold-primary) 15%, var(--gold-primary) 85%, transparent 100%);
    }
    
    .title-decoration.top {
      top: -2rem;
    }
    
    .title-decoration.bottom {
      bottom: -2rem;
    }
    
    h1 {
      font-family: 'Cormorant Garamond', serif;
      font-weight: 300;
      font-size: clamp(2.5rem, 5vw, 5rem);
      letter-spacing: 0.5rem;
      margin: 0;
      text-transform: uppercase;
      position: relative;
    }
    
    .gold-gradient {
      background: linear-gradient(135deg, var(--gold-light), var(--gold-primary), var(--gold-dark));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 400;
    }
    
    .subtitle {
      font-size: clamp(1rem, 1.5vw, 1.2rem);
      color: var(--text-muted);
      letter-spacing: 0.1rem;
      margin-top: 1.5rem;
      max-width: 600px;
      line-height: 1.6;
    }
    
    .serif-italic {
      font-style: italic;
      color: var(--gold-primary);
    }
    
    /* CTA Buttons */
    .cta-container {
      position: relative;
      margin-top: 3rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
    }
    
    .wisdom-cta {
      background: transparent;
      color: var(--gold-primary);
      border: 1px solid rgba(200, 160, 100, 0.3);
      padding: 1.2rem 3rem;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      letter-spacing: 0.2rem;
      position: relative;
      overflow: hidden;
      transition: all var(--transition-base);
      backdrop-filter: blur(5px);
      cursor: pointer;
      border-radius: 2px;
      min-width: 280px;
    }
    
    .wisdom-cta:hover {
      border-color: rgba(200, 160, 100, 0.6);
      background: rgba(20, 15, 5, 0.3);
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
    }
    
    .wisdom-cta::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(200, 160, 100, 0.1), transparent);
      transition: 0.7s;
    }
    
    .wisdom-cta:hover::before {
      left: 100%;
    }
    
    .cta-icon {
      margin-left: 0.8rem;
      font-size: 1.2rem;
      display: inline-block;
      transition: transform var(--transition-base);
    }
    
    .wisdom-cta:hover .cta-icon {
      transform: rotate(45deg);
    }
    
    .disclaimer {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 1.5rem;
      letter-spacing: 0.05rem;
      opacity: 0.7;
      max-width: 500px;
    }
    
    /* Animated Triquetra */
    .triquetra {
      position: absolute;
      width: 120px;
      height: 120px;
      opacity: 0.7;
      transition: opacity 1s ease;
      pointer-events: none;
    }
    
    .triquetra path {
      stroke: var(--gold-primary);
      stroke-width: 1.5;
      fill: none;
      stroke-dasharray: 300;
      stroke-dashoffset: 300;
      animation: draw 8s infinite alternate;
    }
    
    @keyframes draw {
      0% { stroke-dashoffset: 300; opacity: 0.3; }
      50% { stroke-dashoffset: 0; opacity: 0.7; }
      100% { stroke-dashoffset: -300; opacity: 0.3; }
    }
    
    /* Course Content */
    #courseContent {
      text-align: left;
      max-width: 900px;
      margin: 4rem auto;
      opacity: 1;
      height: auto;
      overflow: hidden;
    }
    
    h2 {
      font-family: 'Cormorant Garamond', serif;
      font-weight: 400;
      font-size: 2.5rem;
      color: var(--gold-primary);
      margin: 3rem 0 1.5rem;
      position: relative;
    }
    
    h2::after {
      content: "";
      display: block;
      width: 100px;
      height: 1px;
      background: linear-gradient(90deg, var(--gold-primary), transparent);
      margin-top: 1rem;
    }
    
    h3 {
      font-family: 'Cormorant Garamond', serif;
      font-weight: 400;
      font-size: 1.8rem;
      color: var(--teal-light);
      margin: 2rem 0 1rem;
    }
    
    h4 {
      font-family: 'EB Garamond', serif;
      font-style: italic;
      font-size: 1.2rem;
      color: var(--gold-primary);
      margin: 1.5rem 0 0.5rem;
    }
    
    article {
      background: var(--module-bg);
      border-left: 2px solid var(--gold-primary);
      padding: 2rem;
      margin-bottom: 3rem;
      border-radius: 0 8px 8px 0;
      transition: all var(--transition-base);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(5px);
    }
    
    article:hover {
      transform: translateX(5px);
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
    }
    
    article.completed {
      border-left-color: var(--teal-light);
      background: var(--module-complete);
    }
    
    article.completed::after {
      content: '‚úì';
      position: absolute;
      top: 1rem;
      right: 1rem;
      color: var(--teal-light);
      font-weight: bold;
      font-size: 1.5rem;
    }

    article:focus,
    article:active,
    article p:focus,
    article p:active {
      outline: none !important;
      box-shadow: none !important;
      -webkit-tap-highlight-color: transparent !important;
    }
    
    p {
      margin: 1rem 0;
      font-size: 1.1rem;
      line-height: 1.7;
    }
    
    ul, ol {
      margin: 1.5rem 0;
      padding-left: 1.5rem;
    }
    
    li {
      margin-bottom: 1rem;
      position: relative;
      font-size: 1.1rem;
      line-height: 1.7;
    }
    
    li:before {
      content: '‚Ä¢';
      color: var(--gold-primary);
      position: absolute;
      left: -1.2rem;
    }
    
    strong {
      color: var(--gold-primary);
      font-weight: 400;
    }
    
    em {
      color: var(--teal-light);
      font-style: italic;
    }
    
    .practice-box {
      background: rgba(0, 255, 231, 0.05);
      border-left: 2px solid var(--teal-light);
      padding: 1.5rem;
      margin: 2rem 0;
      border-radius: 0 8px 8px 0;
    }
    
    .practice-box h4 {
      color: var(--teal-light);
    }
    
    .bonus-section {
      background: rgba(212, 175, 55, 0.05);
      border: 1px solid rgba(212, 175, 55, 0.2);
      padding: 2rem;
      border-radius: 8px;
      margin: 4rem 0;
    }
    
    .bonus-section h3 {
      color: var(--gold-primary);
    }
    
    .module-complete {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin-top: 2rem;
      color: var(--gold-primary);
    }
    
    .module-complete input {
      cursor: pointer;
      width: 20px;
      height: 20px;
      accent-color: var(--gold-primary);
    }
    
    .module-complete label {
      font-family: 'EB Garamond', serif;
      font-size: 1.1rem;
      cursor: pointer;
    }
    
    .key-quote {
      font-style: italic;
      color: var(--gold-primary);
      border-left: 2px solid var(--gold-primary);
      padding-left: 1.5rem;
      margin: 2rem 0;
    }
    
    /* Progress Tracking */
    .progress-container {
      width: 100%;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      margin: 3rem 0;
      overflow: hidden;
      position: relative;
      height: 6px;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--gold-primary), var(--teal-light));
      width: 0%;
      transition: width 1s ease;
      position: relative;
    }
    
    .progress-text {
      position: absolute;
      right: 0;
      top: -2rem;
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    
    /* Wallet Connection */
    #walletStatus {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: var(--gold-primary);
      min-height: 1.5rem;
    }
    
    /* AR Styles */
    .ar-marker {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 300px;
      height: 300px;
      z-index: 100;
      border: 1px solid var(--gold-primary);
      border-radius: 8px;
      overflow: hidden;
      display: none;
      box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
    }
    
    /* Meditation Visualizer */
    .meditation-viz {
      width: 100%;
      height: 200px;
      background: rgba(0,0,0,0.2);
      margin: 2rem 0;
      position: relative;
      overflow: hidden;
    }
    
    .breath-circle {
      position: absolute;
      border-radius: 50%;
      border: 2px solid var(--teal-light);
      transform: translate(-50%, -50%);
      opacity: 0.7;
    }
    
    /* NFT Certificate */
    .nft-certificate {
      max-width: 400px;
      margin: 2rem auto;
      padding: 2rem;
      background: linear-gradient(135deg, rgba(20, 20, 30, 0.8), rgba(5, 5, 8, 0.9));
      border: 1px solid var(--gold-primary);
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 0 30px var(--nft-glow);
      display: none;
    }
    
    .nft-certificate h3 {
      color: var(--gold-primary);
      margin-bottom: 1rem;
    }
    
    .nft-certificate p {
      margin: 0.5rem 0;
    }
    
    .nft-image {
      width: 150px;
      height: 150px;
      margin: 1rem auto;
      background: radial-gradient(circle, var(--teal-light) 0%, var(--gold-primary) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: var(--bg-darker);
    }
    
    /* Community Section */
    .community-section {
      background: rgba(0, 122, 109, 0.05);
      border: 1px solid var(--teal-dark);
      padding: 2rem;
      border-radius: 8px;
      margin: 4rem 0;
    }
    
    .community-section h3 {
      color: var(--teal-light);
    }
    
    /* Loading State */
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-darker);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(212, 175, 55, 0.3);
      border-radius: 50%;
      border-top-color: var(--gold-primary);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .container {
        padding: 0 1.5rem;
      }
      
      .kly-logo {
        width: 80px;
        top: 1.5rem;
        left: 1.5rem;
      }
      
      h1 {
        font-size: 2.2rem;
        letter-spacing: 0.3rem;
      }
      
      h2 {
        font-size: 2rem;
      }
      
      h3 {
        font-size: 1.5rem;
      }
      
      article {
        padding: 1.5rem;
      }
      
      .wisdom-cta {
        padding: 1rem 2rem;
        font-size: 1rem;
        min-width: 240px;
      }
      
      .ar-marker {
        width: 200px;
        height: 200px;
        bottom: 1rem;
        right: 1rem;
      }
      
      .title-container {
        margin-bottom: 2rem;
      }
      
      .title-decoration.top {
        top: -1.5rem;
      }
      
      .title-decoration.bottom {
        bottom: -1.5rem;
      }
    }
    
    @media (max-width: 480px) {
      .wisdom-hero {
        padding: 6rem 1.5rem 4rem;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .subtitle {
        font-size: 0.9rem;
      }
      
      .wisdom-cta {
        padding: 0.8rem 1.5rem;
        font-size: 0.9rem;
        min-width: 200px;
      }
      
      article {
        padding: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading" id="loadingScreen">
    <div class="loading-spinner"></div>
    <p style="margin-top: 1rem; color: var(--gold-primary);">Initializing Wisdom Journey...</p>
  </div>
  
  <!-- 3D Sacred Geometry Background -->
  <div id="cosmicContainer" class="cosmic-canvas"></div>
  
  <!-- AR Meditation Marker -->
  <div class="ar-marker" id="arMarker">
    <a-scene embedded arjs>
      <a-entity 
        geometry="primitive: torusKnot; radius: 0.5; radiusTubular: 0.1"
        material="color: #D4AF37; metalness: 0.8; roughness: 0.2"
        rotation="0 45 0"
        animation="property: rotation; to: 0 405 0; loop: true; dur: 10000">
      </a-entity>
      <a-marker-camera preset="hiro"></a-marker-camera>
    </a-scene>
  </div>
  
  <div class="container">
    <!-- Hero Section -->
    <section class="wisdom-hero">
      <img src="https://raw.githubusercontent.com/DelonteKelly/KLY-landing-/main/KLY-logo.png" alt="KLY Logo" class="kly-logo" loading="lazy">
      
      <div class="title-container">
        <div class="title-decoration top"></div>
        <h1>The Path of <span class="gold-gradient">Awakening</span></h1>
        <div class="title-decoration bottom"></div>
        <p class="subtitle">A <span class="serif-italic">transformational</span> journey into self-realization, presence, and embodied truth.</p>
      </div>
      
      <div class="cta-container">
        <button id="startCourseBtn" class="wisdom-cta">
          <span class="cta-text">Begin Journey</span>
          <span class="cta-icon">‚åæ</span>
        </button>

        <button id="connectWallet" class="wisdom-cta">Connect Wallet to Unlock</button>
        <p id="walletStatus"></p>

        <p class="disclaimer">‚úß For those who grasp the alchemical keys ‚Äî the veil parts but for a moment. ‚úß</p>

        <svg class="triquetra" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <path d="M50,15 L65,50 L50,85 L35,50 L50,15 M20,65 L50,50 L80,65 L65,50 L80,35 L50,50 L20,35 L35,50 L20,65"/>
        </svg>
      </div>
    </section>

    <!-- Progress Tracking -->
    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar"></div>
      <span class="progress-text" id="progressText">0% Complete</span>
    </div>
    
 <div id="courseContent" style="display: none;"></div>
  
  <!-- NFT Certificate (hidden by default) -->
  <div class="nft-certificate" id="nftCertificate">
    <div class="nft-image">‚òØ</div>
    <h3>Certificate of Awakening</h3>
    <p>Presented to</p>
    <p id="certificateAddress"></p>
    <p>For completing the Path of Awakening course</p>
    <p>Issued on <span id="certificateDate"></span></p>
    <button id="mintNFTBtn" class="wisdom-cta" style="margin-top: 1.5rem;">
      Mint as NFT
    </button>
  </div>

<script>
  // Configuration
  const CONFIG = {
    KLY_CONTRACT: "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52",
    MIN_BALANCE: 500,
    erc20ABI: [
      "function balanceOf(address) view returns (uint256)",
      "function decimals() view returns (uint8)"
    ],
    NFT_IMAGE_URL: "https://example.com/nft-image.png"
  };

  // State management
  const state = {
    provider: null,
    signer: null,
    address: null,
    completedModules: JSON.parse(localStorage.getItem('completedModules')) || [],
    progress: parseInt(localStorage.getItem('progress')) || 0
  };

  // DOM Elements
  const elements = {
    loadingScreen: document.getElementById("loadingScreen"),
    courseContent: document.getElementById("courseContent"),
    progressBar: document.getElementById("progressBar"),
    progressText: document.getElementById("progressText"),
    walletStatus: document.getElementById("walletStatus"),
    connectWallet: document.getElementById("connectWallet"),
    startCourseBtn: document.getElementById("startCourseBtn"),
    arToggleBtn: document.getElementById("arToggleBtn"),
    arMarker: document.getElementById("arMarker"),
    nftCertificate: document.getElementById("nftCertificate"),
    certificateAddress: document.getElementById("certificateAddress"),
    certificateDate: document.getElementById("certificateDate"),
    mintNFTBtn: document.getElementById("mintNFTBtn")
  };

  // Initialize the application
  async function initApp() {
    try {
      // Initialize 3D background
      init3DBackground();
      
      // Set up event listeners
      setupEventListeners();
      
      // Check if wallet is already connected
      if (window.ethereum && window.ethereum.selectedAddress) {
        await connectWallet();
      }
      
      // Update progress from localStorage
      updateProgress(state.progress);
      
      // Hide loading screen after everything is initialized
      setTimeout(() => {
        elements.loadingScreen.style.opacity = '0';
        setTimeout(() => {
          elements.loadingScreen.style.display = 'none';
        }, 500);
      }, 1500);
    } catch (error) {
      console.error("Initialization error:", error);
      elements.loadingScreen.innerHTML = `
        <p style="color: var(--gold-primary);">Initialization failed. Please refresh the page.</p>
        <button onclick="window.location.reload()" class="wisdom-cta" style="margin-top: 1rem;">
          Refresh Page
        </button>
      `;
    }
  }

  // Set up all event listeners
  function setupEventListeners() {
    // Wallet connection
    elements.connectWallet.addEventListener("click", connectWallet);
    
    // Course navigation
    elements.startCourseBtn?.addEventListener("click", () => {
      scrollToElement("#courseContent");
    });
    
    // AR toggle
    elements.arToggleBtn?.addEventListener("click", toggleAR);
    
    // Module completion checkboxes
    document.querySelectorAll(".module-complete input[type='checkbox']").forEach(checkbox => {
      const moduleId = checkbox.dataset.module;
      checkbox.checked = state.completedModules.includes(moduleId);
      
      checkbox.addEventListener("change", function() {
        updateModuleCompletion(moduleId, this.checked);
      });
    });
    
    // Mint NFT button
    elements.mintNFTBtn?.addEventListener("click", mintCertificateNFT);
  }

  // Connect wallet function
  async function connectWallet() {
    try {
      if (!window.ethereum) {
        alert("Please install MetaMask or another Ethereum wallet to continue");
        return;
      }
      
      // Request account access
      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      state.address = accounts[0];
      
      // Set up ethers provider and signer
      state.provider = new ethers.providers.Web3Provider(window.ethereum);
      state.signer = state.provider.getSigner();
      
      // Update UI
      elements.walletStatus.textContent = `Connected: ${state.address.slice(0, 6)}...${state.address.slice(-4)}`;
      elements.connectWallet.textContent = "Wallet Connected";
      
      // Check KLY balance
      await checkKLYBalance();
      
      // Set up event listener for account changes
      window.ethereum.on('accountsChanged', (newAccounts) => {
        if (newAccounts.length === 0) {
          // Wallet disconnected
          state.address = null;
          elements.walletStatus.textContent = "";
          elements.connectWallet.textContent = "Connect Wallet to Unlock";
          elements.courseContent.style.display = "none";
        } else {
          // Account changed
          state.address = newAccounts[0];
          elements.walletStatus.textContent = `Connected: ${state.address.slice(0, 6)}...${state.address.slice(-4)}`;
          checkKLYBalance();
        }
      });
    } catch (error) {
      console.error("Wallet connection error:", error);
      elements.walletStatus.textContent = "‚ùå Wallet connection failed";
      elements.walletStatus.style.color = "#ff6b6b";
    }
  }

  // Check KLY token balance
  async function checkKLYBalance() {
    try {
      const token = new ethers.Contract(CONFIG.KLY_CONTRACT, CONFIG.erc20ABI, state.provider);
      const rawBalance = await token.balanceOf(state.address);
      const decimals = await token.decimals();
      const balance = parseFloat(ethers.utils.formatUnits(rawBalance, decimals));
      
      if (balance >= CONFIG.MIN_BALANCE) {
        elements.courseContent.style.display = "block";
        elements.walletStatus.textContent += ` | ‚úÖ ${balance.toFixed(2)} KLY ‚Äî Access Granted`;
        showCertificateIfCompleted();
      } else {
        elements.courseContent.style.display = "none";
        elements.walletStatus.textContent += ` | ‚ùå ${balance.toFixed(2)} KLY ‚Äî Minimum 500 KLY required`;
      }
    } catch (error) {
      console.error("Balance check failed:", error);
      elements.walletStatus.textContent += " | Error checking balance";
    }
  }

  // Update module completion status
  function updateModuleCompletion(moduleId, isCompleted) {
    if (isCompleted) {
      if (!state.completedModules.includes(moduleId)) {
        state.completedModules.push(moduleId);
      }
      document.getElementById(`module${moduleId}`).classList.add("completed");
    } else {
      state.completedModules = state.completedModules.filter(id => id !== moduleId);
      document.getElementById(`module${moduleId}`).classList.remove("completed");
    }
    
    // Save to localStorage
    localStorage.setItem('completedModules', JSON.stringify(state.completedModules));
    
    // Update progress
    const totalModules = 7;
    const newProgress = Math.round((state.completedModules.length / totalModules) * 100);
    updateProgress(newProgress);
    
    // Show certificate if all modules completed
    if (state.completedModules.length === totalModules) {
      showCertificateIfCompleted();
    }
  }

  // Update progress bar
  function updateProgress(percent) {
    state.progress = percent;
    localStorage.setItem('progress', percent.toString());
    elements.progressBar.style.width = `${percent}%`;
    elements.progressText.textContent = `${percent}% Complete`;
  }

  // Show certificate if all modules are completed
  function showCertificateIfCompleted() {
    if (state.completedModules.length === 7 && state.address) {
      elements.certificateAddress.textContent = `${state.address.slice(0, 6)}...${state.address.slice(-4)}`;
      elements.certificateDate.textContent = new Date().toLocaleDateString();
      elements.nftCertificate.style.display = "block";
      scrollToElement("#nftCertificate");
    }
  }

  // Mint certificate as NFT
 async function mintCertificateNFT() {
  if (!state.signer || !state.address) {
    alert("Please connect your wallet first");
    return;
  }

  try {
    elements.mintNFTBtn.textContent = "Minting...";
    elements.mintNFTBtn.disabled = true;

    // Define NFT contract address and minimal ABI
    const nftContractAddress = "0xDA76d35742190283E340dbeE2038ecc978a56950";
    const mintABI = ["function mintTo(address recipient, string uri) public"];

    // Example NFT metadata URI (replace with your IPFS/Central URI)
    const metadataURI = "ipfs://bafybeifssvwf74gv25c3r76cxfdqraerll7l4kgruqaox6cskrqsu2e2by";

    // Connect to NFT contract with signer
    const nftContract = new ethers.Contract(nftContractAddress, mintABI, state.signer);

    // Call mintTo function
    const tx = await nftContract.mintTo(state.address, metadataURI);
    await tx.wait();

    alert("üéâ Certificate NFT minted successfully!");
  } catch (error) {
    console.error("Minting error:", error);
    alert("‚ùå Failed to mint NFT. Please check your wallet and try again.");
  } finally {
    elements.mintNFTBtn.textContent = "Mint as NFT";
    elements.mintNFTBtn.disabled = false;
  }
}

  // Toggle AR marker visibility
  function toggleAR() {
    elements.arMarker.style.display = elements.arMarker.style.display === "none" ? "block" : "none";
  }

  // Scroll to element with smooth behavior
  function scrollToElement(selector) {
    const element = document.querySelector(selector);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }

  // Initialize 3D background
  function init3DBackground() {
    const container = document.getElementById("cosmicContainer");
    
    // Scene setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);
    
    // Sacred geometry
    const geometry = new THREE.IcosahedronGeometry(2, 1);
    const material = new THREE.MeshBasicMaterial({ 
      color: 0xD4AF37, 
      wireframe: true, 
      transparent: true, 
      opacity: 0.3 
    });
    const mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);
    
    // Particles
    const particles = new THREE.BufferGeometry();
    const particleCount = 1000;
    const pos = new Float32Array(particleCount * 3);
    const colors = new Float32Array(particleCount * 3);
    
    for (let i = 0; i < particleCount; i++) {
      pos[i * 3] = (Math.random() - 0.5) * 100;
      pos[i * 3 + 1] = (Math.random() - 0.5) * 100;
      pos[i * 3 + 2] = (Math.random() - 0.5) * 100;
      
      colors[i * 3] = 0.8 + Math.random() * 0.2; // R
      colors[i * 3 + 1] = 0.6 + Math.random() * 0.2; // G
      colors[i * 3 + 2] = 0.1 + Math.random() * 0.1; // B
    }
    
    particles.setAttribute('position', new THREE.BufferAttribute(pos, 3));
    particles.setAttribute('color', new THREE.BufferAttribute(colors, 3));
    
    const particleMaterial = new THREE.PointsMaterial({
      size: 0.2,
      vertexColors: true,
      transparent: true,
      opacity: 0.8
    });
    
    const particleSystem = new THREE.Points(particles, particleMaterial);
    scene.add(particleSystem);
    camera.position.z = 5;
    
    // Animation loop
    function animate() {
      requestAnimationFrame(animate);
      mesh.rotation.x += 0.001;
      mesh.rotation.y += 0.002;
      particleSystem.rotation.y += 0.0005;
      renderer.render(scene, camera);
    }
    
    animate();
    
    // Handle window resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  }

  // Initialize the app when DOM is loaded
  document.addEventListener("DOMContentLoaded", initApp);
</script>
</body>
</html>
