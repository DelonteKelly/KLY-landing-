<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sovereignty Mastery Program</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

  <style>
    :root {
      --bg: #0b0f14; 
      --card: #121825; 
      --card-2: #0f1522; 
      --text: #e8eefc; 
      --muted: #aeb7c9;
      --accent: #7c7cff; 
      --accent-2: #5fe1b9; 
      --gold: #f6c667; 
      --danger: #ff6b6b; 
      --ok: #22c55e;
      --border: rgba(255,255,255,.08); 
      --shadow: 0 10px 30px rgba(0,0,0,.35); 
      --radius: 14px;
      --transition: all 0.3s ease;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    html, body {
      margin: 0;
      background: linear-gradient(180deg, #0b0f14 0%, #0e1320 100%);
      color: var(--text);
      font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    a { color: inherit; text-decoration: none; }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* Header */
    .header {
      padding: 2rem 0 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      position: relative;
    }
    
    .header h1 {
      margin: 0;
      font-weight: 800;
      letter-spacing: -0.5px;
      font-size: 2.5rem;
      background: linear-gradient(135deg, var(--accent-2), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .header p {
      margin: 0;
      color: var(--muted);
      font-size: 1.1rem;
      max-width: 800px;
    }
    
    /* Navigation */
    .main-nav {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    
    .nav-item {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      cursor: pointer;
      transition: var(--transition);
    }
    
    .nav-item:hover, .nav-item.active {
      background: linear-gradient(90deg, var(--accent), #8a7cff);
      color: white;
    }
    
    /* Wallet */
    .wallet-bar {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(15, 23, 42, 0.6);
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }
    
    .wallet-btn {
      background: linear-gradient(90deg, var(--accent-2), var(--accent));
      border: none;
      color: #0b0f14;
      padding: 10px 16px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .wallet-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(124, 124, 255, 0.3);
    }
    
    .chip {
      background: rgba(15, 21, 35, 0.8);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      transition: var(--transition);
    }
    
    .chip:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }
    
    .chip .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #777;
    }
    
    .chip.ok .dot {
      background: var(--ok);
    }
    
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      letter-spacing: 0.2px;
    }
    
    .small-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: #cfe2ff;
      border-radius: 8px;
      padding: 4px 8px;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .small-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    /* Progress */
    .progress-container {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin: 1.5rem 0;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }
    
    .progress-container:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
    }
    
    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .progress-title {
      font-weight: 700;
      font-size: 1.2rem;
    }
    
    .progress-percentage {
      font-weight: 700;
      color: var(--accent);
      font-size: 1.2rem;
    }
    
    .progress-bar {
      height: 12px;
      background: rgba(255, 255, 255, 0.06);
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }
    
    .progress-fill {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--accent), #8a7cff, var(--gold));
      border-radius: 999px;
      transition: width 0.7s ease;
      position: relative;
      overflow: hidden;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background-image: linear-gradient(
        -45deg,
        rgba(255, 255, 255, 0.2) 25%,
        transparent 25%,
        transparent 50%,
        rgba(255, 255, 255, 0.2) 50%,
        rgba(255, 255, 255, 0.2) 75%,
        transparent 75%,
        transparent
      );
      z-index: 1;
      background-size: 20px 20px;
      animation: move 1s linear infinite;
      overflow: hidden;
    }
    
    @keyframes move {
      0% {
        background-position: 0 0;
      }
      100% {
        background-position: 20px 20px;
      }
    }
    
    .progress-stats {
      display: flex;
      gap: 1.5rem;
      color: var(--muted);
      font-size: 0.95rem;
      flex-wrap: wrap;
    }
    
    /* Modules grid */
    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 20px;
      margin: 2rem 0;
    }
    
    .module-card {
      background: linear-gradient(180deg, var(--card), var(--card-2));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      height: 100%;
    }
    
    .module-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      opacity: 0;
      transition: var(--transition);
    }
    
    .module-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
    }
    
    .module-card:hover::before {
      opacity: 1;
    }
    
    .module-header {
      display: grid;
      grid-template-columns: auto 1fr;
      grid-template-rows: auto auto;
      column-gap: 12px;
    }
    
    .module-badge {
      height: 40px;
      width: 40px;
      border-radius: 10px;
      background: rgba(124, 124, 255, 0.16);
      border: 1px solid rgba(124, 124, 255, 0.3);
      display: grid;
      place-items: center;
      font-weight: 800;
      color: #bfbfff;
      font-size: 1.1rem;
    }
    
    .module-title {
      margin: 0;
      font-size: 1.3rem;
      font-weight: 700;
    }
    
    .module-theme {
      grid-column: 2;
      color: var(--muted);
      font-size: 0.95rem;
      margin-top: -2px;
    }
    
    .module-content {
      color: var(--muted);
      flex-grow: 1;
    }
    
    .module-description {
      margin-bottom: 1rem;
    }
    
    .learning-objectives h4 {
      margin: 0.5rem 0 0.5rem;
      font-weight: 600;
      color: #dfe6fb;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .objectives-list {
      margin: 0.5rem 0 0 1.1rem;
    }
    
    .objectives-list li {
      margin: 0.35rem 0;
      position: relative;
    }
    
    .objectives-list li::marker {
      color: var(--accent);
    }
    
    .module-footer {
      margin-top: auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    
    .module-status {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #777;
      transition: var(--transition);
    }
    
    .status-indicator.completed {
      background: var(--ok);
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
    }
    
    .status-indicator.in-progress {
      background: #f59e0b;
      box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
    }
    
    .module-button {
      background: linear-gradient(90deg, var(--accent), #8a7cff);
      border: none;
      color: white;
      padding: 10px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
    }
    
    .module-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(124, 124, 255, 0.3);
    }
    
    .module-button:focus-visible {
      outline: 3px solid rgba(124, 124, 255, 0.45);
    }
    
    /* Detail */
    .back-to-modules {
      display: none;
      margin: 1.5rem 0 1rem;
      text-decoration: none;
      color: #cfe2ff;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      width: fit-content;
      transition: var(--transition);
    }
    
    .back-to-modules:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .module-detail {
      display: none;
      background: linear-gradient(180deg, #0f1522, #0b101b);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 2rem;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    
    .detail-title {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 700;
    }
    
    .detail-theme {
      color: var(--muted);
      font-size: 1.1rem;
      margin-top: 0.5rem;
    }
    
    .detail-close {
      background: transparent;
      border: 1px solid var(--border);
      color: #98a4c8;
      height: 40px;
      width: 40px;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .detail-close:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    /* Content styles */
    .detail-content {
      line-height: 1.7;
    }
    
    .detail-content h3 {
      margin: 1.5rem 0 0.75rem;
      color: var(--accent-2);
      font-weight: 600;
    }
    
    .detail-content p {
      margin: 0.75rem 0;
    }
    
    .detail-content ul, .detail-content ol {
      margin: 0.75rem 0;
      padding-left: 1.5rem;
    }
    
    .detail-content li {
      margin: 0.5rem 0;
    }
    
    .practice-box {
      background: rgba(124, 124, 255, 0.08);
      border: 1px dashed rgba(124, 124, 255, 0.35);
      border-radius: 12px;
      padding: 1.25rem;
      margin: 1.25rem 0;
    }
    
    .key-quote {
      background: rgba(255, 255, 255, 0.04);
      border-left: 4px solid var(--gold);
      padding: 1rem 1.25rem;
      border-radius: 8px;
      margin: 1.25rem 0;
      font-style: italic;
    }
    
    .module-complete {
      margin: 1.25rem 0;
      padding: 1rem;
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .module-next {
      color: #b7c7ff;
      text-decoration: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      background: rgba(183, 199, 255, 0.1);
      transition: var(--transition);
    }
    
    .module-next:hover {
      background: rgba(183, 199, 255, 0.2);
    }
    
    /* Wealth Codes nav */
    .nav-container {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin: 1.5rem 0;
    }
    
    .nav-button {
      background: #12172a;
      border: 1px solid var(--border);
      color: #dfe6fb;
      border-radius: 999px;
      padding: 8px 16px;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .nav-button:hover, .nav-button.active {
      background: linear-gradient(90deg, var(--accent-2), var(--accent));
      color: #0b0f14;
      border: none;
    }
    
    /* Hide the source content block */
    #courseContent {
      display: none;
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #0f1422;
      color: #eaf2ff;
      border: 1px solid var(--border);
      padding: 12px 18px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .toast.show {
      opacity: 1;
    }
    
    /* Footer */
    .footer {
      margin-top: 3rem;
      padding: 2rem 0;
      border-top: 1px solid var(--border);
      text-align: center;
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 2rem;
      }
      
      .modules-grid {
        grid-template-columns: 1fr;
      }
      
      .progress-stats {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .wallet-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .detail-header {
        flex-direction: column;
      }
    }
    
    /* Dark mode toggle */
    .theme-toggle {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border);
      color: var(--text);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .theme-toggle:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    /* Loading animation */
    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Achievement badges */
    .achievement-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      background: rgba(246, 198, 103, 0.15);
      border: 1px solid rgba(246, 198, 103, 0.3);
      border-radius: 999px;
      font-size: 0.8rem;
      color: var(--gold);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Sovereignty Mastery Program</h1>
      <p>A 7-module transformative journey to reclaim your personal power and live with authentic authority</p>
      
      <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
        <i class="fas fa-moon"></i>
      </button>

      <!-- Wallet bar -->
      <div class="wallet-bar">
        <button id="connectBtn" class="wallet-btn"><i class="fa-solid fa-wallet"></i> Connect Wallet</button>
        <div id="provChip" class="chip"><i class="fa-solid fa-triangle-exclamation" style="color:#ffd28a"></i> <span>No wallet detected</span></div>
        <div id="addrChip" class="chip" style="display:none"><span class="dot"></span><i class="fa-regular fa-id-card"></i> <span id="addrShort" class="mono">0x…</span> <button id="copyAddr" class="small-btn" title="Copy"><i class="fa-regular fa-copy"></i></button></div>
        <div id="chainChip" class="chip" style="display:none"><i class="fa-solid fa-network-wired"></i> <span id="chainName">Chain</span></div>
        <div id="balChip" class="chip" style="display:none"><i class="fa-solid fa-coins"></i> <span id="nativeBal" class="mono">0.0000</span> <button id="refreshBal" class="small-btn" title="Refresh"><i class="fa-solid fa-rotate"></i></button></div>
        <div id="gateChip" class="chip" style="display:none"><i class="fa-solid fa-key"></i> <span id="gateText">Checking access…</span></div>
      </div>
    </div>

    <!-- Navigation -->
    <div class="main-nav">
      <div class="nav-item active" data-target="modules">Modules</div>
      <div class="nav-item" data-target="progress">Progress</div>
      <div class="nav-item" data-target="resources">Resources</div>
      <div class="nav-item" data-target="community">Community</div>
    </div>

    <!-- Progress -->
    <div class="progress-container" aria-live="polite">
      <div class="progress-header">
        <div class="progress-title">Your Progress</div>
        <div class="progress-percentage" id="progressPct">0% Complete</div>
      </div>
      <div class="progress-bar" aria-hidden="true">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-stats">
        <span id="progressCount">0 of 7 Modules Completed</span>
        <span>Estimated 12 hours to complete</span>
        <span id="timeSpent">Time spent: 0h 0m</span>
      </div>
    </div>

    <!-- Modules Grid -->
    <div class="modules-grid" id="modulesGrid" role="list">
      <!-- Cards 1–7 -->
      <div class="module-card" role="listitem" data-module="1">
        <div class="module-header">
          <div class="module-badge">1</div>
          <h3 class="module-title">Foundations of Self-Awareness</h3>
          <div class="module-theme">Becoming the Observer</div>
        </div>
        <div class="module-content">
          <p class="module-description">Self-awareness is the foundation of awakening—stepping out of unconscious streams to observe with clarity and compassion.</p>
          <div class="learning-objectives">
            <h4><i class="fas fa-brain"></i> Learning Objectives</h4>
            <ul class="objectives-list">
              <li>Lost-in-thought vs observing thought</li>
              <li>Daily mindfulness practices</li>
              <li>Journaling for clarity</li>
              <li>3-Layer Belief Audit</li>
            </ul>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-status"><div class="status-indicator"></div><span class="status-text">Not Started</span></div>
          <button class="module-button" onclick="showModule(1)"><i class="fas fa-book-open"></i> Open</button>
        </div>
      </div>

      <div class="module-card" role="listitem" data-module="2">
        <div class="module-header">
          <div class="module-badge">2</div>
          <h3 class="module-title">Breaking the Illusion of Ego</h3>
          <div class="module-theme">You Are Not Your Story</div>
        </div>
        <div class="module-content">
          <p class="module-description">See through roles and labels; meet the silent watcher beyond narrative identity.</p>
          <div class="learning-objectives">
            <h4><i class="fas fa-bolt"></i> Learning Objectives</h4>
            <ul class="objectives-list">
              <li>Ego vs Essence</li>
              <li>Roles, labels & identity</li>
              <li>Silent Watcher practice</li>
              <li>Ego defenses</li>
            </ul>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-status"><div class="status-indicator"></div><span class="status-text">Not Started</span></div>
          <button class="module-button" onclick="showModule(2)"><i class="fas fa-play-circle"></i> Open</button>
        </div>
      </div>

      <div class="module-card" role="listitem" data-module="3">
        <div class="module-header">
          <div class="module-badge">3</div>
          <h3 class="module-title">Entering the Now</h3>
          <div class="module-theme">Presence is Power</div>
        </div>
        <div class="module-content">
          <p class="module-description">Anchor attention in breath and senses; find the gap between thoughts.</p>
          <div class="learning-objectives">
            <h4><i class="fas fa-water"></i> Learning Objectives</h4>
            <ul class="objectives-list">
              <li>Past/Future fixation</li>
              <li>Sensory anchoring</li>
              <li>Listening as meditation</li>
              <li>Finding the silent gap</li>
            </ul>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-status"><div class="status-indicator"></div><span class="status-text">Not Started</span></div>
          <button class="module-button" onclick="showModule(3)"><i class="fas fa-lock-open"></i> Open</button>
        </div>
      </div>

      <div class="module-card" role="listitem" data-module="4">
        <div class="module-header">
          <div class="module-badge">4</div>
          <h3 class="module-title">Surrender & Emotional Alchemy</h3>
          <div class="module-theme">Freedom Through Letting Go</div>
        </div>
        <div class="module-content">
          <p class="module-description">Transmute emotion by allowing, feeling, and releasing; discover power in surrender.</p>
          <div class="learning-objectives">
            <h4><i class="fas fa-feather"></i> Learning Objectives</h4>
            <ul class="objectives-list">
              <li>What surrender truly is</li>
              <li>Somatic flow of emotion</li>
              <li>3-Step alchemy</li>
              <li>Forgiveness as liberation</li>
            </ul>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-status"><div class="status-indicator"></div><span class="status-text">Not Started</span></div>
          <button class="module-button" onclick="showModule(4)"><i class="fas fa-lock-open"></i> Open</button>
        </div>
      </div>

      <div class="module-card" role="listitem" data-module="5">
        <div class="module-header">
          <div class="module-badge">5</div>
          <h3 class="module-title">The Illusion of Separation</h3>
          <div class="module-theme">Remembering Oneness</div>
        </div>
        <div class="module-content">
          <p class="module-description">See the unity behind duality; meet relationships and nature as mirrors.</p>
          <div class="learning-objectives">
            <h4><i class="fas fa-infinity"></i> Learning Objectives</h4>
            <ul class="objectives-list">
              <li>Seeing through duality</li>
              <li>Relational mirrors</li>
              <li>Nature as teacher</li>
              <li>Entanglement & connection</li>
            </ul>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-status"><div class="status-indicator"></div><span class="status-text">Not Started</span></div>
          <button class="module-button" onclick="showModule(5)"><i class="fas fa-lock-open"></i> Open</button>
        </div>
      </div>

      <div class="module-card" role="listitem" data-module="6">
        <div class="module-header">
          <div class="module-badge">6</div>
          <h3 class="module-title">Embodied Enlightenment</h3>
          <div class="module-theme">Wisdom in Action</div>
        </div>
        <div class="module-content">
          <p class="module-description">Integrate realization into daily life: shadow work, pillars of practice, sacred mundanity.</p>
          <div class="learning-objectives">
            <h4><i class="fas fa-seedling"></i> Learning Objectives</h4>
            <ul class="objectives-list">
              <li>Transcendence → integration</li>
              <li>4 pillars of embodiment</li>
              <li>Shadow & wholeness</li>
              <li>Chop wood, carry water</li>
            </ul>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-status"><div class="status-indicator"></div><span class="status-text">Not Started</span></div>
          <button class="module-button" onclick="showModule(6)"><i class="fas fa-lock-open"></i> Open</button>
        </div>
      </div>

      <div class="module-card" role="listitem" data-module="7">
        <div class="module-header">
          <div class="module-badge">7</div>
          <h3 class="module-title">Living as Awareness</h3>
          <div class="module-theme">The Unfolding Mystery</div>
        </div>
        <div class="module-content">
          <p class="module-description">Rest as awareness; move with spontaneity, impermanence, and effortless action.</p>
          <div class="learning-objectives">
            <h4><i class="fas fa-mountain-sun"></i> Learning Objectives</h4>
            <ul class="objectives-list">
              <li>Form & formlessness</li>
              <li>Flow & spontaneity</li>
              <li>Gift of impermanence</li>
              <li>Beyond seeking</li>
            </ul>
          </div>
        </div>
        <div class="module-footer">
          <div class="module-status"><div class="status-indicator"></div><span class="status-text">Not Started</span></div>
          <button class="module-button" onclick="showModule(7)"><i class="fas fa-lock-open"></i> Open</button>
        </div>
      </div>
    </div>

    <!-- Detail View -->
    <a href="#" class="back-to-modules" id="backToModules" onclick="hideModule();return false;">
      <i class="fas fa-arrow-left"></i> Back to All Modules
    </a>
    <div id="moduleDetail" class="module-detail" aria-live="polite">
      <div class="detail-header">
        <div>
          <h2 class="detail-title" id="detailTitle">Module</h2>
          <div class="detail-theme" id="detailTheme">Theme</div>
        </div>
        <button class="detail-close" onclick="hideModule()" aria-label="Close module details">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="detailBody" class="detail-content"></div>
    </div>

    <!-- Hidden source Course Content (one copy only) -->
    <div id="courseContent">
      <!-- Your full Course Content block from earlier goes here (unchanged) -->
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>Sovereignty Mastery Program &copy; 2023 • All rights reserved</p>
      <p>Designed for awakening consciousness and reclaiming personal sovereignty</p>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"><i class="fas fa-check-circle"></i> Saved</div>

  <!-- Ethers v5 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    // ===== helpers =====
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
    const toast = (m='Saved ✔️', icon='check-circle') => {
      const t = $('#toast'); 
      t.innerHTML = `<i class="fas fa-${icon}"></i> ${m}`;
      t.classList.add('show'); 
      setTimeout(() => t.classList.remove('show'), 2000);
    };

    // ===== progress state =====
    const STORAGE_KEY = 'sovereignty-progress-v2';
    const state = { 
      completed: new Set(JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]')),
      timeSpent: parseInt(localStorage.getItem('sovereignty-time') || '0'),
      achievements: JSON.parse(localStorage.getItem('sovereignty-achievements') || '[]')
    };

    function updateProgressUI() {
      const keys = ['awakening-1','awakening-2','awakening-3','awakening-4','awakening-5','awakening-6','awakening-7'];
      const done = keys.filter(k => state.completed.has(k)).length;
      const pct = Math.round((done/keys.length)*100);
      
      $('#progressPct').textContent = `${pct}% Complete`;
      $('#progressFill').style.width = `${pct}%`;
      $('#progressCount').textContent = `${done} of ${keys.length} Modules Completed`;
      
      // Update time spent
      const hours = Math.floor(state.timeSpent / 60);
      const minutes = state.timeSpent % 60;
      $('#timeSpent').textContent = `Time spent: ${hours}h ${minutes}m`;
      
      // Update card status indicators
      $$('.modules-grid .module-card').forEach(card => {
        const n = card.getAttribute('data-module');
        const key = `awakening-${n}`;
        const ind = $('.status-indicator', card); 
        const text = $('.status-text', card);
        
        if (state.completed.has(key)) { 
          ind.classList.add('completed'); 
          ind.classList.remove('in-progress'); 
          text.textContent = 'Completed'; 
        } else if (card.dataset.opened === '1') { 
          ind.classList.add('in-progress'); 
          ind.classList.remove('completed'); 
          text.textContent = 'In Progress'; 
        } else { 
          ind.classList.remove('completed', 'in-progress'); 
          text.textContent = 'Not Started'; 
        }
      });
      
      // Check for achievements
      checkAchievements();
    }
    
    function saveProgress() { 
      localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(state.completed))); 
      localStorage.setItem('sovereignty-time', state.timeSpent.toString());
      localStorage.setItem('sovereignty-achievements', JSON.stringify(state.achievements));
      updateProgressUI(); 
      toast('Progress saved'); 
    }
    
    function checkAchievements() {
      const keys = ['awakening-1','awakening-2','awakening-3','awakening-4','awakening-5','awakening-6','awakening-7'];
      const done = keys.filter(k => state.completed.has(k)).length;
      
      const newAchievements = [];
      if (done >= 1 && !state.achievements.includes('first-step')) {
        state.achievements.push('first-step');
        newAchievements.push('First Step: Completed your first module!');
      }
      if (done >= 3 && !state.achievements.includes('journey-begun')) {
        state.achievements.push('journey-begun');
        newAchievements.push('Journey Begun: Completed 3 modules!');
      }
      if (done >= 7 && !state.achievements.includes('sovereign-master')) {
        state.achievements.push('sovereign-master');
        newAchievements.push('Sovereign Master: Completed all modules!');
      }
      
      if (newAchievements.length > 0) {
        saveProgress();
        newAchievements.forEach(ach => {
          setTimeout(() => toast(ach, 'trophy'), 500);
        });
      }
    }

    // ===== detail view injection =====
    function injectArticle(el) {
      const title = $('h3', el)?.textContent || 'Module';
      const theme = $('h4', el)?.textContent?.replace(/^Theme:\s*/,'') || '';
      $('#detailTitle').textContent = title; 
      $('#detailTheme').textContent = theme;
      
      const body = $('#detailBody'); 
      body.innerHTML = '';
      Array.from(el.children).forEach(ch => body.appendChild(ch.cloneNode(true)));
      
      // Wire completion checkboxes
      $$('#detailBody .module-complete input[type="checkbox"]').forEach(cb => {
        const k = cb.getAttribute('data-track'); 
        cb.checked = state.completed.has(k);
        cb.addEventListener('change', e => { 
          if (e.target.checked) state.completed.add(k); 
          else state.completed.delete(k); 
          saveProgress(); 
        });
      });
      
      // Wealth Codes internal nav
      $$('#detailBody .nav-button').forEach(b => b.addEventListener('click', () => {
        const m = /Code\s+(\d+)/i.exec(b.textContent.trim()); 
        if (m) showModule('swc'+m[1]);
      }));
      
      // Start time tracking for this module view
      startTimeTracking();
    }
    
    let timeTrackingInterval;
    function startTimeTracking() {
      clearInterval(timeTrackingInterval);
      timeTrackingInterval = setInterval(() => {
        state.timeSpent++;
        saveProgress();
      }, 60000); // Update every minute
    }
    
    function stopTimeTracking() {
      clearInterval(timeTrackingInterval);
    }

    function showModule(id) {
      let src;
      if (typeof id === 'number' || /^[1-7]$/.test(String(id))) {
        src = $(`#courseContent article#module${id}`);
        const card = $(`.modules-grid .module-card[data-module="${id}"]`); 
        if (card) card.dataset.opened = '1';
      } else if (/^swc[1-7]$/.test(String(id))) { 
        src = $(`#courseContent #${id}`); 
      }
      
      if (!src) { 
        console.warn('Module not found', id); 
        return; 
      }
      
      injectArticle(src);
      $('#moduleDetail').style.display = 'block';
      $('#backToModules').style.display = 'inline-block';
      $('#moduleDetail').scrollIntoView({ behavior: 'smooth', block: 'start' });
      updateProgressUI();
    }
    
    function hideModule() { 
      $('#moduleDetail').style.display = 'none'; 
      $('#backToModules').style.display = 'none'; 
      stopTimeTracking();
    }
    
    function restoreCheckboxes() { 
      $$('#courseContent .module-complete input[type="checkbox"]').forEach(cb => {
        const k = cb.getAttribute('data-track'); 
        cb.checked = state.completed.has(k); 
      }); 
      updateProgressUI(); 
    }
    
    window.showModule = showModule; 
    window.hideModule = hideModule;

    // ===== wallet (ethers v5) =====
    const CHAIN_NAMES = { 
      '0x1': 'Ethereum',
      '0xaa36a7': 'Sepolia',
      '0x89': 'Polygon',
      '0xa4b1': 'Arbitrum',
      '0xa': 'Optimism',
      '0x38': 'BNB' 
    };
    
    const CONFIG = {
      ENABLE_GATE: true,
      TOKEN_ADDRESS: '0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52', // KLY (example)
      MIN_TOKEN: 500,
      ERC20_ABI: ["function balanceOf(address) view returns (uint256)", "function decimals() view returns (uint8)"]
    };
    
    let provider, signer, account, chainId;

    const connectBtn = $('#connectBtn'), 
          provChip = $('#provChip'), 
          addrChip = $('#addrChip'), 
          chainChip = $('#chainChip'), 
          balChip = $('#balChip'), 
          gateChip = $('#gateChip');
    
    function short(a) { return `${a.slice(0,6)}…${a.slice(-4)}`; }

    async function connectWallet() {
      if (!window.ethereum) { 
        toast('Install MetaMask', 'exclamation-triangle'); 
        window.open('https://metamask.io/download', '_blank'); 
        return; 
      }
      
      try {
        const accs = await ethereum.request({ method: 'eth_requestAccounts' });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        account = accs[0]; 
        chainId = await ethereum.request({ method: 'eth_chainId' });
        
        paintWallet(); 
        await refreshNative(); 
        if (CONFIG.ENABLE_GATE) await checkGate();
        
        // Event listeners
        ethereum.on('accountsChanged', async a => {
          if (!a.length) { 
            account = null; 
            paintWallet(); 
            return; 
          }
          account = a[0]; 
          paintWallet(); 
          await refreshNative(); 
          if (CONFIG.ENABLE_GATE) await checkGate();
        });
        
        ethereum.on('chainChanged', async cid => {
          chainId = cid; 
          paintWallet(); 
          await refreshNative(); 
          if (CONFIG.ENABLE_GATE) await checkGate();
        });
        
      } catch (e) { 
        console.error(e); 
        toast('Wallet connection failed', 'exclamation-triangle'); 
      }
    }
    
    function paintWallet() {
      const hasEth = !!window.ethereum;
      provChip.style.display = hasEth ? 'none' : 'inline-flex';
      
      if (account) {
        $('#addrShort').textContent = short(account);
        $('#chainName').textContent = CHAIN_NAMES[chainId] || `Chain ${chainId}`;
        addrChip.style.display = 'inline-flex'; 
        addrChip.classList.add('ok');
        chainChip.style.display = 'inline-flex';
        balChip.style.display = 'inline-flex';
        connectBtn.innerHTML = '<i class="fas fa-check"></i> Connected';
        connectBtn.disabled = true;
      } else {
        addrChip.style.display = 'none'; 
        chainChip.style.display = 'none'; 
        balChip.style.display = 'none'; 
        gateChip.style.display = 'none';
        connectBtn.innerHTML = '<i class="fa-solid fa-wallet"></i> Connect Wallet';
        connectBtn.disabled = false;
      }
    }
    
    async function refreshNative() {
      if (!provider || !account) return;
      
      try {
        $('#refreshBal').innerHTML = '<span class="loader"></span>';
        const wei = await provider.getBalance(account);
        const eth = Number(ethers.utils.formatEther(wei));
        $('#nativeBal').textContent = `${eth.toLocaleString(undefined, { maximumFractionDigits: 6 })} ${CHAIN_NAMES[chainId] === 'Polygon' ? 'MATIC' : 'ETH'}`;
        $('#refreshBal').innerHTML = '<i class="fa-solid fa-rotate"></i>';
        toast('Balance updated', 'coins');
      } catch (e) {
        console.error(e);
        $('#refreshBal').innerHTML = '<i class="fa-solid fa-rotate"></i>';
        toast('Balance update failed', 'exclamation-triangle');
      }
    }
    
    async function checkGate() {
      try {
        if (!provider || !account) { 
          gateChip.style.display = 'none'; 
          return; 
        }
        
        gateChip.style.display = 'inline-flex'; 
        $('#gateText').innerHTML = '<span class="loader"></span> Checking access…';
        
        const token = new ethers.Contract(CONFIG.TOKEN_ADDRESS, CONFIG.ERC20_ABI, provider);
        const [raw, dec] = await Promise.all([token.balanceOf(account), token.decimals()]);
        const bal = Number(ethers.utils.formatUnits(raw, dec));
        
        if (bal >= CONFIG.MIN_TOKEN) {
          $('#gateText').innerHTML = `✅ ${bal.toFixed(2)} KLY — Access Granted`;
          gateChip.classList.add('ok');
        } else {
          $('#gateText').innerHTML = `❌ ${bal.toFixed(2)} KLY — Need ${CONFIG.MIN_TOKEN}+`;
          gateChip.classList.remove('ok');
        }
      } catch (e) { 
        console.error(e); 
        $('#gateText').innerHTML = 'Error checking token';
      }
    }

    // ===== theme toggle =====
    function initTheme() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      updateThemeIcon(savedTheme);
    }
    
    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
    }
    
    function updateThemeIcon(theme) {
      const icon = $('#themeToggle i');
      icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    }

    // ===== init =====
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize theme
      initTheme();
      
      // Initialize progress
      restoreCheckboxes();
      
      // Event listeners
      document.addEventListener('keydown', e => { 
        if (e.key === 'Escape') hideModule(); 
      });
      
      connectBtn.addEventListener('click', connectWallet);
      $('#refreshBal').addEventListener('click', refreshNative);
      $('#themeToggle').addEventListener('click', toggleTheme);
      
      $('#copyAddr').addEventListener('click', async () => { 
        try { 
          await navigator.clipboard.writeText(account || ''); 
          toast('Address copied', 'copy'); 
        } catch { 
          toast('Copy failed', 'exclamation-triangle'); 
        } 
      });
      
      // Navigation
      $$('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
          $$('.nav-item').forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          // Here you would implement section switching
          toast(`Showing ${item.dataset.target}`, 'eye');
        });
      });
      
      // Auto-open M1 once
      if (!localStorage.getItem('__opened_once__')) { 
        showModule(1); 
        localStorage.setItem('__opened_once__', '1'); 
      }
      
      // Prepaint provider hint
      paintWallet();
    });
  </script>
</body>
</html>
