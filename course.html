<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KLY Legacy Course</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #050505;
      color: #e0e0e0;
      font-family: 'Rajdhani', sans-serif;
      margin: 0;
      padding: 2rem;
      text-align: center;
    }
    h2 {
      font-family: 'Orbitron', sans-serif;
      color: #00ffe7;
    }
    section {
      background: rgba(0, 255, 231, 0.05);
      border: 1px solid rgba(0, 255, 231, 0.15);
      border-radius: 12px;
      padding: 2rem;
      margin: 2rem auto;
      max-width: 800px;
      box-shadow: 0 0 30px rgba(0, 255, 231, 0.1);
    }
    button {
      background: linear-gradient(135deg, #00ffe7, #ff00aa);
      color: #000;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-family: 'Orbitron', sans-serif;
      font-weight: bold;
      margin-top: 1rem;
      box-shadow: 0 0 10px rgba(0, 255, 231, 0.3);
    }
    button:hover {
      box-shadow: 0 0 20px rgba(0, 255, 231, 0.5);
      transform: scale(1.02);
    }
    .hidden { display: none; }
    .status { margin-top: 1rem; font-weight: bold; color: #00ff99; }
    .module-title { font-size: 1.8rem; margin-bottom: 1rem; }
    .module-text { margin-bottom: 1rem; color: #ccc; }
    img {
      max-width: 250px;
      margin-top: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0, 255, 231, 0.3);
    }
  </style>
</head>
<body>

<section id="accessPanel">
  <h2>KLY Legacy Course</h2>
  <p>Complete the journey. Unlock legacy knowledge. Mint your NFT certification.</p>
  <button onclick="connectWallet()">Connect Wallet</button>
  <button onclick="verifyAccess()">Verify Access (500 KLY)</button>
  <p id="accessStatus" class="status"></p>
</section>

<section id="courseContent" class="hidden">
  <div id="module1" class="hidden">
    <h2 class="module-title">Module 1: Web3 Foundations</h2>
    <p class="module-text">Web3 is not just the next version of the internet—it’s a complete reimagining of how ownership, identity, and value move online...</p>
    <button onclick="showNextModule(2)">Next</button>
  </div>
  <div id="module2" class="hidden">
    <h2 class="module-title">Module 2: Tokenization</h2>
    <p class="module-text">Tokenization is the engine of Web3. It allows us to represent value, ownership, access, and identity on-chain in programmable form...</p>
    <button onclick="showNextModule(3)">Next</button>
  </div>
  <div id="module3" class="hidden">
    <h2 class="module-title">Module 3: Smart Contracts</h2>
    <p class="module-text">Smart contracts are the backbone of Web3 automation. They’re not contracts in the legal sense, but self-executing code that runs on the blockchain when predefined conditions are met...</p>
    <button onclick="showNextModule(4)">Next</button>
  </div>
  <div id="module4" class="hidden">
    <h2 class="module-title">Module 4: DeFi, Credit & Capital</h2>
    <p class="module-text">Decentralized Finance (DeFi) replaces banks with smart contracts. It offers open access to financial tools like borrowing, lending, staking, and trading—without middlemen, paperwork, or gatekeepers...</p>
    <button onclick="showNextModule(5)">Next</button>
  </div>
  <div id="module5" class="hidden">
    <h2 class="module-title">Module 5: Ownership & Legacy</h2>
    <p class="module-text">In Web3, true wealth isn't just about earning tokens—it's about protecting them, governing them, and passing them on...</p>
    <button onclick="showNextModule('mint')">Complete Course</button>
  </div>

  <div id="mintSection" class="hidden">
    <h2>Claim Your NFT Certificate</h2>
    <img src="https://ipfs.io/ipfs/bafybeihkmkaf2mgx7xkrnkhmzd2uvhr6ddgj6z3vkqcgnvlaa3z7x263r4" alt="NFT Certificate">
    <button onclick="mintNFT()">Mint NFT</button>
    <p id="mintStatus" class="status"></p>
  </div>
</section>

<script>
  const KLY_TOKEN = "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52";
  const KLY_ABI = [{ constant: true, inputs: [{ name: "account", type: "address" }], name: "balanceOf", outputs: [{ name: "", type: "uint256" }], type: "function" }];
  let wallet;

  async function connectWallet() {
    if (!window.ethereum) return alert("Please install MetaMask");
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const accounts = await web3.eth.getAccounts();
    wallet = accounts[0];
    document.getElementById("accessStatus").innerText = "Wallet connected: " + wallet.slice(0, 6) + "..." + wallet.slice(-4);
  }

  async function verifyAccess() {
    if (!wallet) return alert("Connect your wallet first.");
    const web3 = new Web3(window.ethereum);
    const contract = new web3.eth.Contract(KLY_ABI, KLY_TOKEN);
    const balance = await contract.methods.balanceOf(wallet).call();
    const balanceEth = web3.utils.fromWei(balance, "ether");
    if (parseFloat(balanceEth) >= 500) {
      document.getElementById("accessPanel").classList.add("hidden");
      document.getElementById("courseContent").classList.remove("hidden");
      document.getElementById("module1").classList.remove("hidden");
    } else {
      document.getElementById("accessStatus").innerText = "Access Denied: You only hold " + balanceEth + " KLY";
    }
  }

  function showNextModule(id) {
    if (typeof id === 'number') {
      document.getElementById("module" + (id - 1)).classList.add("hidden");
      document.getElementById("module" + id).classList.remove("hidden");
    } else if (id === 'mint') {
      document.getElementById("module5").classList.add("hidden");
      document.getElementById("mintSection").classList.remove("hidden");
    }
  }

  async function mintNFT() {
    if (!wallet) return alert("Please connect your wallet first.");
    try {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();
      const nftContract = new ethers.Contract(
        "0xDA76d35742190283E340dbeE2038ecc978a56950",
        [{ "inputs": [
          { "internalType": "address", "name": "to", "type": "address" },
          { "internalType": "int24", "name": "tickLower", "type": "int24" },
          { "internalType": "int24", "name": "tickUpper", "type": "int24" },
          { "internalType": "uint128", "name": "amount", "type": "uint128" },
          { "internalType": "bytes", "name": "data", "type": "bytes" }],
          "name": "mint",
          "outputs": [],
          "stateMutability": "nonpayable",
          "type": "function" }
        ],
        signer
      );

      const tx = await nftContract.mint(wallet, -600, 600, 1, "0x");
      document.getElementById("mintStatus").innerText = "Minting in progress...";
      await tx.wait();
      document.getElementById("mintStatus").innerText = "✅ NFT successfully minted!";
    } catch (error) {
      console.error("Minting failed:", error);
      document.getElementById("mintStatus").innerText = "❌ Minting failed. Please try again.";
    }
  }
</script>

</body>
</html>
