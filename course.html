<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sovereignty Mastery Program</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
  
  <!-- Animation Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  
  <!-- Web3 Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
  <script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>

  <style>
    :root {
      --primary: #6C4DF6;
      --primary-light: #8A6DF9;
      --secondary: #FF7D05;
      --secondary-light: #FF9A3D;
      --accent: #00E0FF;
      --accent-light: #5DEBFF;
      --dark: #0A0A1E;
      --darker: #050510;
      --light: #F5F5FF;
      --lighter: #FFFFFF;
      --success: #00C853;
      --warning: #FFAB00;
      --danger: #FF3D00;
      --card-bg: rgba(15, 15, 35, 0.8);
      --glass: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.15);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--darker);
      background-image: 
        radial-gradient(at 80% 0%, rgba(108, 77, 246, 0.2) 0px, transparent 50%),
        radial-gradient(at 0% 50%, rgba(0, 224, 255, 0.2) 0px, transparent 50%),
        linear-gradient(to bottom, rgba(10,10,30,0.9), rgba(5,5,16,1));
      color: var(--light);
      font-family: 'Kanit', sans-serif;
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* Floating Particles Background */
    .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
    .particle { position: absolute; background: var(--accent); border-radius: 50%; opacity: 0.3; animation: float linear infinite; }
    @keyframes float { 0% { transform: translateY(0) translateX(0); } 50% { transform: translateY(-100px) translateX(50px); } 100% { transform: translateY(0) translateX(0); } }
    
    /* Typography */
    h1, h2, h3, h4 { font-family: 'Space Grotesk', sans-serif; font-weight: 700; margin-bottom: 1rem; }
    h1 {
      font-size: 3rem;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      line-height: 1.2; text-transform: uppercase; letter-spacing: 1px; position: relative; display: inline-block;
    }
    h1::after { content: ''; position: absolute; bottom: -10px; left: 0; width: 100%; height: 3px; background: linear-gradient(90deg, var(--primary), var(--accent)); border-radius: 3px; }
    h2 { font-size: 2rem; color: var(--accent); position: relative; padding-bottom: 0.5rem; }
    h2::after { content: ''; position: absolute; bottom: 0; left: 0; width: 50px; height: 2px; background: var(--accent); }
    p { margin-bottom: 1rem; color: rgba(255, 255, 255, 0.8); }
    a { color: var(--accent); text-decoration: none; transition: all 0.3s ease; position: relative; }
    a:hover { color: var(--accent-light); text-decoration: none; }
    a::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 0; height: 1px; background: var(--accent-light); transition: width 0.3s ease; }
    a:hover::after { width: 100%; }
    
    /* Layout */
    .container { width: 100%; max-width: 1400px; margin: 0 auto; padding: 0 2rem; }
    header { padding: 3rem 0 2rem; text-align: center; position: relative; }
    .logo { font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; gap: 1rem; position: relative; }
    .logo-icon { color: var(--primary); font-size: 3rem; animation: pulse 2s infinite; }
    .tagline { font-size: 1.2rem; color: rgba(255, 255, 255, 0.7); max-width: 700px; margin: 0 auto 1.5rem; }
    
    .main-content { display: grid; grid-template-columns: 300px 1fr; gap: 2rem; padding-bottom: 4rem; }
    @media (max-width: 992px) { .main-content { grid-template-columns: 1fr; } }
    
    /* Sidebar */
    .sidebar { background: var(--card-bg); border-radius: 1.5rem; padding: 2rem; backdrop-filter: blur(10px); border: 1px solid var(--glass-border); height: fit-content; position: sticky; top: 2rem; box-shadow: var(--shadow); transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .sidebar:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4); }
    .user-profile { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--glass-border); }
    .avatar { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--accent)); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; color: white; box-shadow: 0 0 0 3px rgba(108, 77, 246, 0.3); transition: all 0.3s ease; }
    .avatar:hover { transform: scale(1.05); box-shadow: 0 0 0 5px rgba(108, 77, 246, 0.5); }
    .wallet-info { font-size: 0.9rem; }
    .wallet-address { font-family: monospace; word-break: break-all; color: var(--lighter); }
    .disconnect-btn { background: none; border: none; color: var(--danger); font-size: 0.8rem; cursor: pointer; margin-top: 0.3rem; display: flex; align-items: center; gap: 0.3rem; transition: all 0.3s ease; }
    .disconnect-btn:hover { color: var(--lighter); }
    
    .progress-container { margin: 2rem 0; }
    .progress-title { display: flex; justify-content: space-between; margin-bottom: 0.8rem; font-size: 0.9rem; color: var(--lighter); }
    .progress-bar { height: 10px; background: var(--dark); border-radius: 5px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2); }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 5px; width: 0%; transition: width 0.5s ease; position: relative; overflow: hidden; }
    .progress-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.3) 50%, rgba(255, 255, 255, 0) 100%); animation: shimmer 2s infinite; }
    @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
    
    .course-menu { margin-top: 2rem; }
    .course-menu h3 { font-size: 1.2rem; margin-bottom: 1.5rem; color: var(--accent); display: flex; align-items: center; gap: 0.5rem; }
    .course-menu h3 i { font-size: 1.1rem; }
    .menu-item { display: flex; align-items: center; gap: 1rem; padding: 1rem; border-radius: 0.8rem; cursor: pointer; transition: all 0.3s ease; margin-bottom: 0.5rem; background: rgba(0, 0, 0, 0.3); border: 1px solid transparent; }
    .menu-item:hover { background: rgba(108, 77, 246, 0.2); border-color: rgba(108, 77, 246, 0.3); transform: translateX(5px); }
    .menu-item.active { background: linear-gradient(90deg, rgba(108, 77, 246, 0.3), rgba(0, 224, 255, 0.2)); border-color: var(--glass-border); box-shadow: 0 5px 15px rgba(108, 77, 246, 0.2); }
    .menu-icon { width: 30px; height: 30px; border-radius: 8px; background: rgba(0, 224, 255, 0.1); display: flex; align-items: center; justify-content: center; color: var(--accent); transition: all 0.3s ease; }
    .menu-item.active .menu-icon { background: var(--primary); color: white; }
    .menu-text { flex: 1; }
    .menu-badge { background: var(--secondary); color: var(--darker); padding: 0.2rem 0.5rem; border-radius: 1rem; font-size: 0.7rem; font-weight: bold; }
    
    /* Course Content */
    .course-content { background: var(--card-bg); border-radius: 1.5rem; padding: 2.5rem; backdrop-filter: blur(10px); border: 1px solid var(--glass-border); box-shadow: var(--shadow); transition: transform 0.3s ease; }
    .course-content:hover { transform: translateY(-5px); }
    .module-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--glass-border); }
    .module-title { font-size: 1.8rem; color: var(--lighter); display: flex; align-items: center; gap: 1rem; }
    .module-number { width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
    .module-nav { display: flex; gap: 1rem; }
    .module-body { padding: 1rem 0; }
    .module-section { margin-bottom: 2.5rem; }
    .module-section h3 { color: var(--secondary-light); margin-bottom: 1rem; font-size: 1.4rem; display: flex; align-items: center; gap: 0.8rem; }
    .module-section h3 i { color: var(--accent); font-size: 1.2rem; }
    .module-section ul { padding-left: 1.8rem; margin-bottom: 1.5rem; }
    .module-section li { margin-bottom: 0.8rem; position: relative; padding-left: 1.5rem; color: rgba(255, 255, 255, 0.8); }
    .module-section li::before { content: ''; position: absolute; left: 0; top: 0.6rem; width: 8px; height: 8px; background: var(--accent); border-radius: 50%; }
    .callout { background: rgba(0, 224, 255, 0.1); border-left: 4px solid var(--accent); padding: 1.5rem; margin: 2rem 0; border-radius: 0 0.8rem 0.8rem 0; position: relative; overflow: hidden; }
    .callout::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, rgba(0, 224, 255, 0.05) 0%, rgba(0, 224, 255, 0.01) 100%); pointer-events: none; }
    .callout-icon { position: absolute; top: 1rem; right: 1rem; opacity: 0.1; font-size: 3rem; color: var(--accent); }
    .callout-title { font-weight: bold; margin-bottom: 0.5rem; color: var(--accent-light); }
    .module-content {
  padding: 2rem;
  border-radius: 12px;
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(10px);
}
    
    /* Buttons */
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.8rem; padding: 1rem 2rem; border-radius: 0.8rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; border: none; font-family: 'Space Grotesk', sans-serif; text-transform: uppercase; letter-spacing: 0.5px; position: relative; overflow: hidden; z-index: 1; }
    .btn::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.1) 100%); z-index: -1; opacity: 0; transition: opacity 0.3s ease; }
    .btn:hover::before { opacity: 1; }
    .btn-primary { background: linear-gradient(90deg, var(--primary), var(--secondary)); color: white; box-shadow: 0 5px 20px rgba(108, 77, 246, 0.5); }
    .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(108, 77, 246, 0.7); }
    .btn-outline { background: transparent; border: 2px solid var(--glass-border); color: var(--light); }
    .btn-outline:hover { border-color: var(--accent); color: var(--accent); box-shadow: 0 5px 15px rgba(0, 224, 255, 0.2); }
    .btn-sm { padding: 0.8rem 1.5rem; font-size: 0.9rem; }
    
    /* Wallet Connect Section */
    .connect-section { text-align: center; max-width: 700px; margin: 3rem auto; padding: 3rem; background: var(--card-bg); border-radius: 1.5rem; border: 1px solid var(--glass-border); backdrop-filter: blur(10px); box-shadow: var(--shadow); position: relative; overflow: hidden; }
    .connect-section::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle at center, rgba(108, 77, 246, 0.1) 0%, transparent 70%); animation: rotate 20s linear infinite; z-index: -1; }
    @keyframes rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .connect-section h2 { margin-bottom: 1.5rem; font-size: 2rem; }
    .connect-section p { margin-bottom: 2rem; font-size: 1.1rem; max-width: 600px; margin-left: auto; margin-right: auto; }
    .wallet-options { display: flex; justify-content: center; gap: 1rem; margin-top: 2rem; flex-wrap: wrap; }
    .wallet-option { background: rgba(0, 0, 0, 0.3); border: 1px solid var(--glass-border); border-radius: 0.8rem; padding: 1rem 1.5rem; display: flex; align-items: center; gap: 0.8rem; cursor: pointer; transition: all 0.3s ease; }
    .wallet-option:hover { background: rgba(108, 77, 246, 0.2); border-color: var(--primary); transform: translateY(-3px); }
    .wallet-icon { font-size: 1.5rem; color: var(--accent); }
    .connect-note {
  font-size: 0.9rem;
  color: var(--text-light, #bbb);
  margin: 0.5rem 0 1.25rem;
  line-height: 1.4;
  text-align: center;
}
.connect-note strong {
  color: var(--accent); /* make “5 SolCoin” pop */
}
    
    /* Notification */
    .notification { position: fixed; bottom: 2rem; right: 2rem; padding: 1.2rem 2rem; background: var(--dark); color: white; border-radius: 0.8rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); display: flex; align-items: center; gap: 1rem; z-index: 1000; animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); border-left: 4px solid var(--primary); transform-origin: bottom right; max-width: 400px; }
    .notification.success { border-left-color: var(--success); }
    .notification.error { border-left-color: var(--danger); }
    .notification.warning { border-left-color: var(--warning); }
    .notification-icon { font-size: 1.5rem; }
    .notification-content { flex: 1; }
    .notification-title { font-weight: bold; margin-bottom: 0.3rem; }
    .notification-message { font-size: 0.9rem; opacity: 0.9; }
    .notification-close { background: none; border: none; color: rgba(255, 255, 255, 0.5); cursor: pointer; font-size: 1rem; transition: all 0.3s ease; }
    .notification-close:hover { color: white; }
    @keyframes slideIn { from { transform: translateX(100%) scale(0.9); opacity: 0; } to { transform: translateX(0) scale(1); opacity: 1; } }
    
    /* Badges */
    .badge { display: inline-block; padding: 0.3rem 0.8rem; border-radius: 1rem; font-size: 0.8rem; font-weight: 700; background: linear-gradient(90deg, var(--primary), var(--secondary)); color: white; margin-left: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; }
    
    /* Certificate Section */
    .certificate-section { text-align: center; margin-top: 4rem; padding-top: 3rem; border-top: 1px solid var(--glass-border); position: relative; }
    .certificate-section::before { content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 3px; background: linear-gradient(90deg, var(--primary), var(--accent)); border-radius: 3px; }
    .certificate-title { font-size: 1.8rem; margin-bottom: 1rem; background: linear-gradient(90deg, var(--primary), var(--accent)); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .certificate-desc { max-width: 600px; margin: 0 auto 2rem; font-size: 1.1rem; }
    .certificate-image { max-width: 300px; margin: 0 auto 2rem; border-radius: 1rem; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); border: 1px solid var(--glass-border); opacity: 0.9; transition: all 0.3s ease; }
    .certificate-image:hover { opacity: 1; transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6); }
    
    /* Floating & Pulse */
    @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }
    .floating { animation: float 6s ease-in-out infinite; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    .pulse { animation: pulse 2s infinite; }
    
    /* Mobile Styles */
    @media (max-width: 768px) {
      .container { padding: 0 1.5rem; }
      header { padding: 2rem 0 1.5rem; }
      h1 { font-size: 2.2rem; }
      .logo { font-size: 2rem; }
      .logo-icon { font-size: 2.5rem; }
      .tagline { font-size: 1rem; }
      .connect-section { padding: 2rem 1.5rem; }
      .connect-section h2 { font-size: 1.5rem; }
      .module-header { flex-direction: column; align-items: flex-start; gap: 1.5rem; }
      .module-nav { width: 100%; justify-content: space-between; }
      .btn { width: 100%; }
      .wallet-options { flex-direction: column; }
      .wallet-option { width: 100%; justify-content: center; }
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(5, 5, 16, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-container {
      background: var(--card-bg);
      border-radius: 1.5rem;
      border: 1px solid var(--glass-border);
      width: 90%;
      max-width: 900px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 2.5rem;
      position: relative;
      transform: translateY(50px);
      transition: transform 0.4s ease;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    }
    
    .modal-overlay.active .modal-container {
      transform: translateY(0);
    }
    
    .modal-close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: none;
      border: none;
      color: var(--light);
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--accent);
    }
    
    .modal-header {
      margin-bottom: 2rem;
      padding-right: 3rem;
    }
    
    .modal-title {
      font-size: 2rem;
      color: var(--lighter);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .modal-subtitle {
      color: var(--accent);
      font-size: 1.2rem;
      font-weight: 500;
    }
    
    .modal-body {
      padding: 1rem 0;
    }
    
    .modal-section {
      margin-bottom: 2.5rem;
    }
    
    .modal-section h3 {
      color: var(--secondary-light);
      margin-bottom: 1rem;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    
    .modal-section h3 i {
      color: var(--accent);
      font-size: 1.2rem;
    }
    
    .practice-box {
      background: rgba(0, 224, 255, 0.1);
      border-left: 4px solid var(--accent);
      padding: 1.5rem;
      margin: 2rem 0;
      border-radius: 0 0.8rem 0.8rem 0;
      position: relative;
      overflow: hidden;
    }
    
    .practice-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, rgba(0, 224, 255, 0.05) 0%, rgba(0, 224, 255, 0.01) 100%);
      pointer-events: none;
    }
    
    .practice-title {
      font-weight: bold;
      margin-bottom: 1rem;
      color: var(--accent-light);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .modal-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--glass-border);
    }
    
    .module-status {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-size: 0.9rem;
    }
    
    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #444;
      display: inline-block;
    }
    
    .status-indicator.completed {
      background: var(--success);
    }
    
    .status-indicator.in-progress {
      background: var(--warning);
    }
    
    /* Scrollable list for mobile (optional) */
    .course-list-container { max-height: 60vh; overflow-y: auto; padding-right: 8px; }
    .course-list-container::-webkit-scrollbar { width: 4px; }
    .course-list-container::-webkit-scrollbar-thumb { background-color: rgba(255, 255, 255, 0.2); border-radius: 2px; }
    @media (max-width: 768px) { .course-list-container .menu-item { margin-bottom: 12px; padding: 0.8rem; } }
    
  </style>
</head>
<body>
  <!-- Floating Particles Background -->
  <div class="particles" id="particles"></div>

  <div class="container">
    <header>
      <div class="logo">
        <i class="fas fa-crown logo-icon"></i>
        <span>Sovereignty Mastery</span>
      </div>
      <p class="tagline">A transformative journey to reclaim your personal power and live with authentic authority.</p>
    </header>

    <div class="main-content">
      <aside class="sidebar">
        <div class="user-profile" id="userProfile">
          <div class="avatar" id="userAvatar">?</div>
          <div class="wallet-info">
            <div class="wallet-address" id="walletAddress">Not connected</div>
            <button class="disconnect-btn" id="disconnectBtn" style="display: none;">
              <i class="fas fa-unlink"></i> Disconnect
            </button>
          </div>
        </div>

        <div class="progress-container">
          <div class="progress-title">
            <span>Your Progress</span>
            <span id="progressPercentage">0%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
          </div>
        </div>

        <div class="course-menu">
          <h3><i class="fas fa-graduation-cap"></i> Course Modules</h3>
          <div class="course-list-container" id="courseList">
            <!-- Menu items will be generated dynamically -->
          </div>
        </div>
      </aside>

      <main class="course-content" id="courseContent">
        <div class="connect-section" id="connectSection">
          <h2>Connect Your Wallet</h2>
     <p class="connect-note">
  Connect your Web3 wallet to access the complete <strong>Sovereignty Mastery Program</strong>, track your progress, and unlock all 14 modules.  
  Access requires holding at least <strong>5 SolCoin</strong> on <strong>BNB Smart Chain</strong>.
</p>
     <div class="wallet-options">
  <div class="wallet-option" id="connectWalletBtn">
    <i class="fas fa-wallet wallet-icon"></i>
    <span>Connect Wallet</span>
  </div>
 </div>
</div>
    <div class="module-content" id="moduleContent" style="display:none;">
          <div class="module-header">
            <div class="module-title">
              <div class="module-number" id="moduleNumber">1</div>
              <span id="moduleTitle">Foundation of Sovereignty</span>
            </div>
            <div class="module-nav">
              <button class="btn btn-outline btn-sm" id="prevModuleBtn" disabled>
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <button class="btn btn-primary btn-sm" id="nextModuleBtn">
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>

          <div class="module-body">
            <div class="module-section">
              <h3><i class="fas fa-bullseye"></i> Core Concept</h3>
              <p id="moduleConcept">Sovereignty is your birthright to complete authority over your being—thoughts, emotions, choices, and energy. This module establishes the foundational understanding of what it means to be truly sovereign.</p>
            </div>

            <div class="module-section">
              <h3><i class="fas fa-tasks"></i> Learning Objectives</h3>
              <ul id="moduleObjectives">
                <!-- Objectives will be populated dynamically -->
              </ul>
            </div>

            <div class="module-section">
              <h3><i class="fas fa-book-open"></i> Key Lessons</h3>
              <ul id="moduleLessons">
                <!-- Lessons will be populated dynamically -->
              </ul>
            </div>

            <div class="practice-box" id="modulePractice">
              <div class="practice-title">
                <i class="fas fa-pen-fancy"></i> Sovereignty Audit Worksheet
              </div>
              <p><strong>Reflection Questions:</strong></p>
              <ul id="practiceQuestions">
                <!-- Questions will be populated dynamically -->
              </ul>
              <p><strong>Action Step:</strong> <span id="actionStep">Identify one area where you've given away power and take one concrete action to reclaim it within 48 hours.</span></p>
            </div>

            <div class="callout">
              <i class="fas fa-lightbulb callout-icon"></i>
              <div class="callout-title">Sovereign Insight</div>
              <p id="sovereignInsight">True sovereignty begins not with controlling others, but with mastering yourself. The most powerful throne you will ever sit upon is the one within your own being.</p>
            </div>

            <div style="text-align: center; margin-top: 2.5rem;">
              <button class="btn btn-primary" id="openModal">
                <i class="fas fa-expand"></i> View Full Module Content
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-container">
      <button class="modal-close" id="modalClose">
        <i class="fas fa-times"></i>
      </button>

      <div class="modal-header">
        <h2 class="modal-title">
          <div class="module-number" id="modalModuleNumber">1</div>
          <span id="modalModuleTitle">Foundation of Sovereignty</span>
        </h2>
        <div class="modal-subtitle" id="modalModuleSubtitle">Understanding Personal Power</div>
      </div>

      <div class="modal-body" id="modalModuleContent">
        <!-- Modal content will be populated dynamically -->
      </div>

      <div class="modal-footer">
        <div class="module-status">
          <span class="status-indicator" id="modalStatusIndicator"></span>
          <span class="status-text" id="modalStatusText">Not Started</span>
        </div>
        <div>
          <button class="btn btn-outline btn-sm" id="saveProgressBtn">
            <i class="fas fa-bookmark"></i> Save Progress
          </button>
          <button class="btn btn-primary btn-sm" id="markCompleteBtn">
            Mark Complete <i class="fas fa-check"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

<script>
// ================== CONFIG ==================
const TOKEN_ADDRESS   = '0x7a732Ae6b2Db2ceACc3Ffe6F63F3B9B0Ce94A026'; // <-- put SolCoin contract here
const REQUIRED_TOKENS = 5;                          // gate at 5 tokens

// Target network (BNB Smart Chain)
const CHAIN_ID   = 56; // 1=Ethereum, 56=BNB, 137=Polygon, etc.
const CHAIN_NAME = 'BNB Smart Chain';
const RPC_URL    = 'https://bsc-dataseed.binance.org';

// Minimal ERC-20 ABI
const ERC20_ABI = [
  'function balanceOf(address) view returns (uint256)',
  'function decimals() view returns (uint8)',
  'function symbol() view returns (string)'
];

// ================== HELPERS / GLOBALS ==================
const toHexChainId = (id) => '0x' + id.toString(16);
let web3Modal, extProvider, provider, signer, tokenContract;

// ================== WEB3MODAL SETUP ==================
const providerOptions = {
  walletconnect: {
    package: window.WalletConnectProvider.default,
    options: {
      rpc: { [CHAIN_ID]: RPC_URL },
      chainId: CHAIN_ID
    }
  }
};
web3Modal = new window.Web3Modal.default({
  cacheProvider: true,
  providerOptions,
  theme: 'dark'
});

// ================== COURSE DATA ==================
const courseModules = [
  {
    id: 1,
    title: "Foundation of Sovereignty",
    subtitle: "Understanding Personal Power",
    concept: "Sovereignty is your birthright to complete authority over your being—thoughts, emotions, choices, and energy. This module establishes the foundational understanding of what it means to be truly sovereign.",
    objectives: [
      "Understand the historical and philosophical roots of sovereignty",
      "Identify areas where you've surrendered personal authority",
      "Recognize the difference between ego-driven and soul-aligned power",
      "Establish a daily practice to strengthen sovereign awareness",
      "Create a personal sovereignty declaration"
    ],
    lessons: [
      "The Historical Context of Sovereignty - Explore how sovereignty has been understood across cultures and time periods",
      "Internal vs External Authority - Learn to distinguish between making decisions based on external validation versus internal wisdom",
      "The Ego's Illusion of Control - Understand how the ego masquerades as sovereignty while actually keeping you trapped",
      "Sovereignty as a Daily Practice - Discover practical techniques for cultivating sovereignty in everyday life",
      "Energy Management Basics - Learn to recognize and protect your energy as the fundamental resource of sovereign practice"
    ],
    questions: [
      "Where in my life do I consistently defer to others' opinions rather than trusting my own knowing?",
      "What decisions have I made recently from fear of judgment rather than alignment with my truth?",
      "Which relationships or situations require me to shrink or hide parts of myself?",
      "What one decision this week would most restore my sense of personal power?"
    ],
    actionStep: "Identify one area where you've given away power and take one concrete action to reclaim it within 48 hours.",
    insight: "True sovereignty begins not with controlling others, but with mastering yourself. The most powerful throne you will ever sit upon is the one within your own being."
  },
  {
    id: 2,
    title: "Boundaries & Energy Protection",
    subtitle: "Creating Safe Containers",
    concept: "Boundaries are the foundation of sovereignty. They define where you end and others begin, protecting your energy and creating space for authentic expression.",
    objectives: [
      "Identify your current boundary patterns and where they need strengthening",
      "Learn to set clear, compassionate boundaries without guilt",
      "Develop techniques for protecting your energy in various situations",
      "Recognize and respond to boundary violations effectively",
      "Create a personalized boundary framework for different relationships"
    ],
    lessons: [
      "The Spectrum of Boundaries - From rigid to porous to healthy",
      "Energy Protection Techniques - Shielding, grounding, and cleansing practices",
      "The Art of Saying No - Without explanation, guilt, or justification",
      "Boundary Communication - Expressing your limits with clarity and compassion",
      "Relationship-Specific Boundaries - Tailoring your approach for different contexts"
    ],
    questions: [
      "Where do I notice my energy draining in relationships or situations?",
      "What boundaries have I been afraid to set for fear of conflict or rejection?",
      "How do I typically respond when someone crosses my boundaries?",
      "What would change if I honored my limits without apology?"
    ],
    actionStep: "Identify one relationship or situation where you need to set a clearer boundary and communicate it this week.",
    insight: "Boundaries aren't walls to keep people out, but gates that allow you to choose what enters your field. They are the foundation of self-respect."
  },
  {
    id: 3,
    title: "Authentic Decision Making",
    subtitle: "Listening to Inner Wisdom",
    concept: "Sovereign decision-making comes from alignment with your core truth, not external influences or conditioned responses. This module teaches you to access and trust your inner guidance system.",
    objectives: [
      "Distinguish between fear-based and aligned decision-making",
      "Develop practices for accessing your inner wisdom consistently",
      "Recognize and overcome conditioning that clouds your judgment",
      "Create a decision-making framework based on your core values",
      "Learn to trust and act on your intuitive guidance"
    ],
    lessons: [
      "The Decision-Making Spectrum - From fear to alignment",
      "Accessing Body Wisdom - Learning to read somatic signals",
      "Values-Based Choices - Making decisions aligned with your core principles",
      "Intuition Development - Strengthening your connection to inner knowing",
      "Navigating Uncertainty - Making confident choices without all the information"
    ],
    questions: [
      "What recent decision did I make from fear or external pressure rather than alignment?",
      "How do I typically know when a decision feels right in my body?",
      "What areas of my life feel most out of alignment with my true values?",
      "How can I create more space for reflective decision-making?"
    ],
    actionStep: "Practice pausing before making decisions this week. Check in with your body and values before choosing.",
    insight: "The most sovereign decision is the one that aligns with your soul's truth, regardless of external validation or approval."
  },
  {
    id: 4,
    title: "Sovereign Communication",
    subtitle: "Expressing Truth with Power",
    concept: "Sovereign communication is the practice of expressing your truth with clarity, compassion, and conviction, without attachment to how it's received.",
    objectives: [
      "Develop clarity in expressing your needs and boundaries",
      "Learn to communicate without blame, judgment, or defense",
      "Practice active listening and presence in conversations",
      "Express difficult truths with compassion and firmness",
      "Recognize and transform communication patterns that diminish your power"
    ],
    lessons: [
      "Nonviolent Communication - Expressing needs without blame",
      "The Power of Presence - Bringing full attention to conversations",
      "Authentic Expression - Speaking your truth without filters",
      "Navigating Conflict - Maintaining sovereignty in difficult discussions",
      "Conscious Language - Transforming disempowering speech patterns"
    ],
    questions: [
      "Where do I hold back from expressing my truth in relationships?",
      "What communication patterns make me feel diminished or powerless?",
      "How can I express difficult truths with more compassion and clarity?",
      "When do I prioritize harmony over authenticity in communication?"
    ],
    actionStep: "Identify one truth you've been avoiding expressing and communicate it clearly this week.",
    insight: "Sovereign communication isn't about controlling how your message is received, but about taking responsibility for how it's delivered."
  },
  {
    id: 5,
    title: "Financial Sovereignty",
    subtitle: "Wealth as Energy Exchange",
    concept: "Financial sovereignty is about aligning your relationship with money to support your values and freedom, transforming scarcity consciousness into empowered stewardship.",
    objectives: [
      "Examine and transform limiting beliefs about money and abundance",
      "Create systems for conscious earning, spending, and investing",
      "Align financial decisions with your values and life purpose",
      "Develop a healthy relationship with money as energy exchange",
      "Create a financial foundation that supports your sovereignty"
    ],
    lessons: [
      "Money Mindset - Identifying and transforming limiting beliefs",
      "Conscious Earning - Aligning income with values and purpose",
      "Value-Based Spending - Making financial choices that reflect priorities",
      "Energy Exchange - Understanding money as flow rather than storage",
      "Financial Systems - Creating structures that support freedom"
    ],
    questions: [
      "What beliefs about money did I inherit from family or culture?",
      "How does my current financial situation support or hinder my sovereignty?",
      "What would change if I viewed money as energy rather than security?",
      "How can I align my earning and spending with my core values?"
    ],
    actionStep: "Review your spending from the last month and identify one area where you can better align with your values.",
    insight: "True financial sovereignty isn't about the amount of money you have, but about your relationship with it and how it flows through your life."
  },
  {
    id: 6,
    title: "Sovereign Relationships",
    subtitle: "Connecting Without Losing Self",
    concept: "Sovereign relationships honor both connection and autonomy, allowing for deep intimacy without enmeshment or loss of self.",
    objectives: [
      "Identify relationship patterns that diminish your sovereignty",
      "Develop practices for maintaining self-connection in relationships",
      "Create relationships based on mutual respect and autonomy",
      "Navigate the balance between intimacy and independence",
      "Communicate needs and boundaries clearly in relationships"
    ],
    lessons: [
      "Attachment Patterns - Understanding how early patterns affect current relationships",
      "The Autonomy-Intimacy Dance - Balancing connection and independence",
      "Conscious Relating - Bringing presence and awareness to relationships",
      "Navigating Differences - Honoring sovereignty in conflict and disagreement",
      "Sovereign Partnerships - Creating relationships that empower both individuals"
    ],
    questions: [
      "Where do I compromise myself to maintain harmony in relationships?",
      "What patterns from past relationships continue to affect me?",
      "How can I bring more authentic presence to my connections?",
      "What would a truly sovereign relationship look and feel like?"
    ],
    actionStep: "Practice checking in with yourself during interactions this week. Notice where you might be abandoning yourself to please others.",
    insight: "The most nourishing relationships are those where two sovereign beings choose to connect, not because they need to, but because they want to."
  },
  {
    id: 7,
    title: "Living as Sovereign Being",
    subtitle: "Integration & Mastery",
    concept: "Sovereignty becomes embodied when it infuses every aspect of your life. This module focuses on integrating all practices into a cohesive way of being.",
    objectives: [
      "Integrate sovereignty practices into daily routines and habits",
      "Develop resilience in maintaining sovereignty during challenges",
      "Create environments that support your sovereign expression",
      "Embody sovereignty as your natural state of being",
      "Become a conscious creator of your life experience"
    ],
    lessons: [
      "Daily Sovereignty Practices - Rituals and routines that support empowerment",
      "Resilience Building - Maintaining center during challenges and triggers",
      "Environmental Design - Creating spaces that reflect and support sovereignty",
      "Embodied Sovereignty - Living from alignment as your default state",
      "Conscious Creation - Moving from reaction to intentional creation"
    ],
    questions: [
      "What daily practices most support my sense of sovereignty?",
      "How do I typically respond when my sovereignty is challenged?",
      "What in my environment supports or hinders my empowered expression?",
      "How can I make sovereignty my default way of being?"
    ],
    actionStep: "Create one daily ritual that reinforces your sovereignty and practice it consistently for the next month.",
    insight: "Sovereignty isn't a destination to reach, but a way of traveling through life—a continuous practice of remembering and reclaiming your authentic power."
  }
];

// ================== STATE ==================
let currentModule = 1;
let userProgress = {};
let userAddress = null;

// ================== DOM REFS ==================
const connectSection   = document.getElementById('connectSection');
const moduleContent    = document.getElementById('moduleContent');
const courseList       = document.getElementById('courseList');
const userAvatar       = document.getElementById('userAvatar');
const walletAddress    = document.getElementById('walletAddress');
const disconnectBtn    = document.getElementById('disconnectBtn');
const connectWalletBtn = document.getElementById('connectWalletBtn');
const progressPercentage = document.getElementById('progressPercentage');
const progressFill       = document.getElementById('progressFill');
const prevModuleBtn    = document.getElementById('prevModuleBtn');
const nextModuleBtn    = document.getElementById('nextModuleBtn');
const openModalBtn     = document.getElementById('openModal');
const modalOverlay     = document.getElementById('modalOverlay');
const modalClose       = document.getElementById('modalClose');

// ================== UI / CONTENT ==================
function createParticles() {
  const particlesContainer = document.getElementById('particles');
  const particleCount = 30;
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.classList.add('particle');
    const size = Math.random() * 10 + 2;
    const posX = Math.random() * 100;
    const posY = Math.random() * 100;
    const animationDuration = Math.random() * 20 + 10;
    const animationDelay = Math.random() * 5;
    const opacity = Math.random() * 0.3 + 0.1;

    particle.style.width = `${size}px`;
    particle.style.height = `${size}px`;
    particle.style.left = `${posX}%`;
    particle.style.top = `${posY}%`;
    particle.style.animationDuration = `${animationDuration}s`;
    particle.style.animationDelay = `${animationDelay}s`;
    particle.style.opacity = opacity;

    const colors = [
      'var(--primary)', 'var(--secondary)', 'var(--accent)',
      'var(--primary-light)', 'var(--accent-light)'
    ];
    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
    particlesContainer.appendChild(particle);
  }
}

function renderCourseMenu() {
  courseList.innerHTML = '';
  courseModules.forEach(module => {
    const menuItem = document.createElement('div');
    menuItem.classList.add('menu-item');
    if (module.id === currentModule) menuItem.classList.add('active');

    menuItem.innerHTML = `
      <div class="menu-icon"><i class="fas fa-${module.id}"></i></div>
      <div class="menu-text">${module.title}</div>
      ${module.id === 1 ? '<div class="menu-badge">New</div>' : ''}
    `;
    menuItem.addEventListener('click', () => {
      currentModule = module.id;
      updateUI();
    });
    courseList.appendChild(menuItem);
  });
}

function updateUI() {
  const module = courseModules.find(m => m.id === currentModule);
  if (!module) return;

  document.getElementById('moduleNumber').textContent = module.id;
  document.getElementById('moduleTitle').textContent  = module.title;
  document.getElementById('moduleConcept').textContent = module.concept;

  const objectivesList = document.getElementById('moduleObjectives');
  objectivesList.innerHTML = '';
  module.objectives.forEach(obj => {
    const li = document.createElement('li');
    li.textContent = obj;
    objectivesList.appendChild(li);
  });

  const lessonsList = document.getElementById('moduleLessons');
  lessonsList.innerHTML = '';
  module.lessons.forEach(lesson => {
    const li = document.createElement('li');
    li.textContent = lesson;
    lessonsList.appendChild(li);
  });

  const questionsList = document.getElementById('practiceQuestions');
  questionsList.innerHTML = '';
  module.questions.forEach(q => {
    const li = document.createElement('li');
    li.textContent = q;
    questionsList.appendChild(li);
  });

  document.getElementById('actionStep').textContent     = module.actionStep;
  document.getElementById('sovereignInsight').textContent = module.insight;

  prevModuleBtn.disabled = currentModule === 1;
  nextModuleBtn.disabled = currentModule === courseModules.length;

  updateProgressUI();

  document.querySelectorAll('.menu-item').forEach((item, index) => {
    if (index + 1 === currentModule) item.classList.add('active');
    else item.classList.remove('active');
  });
}

function navigateModule(direction) {
  const newModule = currentModule + direction;
  if (newModule >= 1 && newModule <= courseModules.length) {
    currentModule = newModule;
    updateUI();
  }
}

function updateProgressUI() {
  const totalModules = courseModules.length;
  const completedModules = Object.values(userProgress).filter(s => s === 'completed').length;
  const progress = Math.round((completedModules / totalModules) * 100);
  progressPercentage.textContent = `${progress}%`;
  progressFill.style.width = `${progress}%`;
}

function loadProgress() {
  const saved = localStorage.getItem('sovereigntyProgress');
  if (saved) userProgress = JSON.parse(saved);
}

function saveProgress() {
  localStorage.setItem('sovereigntyProgress', JSON.stringify(userProgress));
  updateProgressUI();
}

// ================== MODAL ==================
function setupModal() {
  openModalBtn.addEventListener('click', openModal);
  modalClose.addEventListener('click', closeModal);
  modalOverlay.addEventListener('click', (e) => {
    if (e.target === modalOverlay) closeModal();
  });
}

function openModal() {
  const module = courseModules.find(m => m.id === currentModule);
  if (!module) return;

  document.getElementById('modalModuleNumber').textContent = module.id;
  document.getElementById('modalModuleTitle').textContent  = module.title;
  document.getElementById('modalModuleSubtitle').textContent = module.subtitle;

  const modalContent = document.getElementById('modalModuleContent');
  modalContent.innerHTML = `
    <div class="modal-section">
      <h3><i class="fas fa-bullseye"></i> Core Concept</h3>
      <p>${module.concept}</p>
    </div>
    <div class="modal-section">
      <h3><i class="fas fa-tasks"></i> Learning Objectives</h3>
      <ul>${module.objectives.map(o => `<li>${o}</li>`).join('')}</ul>
    </div>
    <div class="modal-section">
      <h3><i class="fas fa-book-open"></i> Key Lessons</h3>
      <ul>${module.lessons.map(l => `<li>${l}</li>`).join('')}</ul>
    </div>
    <div class="practice-box">
      <div class="practice-title"><i class="fas fa-pen-fancy"></i> Sovereignty Practice</div>
      <p><strong>Reflection Questions:</strong></p>
      <ul>${module.questions.map(q => `<li>${q}</li>`).join('')}</ul>
      <p><strong>Action Step:</strong> ${module.actionStep}</p>
    </div>
    <div class="callout">
      <i class="fas fa-lightbulb callout-icon"></i>
      <div class="callout-title">Sovereign Insight</div>
      <p>${module.insight}</p>
    </div>
  `;

  const status = userProgress[currentModule] || 'not-started';
  const statusIndicator = document.getElementById('modalStatusIndicator');
  const statusText = document.getElementById('modalStatusText');

  statusIndicator.className = 'status-indicator';
  if (status === 'completed') {
    statusIndicator.classList.add('completed');
    statusText.textContent = 'Completed';
  } else if (status === 'in-progress') {
    statusIndicator.classList.add('in-progress');
    statusText.textContent = 'In Progress';
  } else {
    statusText.textContent = 'Not Started';
  }

  modalOverlay.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  modalOverlay.classList.remove('active');
  document.body.style.overflow = 'auto';
}

// ================== NOTIFICATIONS ==================
function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.classList.add('notification', type);

  const icons = {
    success: 'fa-check-circle',
    error: 'fa-exclamation-circle',
    warning: 'fa-exclamation-triangle',
    info: 'fa-info-circle'
  };

  notification.innerHTML = `
    <i class="fas ${icons[type]} notification-icon"></i>
    <div class="notification-content">
      <div class="notification-message">${message}</div>
    </div>
    <button class="notification-close"><i class="fas fa-times"></i></button>
  `;

  document.body.appendChild(notification);
  notification.querySelector('.notification-close').addEventListener('click', () => notification.remove());
  setTimeout(() => { if (notification.parentNode) notification.remove(); }, 5000);
}

// ================== WALLET FLOW ==================
async function connectWallet() {
  try {
    extProvider = await web3Modal.connect();
    provider = new ethers.providers.Web3Provider(extProvider, "any");

    // Helps some mobile wallets
    await provider.send("eth_requestAccounts", []);

    // Ensure target chain
    const net = await provider.getNetwork();
    if (net.chainId !== CHAIN_ID) {
      try {
        await extProvider.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: toHexChainId(CHAIN_ID) }]
        });
      } catch (switchErr) {
        try {
          await extProvider.request({
            method: "wallet_addEthereumChain",
            params: [{
              chainId: toHexChainId(CHAIN_ID),
              chainName: CHAIN_NAME,
              nativeCurrency: { name: "BNB", symbol: "BNB", decimals: 18 },
              rpcUrls: [RPC_URL],
              blockExplorerUrls: ["https://bscscan.com"]
            }]
          });
        } catch (addErr) {
          showNotification(`Please switch to ${CHAIN_NAME} in your wallet.`, "warning");
          return; // stop here; user hasn’t switched
        }
      }
    }

    // Address & contract
    signer = provider.getSigner();
    userAddress = await signer.getAddress();
    tokenContract = new ethers.Contract(TOKEN_ADDRESS, ERC20_ABI, provider);

    // Header UI
    userAvatar.textContent = userAddress.substring(2, 4).toUpperCase();
    walletAddress.textContent = `${userAddress.slice(0, 8)}...${userAddress.slice(-4)}`;
    disconnectBtn.style.display = "flex";

    // Gate check
    await checkAccess();

    // Prevent duplicate listeners on reconnects
    extProvider.removeAllListeners?.();

    // Light listeners
    extProvider.on?.("accountsChanged", async (accounts) => {
      if (!accounts || accounts.length === 0) return disconnectWallet();
      userAddress = accounts[0];
      await checkAccess();
    });

    extProvider.on?.("chainChanged", async () => {
      provider = new ethers.providers.Web3Provider(extProvider, "any");
      tokenContract = new ethers.Contract(TOKEN_ADDRESS, ERC20_ABI, provider);
      await checkAccess();
    });

    extProvider.on?.("disconnect", () => disconnectWallet());

  } catch (err) {
    console.error(err);
    showNotification("Connection failed or cancelled.", "error");
  }
}

async function checkAccess() {
  try {
    // Double-ensure signer/address
    signer = provider.getSigner();
    userAddress = await signer.getAddress();

    const [rawBal, decimals, symbol] = await Promise.all([
      tokenContract.balanceOf(userAddress),
      tokenContract.decimals().catch(() => 18),
      tokenContract.symbol().catch(() => "TOKEN")
    ]);

    const human = Number(ethers.utils.formatUnits(rawBal, decimals));

    if (human >= REQUIRED_TOKENS) {
      connectSection.style.display = "none";
      moduleContent.style.display  = "block";
      showNotification(`Wallet connected. Balance: ${human.toLocaleString()} ${symbol}. Access granted.`, "success");
    } else {
      connectSection.style.display = "block";
      moduleContent.style.display  = "none";
      showNotification(`You have ${human.toLocaleString()} ${symbol}. Need at least ${REQUIRED_TOKENS} ${symbol} to unlock.`, "warning");
    }
  } catch (e) {
    console.error(e);
    showNotification("Could not read token balance. Check TOKEN_ADDRESS and network.", "error");
  }
}

async function disconnectWallet() {
  try {
    if (extProvider?.disconnect && typeof extProvider.disconnect === "function") {
      await extProvider.disconnect();
    }
  } catch (err) {
    console.warn("Provider disconnect failed:", err);
  }

  try {
    await web3Modal.clearCachedProvider();
  } catch (err) {
    console.warn("Clear cache failed:", err);
  }

  // Reset UI
  userAddress = null;
  provider = signer = tokenContract = null;

  userAvatar.textContent = "?";
  walletAddress.textContent = "Not connected";
  disconnectBtn.style.display = "none";
  connectSection.style.display = "block";
  moduleContent.style.display = "none";

  showNotification("Wallet disconnected", "info");
}

// ================== INIT (single source of truth) ==================
function init() {
  createParticles();
  setupModal();
  renderCourseMenu();
  loadProgress();
  updateUI();

  // Listeners
  connectWalletBtn.addEventListener('click', connectWallet);
  disconnectBtn.addEventListener('click', disconnectWallet);
  prevModuleBtn.addEventListener('click', () => navigateModule(-1));
  nextModuleBtn.addEventListener('click', () => navigateModule(1));
  openModalBtn.addEventListener('click', openModal);
  modalClose.addEventListener('click', closeModal);
  modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) closeModal(); });

  // Progress buttons
  document.getElementById('markCompleteBtn').addEventListener('click', () => {
    userProgress[currentModule] = 'completed';
    saveProgress();

    const statusIndicator = document.getElementById('modalStatusIndicator');
    const statusText = document.getElementById('modalStatusText');
    statusIndicator.className = 'status-indicator completed';
    statusText.textContent = 'Completed';

    const completed = Object.values(userProgress).filter(s => s === 'completed').length;
    if (completed === courseModules.length) {
      confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
      showNotification('Congratulations! You completed all modules!', 'success');
    } else {
      showNotification('Module marked as complete', 'success');
    }
  });

  document.getElementById('saveProgressBtn').addEventListener('click', () => {
    userProgress[currentModule] = 'in-progress';
    saveProgress();

    const statusIndicator = document.getElementById('modalStatusIndicator');
    const statusText = document.getElementById('modalStatusText');
    statusIndicator.className = 'status-indicator in-progress';
    statusText.textContent = 'In Progress';

    showNotification('Progress saved', 'info');
  });

  // Safe auto-reconnect after UI is ready
  if (web3Modal?.cachedProvider) {
    connectWallet().catch(() => {});
  }
}
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
