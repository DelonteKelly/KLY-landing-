
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KLY Legacy Course</title>
  <style>
    body {
      background-color: #0c0c0c;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 2rem;
      text-align: center;
    }
    section {
      background: #111;
      border-radius: 12px;
      padding: 2rem;
      margin: 2rem auto;
      max-width: 700px;
      box-shadow: 0 0 15px #00ffe066;
    }
    button {
      background: #00ffe0;
      color: #000;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 1rem;
    }
    .hidden { display: none; }
    h2 { color: #00ffe0; }
    .status { margin-top: 1rem; font-weight: bold; color: #0f0; }
  </style>
</head>
<body>

<section id="accessPanel">
  <h2>KLY Legacy Course</h2>
  <p>Complete the journey. Unlock legacy knowledge. Mint your NFT certification.</p>
  <button onclick="connectWallet()">Connect Wallet</button>
  <button onclick="verifyAccess()">Verify Access (500 KLY)</button>
  <p id="accessStatus" class="status"></p>
</section>

<section id="courseContent" class="hidden">
  <div id="module1" class="hidden">
    <h2>Module 1: Foundation</h2>
    <p>This module lays the groundwork for your journey into Web3 entrepreneurship...</p>
    <button onclick="showNextModule(2)">Next</button>
  </div>

  <div id="module2" class="hidden">
    <h2>Module 2: Tokenization</h2>
    <p>This module introduces the process of creating your own token using blockchain...</p>
    <button onclick="showNextModule(3)">Next</button>
  </div>

  <div id="module3" class="hidden">
    <h2>Module 3: Web3 Business</h2>
    <p>Learn how to create a token-powered business model using smart contracts...</p>
    <button onclick="showNextModule(4)">Next</button>
  </div>

  <div id="module4" class="hidden">
    <h2>Module 4: Credit & Capital</h2>
    <p>This module focuses on business credit, access to capital, and DeFi integrations...</p>
    <button onclick="showNextModule(5)">Next</button>
  </div>

  <div id="module5" class="hidden">
    <h2>Module 5: Ownership & Legacy</h2>
    <p>Protect and preserve your assets using trusts and wallet-based ownership models...</p>
    <button onclick="showNextModule('mint')">Complete Course</button>
  </div>

  <div id="mintSection" class="hidden">
    <h3>Claim Your NFT Certificate</h3>
    <button onclick="mintNFT()">Mint NFT</button>
    <p id="mintStatus" class="status"></p>
  </div>
</section>

<script>
    const KLY_TOKEN = "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52";
    const KLY_ABI = [{
      constant: true,
      inputs: [{ name: "account", type: "address" }],
      name: "balanceOf",
      outputs: [{ name: "", type: "uint256" }],
      type: "function"
    }];
    let wallet;

    async function connectWallet() {
      if (!window.ethereum) return alert("Please install MetaMask");
      const web3 = new Web3(window.ethereum);
      await window.ethereum.request({ method: "eth_requestAccounts" });
      const accounts = await web3.eth.getAccounts();
      wallet = accounts[0];
      document.getElementById("accessStatus").innerText = "Wallet connected: " + wallet.slice(0,6) + "..." + wallet.slice(-4);
    }

    async function verifyAccess() {
      if (!wallet) return alert("Connect your wallet first.");
      const web3 = new Web3(window.ethereum);
      const contract = new web3.eth.Contract(KLY_ABI, KLY_TOKEN);
      const balance = await contract.methods.balanceOf(wallet).call();
      const balanceEth = web3.utils.fromWei(balance, "ether");
      if (parseFloat(balanceEth) >= 500) {
        document.getElementById("accessPanel").classList.add("hidden");
        document.getElementById("courseContent").classList.remove("hidden");
        document.getElementById("module1").classList.remove("hidden");
      } else {
        document.getElementById("accessStatus").innerText = "Access Denied: You only hold " + balanceEth + " KLY";
      }
    }

    function showNextModule(id) {
      if (typeof id === 'number') {
        document.getElementById("module" + (id - 1)).classList.add("hidden");
        document.getElementById("module" + id).classList.remove("hidden");
      } else if (id === 'mint') {
        document.getElementById("module5").classList.add("hidden");
        document.getElementById("mintSection").classList.remove("hidden");
      }
    }

    async function mintNFT() {
      if (!wallet) return alert("Please connect your wallet first.");
      try {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();

        const nftContract = new ethers.Contract(
          "0xDA76d35742190283E340dbeE2038ecc978a56950",
          [
            {
              "inputs": [
                { "internalType": "address", "name": "to", "type": "address" },
                { "internalType": "int24", "name": "tickLower", "type": "int24" },
                { "internalType": "int24", "name": "tickUpper", "type": "int24" },
                { "internalType": "uint128", "name": "amount", "type": "uint128" },
                { "internalType": "bytes", "name": "data", "type": "bytes" }
              ],
              "name": "mint",
              "outputs": [],
              "stateMutability": "nonpayable",
              "type": "function"
            }
          ],
          signer
        );

        const tickLower = -600;
        const tickUpper = 600;
        const amount = 1;
        const data = "0x";

        const tx = await nftContract.mint(wallet, tickLower, tickUpper, amount, data);
        document.getElementById("mintStatus").innerText = "Minting in progress...";
        await tx.wait();
        document.getElementById("mintStatus").innerText = "NFT successfully minted!";
      } catch (error) {
        console.error("Minting failed:", error);
        document.getElementById("mintStatus").innerText = "Minting failed. Please try again.";
      }
    }
  </script>

</body>
</html>
