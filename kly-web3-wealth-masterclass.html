<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KLY Academy — Web3 Wealth Building Masterclass</title>
  <meta name="description" content="Token-gated masterclass with wallet connection, BNB Chain verification, and NFT certificate minting."/>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Rajdhani:wght@500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <!-- Web3 Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3modal@1.9.12/dist/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>

  <style>
    :root{
      --bg:#0a0a0c; --panel:#121217; --muted:#9c9ca8; --txt:#f4f4f6;
      --gold:#e6c15a; --gold-2:#9a7a2b; --ok:#3ddc97; --warn:#f39c12; --err:#ff5d5d;
      --edge:#1e1e25; --glow:0 0 20px rgba(230,193,90,.25), 0 0 60px rgba(230,193,90,.12);
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1000px 600px at 75% -10%,rgba(230,193,90,.08),transparent 60%),linear-gradient(180deg,#0a0a0c,#0a0a0c 40%,#0b0b11);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--gold);text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:24px 18px 80px}
    header{
      display:flex;align-items:center;justify-content:space-between;margin:8px 0 18px;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .brand .logo{font-family:Orbitron,Inter,sans-serif;letter-spacing:.5px;font-weight:700}
    .brand .logo span{color:var(--gold)}
    .chip{border:1px solid var(--edge);padding:10px 14px;border-radius:10px;background:#0e0e14;display:flex;gap:10px;align-items:center}
    .chip small{color:var(--muted)}
    .btn{
      background:linear-gradient(180deg,#1a1a22,#12121a);
      color:var(--txt);border:1px solid var(--edge);padding:12px 16px;border-radius:12px;
      font-weight:600;cursor:pointer;transition:all .2s ease;display:inline-flex;gap:10px;align-items:center
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(0,0,0,.35)}
    .btn.primary{border-color:rgba(230,193,90,.65);background:linear-gradient(180deg,#242117,#15130f);color:#fff;box-shadow:var(--glow)}
    .btn.ghost{background:transparent}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:22px}
    @media (max-width: 960px){.grid{grid-template-columns:1fr}}
    .panel{background:linear-gradient(180deg,#121217,#101015);border:1px solid var(--edge);border-radius:16px;padding:18px 18px 6px;box-shadow:inset 0 0 0 1px rgba(255,255,255,.02)}
    .hero{padding:20px 18px 24px}
    h1{font-family:Orbitron,Inter,sans-serif;margin:6px 0 10px;font-size:clamp(26px,3vw,34px);}
    h1 .accent{color:var(--gold);text-shadow:0 0 24px rgba(230,193,90,.25)}
    p.lead{color:#d9d9de;max-width:800px}
    .statbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .stat{background:#0e0e14;border:1px solid var(--edge);border-radius:10px;padding:10px 12px;display:flex;gap:8px;align-items:center}
    .locked{border:1px dashed rgba(230,193,90,.45);border-radius:12px;padding:14px 14px;background:rgba(230,193,90,.07);display:flex;gap:12px;align-items:flex-start;margin:12px 0}
    .locked i{color:var(--gold)}
    .cta{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .tag{color:#ddd;background:#0d0d13;border:1px solid var(--edge);padding:6px 10px;border-radius:999px;font-size:12px}
    .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);margin:16px -18px}
    .modules{padding:10px 0 16px}
    .module{border:1px solid var(--edge);border-radius:14px;background:#0d0d13;margin:12px 0;overflow:hidden}
    .module header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;cursor:pointer}
    .module header h3{margin:0;font-size:16px}
    .module .content{display:none;padding:12px 16px 18px;color:#e8e8ee}
    .module.open .content{display:block}
    .module .check{display:flex;gap:8px;align-items:center;color:#cfd0d8}
    .progress{margin:10px 0 4px;color:var(--muted)}
    .progressbar{height:10px;background:#121219;border:1px solid var(--edge);border-radius:8px;overflow:hidden}
    .progressbar > div{height:100%;width:0%;background:linear-gradient(90deg, rgba(230,193,90,.85), rgba(230,193,90,.35));box-shadow:var(--glow);transition:width .25s ease}
    .mint{padding:14px 16px 20px;display:flex;flex-direction:column;gap:8px}
    .note{font-size:13px;color:var(--muted)}
    .footer{margin-top:28px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;gap:14px;flex-wrap:wrap}
    .toast{position:fixed;bottom:18px;right:18px;background:#121217;border:1px solid var(--edge);color:#fff;padding:12px 16px;border-radius:10px;box-shadow:0 12px 40px rgba(0,0,0,.35);display:none;z-index:9999}
    .toast.show{display:block}
    code.inline{background:#15151d;border:1px solid var(--edge);padding:2px 6px;border-radius:6px;color:#eee}
    .kudos{display:flex;gap:10px;align-items:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" style="font-size:20px"><span>KLY</span> ACADEMY</div>
        <div class="chip">
          <i class="fa-solid fa-circle-nodes"></i>
          <div>
            <div style="font-weight:700">Web3 Wealth Building — Masterclass</div>
            <small>BNB Smart Chain • Token-gated</small>
          </div>
        </div>
      </div>

      <div class="kudos">
        <div id="networkChip" class="chip"><i class="fa-solid fa-signal"></i> <small>Network:</small> <span id="networkName">—</span></div>
        <button id="connectBtn" class="btn primary"><i class="fa-solid fa-wallet"></i> <span>Connect Wallet</span></button>
      </div>
    </header>

    <div class="grid">
      <section class="panel hero">
        <h1>Master the <span class="accent">New Wealth</span> — Sovereign, On‑Chain, Scalable.</h1>
        <p class="lead">Learn how to build, protect, and multiply wealth using Web3 tools — from DeFi income to utility NFTs and DAOs — inside the KLY + SólCoin ecosystem.</p>

        <div class="statbar">
          <div class="stat"><i class="fa-solid fa-lock"></i> Access requires <b style="margin:0 6px">≥ 500 KLY</b> <span class="tag">or enable SólCoin in config</span></div>
          <div class="stat"><i class="fa-brands fa-btc"></i> Chain: <b style="margin:0 6px">BNB Smart Chain</b> <span class="tag">Mainnet</span></div>
          <div class="stat"><i class="fa-solid fa-certificate"></i> On completion: <b style="margin:0 6px">Mint NFT Certificate</b></div>
        </div>

        <div id="lockedNotice" class="locked">
          <i class="fa-solid fa-shield-halved"></i>
          <div>
            <b>Course Locked.</b> Connect your wallet on BNB Chain and hold at least <b>500 KLY</b> to unlock modules.
            <div class="cta">
              <a id="buyKlyLink" class="btn ghost" href="#" target="_blank"><i class="fa-solid fa-coins"></i> Buy KLY</a>
              <a id="buySolLink" class="btn ghost" href="#" target="_blank"><i class="fa-solid fa-sun"></i> Buy SólCoin</a>
              <button id="recheckBtn" class="btn"><i class="fa-solid fa-rotate"></i> Re-check Access</button>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="progress"><span id="progressText">Progress: 0/7 complete</span></div>
        <div class="progressbar"><div id="progressBar"></div></div>
      </section>

      <aside class="panel">
        <div style="padding:14px 16px 8px">
          <div style="font-weight:700;margin-bottom:6px">Certificate Mint</div>
          <div class="note">After completing all modules, mint your on-chain certificate (ERC‑721) to your wallet.</div>
        </div>
        <div class="mint">
          <div class="note">Contract: <span id="nftAddr" class="tag"></span></div>
          <div class="note">Metadata URI: <code class="inline" id="nftUri"></code></div>
          <button id="mintBtn" class="btn primary" disabled><i class="fa-solid fa-stamp"></i> Mint Completion NFT</button>
          <small class="note">A small BNB gas fee applies. View on BscScan after mint.</small>
        </div>
        <div class="divider"></div>
        <div class="mint" style="padding-top:8px">
          <div style="font-weight:700;margin-bottom:6px">Quick Links</div>
          <a id="explorerLink" class="btn ghost" href="#" target="_blank"><i class="fa-solid fa-up-right-from-square"></i> View Course NFT Contract</a>
          <a id="supportLink" class="btn ghost" href="mailto:support@kellylegacyestates.com"><i class="fa-solid fa-headset"></i> Support</a>
        </div>
      </aside>
    </div>

    <section id="modules" class="panel modules" style="pointer-events:none;opacity:.5">
      <!-- 7 Modules -->
      <div class="module" data-id="1">
        <header><h3>Module 1 — The Sovereign Mindset of Wealth</h3> <div class="check"><input type="checkbox"/> Mark complete</div></header>
        <div class="content">
          <ul>
            <li>Money as energy + code. Rewriting scarcity patterns.</li>
            <li>Why Web3 = financial sovereignty revolution.</li>
            <li>Practice: Breath + visualization to anchor abundance.</li>
          </ul>
        </div>
      </div>

      <div class="module" data-id="2">
        <header><h3>Module 2 — Blockchain & Tokenomics Decoded</h3> <div class="check"><input type="checkbox"/> Mark complete</div></header>
        <div class="content">
          <ul>
            <li>How blockchains create value. Networks vs assets.</li>
            <li>ERC-20s, NFTs, stablecoins, L2s.</li>
            <li>Inflationary vs deflationary models, vesting, supply.</li>
          </ul>
        </div>
      </div>

      <div class="module" data-id="3">
        <header><h3>Module 3 — Wealth via Ecosystems</h3> <div class="check"><input type="checkbox"/> Mark complete</div></header>
        <div class="content">
          <ul>
            <li>Utility-first tokens vs hype cycles.</li>
            <li>The dual-token engine: KLY (govern) + SólCoin (utility).</li>
            <li>Practical: Wallet setup, portfolio tracking.</li>
          </ul>
        </div>
      </div>

      <div class="module" data-id="4">
        <header><h3>Module 4 — DeFi Mastery</h3> <div class="check"><input type="checkbox"/> Mark complete</div></header>
        <div class="content">
          <ul>
            <li>Staking, farming, LPs — risk/reward.</li>
            <li>Stable income frameworks.</li>
            <li>Practical: Stake KLY/SólCoin inside the Vault.</li>
          </ul>
        </div>
      </div>

      <div class="module" data-id="5">
        <header><h3>Module 5 — NFTs as Wealth Vehicles</h3> <div class="check"><input type="checkbox"/> Mark complete</div></header>
        <div class="content">
          <ul>
            <li>NFTs as access, identity, and digital property.</li>
            <li>Case studies and market navigation.</li>
            <li>Practical: Mint your utility NFT and list.</li>
          </ul>
        </div>
      </div>

      <div class="module" data-id="6">
        <header><h3>Module 6 — Multiple Web3 Income Streams</h3> <div class="check"><input type="checkbox"/> Mark complete</div></header>
        <div class="content">
          <ul>
            <li>Freelancing with crypto payouts.</li>
            <li>Launching token or NFT projects.</li>
            <li>DAOs, content monetization, A.I. + Web3.</li>
          </ul>
        </div>
      </div>

      <div class="module" data-id="7">
        <header><h3>Module 7 — Sovereign Wealth Strategy</h3> <div class="check"><input type="checkbox"/> Mark complete</div></header>
        <div class="content">
          <ul>
            <li>Personal sovereignty plan: crypto + trust + PMA.</li>
            <li>Asset protection in a digital world.</li>
            <li>Compounding long-term with KLY + SólCoin.</li>
          </ul>
        </div>
      </div>
    </section>

    <div class="footer">
      <div>© <span id="year"></span> KLY Legacy — All rights reserved.</div>
      <div>Built with ❤️ for the Tribe • <span class="tag">v1.0</span></div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // ---------- CONFIG ----------
    const CONFIG = {
      chainId: 56, // BNB Smart Chain Mainnet
      chainHex: '0x38',
      chainName: 'BNB Smart Chain',
      rpcUrls: ['https://bsc-dataseed.binance.org/'],
      explorerBase: 'https://bscscan.com',
      // Token addresses
      klyToken: '0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52', // Official KLY (per your project context)
      solToken: '', // OPTIONAL: set if you want to allow SólCoin as an alternative gate
      minAccessKLY: '500', // human units
      // NFT Certificate (Thirdweb ERC-721)
      courseNftContract: '0xDA76d35742190283E340dbeE2038ecc978a56950',
      certificateUri: 'ipfs://PUT-YOUR-CERT-METADATA-URI-HERE' // <-- replace with your metadata URI
    };

    // ---------- STATE ----------
    let web3Modal, provider, ethersProvider, signer, userAddress = null;
    let klyDecimals = 18, solDecimals = 18;
    const ERC20_ABI = [
      'function balanceOf(address) view returns (uint256)',
      'function decimals() view returns (uint8)',
      'function symbol() view returns (string)'
    ];
    const ERC721_ABI = [
      'function mintTo(address to, string uri) public'
    ];

    // ---------- UTIL ----------
    const $ = (q) => document.querySelector(q);
    const $all = (q) => Array.from(document.querySelectorAll(q));
    const showToast = (msg, kind='info') => {
      const el = $('#toast'); el.textContent = msg;
      el.style.borderColor = kind==='error' ? 'var(--err)' : (kind==='warn' ? 'var(--warn)' : 'var(--edge)');
      el.classList.add('show'); setTimeout(()=>el.classList.remove('show'), 3600);
    };
    const fmt = (v, d=4) => {
      try{
        if (typeof v === 'string') return v;
        return Number(v).toLocaleString(undefined, {maximumFractionDigits:d});
      }catch{ return String(v);}
    };
    const lsKey = (addr) => `masterclass_progress_${(addr||'guest').toLowerCase()}`;

    // ---------- INIT ----------
    window.addEventListener('load', () => {
      $('#year').textContent = new Date().getFullYear();
      $('#nftAddr').textContent = CONFIG.courseNftContract;
      $('#nftUri').textContent = CONFIG.certificateUri;
      $('#explorerLink').href = `${CONFIG.explorerBase}/address/${CONFIG.courseNftContract}`;

      initModulesUI();
      initWeb3Modal();
      bindUI();
      updateNetworkChip();
    });

    function initWeb3Modal(){
      const providerOptions = {
        walletconnect: {
          package: window.WalletConnectProvider.default,
          options: { rpc: { [CONFIG.chainId]: CONFIG.rpcUrls[0] } }
        }
      };
      web3Modal = new window.Web3Modal.default({ cacheProvider: true, providerOptions, theme: 'dark' });
      if (web3Modal.cachedProvider) connectWallet();
    }

    function bindUI(){
      $('#connectBtn').addEventListener('click', connectWallet);
      $('#recheckBtn').addEventListener('click', checkAccess);
      $('#mintBtn').addEventListener('click', mintCertificate);

      // accordion behavior
      $all('.module header').forEach(h=>{
        h.addEventListener('click', (e)=>{
          if (e.target.tagName.toLowerCase()==='input') return;
          h.parentElement.classList.toggle('open');
        });
      });
      // module completion
      $all('.module .check input').forEach(chk=>{
        chk.addEventListener('change', ()=>{
          saveProgress();
          refreshProgress();
        });
      });
    }

    function updateNetworkChip(name){
      $('#networkName').textContent = name || '—';
    }

    function initModulesUI(){
      // initial locked state
      lockCourse(true);
      refreshProgress();
    }

    function lockCourse(flag){
      const modules = $('#modules');
      modules.style.pointerEvents = flag ? 'none' : 'auto';
      modules.style.opacity = flag ? '.5' : '1';
      $('#lockedNotice').style.display = flag ? 'flex' : 'none';
    }

    async function connectWallet(){
      try{
        provider = await web3Modal.connect();
        provider.on('accountsChanged', handleAccountChange);
        provider.on('chainChanged', handleChainChange);
        provider.on('disconnect', resetConnection);

        ethersProvider = new ethers.providers.Web3Provider(provider);
        signer = ethersProvider.getSigner();
        userAddress = (await signer.getAddress());
        $('#connectBtn').innerHTML = `<i class="fa-solid fa-wallet"></i> ${userAddress.slice(0,6)}…${userAddress.slice(-4)}`;

        const net = await ethersProvider.getNetwork();
        updateNetworkChip(net.name || `Chain ${net.chainId}`);
        if (net.chainId !== CONFIG.chainId){
          await switchToBSC();
        }
        await checkAccess();
        loadProgress();
      }catch(err){
        console.error(err); showToast('Wallet connection canceled or failed','warn');
      }
    }

    async function switchToBSC(){
      try{
        await provider.request({ method:'wallet_switchEthereumChain', params:[{ chainId: CONFIG.chainHex }]});
        const net = await ethersProvider.getNetwork();
        updateNetworkChip(net.name || `Chain ${net.chainId}`);
      }catch(switchErr){
        // try to add
        if (switchErr.code === 4902){
          try{
            await provider.request({ method:'wallet_addEthereumChain', params:[{
              chainId: CONFIG.chainHex, chainName: CONFIG.chainName,
              rpcUrls: CONFIG.rpcUrls, nativeCurrency:{ name:'BNB', symbol:'BNB', decimals:18 },
              blockExplorerUrls:[CONFIG.explorerBase]
            }]});
          }catch(addErr){
            console.error(addErr); showToast('Please switch to BNB Smart Chain in your wallet','warn');
          }
        }else{
          console.error(switchErr); showToast('Please switch to BNB Smart Chain','warn');
        }
      }
    }

    async function handleAccountChange(accs){ if (!accs || accs.length===0){ resetConnection(); } else { userAddress = accs[0]; loadProgress(); await checkAccess(); } }
    async function handleChainChange(){ const net = await ethersProvider.getNetwork(); updateNetworkChip(net.name || `Chain ${net.chainId}`); await checkAccess(); }
    function resetConnection(){ userAddress = null; $('#connectBtn').innerHTML = '<i class="fa-solid fa-wallet"></i> Connect Wallet'; lockCourse(true); showToast('Disconnected','warn'); }

    async function checkAccess(){
      if (!ethersProvider || !signer || !userAddress){ showToast('Connect wallet to verify access','warn'); return; }
      try{
        const kly = new ethers.Contract(CONFIG.klyToken, ERC20_ABI, ethersProvider);
        klyDecimals = await kly.decimals();
        const bal = await kly.balanceOf(userAddress);
        const needed = ethers.utils.parseUnits(CONFIG.minAccessKLY, klyDecimals);
        const hasKly = bal.gte(needed);

        let hasSol = false;
        if (CONFIG.solToken){
          const sol = new ethers.Contract(CONFIG.solToken, ERC20_ABI, ethersProvider);
          solDecimals = await sol.decimals();
          const solBal = await sol.balanceOf(userAddress);
          // If you want SólCoin threshold, mirror KLY or set your own logic
          const solNeeded = ethers.utils.parseUnits(CONFIG.minAccessKLY, solDecimals);
          hasSol = solBal.gte(solNeeded);
        }

        const granted = hasKly || hasSol;
        if (granted){
          lockCourse(false);
          showToast('Access granted — modules unlocked ✅','success');
        }else{
          lockCourse(true);
          const humanBal = Number(ethers.utils.formatUnits(bal, klyDecimals));
          showToast(`Access requires ≥ ${CONFIG.minAccessKLY} KLY. Your KLY: ${fmt(humanBal)}.`,'warn');
        }
        return granted;
      }catch(err){
        console.error(err);
        showToast('Failed to check token balance. Make sure you are on BNB Chain.','error');
        lockCourse(true);
        return false;
      }
    }

    // ---------- PROGRESS ----------
    function loadProgress(){
      const data = JSON.parse(localStorage.getItem(lsKey(userAddress)) || '{}');
      $all('.module').forEach(mod=>{
        const id = mod.getAttribute('data-id');
        const chk = mod.querySelector('.check input');
        chk.checked = !!data[id];
      });
      refreshProgress();
    }
    function saveProgress(){
      const data = {};
      $all('.module').forEach(mod=>{
        const id = mod.getAttribute('data-id');
        const chk = mod.querySelector('.check input');
        data[id] = chk.checked;
      });
      localStorage.setItem(lsKey(userAddress), JSON.stringify(data));
    }
    function refreshProgress(){
      const total = $all('.module').length;
      const done = $all('.module .check input:checked').length;
      $('#progressText').textContent = `Progress: ${done}/${total} complete`;
      $('#progressBar').style.width = `${Math.round((done/total)*100)}%`;
      // enable mint when all complete
      $('#mintBtn').disabled = !(done === total);
    }

    // ---------- MINT ----------
    async function mintCertificate(){
      try{
        if (!await checkAccess()){ showToast('Unlock access before minting','warn'); return; }
        if (!userAddress) { showToast('Connect wallet first','warn'); return; }
        if (!CONFIG.certificateUri || CONFIG.certificateUri.includes('PUT-YOUR-CERT-METADATA-URI')){
          showToast('Configure certificate metadata URI in CONFIG first.','warn'); return;
        }
        const net = await ethersProvider.getNetwork();
        if (net.chainId !== CONFIG.chainId){ await switchToBSC(); }

        const nft = new ethers.Contract(CONFIG.courseNftContract, ERC721_ABI, signer);
        const tx = await nft.mintTo(userAddress, CONFIG.certificateUri);
        showToast('Minting… waiting for confirmation');
        const rec = await tx.wait();
        showToast('Certificate minted! View on BscScan.');
        if (rec && rec.transactionHash){
          window.open(`${CONFIG.explorerBase}/tx/${rec.transactionHash}`, '_blank');
        }
      }catch(err){
        console.error(err);
        // Handle common Thirdweb revert / access errors gracefully
        const msg = (err && (err.data?.message || err.error?.message || err.message)) || 'Mint failed';
        showToast(msg, 'error');
      }
    }
  </script>
</body>
</html>
