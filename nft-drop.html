<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frequency Key | Web3 NFT Drop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6e45e2;
            --secondary: #88d3ce;
            --dark: #1a1a2e;
            --light: #f1f1f1;
            --success: #4CAF50;
            --warning: #FF9800;
            --glow: 0 0 10px rgba(110, 69, 226, 0.7);
            --glow-success: 0 0 10px rgba(76, 175, 80, 0.7);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background-color: var(--dark);
            color: var(--light);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(110, 69, 226, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(136, 211, 206, 0.1) 0%, transparent 20%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .connect-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            color: var(--light);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--glow);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(110, 69, 226, 0.9);
        }
        
        .connect-btn.connected {
            background: linear-gradient(45deg, var(--success), #8BC34A);
            box-shadow: var(--glow-success);
        }
        
        .hero {
            text-align: center;
            margin: 3rem 0;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .countdown {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .countdown-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            min-width: 80px;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        
        .countdown-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary);
        }
        
        .countdown-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
        }
        
        .nft-display {
            display: flex;
            justify-content: center;
            margin: 3rem 0;
            perspective: 1000px;
        }
        
        .nft-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--glow);
            transition: all 0.5s ease;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        .nft-card:hover {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: 0 15px 30px rgba(110, 69, 226, 0.4);
        }
        
        .nft-image {
            width: 100%;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .nft-image:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .nft-title {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--light);
        }
        
        .nft-description {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .mint-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            padding: 1rem 2rem;
            border-radius: 30px;
            color: var(--light);
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--glow);
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .mint-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(110, 69, 226, 0.5);
        }
        
        .mint-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .mint-btn.connected {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
        }
        
        .mint-btn.minted {
            background: linear-gradient(45deg, var(--success), #8BC34A);
            box-shadow: var(--glow-success);
        }
        
        .info-section {
            margin: 4rem 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--glow);
        }
        
        .info-card h3 {
            color: var(--secondary);
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-card p {
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
        }
        
        footer {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 2rem;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        
        .mint-status {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--secondary);
        }
        
        .network-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            display: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: var(--dark);
            padding: 2rem;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--primary);
            box-shadow: var(--glow);
            text-align: center;
        }
        
        .modal h2 {
            margin-bottom: 1rem;
            color: var(--secondary);
        }
        
        .modal p {
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .modal-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .modal-btn:hover {
            background: var(--secondary);
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .countdown {
                flex-wrap: wrap;
            }
            
            .nft-card {
                padding: 1.5rem;
            }
            
            .logo {
                font-size: 1.2rem;
            }
            
            .connect-btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles-js"></div>
    
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-key"></i> Frequency Key
            </div>
            <button class="connect-btn" id="connectWallet">
                <i class="fas fa-wallet"></i> Connect Wallet
            </button>
        </header>
        
        <section class="hero">
            <h1>FREQUENCY KEY NFT DROP</h1>
            <p>Unlock the next dimension of digital ownership with this exclusive Web3 collectible. Each Frequency Key is a unique artifact in the blockchain universe.</p>
            
            <div class="countdown">
                <div class="countdown-item">
                    <div class="countdown-number" id="days">00</div>
                    <div class="countdown-label">Days</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-number" id="hours">00</div>
                    <div class="countdown-label">Hours</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-number" id="minutes">00</div>
                    <div class="countdown-label">Minutes</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-number" id="seconds">00</div>
                    <div class="countdown-label">Seconds</div>
                </div>
            </div>
        </section>
        
        <section class="nft-display">
            <div class="nft-card">
                <img src="https://gateway.pinata.cloud/ipfs/bafybeifssvwf74gv25c3r76cxfdqraerll7l4kgruqaox6cskrqsu2e2by" alt="Frequency Key" class="nft-image">
                <h2 class="nft-title">Frequency Key #001</h2>
                <p class="nft-description">This unique digital artifact represents access to higher vibrational states in the metaverse. Holders gain exclusive benefits across multiple Web3 platforms.</p>
                <button class="mint-btn" id="mintButton" disabled>
                    <i class="fas fa-lock"></i> CONNECT TO MINT
                </button>
                <div class="mint-status" id="mintStatus"></div>
            </div>
        </section>
        
        <section class="info-section">
            <div class="info-card">
                <h3><i class="fas fa-info-circle"></i> About Frequency Keys</h3>
                <p>Frequency Keys are algorithmically generated digital artifacts that exist on the Ethereum blockchain. Each key has unique properties that may unlock special features in future metaverse applications.</p>
            </div>
            <div class="info-card">
                <h3><i class="fas fa-gem"></i> Utility & Benefits</h3>
                <p>Key holders will receive airdrops, whitelist spots for future drops, and access to exclusive content. The keys may also function as access tokens in upcoming virtual worlds.</p>
            </div>
            <div class="info-card">
                <h3><i class="fas fa-cog"></i> Technical Details</h3>
                <p>ERC-721A standard. Minted on Ethereum. Stored on IPFS. 10,000 unique keys with varying rarity traits. 0.08 ETH mint price (plus gas).</p>
            </div>
        </section>
        
        <footer>
            <p>© 2023 Frequency Key Project. All rights reserved.</p>
        </footer>
    </div>
    
    <div class="network-info" id="networkInfo"></div>
    
    <div class="modal" id="successModal">
        <div class="modal-content">
            <h2><i class="fas fa-check-circle"></i> Mint Successful!</h2>
            <p>Your Frequency Key NFT has been minted successfully. It may take a few minutes to appear in your wallet.</p>
            <p>You can view your transaction on <a href="#" id="txLink" target="_blank" style="color: var(--secondary);">Etherscan</a>.</p>
            <button class="modal-btn" id="closeModal">Close</button>
        </div>
    </div>
    
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <h2><i class="fas fa-exclamation-triangle"></i> Error Occurred</h2>
            <p id="errorMessage">There was an issue with your transaction. Please try again.</p>
            <button class="modal-btn" id="closeErrorModal">Close</button>
        </div>
    </div>

<!-- Ethers.js + Wallet Connect + Mint Script -->
<script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" 
        integrity="sha384-0Q3z3Q5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5p5"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js" defer></script>
<script>
  // First verify critical dependencies are loaded
  function checkDependencies() {
    const errors = [];
    
    if (typeof ethers === 'undefined') {
      errors.push('Ethers.js library failed to load');
    }
    
    if (errors.length > 0) {
      const errorMsg = `Critical errors detected:\n${errors.join('\n')}\n\nPlease refresh the page.`;
      console.error(errorMsg);
      alert(errorMsg);
      return false;
    }
    
    return true;
  }

  // Main initialization function
  async function initializeApp() {
    if (!checkDependencies()) return;

    try {
      // Initialize particles.js background (non-critical)
      initializeParticles();
      
      // Setup countdown timer
      setupCountdown();
      
      // Initialize Web3 functionality
      await initializeWeb3();
      
    } catch (error) {
      console.error('Initialization error:', error);
      showError('Initialization failed: ' + error.message);
    }
  }

  function initializeParticles() {
    if (typeof particlesJS !== 'undefined') {
      try {
        particlesJS('particles-js', {
          particles: {
            number: { value: 80, density: { enable: true, value_area: 800 } },
            color: { value: "#6e45e2" },
            shape: { type: "circle" },
            opacity: { value: 0.5, random: true },
            size: { value: 3, random: true },
            line_linked: { enable: true, distance: 150, color: "#88d3ce", opacity: 0.4, width: 1 },
            move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
          },
          interactivity: {
            detect_on: "canvas",
            events: {
              onhover: { enable: true, mode: "repulse" },
              onclick: { enable: true, mode: "push" }
            }
          }
        });
      } catch (e) {
        console.warn('Particles.js initialization failed:', e);
      }
    }
  }

  function setupCountdown() {
    const countdownDate = new Date();
    countdownDate.setDate(countdownDate.getDate() + 7);
    
    const updateCountdown = () => {
      try {
        const now = new Date().getTime();
        const distance = countdownDate - now;
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        document.getElementById("days").textContent = String(days).padStart(2, "0");
        document.getElementById("hours").textContent = String(hours).padStart(2, "0");
        document.getElementById("minutes").textContent = String(minutes).padStart(2, "0");
        document.getElementById("seconds").textContent = String(seconds).padStart(2, "0");

        if (distance < 0) {
          clearInterval(countdownInterval);
          const mintButton = document.getElementById("mintButton");
          if (mintButton) {
            mintButton.innerHTML = '<i class="fas fa-bolt"></i> MINT NOW';
            mintButton.disabled = false;
          }
          const mintStatus = document.getElementById("mintStatus");
          if (mintStatus) mintStatus.textContent = "Minting is now live!";
        }
      } catch (e) {
        console.error('Countdown error:', e);
        clearInterval(countdownInterval);
      }
    };

    const countdownInterval = setInterval(updateCountdown, 1000);
    updateCountdown();
  }

  // Web3 Initialization
  async function initializeWeb3() {
    const contractAddress = "0xDA76d35742190283E340dbeE2038ecc978a56950";
    const contractABI = [/* Your ABI here */];
    const metadataURI = "ipfs://bafybeifssvwf74gv25c3r76cxfdqraerll7l4kgruqaox6cskrqsu2e2by";

    let provider, signer, contract;
    const connectBtn = document.getElementById("connectWallet");
    const mintBtn = document.getElementById("mintButton");
    const mintStatus = document.getElementById("mintStatus");

    // Check initial wallet connection
    await checkWalletConnection();

    // Event listeners
    if (connectBtn) connectBtn.addEventListener("click", connectWallet);
    if (mintBtn) mintBtn.addEventListener("click", mintNFT);

    async function checkWalletConnection() {
      if (!window.ethereum) {
        updateMintStatus("MetaMask or other Web3 wallet is required to mint.");
        return;
      }

      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        const accounts = await provider.listAccounts();
        
        if (accounts.length > 0) {
          await connectWallet();
        } else {
          if (mintBtn) {
            mintBtn.innerHTML = '<i class="fas fa-lock"></i> CONNECT TO MINT';
            mintBtn.disabled = true;
          }
        }
      } catch (err) {
        console.error("Wallet connection check failed:", err);
        updateMintStatus("Error checking wallet connection");
      }
    }

    async function connectWallet() {
      if (!window.ethereum) {
        updateMintStatus("MetaMask is required to mint. Please install it.");
        showError("MetaMask is required to mint. Please install it.");
        return;
      }

      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const address = await signer.getAddress();
        
        // Update UI
        if (connectBtn) {
          connectBtn.innerHTML = `<i class="fas fa-check-circle"></i> ${address.slice(0, 6)}...${address.slice(-4)}`;
          connectBtn.classList.add("connected");
        }
        
        if (mintBtn) {
          mintBtn.innerHTML = '<i class="fas fa-bolt"></i> MINT NOW';
          mintBtn.disabled = false;
          mintBtn.classList.add("connected");
        }
        
        updateMintStatus("Wallet connected. You can now mint your Frequency Key.");
        
        // Initialize contract
        contract = new ethers.Contract(contractAddress, contractABI, signer);
        
        // Check network
        const network = await provider.getNetwork();
        const networkInfo = document.getElementById("networkInfo");
        if (network.chainId !== 1) {
          if (networkInfo) {
            networkInfo.textContent = `Please switch to Ethereum Mainnet (Currently on ${network.name})`;
            networkInfo.style.display = "block";
          }
          updateMintStatus("Wrong network detected. Please switch to Ethereum Mainnet.");
          if (mintBtn) mintBtn.disabled = true;
        } else if (networkInfo) {
          networkInfo.style.display = "none";
        }
        
        // Check if user already minted
        const balance = await contract.balanceOf(address);
        if (balance.gt(0) && mintBtn) {
          mintBtn.innerHTML = '<i class="fas fa-check"></i> ALREADY MINTED';
          mintBtn.disabled = true;
          mintBtn.classList.add("minted");
          updateMintStatus("You already own a Frequency Key!");
        }
      } catch (err) {
        console.error("Wallet connection failed:", err);
        updateMintStatus("Failed to connect wallet: " + err.message);
        showError("Failed to connect wallet: " + err.message);
      }
    }

    async function mintNFT() {
      if (!signer || !contract) {
        updateMintStatus("Please connect your wallet first.");
        return;
      }

      try {
        if (mintBtn) {
          mintBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> MINTING...';
          mintBtn.disabled = true;
        }
        updateMintStatus("Processing your transaction...");
        
        const userAddress = await signer.getAddress();
        const tx = await contract.mintTo(userAddress, metadataURI);
        
        updateMintStatus("Transaction sent! Waiting for confirmation...");
        
        const receipt = await tx.wait();
        
        // Success!
        if (mintBtn) {
          mintBtn.innerHTML = '<i class="fas fa-check"></i> MINTED!';
          mintBtn.disabled = true;
          mintBtn.classList.add("minted");
        }
        updateMintStatus("Success! Your Frequency Key has been minted.");
        
        // Show success modal with transaction link
        const txLink = document.getElementById("txLink");
        const successModal = document.getElementById("successModal");
        if (txLink && successModal) {
          txLink.href = `https://etherscan.io/tx/${tx.hash}`;
          successModal.style.display = "flex";
        }
      } catch (err) {
        console.error("Mint error:", err);
        
        let errorMsg = "Mint failed";
        if (err.message.includes("user rejected transaction")) {
          errorMsg = "Transaction rejected by user";
        } else if (err.message.includes("insufficient funds")) {
          errorMsg = "Insufficient funds for transaction";
        } else if (err.message.includes("already minted")) {
          errorMsg = "You've already minted a Frequency Key";
        } else {
          errorMsg = err.message;
        }
        
        if (mintBtn) {
          mintBtn.innerHTML = '<i class="fas fa-bolt"></i> MINT NOW';
          mintBtn.disabled = false;
        }
        updateMintStatus(errorMsg);
        showError(errorMsg);
      }
    }

    function updateMintStatus(message) {
      const mintStatus = document.getElementById("mintStatus");
      if (mintStatus) mintStatus.textContent = message;
    }

    function showError(message) {
      const errorMessage = document.getElementById("errorMessage");
      const errorModal = document.getElementById("errorModal");
      if (errorMessage && errorModal) {
        errorMessage.textContent = message;
        errorModal.style.display = "flex";
      }
    }

    // Handle account/network changes
    if (window.ethereum) {
      window.ethereum.on("accountsChanged", (accounts) => {
        if (accounts.length === 0) {
          // Wallet disconnected
          if (connectBtn) {
            connectBtn.innerHTML = '<i class="fas fa-wallet"></i> Connect Wallet';
            connectBtn.classList.remove("connected");
          }
          if (mintBtn) {
            mintBtn.innerHTML = '<i class="fas fa-lock"></i> CONNECT TO MINT';
            mintBtn.disabled = true;
            mintBtn.classList.remove("connected", "minted");
          }
          updateMintStatus("");
          const networkInfo = document.getElementById("networkInfo");
          if (networkInfo) networkInfo.style.display = "none";
        } else {
          // Account changed
          connectWallet();
        }
      });

      window.ethereum.on("chainChanged", () => {
        window.location.reload();
      });
    }
  }

  // Start the application when DOM is ready
  document.addEventListener("DOMContentLoaded", initializeApp);
</script>
</body>
</html>
