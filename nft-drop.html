<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KLY Genesis NFT Drop | BNB Chain</title>
  <meta name="description" content="Mint your exclusive KLY Genesis NFT on BNB Chain - Limited edition digital collectibles">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --primary: #00ffe7;
      --secondary: #ff00aa;
      --dark: #050505;
      --darker: #0a0a0a;
      --light: #e0e0e0;
      --error: #ff5555;
      --success: #00ff88;
      --bnb-yellow: #F0B90B;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      background: linear-gradient(135deg, var(--dark), var(--darker));
      color: var(--light);
      font-family: 'Rajdhani', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 30%, rgba(0, 255, 231, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 80% 70%, rgba(255, 0, 170, 0.1) 0%, transparent 20%);
      z-index: -1;
    }
    
    .container {
      max-width: 800px;
      width: 100%;
      background: rgba(15, 15, 15, 0.8);
      border-radius: 16px;
      padding: 2.5rem;
      box-shadow: 0 0 25px rgba(0, 255, 231, 0.3);
      border: 1px solid rgba(0, 255, 231, 0.2);
      backdrop-filter: blur(10px);
      text-align: center;
    }
    
    h1 {
      font-family: 'Orbitron', sans-serif;
      color: var(--primary);
      text-shadow: 0 0 10px var(--primary);
      margin-bottom: 1.5rem;
      font-size: 2.5rem;
      letter-spacing: 1px;
    }
    
    .network-badge {
      display: inline-block;
      background: rgba(240, 185, 11, 0.2);
      color: var(--bnb-yellow);
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      border: 1px solid var(--bnb-yellow);
    }
    
    .subtitle {
      color: var(--light);
      margin-bottom: 2rem;
      font-size: 1.2rem;
      opacity: 0.9;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .nft-preview {
      width: 300px;
      height: 300px;
      margin: 0 auto 2rem;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid var(--primary);
      box-shadow: 0 0 20px rgba(0, 255, 231, 0.3);
      position: relative;
    }
    
    .nft-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .nft-preview::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        135deg,
        rgba(0, 255, 231, 0.1) 0%,
        rgba(255, 0, 170, 0.1) 100%
      );
      pointer-events: none;
    }
    
    .btn {
      padding: 1rem 2rem;
      margin: 0.5rem;
      font-family: 'Orbitron', sans-serif;
      font-weight: bold;
      font-size: 1.1rem;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #000;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(0, 255, 231, 0.5);
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--secondary), var(--primary));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 25px rgba(255, 0, 170, 0.7);
    }
    
    .btn:hover::before {
      opacity: 1;
    }
    
    .btn:disabled {
      background: #555;
      box-shadow: none;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn:disabled:hover::before {
      opacity: 0;
    }
    
    .btn-secondary {
      background: rgba(240, 185, 11, 0.1);
      color: var(--bnb-yellow);
      box-shadow: none;
      border: 1px solid var(--bnb-yellow);
    }
    
    .btn-secondary:hover {
      background: rgba(240, 185, 11, 0.2);
    }
    
    .wallet-display {
      margin: 1.5rem 0;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      border: 1px solid rgba(0, 255, 231, 0.2);
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      word-break: break-all;
    }
    
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
      background: var(--error);
    }
    
    .status-indicator.connected {
      background: var(--success);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(0, 255, 136, 0); }
      100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); }
    }
    
    .status-text {
      margin: 1rem 0;
      font-size: 1.1rem;
      min-height: 2rem;
    }
    
    .error-text {
      color: var(--error);
      margin: 1rem 0;
      min-height: 2rem;
      font-size: 1rem;
    }
    
    .success-text {
      color: var(--success);
      margin: 1rem 0;
    }
    
    .info-box {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 2rem 0;
      border: 1px solid rgba(0, 255, 231, 0.2);
      text-align: left;
    }
    
    .info-box h3 {
      color: var(--primary);
      margin-bottom: 1rem;
      font-family: 'Orbitron', sans-serif;
    }
    
    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .info-row:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .info-label {
      color: var(--primary);
      font-weight: bold;
    }
    
    .mint-progress {
      width: 100%;
      height: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      margin: 1.5rem 0;
      overflow: hidden;
    }
    
    .mint-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      width: 0%;
      transition: width 0.5s ease;
    }
    
    .action-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
      margin: 1.5rem 0;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(15, 15, 15, 0.95);
      border-left: 4px solid var(--primary);
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transform: translateX(120%);
      transition: transform 0.3s ease;
      z-index: 1000;
      max-width: 350px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.error {
      border-left-color: var(--error);
    }
    
    .notification.success {
      border-left-color: var(--success);
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 1.5rem;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .nft-preview {
        width: 250px;
        height: 250px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>KLY GENESIS NFT DROP</h1>
    <div class="network-badge">
      <i class="fab fa-btc"></i> BNB Chain
    </div>
    <p class="subtitle">Exclusive limited edition NFT collection for early supporters of the KLY ecosystem</p>
    
    <div class="nft-preview">
      <img src="https://ipfs.io/ipfs/bafybeihkmkaf2mgx7xkrnkhmzd2uvhr6ddgj6z3vkqcgnvlaa3z7x263r4" alt="KLY Genesis NFT Preview" id="nftImage">
    </div>
    
    <div class="mint-progress">
      <div class="mint-progress-bar" id="mintProgressBar"></div>
    </div>
    
    <div class="info-box">
      <h3>Collection Details</h3>
      <div class="info-row">
        <span class="info-label">Total Supply:</span>
        <span id="totalSupply">-</span>
      </div>
      <div class="info-row">
        <span class="info-label">Minted:</span>
        <span id="mintedCount">-</span>
      </div>
      <div class="info-row">
        <span class="info-label">Price:</span>
        <span id="mintPrice">- BNB</span>
      </div>
      <div class="info-row">
        <span class="info-label">Contract:</span>
        <span id="contractAddress">0xc1a2...d5C5</span>
      </div>
    </div>
    
    <div class="wallet-display" id="walletDisplay">
      <span id="statusIndicator" class="status-indicator"></span>
      <span id="walletAddress">Not connected</span>
    </div>
    
    <div class="action-buttons">
      <button class="btn" id="connectBtn" onclick="connectWallet()">
        <i class="fas fa-wallet"></i> Connect Wallet
      </button>
      <button class="btn" id="mintBtn" onclick="showMintForm()" disabled>
        <i class="fas fa-coins"></i> Mint NFT
      </button>
      <button class="btn btn-secondary" id="viewCollectionBtn" onclick="viewCollection()">
        <i class="fas fa-external-link-alt"></i> View Collection
      </button>
    </div>
    
    <div id="mintForm" style="display: none; width: 100%; max-width: 400px; margin: 1rem auto;">
      <div style="margin-bottom: 1.5rem;">
        <label for="mintAmount" style="display: block; margin-bottom: 0.5rem; text-align: left; color: var(--primary);">Mint Amount (Max 5)</label>
        <input type="number" id="mintAmount" min="1" max="5" value="1" 
               style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--primary); background: rgba(0,0,0,0.5); color: white; font-family: 'Rajdhani', sans-serif;">
      </div>
      <button class="btn" id="confirmMintBtn" onclick="mintNFT()" style="width: 100%;">
        <i class="fas fa-check-circle"></i> Confirm Mint
      </button>
    </div>
    
    <div class="status-text" id="statusText">
      Connect your wallet to mint your KLY Genesis NFT
    </div>
    
    <div class="error-text" id="errorText"></div>
    
    <div class="success-text" id="successText" style="display: none;"></div>
  </div>
  
  <div class="notification" id="notification"></div>

<!-- Ethers.js -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<script>
const CONTRACT_ADDRESS = "0xc1a2E9A475779EfD04247EA473638717E26cd5C5";
const BSC_CHAIN_ID = 56;
const BSC_RPC_URL = "https://bsc-dataseed.binance.org/";
const METADATA_URI = "ipfs://bafybeihkmkaf2mgx7xkrnkhmzd2uvhr6ddgj6z3vkqcgnvlaa3z7x263r4";

// ABI
const ABI = [
  {
    "inputs": [
      { "internalType": "address", "name": "_to", "type": "address" },
      { "internalType": "string", "name": "_uri", "type": "string" }
    ],
    "name": "mintTo",
    "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  { "inputs": [], "name": "totalSupply", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" },
  { "inputs": [], "name": "maxSupply", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" },
  { "inputs": [], "name": "mintPrice", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" },
];

// UI Elements
const connectBtn = document.getElementById("connectBtn");
const mintBtn = document.getElementById("mintBtn");
const walletDisplay = document.getElementById("walletDisplay");
const walletAddress = document.getElementById("walletAddress");
const statusIndicator = document.getElementById("statusIndicator");
const statusText = document.getElementById("statusText");
const mintPriceEl = document.getElementById("mintPrice");
const totalSupplyEl = document.getElementById("totalSupply");
const mintedCountEl = document.getElementById("mintedCount");
const mintProgressBar = document.getElementById("mintProgressBar");
const notification = document.getElementById("notification");
const mintForm = document.getElementById("mintForm");
const mintAmountInput = document.getElementById("mintAmount");
const successText = document.getElementById("successText");
const errorText = document.getElementById("errorText");

// Global
let provider, signer, contract;
let userAddress = null;
let maxSupply = 1000;
let mintPrice = "0.1";

// Initialize
async function init() {
  setupEvents();
  
  if (window.ethereum && window.ethereum.selectedAddress) {
    await connectWallet();
  } else {
    await loadContractPublic();
  }
}

// Setup listeners
function setupEvents() {
  connectBtn?.addEventListener('click', connectWallet);
  mintBtn?.addEventListener('click', showMintForm);
  document.getElementById('confirmMintBtn')?.addEventListener('click', mintNFT);

  if (window.ethereum) {
    window.ethereum.on('accountsChanged', () => window.location.reload());
    window.ethereum.on('chainChanged', () => window.location.reload());
  }
}

// Connect Wallet
async function connectWallet() {
  if (!window.ethereum) {
    notify("Please install MetaMask", "error");
    return;
  }

  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);

  const network = await provider.getNetwork();
  if (network.chainId !== BSC_CHAIN_ID) {
    await switchToBSC();
  }

  signer = provider.getSigner();
  userAddress = await signer.getAddress();
  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

  updateWalletUI();
  loadContractData();
  notify("Wallet connected!", "success");
}

// Load Contract with wallet
async function loadContractData() {
  try {
    const [supply, max, price] = await Promise.all([
      contract.totalSupply(),
      contract.maxSupply(),
      contract.mintPrice()
    ]);

    mintedCountEl.textContent = supply.toString();
    totalSupplyEl.textContent = max.toString();
    mintPriceEl.textContent = `${ethers.utils.formatEther(price)} BNB`;
    mintProgressBar.style.width = `${(supply.toNumber() / max.toNumber()) * 100}%`;

    maxSupply = max.toNumber();
    mintPrice = ethers.utils.formatEther(price);

  } catch (err) {
    console.error("Contract error:", err);
    notify("Error loading contract data", "error");
  }
}

// Load contract using public RPC if no wallet
async function loadContractPublic() {
  try {
    const publicProvider = new ethers.providers.JsonRpcProvider(BSC_RPC_URL);
    contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, publicProvider);

    const [supply, max, price] = await Promise.all([
      contract.totalSupply(),
      contract.maxSupply(),
      contract.mintPrice()
    ]);

    mintedCountEl.textContent = supply.toString();
    totalSupplyEl.textContent = max.toString();
    mintPriceEl.textContent = `${ethers.utils.formatEther(price)} BNB`;
    mintProgressBar.style.width = `${(supply.toNumber() / max.toNumber()) * 100}%`;

    maxSupply = max.toNumber();
    mintPrice = ethers.utils.formatEther(price);

  } catch (err) {
    console.error("Public load error:", err);
  }
}

// Mint NFT
async function mintNFT() {
  try {
    const amount = parseInt(mintAmountInput.value);
    if (amount < 1 || amount > 5) {
      notify("Enter a valid mint amount (1-5)", "error");
      return;
    }

    setLoading(true);

    const txs = [];
    for (let i = 0; i < amount; i++) {
      const tx = await contract.mintTo(userAddress, METADATA_URI);
      txs.push(tx);
    }

    const receipt = await txs[txs.length - 1].wait();
    notify(`Successfully minted ${amount} NFT(s)!`, "success");

    successText.innerHTML = `
      ✅ Minted ${amount} KLY Genesis NFTs!<br>
      <a href="https://bscscan.com/tx/${receipt.transactionHash}" target="_blank" style="color:var(--primary);">View on BscScan</a>
    `;
    successText.style.display = "block";

    mintForm.style.display = "none";
    mintBtn.style.display = "inline-flex";

    await loadContractData();

  } catch (err) {
    console.error("Mint error:", err);
    if (err.code === 4001) {
      notify("Transaction rejected", "error");
    } else {
      notify("Mint failed", "error");
    }
  } finally {
    setLoading(false);
  }
}

// Show Mint Form
function showMintForm() {
  mintForm.style.display = "block";
  mintBtn.style.display = "none";
  mintAmountInput.value = "1";
}

// Switch Network
async function switchToBSC() {
  try {
    await window.ethereum.request({
      method: 'wallet_switchEthereumChain',
      params: [{ chainId: `0x${BSC_CHAIN_ID.toString(16)}` }]
    });
  } catch (err) {
    if (err.code === 4902) {
      await window.ethereum.request({
        method: 'wallet_addEthereumChain',
        params: [{
          chainId: `0x${BSC_CHAIN_ID.toString(16)}`,
          chainName: "BNB Smart Chain",
          nativeCurrency: { name: "BNB", symbol: "BNB", decimals: 18 },
          rpcUrls: [BSC_RPC_URL],
          blockExplorerUrls: ["https://bscscan.com/"]
        }]
      });
    } else {
      throw err;
    }
  }
}

// Update Wallet UI
function updateWalletUI() {
  walletAddress.textContent = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
  walletAddress.title = userAddress;
  statusIndicator.classList.add("connected");

  connectBtn.innerHTML = `<i class="fas fa-check-circle"></i> Connected`;
  connectBtn.disabled = true;
  mintBtn.disabled = false;
}

// Notify
function notify(message, type = "info") {
  notification.textContent = message;
  notification.className = `notification ${type} show`;
  setTimeout(() => notification.classList.remove("show"), 4000);
}

// Set loading
function setLoading(isLoading) {
  const confirmBtn = document.getElementById('confirmMintBtn');
  if (isLoading) {
    confirmBtn.disabled = true;
    confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Minting...';
  } else {
    confirmBtn.disabled = false;
    confirmBtn.innerHTML = '<i class="fas fa-check-circle"></i> Confirm Mint';
  }
}

// Init on page load
document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
