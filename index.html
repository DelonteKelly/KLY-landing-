<!doctype html>
<html lang="en" id="top">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>KLY Token — Build Wealth. Own Legacy.</title>
  <meta name="description" content="KLY tokenized education + DeFi + DAO on BNB Chain. Enter the Vault. Enter the Academy. Build wealth and own legacy." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Unna:wght@400;700;800&display=swap" rel="stylesheet" />

  <!-- Design Tokens JSON (optional source of truth) -->
  <script type="application/json" id="design-tokens">
  {
    "brand": { "name": "KLY", "chain": "BNB Smart Chain", "contract": "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52" },
    "color": {
      "bg": "#0B0C0E","bgElev": "#0F1115","panel": "#121418","panelHigh": "#171A1F",
      "text": "#EDEFF5","textDim": "#B8BFCC","muted": "#8791A1",
      "gold": "#D4AF37","goldSoft": "#C9A33A","goldLine": "rgba(212,175,55,0.5)",
      "teal": "#1EE8C2","tealDim": "rgba(30,232,194,0.22)",
      "green": "#31D0AA","red": "#FF5C70","focus": "#5EEAD4"
    },
    "motion": { "fast": "150ms","base": "220ms","snappy": "300ms","easing": "cubic-bezier(.2,.8,.2,1)" }
  }
  </script>

  <style>
    /* ============= CSS VARIABLES ============= */
    :root{
      --bg:#0B0C0E;--bgElev:#0F1115;--panel:#121418;--panelHigh:#171A1F;
      --text:#EDEFF5;--text-dim:#B8BFCC;--muted:#8791A1;
      --gold:#D4AF37;--gold-soft:#C9A33A;--gold-line:rgba(212,175,55,0.5);
      --teal:#1EE8C2;--teal-dim:rgba(30,232,194,0.22);
      --green:#31D0AA;--red:#FF5C70;--focus:#5EEAD4;

      --r-xs:6px;--r-sm:10px;--r-md:14px;--r-lg:20px;--r-xl:28px;--r-pill:999px;

      --s-2:8px;--s-3:12px;--s-4:16px;--s-5:20px;--s-6:24px;--s-7:28px;--s-8:32px;--s-10:40px;--s-12:48px;--s-16:64px;--s-20:80px;--s-24:96px;

      --fs-xs:12px;--fs-sm:14px;--fs-base:18px;--fs-md:20px;--fs-lg:24px;--fs-xl:28px;--fs-2xl:36px;--fs-3xl:44px;--fs-4xl:56px;--fs-5xl:72px;
      --lh-tight:1.1;--lh-snug:1.2;--lh-normal:1.4;

      --shadow-sm:0 1px 2px rgba(0,0,0,0.35);--shadow-md:0 6px 18px rgba(0,0,0,0.35);--shadow-lg:0 14px 44px rgba(0,0,0,0.45);
      --anim-fast:150ms;--anim-base:220ms;--anim-snappy:300ms;--anim-ease:cubic-bezier(.2,.8,.2,1);
      --halo:0 0 0 2px rgba(30,232,194,0.10),0 0 24px rgba(212,175,55,0.12);
      --glow:0 8px 28px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);
    }

    /* ============= BASE ============= */
    html,body{height:100%;}
    html{scroll-behavior:smooth;}
    body{
      margin:0;background:
        radial-gradient(1000px 600px at 70% -10%, rgba(30,232,194,0.04),transparent 60%),
        radial-gradient(800px 520px at 0% 0%, rgba(212,175,55,0.06),transparent 55%),
        var(--bg);
      color:var(--text); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, sans-serif;
      font-size:var(--fs-base); line-height:var(--lh-normal); overflow-x:hidden;
    }
    *,*::before,*::after{box-sizing:border-box;}
    img{max-width:100%; display:block;}
    a{color:inherit; text-decoration:none;}
    .container{max-width:1200px; margin:0 auto; padding:0 var(--s-6);}
    :focus-visible{outline:2px solid var(--focus); outline-offset:2px; border-radius:6px;}

    /* Sticky Topbar */
    .topbar{position:sticky; top:0; z-index:50; backdrop-filter: blur(8px);
      background:linear-gradient(to bottom, rgba(11,12,14,0.85), rgba(11,12,14,0.55));
      border-bottom:1px solid rgba(255,255,255,0.06);}
    .topbar-inner{display:flex; align-items:center; justify-content:space-between; height:64px;}
    .brand{display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:0.06em;}
    .brand .wordmark{font-family:Unna,serif; font-weight:800; font-size:20px;}

    /* Dropdown nav */
    .nav-links{position:relative;}
    .nav-dropdown{position:relative;}
    .nav-link#ecosysBtn{
      min-height:40px; padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.04); color:#EDEFF5; font-weight:700; cursor:pointer;
    }
    .dropdown-content#ecosysMenu{
      position:absolute; top:calc(100% + 8px); left:0; min-width:220px; padding:8px; list-style:none; margin:0;
      background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.35));
      border:1px solid rgba(255,255,255,0.10); border-radius:12px; box-shadow:var(--shadow-lg); z-index:60;
    }
    .dropdown-content[hidden]{display:none;}
    .dropdown-content a{display:block; padding:10px 12px; border-radius:8px; color:#EDEFF5; white-space:nowrap;}
    .dropdown-content a:hover,.dropdown-content a:focus-visible{background:rgba(255,255,255,0.08);}
    .new-badge{font-size:12px; color:var(--teal); margin-left:6px;}

    /* Wallet / Buttons */
    .chip{
      display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:var(--r-pill);
      background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.2));
      border:1px solid rgba(255,255,255,0.08); box-shadow:var(--shadow-sm); min-height:44px;
    }
    .wallet-wrap{display:flex; align-items:center; gap:12px;}
    .btn{
      --bg:var(--panelHigh); --bd:rgba(255,255,255,0.08); --fg:var(--text);
      display:inline-grid; place-items:center; gap:8px; grid-auto-flow:column;
      padding:12px 18px; border-radius:var(--r-pill); border:1px solid var(--bd);
      background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.18)), var(--bg);
      color:var(--fg); box-shadow:var(--shadow-sm);
      min-height:44px; font-weight:700; transition:transform var(--anim-base) var(--anim-ease), box-shadow var(--anim-base) var(--anim-ease);
      cursor:pointer;
    }
    .btn:hover{transform:translateY(-2px); box-shadow:var(--shadow-md);}
    .btn[disabled], .btn.is-disabled{opacity:.55; cursor:not-allowed; filter:saturate(.6)}
    .btn-primary{background:linear-gradient(180deg, rgba(212,175,55,.35), rgba(212,175,55,.10)), #1A1E24; border-color:var(--gold-line); color:#fff;}
    .btn .spinner{width:18px;height:18px;border-radius:50%;border:2px solid rgba(255,255,255,.25);border-top-color:#fff;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Hero */
    .hero{position:relative; isolation:isolate; padding:var(--s-24) 0 var(--s-20);}
    .hero .frame{display:grid; grid-template-columns:1.2fr 0.8fr; gap:var(--s-16); align-items:center;}
    .h1{
      font-family:Unna,serif; font-size:clamp(var(--fs-3xl), 6vw, var(--fs-5xl)); line-height:var(--lh-tight);
      letter-spacing:.01em; margin:0 0 var(--s-6); font-weight:800; color:#fff;
    }
    .h1 .gold{
      background:linear-gradient(180deg, #F1D07A 0%, #D4AF37 55%, #9E7C20 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 2px 20px rgba(212,175,55,.18);
    }
    .sub{font-size:var(--fs-lg); color:var(--text-dim); max-width:52ch; margin:0 0 var(--s-8);}
    .cta-row{display:flex; flex-wrap:wrap; gap:12px;}
    .fine-print{margin-top:var(--s-6); color:var(--muted); font-size:var(--fs-sm); display:flex; align-items:center; gap:10px;}
    .fine-pill{border:1px solid var(--gold-line); border-radius:var(--r-pill); padding:6px 10px; background:rgba(212,175,55,0.06);}

    .contract-bar{margin-top:var(--s-8); display:flex; align-items:center; gap:12px; flex-wrap:wrap;
      border:1px solid rgba(255,255,255,0.08); background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.2)); border-radius:var(--r-md); padding:10px 12px; box-shadow:var(--shadow-sm);}
    .addr{font-family:ui-monospace,Menlo,Consolas,monospace; background:rgba(255,255,255,0.04); border:1px dashed rgba(255,255,255,0.12); padding:8px 10px; border-radius:var(--r-sm); color:#fff;}
    .addr small{color:var(--text-dim);}

    /* Right visual */
    .hero-art{position:relative; min-height:360px; display:grid; place-items:center;}
    .portal{width:min(440px, 90%); aspect-ratio:1; border-radius:50%;
      background:radial-gradient(closest-side, rgba(30,232,194,0.12), transparent 70%), radial-gradient(circle at 50% 50%, rgba(212,175,55,0.15), transparent 60%);
      border:1px solid rgba(255,255,255,0.08); box-shadow:0 0 0 2px rgba(30,232,194,0.08), inset 0 0 80px rgba(212,175,55,0.12), var(--shadow-md);
      display:grid; place-items:center; position:relative; overflow:hidden;}
    .portal .ring{position:absolute; inset:8%; border-radius:50%; border:1px solid rgba(212,175,55,0.25); mix-blend:screen; animation:spin-slow 30s linear infinite;}
    @keyframes spin-slow{to{transform:rotate(360deg)}}
    @media (prefers-reduced-motion: reduce){ .btn:hover{transform:none;} .portal .ring{animation:none;} }
    .glyph-coin{width:58%; filter:drop-shadow(0 6px 24px rgba(0,0,0,.5));}

    /* Badges */
    .badges{display:grid; grid-template-columns:repeat(4,1fr); gap:var(--s-6); margin:var(--s-16) 0 var(--s-12);}
    .badge{display:flex; align-items:center; gap:10px; padding:12px 14px; border-radius:var(--r-md);
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.2));
      border:1px solid rgba(255,255,255,0.08); box-shadow:var(--shadow-sm); position:relative; overflow:hidden;}
    .badge::after{content:""; position:absolute; inset:0; background:linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent);
      transform:translateX(-120%); animation:badge-shimmer 1.8s var(--anim-ease) 1 both;}
    @keyframes badge-shimmer{to{transform:translateX(120%)}}

    /* Feature Grid */
    .grid4{display:grid; grid-template-columns:repeat(4,1fr); gap:var(--s-8);}
    .card{background:var(--panel); border:1px solid rgba(255,255,255,0.08); border-radius:var(--r-lg); padding:var(--s-10); box-shadow:var(--shadow-sm); transition:transform var(--anim-base) var(--anim-ease), box-shadow var(--anim-base) var(--anim-ease);}
    .card:hover{transform:translateY(-3px); box-shadow:var(--shadow-md);}
    .card h3{margin:0 0 var(--s-4); font-size:var(--fs-xl); line-height:var(--lh-snug);}
    .card p{margin:0 0 var(--s-5); color:var(--text-dim);}
    .card .link{color:var(--teal); font-weight:700; text-decoration:underline dotted rgba(30,232,194,0.3); text-underline-offset:3px;}

    /* Bands / status */
    .band{margin:var(--s-20) 0; padding:var(--s-16); border-radius:var(--r-xl); background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.25)); border:1px solid rgba(255,255,255,0.08); box-shadow:var(--shadow-md);}
    .vault-grid{display:grid; grid-template-columns:1fr 1fr; gap:var(--s-10); align-items:start;}
    .steps{display:grid; gap:12px;}
    .step{display:grid; grid-template-columns:28px 1fr; gap:12px; align-items:start;}
    .step .dot{width:28px;height:28px;border-radius:50%; display:grid;place-items:center; background:rgba(30,232,194,0.08); border:1px solid rgba(30,232,194,0.35); color:#fff; font-weight:700;}
    .status-card{background:var(--panelHigh); border:1px solid rgba(255,255,255,0.10); border-radius:var(--r-lg); padding:var(--s-8); box-shadow:var(--shadow-sm);}
    .status-card .row{display:flex; align-items:center; justify-content:space-between; padding:10px 0; border-bottom:1px dashed rgba(255,255,255,0.07);}
    .status-card .row:last-child{border-bottom:0;}
    .status-card code{font-family:ui-monospace, Menlo, monospace; font-size:14px; color:var(--text-dim);}

    .section-title{display:flex; align-items:center; gap:12px; margin:var(--s-20) 0 var(--s-8);}
    .divider-glyph{width:32px;height:32px; opacity:.9;}
    .academy{display:grid; grid-template-columns:1.2fr 0.8fr; gap:var(--s-12); align-items:center;}
    .note{color:var(--muted);}
    .split{display:grid; grid-template-columns:1.2fr 0.8fr; gap:var(--s-12); align-items:start;}
    .tokenomics{background:var(--panelHigh); border:1px solid rgba(255,255,255,0.1); border-radius:var(--r-lg); padding:var(--s-10);}
    .progress{height:10px; background:rgba(255,255,255,0.06); border-radius:var(--r-pill); overflow:hidden;}
    .progress > span{display:block; height:100%; background:linear-gradient(90deg, var(--gold), var(--teal));}

    .roadmap{position:relative; padding:var(--s-20) 0;}
    .spine{position:absolute; left:50%; top:0; bottom:0; width:2px; background:linear-gradient(180deg, rgba(212,175,55,0.35), rgba(30,232,194,0.35)); transform:translateX(-50%);}
    .rm-grid{display:grid; grid-template-columns:1fr 1fr; gap:var(--s-12); position:relative;}
    .rm-item{background:var(--panel); border:1px solid rgba(255,255,255,0.08); border-radius:var(--r-lg); padding:var(--s-8); box-shadow:var(--shadow-sm); position:relative;}
    .rm-item.current{border-color:rgba(30,232,194,0.45); box-shadow:0 0 0 2px rgba(30,232,194,0.18);}
    .rm-item::before{content:""; position:absolute; top:50%; width:12px; height:12px; border-radius:50%; background:var(--gold); box-shadow:0 0 24px var(--gold);}
    .rm-left::before{right:-6px;} .rm-right::before{left:-6px;}
    .rm-time{color:var(--text-dim); font-size:14px; margin-bottom:6px;}

    .call{display:grid; place-items:center; text-align:center; padding:var(--s-24) 0;}
    .call .portal{width:min(360px, 80%);} .call h3{font-family:Unna,serif; font-size:var(--fs-2xl); margin:var(--s-6) 0 var(--s-4);}
    .call p{color:var(--text-dim); max-width:60ch; margin:0 auto var(--s-6);}

    .faq{margin:var(--s-20) 0;}
    .accordion{border:1px solid rgba(255,255,255,0.08); border-radius:var(--r-lg); overflow:hidden;}
    .acc-item + .acc-item{border-top:1px solid rgba(255,255,255,0.08);}
    .acc-btn{width:100%; text-align:left; background:var(--panel); color:var(--text); padding:16px 18px; border:0; display:flex; align-items:center; justify-content:space-between; cursor:pointer; font-weight:600;}
    .acc-btn .pm{width:22px;height:22px; display:grid; place-items:center; border-radius:6px; border:1px solid rgba(255,255,255,0.12);}
    .acc-panel{max-height:0; overflow:hidden; background:var(--panelHigh); transition:max-height var(--anim-snappy) var(--anim-ease);}
    .acc-panel .content{padding:0 18px 16px; color:var(--text-dim);} .acc-item.open .acc-panel{max-height:280px;}

    footer{margin-top:var(--s-24); border-top:1px solid rgba(255,255,255,0.08); background:linear-gradient(180deg, rgba(0,0,0,0.2), rgba(0,0,0,0.4));}
    .foot{display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:var(--s-8); padding:var(--s-12) 0;}
    .links{display:flex; gap:18px; flex-wrap:wrap;} .links a{position:relative;}
    .links a::after{content:""; position:absolute; left:0; right:0; bottom:-3px; height:2px; background:radial-gradient(40px 6px at 50% 50%, var(--teal), transparent 70%); opacity:0; transition:opacity var(--anim-base) var(--anim-ease);}
    .links a:hover::after{opacity:1;} .foot .sigil{justify-self:center; opacity:.9;}

    /* Responsive */
    @media (max-width:1024px){
      .hero .frame{grid-template-columns:1fr; gap:var(--s-12);}
      .academy{grid-template-columns:1fr;} .vault-grid{grid-template-columns:1fr;}
      .grid4{grid-template-columns:repeat(2,1fr);} .split{grid-template-columns:1fr;}
      .foot{grid-template-columns:1fr; gap:var(--s-6);}
    }
    @media (max-width:520px){
      body{font-size:17px;}
      .badges{grid-template-columns:1fr 1fr;} .grid4{grid-template-columns:1fr;}
    }

    /* ---- Toasts ---- */
.toasts{
  position: fixed; right: 16px; bottom: 16px; z-index: 1000;
  display: grid; gap: 10px; width: min(360px, 92vw);
}
.toast{
  display: grid; grid-template-columns: 24px 1fr auto; gap: 10px;
  align-items: center; padding: 12px 14px; border-radius: 12px;
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.25));
  border: 1px solid rgba(255,255,255,.12); box-shadow: var(--shadow-md);
  color: var(--text); backdrop-filter: blur(6px);
}
.toast.success{ border-color: rgba(49,208,170,.5); box-shadow: 0 0 0 2px rgba(49,208,170,.15); }
.toast.error{ border-color: rgba(255,92,112,.5); box-shadow: 0 0 0 2px rgba(255,92,112,.12); }
.toast.warn{  border-color: rgba(212,175,55,.45); box-shadow: 0 0 0 2px rgba(212,175,55,.12); }
.toast > span{ font-size: 18px; line-height: 0; opacity: .95; }
.toast .close{
  background: transparent; color: var(--text-dim); border: 0; cursor: pointer;
  width: 28px; height: 28px; border-radius: 8px; font-size: 18px; line-height: 1;
}
.toast .close:hover{ background: rgba(255,255,255,.06); color: var(--text); }

/* Disabled link look for gated items */
a.is-disabled[aria-disabled="true"]{
  pointer-events: none; filter: saturate(.4) opacity(.6); cursor: not-allowed;
}
  </style>
</head>
<body>

  <!-- Sticky Topbar -->
  <header class="topbar" role="banner">
    <div class="container topbar-inner">
      <!-- Brand -->
      <a href="index.html" class="brand" aria-label="KLY Home">
        <svg width="28" height="28" viewBox="0 0 64 64" aria-hidden="true">
          <defs><radialGradient id="g0" cx="50%" cy="50%" r="60%"><stop offset="0%" stop-color="#D4AF37"/><stop offset="60%" stop-color="#8A6B1E"/><stop offset="100%" stop-color="#2B2207"/></radialGradient></defs>
          <circle cx="32" cy="32" r="30" fill="url(#g0)" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
          <path d="M32 14 L42 24 L32 34 L22 24 Z M22 40 L32 50 L42 40" fill="none" stroke="#1EE8C2" stroke-opacity="0.9" stroke-width="2"/>
        </svg>
        <span class="wordmark">KLY TOKEN</span>
      </a>

      <!-- Ecosystem Dropdown -->
      <nav class="nav-links centered-nav" aria-label="Primary">
        <div class="nav-dropdown">
          <button id="ecosysBtn" class="nav-link" aria-haspopup="true" aria-expanded="false" aria-controls="ecosysMenu" type="button">
            Ecosystem <span aria-hidden="true">▾</span>
          </button>
          <div id="ecosysMenu" class="dropdown-content" role="menu" hidden>
            <a href="jointhetribe.html" role="menuitem">Join the Tribe</a>
            <a href="founders.html" role="menuitem" style="background:#e6c15a;color:#121212;padding:8px 16px;border-radius:8px;font-weight:700;">Founders Circle</a>
            <a href="marketplace.html" role="menuitem" style="background:#d6b25e;color:#121212;padding:8px 16px;border-radius:8px;font-weight:700;">Marketplace</a>
            <a href="mint.html" role="menuitem">Mint NFTs</a>
            <a href="kly-academy.html" role="menuitem" data-academy="true">KLY Academy</a>
            <a href="stake.html" role="menuitem">Stake</a>
            <a href="oracle.html" role="menuitem">Oracle Scrolls</a>
            <a href="dao.html" role="menuitem">DAO Governance</a>
            <a href="course.html" role="menuitem">Course</a>
            <a href="launchpad.html" role="menuitem">Launchpad</a>
            <a href="KLY-vault.html" role="menuitem">KLY Vault <span class="new-badge">NEW</span></a>
          </div>
        </div>
      </nav>

      <!-- Wallet -->
      <div class="wallet-wrap">
        <div id="walletChip" class="chip" aria-live="polite"><span id="walletLabel">Not connected</span></div>
        <button id="connectBtn" class="btn btn-primary" type="button"><span>Connect Wallet</span></button>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero" aria-labelledby="hero-title">
    <div id="particles-js" aria-hidden="true"></div>
    <div class="container frame">
      <div>
        <h1 id="hero-title" class="h1"><span class="gold">BUILD WEALTH.</span> OWN LEGACY.</h1>
        <p class="sub">KLY unites tokenized education, DeFi yield, and DAO governance on BNB Smart Chain. Staking vaults. Gated academy. On-chain credentials.</p>

        <div class="cta-row" role="group" aria-label="Primary actions">
          <a href="KLY-vault.html" class="btn btn-primary" id="enterVaultTop"><span>Enter the Vault</span></a>
          <a href="kly-academy.html" class="btn" id="enterAcademyTop" data-academy="true"><span>Enter Academy</span></a>
        </div>

        <div class="fine-print" aria-label="requirements">
          <span class="fine-pill">Academy requires <strong>500+ KLY</strong></span>
          <span class="fine-pill">BNB Smart Chain</span>
        </div>

        <!-- Contract micro-bar -->
        <div class="contract-bar" role="group" aria-label="Contract">
          <div class="addr" title="KLY Contract Address"><small>Contract</small> • <span id="contractShort">0x2e4f...4E52</span></div>
          <div class="contract-actions">
            <a class="btn" rel="noopener" target="_blank" href="https://bscscan.com/token/0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52">View on BscScan</a>
            <button id="copyContract" class="btn" aria-label="Copy contract address" type="button">Copy Contract</button>
          </div>
        </div>

        <!-- Status (global mirrors) -->
        <div style="margin-top:12px; color:var(--text-dim)">
          <div>Network: <strong>BNB Smart Chain</strong></div>
          <div>Wallet: <code data-status="wallet">Not connected</code></div>
          <div>Eligibility: <code data-status="eligibility">Academy: 500+ KLY required</code></div>
          <div>Message: <code data-status="message">Connect wallet to continue.</code></div>
        </div>
      </div>

      <div class="hero-art" aria-hidden="true">
        <div class="portal">
          <div class="ring"></div><div class="ring" style="inset:14%; animation-duration:40s; opacity:.6;"></div><div class="ring" style="inset:20%; animation-duration:50s; opacity:.4;"></div>
          <!-- Central coin -->
          <svg class="glyph-coin" viewBox="0 0 200 200">
            <defs><radialGradient id="coinG" cx="50%" cy="50%" r="60%"><stop offset="0%" stop-color="#FFF"/><stop offset="55%" stop-color="#E2C86C"/><stop offset="100%" stop-color="#6B5520"/></radialGradient></defs>
            <circle cx="100" cy="100" r="86" fill="url(#coinG)" stroke="rgba(0,0,0,0.35)" stroke-width="2"/>
            <circle cx="100" cy="100" r="72" fill="none" stroke="rgba(30,232,194,0.45)" stroke-width="2" stroke-dasharray="6 10"/>
            <path d="M100 50 L135 85 L100 120 L65 85 Z M65 140 L100 175 L135 140" fill="none" stroke="#0D1117" stroke-width="6" opacity=".8"/>
            <path d="M100 50 L135 85 L100 120 L65 85 Z M65 140 L100 175 L135 140" fill="none" stroke="#1EE8C2" stroke-width="2"/>
          </svg>
        </div>
      </div>
    </div>

    <!-- Badges -->
    <div class="container badges" aria-label="Highlights">
      <div class="badge"><svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 12h16M4 17h10M4 7h16" stroke="currentColor" opacity=".9"/></svg><span>Low fees on BNB</span></div>
      <div class="badge"><svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3l8 4v6c0 4-3 7-8 8-5-1-8-4-8-8V7l8-4z" stroke="currentColor"/></svg><span>Self-custody</span></div>
      <div class="badge"><svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 6h12v7H6z"/><path d="M8 19h8" stroke="currentColor"/></svg><span>Token-gated Academy</span></div>
      <div class="badge"><svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2l4 7-6 6 7-4 5 11" stroke="currentColor"/></svg><span>NFT Certificates</span></div>
    </div>
  </section>

  <!-- Feature Grid -->
  <section class="container" aria-labelledby="features">
    <div class="section-title">
      <svg class="divider-glyph" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10" stroke="var(--gold)" fill="none"/><path d="M12 4v16M4 12h16" stroke="var(--teal)"/></svg>
      <h2 id="features">What You Unlock</h2>
    </div>
    <div class="grid4">
      <article class="card"><h3>Tokenized Education</h3><p>Master DeFi and on-chain ops with structured, token-gated paths.</p><a class="link" href="kly-academy.html" data-academy="true">Explore Academy</a></article>
      <article class="card"><h3>DeFi Ecosystem</h3><p>Stake, mint, and claim inside the Vault. Designed for clarity and control.</p><a class="link" href="KLY-vault.html">Enter Vault</a></article>
      <article class="card"><h3>DAO Governance</h3><p>Put KLY to work. Vote on upgrades, grants, and launch priorities.</p><a class="link" href="dao.html">View DAO</a></article>
      <article class="card"><h3>Launchpad</h3><p>Participate in vetted drops and cohort projects with on-chain checks.</p><a class="link" href="launchpad.html">See Launchpad</a></article>
    </div>
  </section>

  <!-- Vault Preview -->
  <section id="vault" class="container band" aria-labelledby="vault-title">
    <h2 id="vault-title" class="section-title" style="gap:10px;">
      <svg class="divider-glyph" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10" stroke="var(--gold)" fill="none"/><path d="M12 4v16M4 12h16" stroke="var(--teal)"/></svg>
      <span>Vault — Stake. Mint. Claim.</span>
    </h2>
    <div class="vault-grid">
      <div class="steps" role="list">
        <div class="step" role="listitem"><div class="dot">1</div><div><strong>Connect</strong><p class="note">Link your wallet on BNB Smart Chain.</p></div></div>
        <div class="step" role="listitem"><div class="dot">2</div><div><strong>Verify balance</strong><p class="note">We check your KLY holdings securely.</p></div></div>
        <div class="step" role="listitem"><div class="dot">3</div><div><strong>Unlock</strong><p class="note">Academy opens at <b>500+ KLY</b>. Vault is always available.</p></div></div>
        <div class="step" role="listitem"><div class="dot">4</div><div><strong>Mint / Stake / Claim</strong><p class="note">One clean flow. Low fees. Clear states.</p></div></div>
        <div class="cta"><a href="KLY-vault.html" class="btn btn-primary"><span>Enter the Vault</span></a></div>
      </div>

      <aside class="status-card" aria-live="polite">
        <div class="row"><span>Network</span><strong>BNB Smart Chain</strong></div>
        <div class="row"><span>Wallet</span><code data-status="wallet">Not connected</code></div>
        <div class="row"><span>Eligibility</span><code data-status="eligibility">Academy: 500+ KLY required</code></div>
        <div class="row"><span>Message</span><code data-status="message">Connect wallet to continue.</code></div>
      </aside>
    </div>
  </section>

  <!-- Academy -->
  <section id="academy" class="container band" aria-labelledby="academy-title">
    <div class="academy">
      <div>
        <h2 id="academy-title">The Academy</h2>
        <p class="note">Enter a focused learning vault. Complete tracks, earn <b>NFT certificates</b>, and level up your DeFi execution. Access requires <b>500+ KLY</b>.</p>
        <div class="cta-row">
          <a href="kly-academy.html" class="btn" data-academy="true"><span>Enter Academy</span></a>
        </div>
      </div>
      <div class="portal" aria-hidden="true">
        <div class="ring"></div><div class="ring" style="inset:16%; animation-duration:36s;"></div>
        <svg class="glyph-coin" viewBox="0 0 200 200"><circle cx="100" cy="100" r="76" fill="rgba(30,232,194,0.08)" stroke="rgba(30,232,194,0.35)"/><path d="M100 56 L128 84 L100 112 L72 84 Z" stroke="#1EE8C2" fill="none"/></svg>
      </div>
    </div>
  </section>

  <!-- Quests / Achievements -->
  <section class="container" aria-labelledby="quest-title">
    <div class="section-title">
      <svg class="divider-glyph" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10" stroke="var(--gold)" fill="none"/><path d="M12 4v16M4 12h16" stroke="var(--teal)"/></svg>
      <h2 id="quest-title">Quests & Leaderboard</h2>
    </div>
    <div class="quests">
      <div class="quest"><div class="top"><strong>Connect on BNB</strong><span class="state lock">Locked</span></div><p class="note">You connected your wallet on BNB Smart Chain.</p></div>
      <div class="quest"><div class="top"><strong>Stake KLY</strong><span class="state lock">Locked</span></div><p class="note">Stake any amount to unlock the streak bonus.</p></div>
      <div class="quest"><div class="top"><strong>Reach 500+ KLY</strong><span class="state lock">Locked</span></div><p class="note">Required to enter the Academy.</p></div>
    </div>
  </section>

  <!-- Why + Tokenomics -->
  <section class="container" aria-labelledby="why-title">
    <div class="section-title">
      <svg class="divider-glyph" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10" stroke="var(--gold)" fill="none"/><path d="M12 4v16M4 12h16" stroke="var(--teal)"/></svg>
      <h2 id="why-title">Why KLY</h2>
    </div>
    <div class="split">
      <div>
        <p>KLY is a focused path to on-chain mastery. We pair <b>clean DeFi flows</b> with <b>tokenized curriculum</b> and <b>DAO ownership</b>. You learn. You earn. You decide.</p>
        <p>Every component honors clarity: crisp states, no hidden steps, and fees you can see.</p>
        <a class="btn btn-primary" href="KLY-vault.html"><span>Start in the Vault</span></a>
      </div>
      <aside class="tokenomics" aria-label="Tokenomics">
        <h3 style="margin-top:0;">Tokenomics</h3>
        <p class="note">Transparent, programmatic distribution.</p>
        <div style="display:grid; gap:12px;">
          <div><div style="display:flex; justify-content:space-between;"><span>Community</span><span>40%</span></div><div class="progress"><span style="width:40%;"></span></div></div>
          <div><div style="display:flex; justify-content:space-between;"><span>Treasury & DAO</span><span>25%</span></div><div class="progress"><span style="width:25%;"></span></div></div>
          <div><div style="display:flex; justify-content:space-between;"><span>Team & Advisors</span><span>20%</span></div><div class="progress"><span style="width:20%;"></span></div></div>
          <div><div style="display:flex; justify-content:space-between;"><span>Launchpad / Partners</span><span>15%</span></div><div class="progress"><span style="width:15%;"></span></div></div>
        </div>
      </aside>
    </div>
  </section>

  <!-- Roadmap -->
  <section class="container roadmap" aria-labelledby="roadmap-title">
    <span class="spine" aria-hidden="true"></span>
    <div class="section-title">
      <svg class="divider-glyph" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10" stroke="var(--gold)" fill="none"/><path d="M12 4v16M4 12h16" stroke="var(--teal)"/></svg>
      <h2 id="roadmap-title">Roadmap</h2>
    </div>
    <div class="rm-grid">
      <div class="rm-item rm-left current"><div class="rm-time">Now</div><strong>Vault v1</strong><p class="note">Stake, mint, claim with audit-ready flows.</p></div>
      <div class="rm-item rm-right"><div class="rm-time">Q4</div><strong>Academy v1</strong><p class="note">Curriculum tracks + NFT certificates.</p></div>
      <div class="rm-item rm-left"><div class="rm-time">Q1</div><strong>DAO Onboarding</strong><p class="note">Snapshot + proposals + weighted voting.</p></div>
      <div class="rm-item rm-right"><div class="rm-time">Q2</div><strong>Launchpad</strong><p class="note">Cohort projects & grants.</p></div>
    </div>
  </section>

  <!-- Ancestral Call -->
  <section class="container call" aria-labelledby="call-title">
    <div class="portal" aria-hidden="true"><div class="ring"></div></div>
    <h3 id="call-title">Answer the Call</h3>
    <p>Step through the gate. Build wealth. Own legacy.</p>
    <a href="KLY-vault.html" class="btn btn-primary" style="margin-top:10px;"><span>Enter the Vault</span></a>
  </section>

  <!-- FAQ -->
  <section class="container faq" aria-labelledby="faq-title">
    <div class="section-title">
      <svg class="divider-glyph" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10" stroke="var(--gold)" fill="none"/><path d="M12 4v16M4 12h16" stroke="var(--teal)"/></svg>
      <h2 id="faq-title">FAQ</h2>
    </div>
    <div class="accordion" role="region" aria-labelledby="faq-title">
      <div class="acc-item">
        <button class="acc-btn" aria-expanded="false" type="button"><span>What chain does KLY use?</span><span class="pm" aria-hidden="true">+</span></button>
        <div class="acc-panel"><div class="content">BNB Smart Chain. Low fees, fast finality.</div></div>
      </div>
      <div class="acc-item">
        <button class="acc-btn" aria-expanded="false" type="button"><span>How do I access the Academy?</span><span class="pm" aria-hidden="true">+</span></button>
        <div class="acc-panel"><div class="content">Hold <b>500+ KLY</b> in your connected wallet, then select “Enter Academy”.</div></div>
      </div>
      <div class="acc-item">
        <button class="acc-btn" aria-expanded="false" type="button"><span>Where can I verify the contract?</span><span class="pm" aria-hidden="true">+</span></button>
        <div class="acc-panel"><div class="content">Use the “View on BscScan” button above the fold or in the footer.</div></div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer role="contentinfo">
    <div class="container foot">
      <nav class="links" aria-label="Footer">
        <a href="KLY-vault.html">Vault</a>
        <a href="kly-academy.html" data-academy="true">Academy</a>
        <a href="https://bscscan.com/token/0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52" target="_blank" rel="noopener">BscScan</a>
        <a href="launchpad.html">Launchpad</a>
      </nav>
      <svg class="sigil" width="40" height="40" viewBox="0 0 40 40" aria-hidden="true"><circle cx="20" cy="20" r="18" fill="none" stroke="var(--gold)" /><path d="M20 4 L32 20 L20 36 L8 20 Z" fill="none" stroke="var(--teal)"/></svg>
      <div class="links" style="justify-self:end;">
        <a href="https://twitter.com/zamarispeaks" target="_blank" rel="noopener" aria-label="X / Twitter">X</a>
        <a href="https://discord.gg/msvx63vp" target="_blank" rel="noopener" aria-label="Discord">Discord</a>
        <a href="documentation.html" aria-label="Docs">Docs</a>
      </div>
    </div>
  </footer>

  <!-- Toasts -->
  <div class="toasts" id="toasts" aria-live="polite" aria-atomic="true"></div>

<!-- Ethers v5 (Web3Modal v1 expects v5) -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<!-- Web3Modal v1 -->
<script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
<!-- WalletConnect v2 (UMD) -->
<script src="https://unpkg.com/@walletconnect/ethereum-provider@2.12.1/dist/umd/index.min.js"></script>

<script>
/* =========================================
   KLY Wallet Connect — Web3Modal + Fallback + WC v2
   (ethers v5 compatible)
========================================= */
const BSC_CHAIN_ID = 56;
const RPC_URL   = "https://bsc-dataseed.binance.org/";
const EXPLORER  = "https://bscscan.com";
const CONTRACT_ADDRESS = "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52";
const KLY_THRESHOLD_HUMAN = "500";
const WC_PROJECT_ID = "df8063092ef3c627437d698df0977bc1";

const ERC20_ABI_MIN = [
  "function balanceOf(address) view returns (uint256)",
  "function decimals() view returns (uint8)",
  "function symbol() view returns (string)"
];

/* DOM */
const connectBtn   = document.getElementById("connectBtn");
const connectText  = connectBtn?.querySelector("span") || connectBtn;
const walletLabel  = document.getElementById("walletLabel");
const toasts       = document.getElementById("toasts");
const academyLinks = Array.from(document.querySelectorAll('[data-academy]'));

// Status mirrors (update all instances at once)
const sts = {
  wallet:      () => document.querySelectorAll('[data-status="wallet"]'),
  eligibility: () => document.querySelectorAll('[data-status="eligibility"]'),
  message:     () => document.querySelectorAll('[data-status="message"]')
};
function setStatus(which, text){ sts[which]().forEach(el => el.textContent = text); }

function toast(msg, kind="neutral", timeout=3500){
  const el = document.createElement("div");
  el.className = `toast ${kind==="ok"?"success":kind==="err"?"error":kind==="warn"?"warn":""}`;
  el.innerHTML = `<span>${kind==="ok"?"✅":kind==="err"?"⚠️":"✨"}</span>
                  <div>${msg}</div>
                  <button class="close" aria-label="Close" type="button">&times;</button>`;
  toasts.appendChild(el);
  const remove=()=>el.remove();
  el.querySelector(".close").addEventListener("click", remove);
  setTimeout(remove, timeout);
}
const short = a => a ? `${a.slice(0,6)}…${a.slice(-4)}` : "—";

/* Gate (500 KLY) */
function lockAcademy(){
  academyLinks.forEach(a=>{
    a.classList.add("is-disabled"); a.setAttribute("aria-disabled","true");
    a.setAttribute("data-locked","true"); a.title = `Requires ${KLY_THRESHOLD_HUMAN}+ KLY`;
  });
  setStatus("eligibility", `Academy: ${KLY_THRESHOLD_HUMAN}+ KLY required`);
}
function unlockAcademy(){
  academyLinks.forEach(a=>{
    a.classList.remove("is-disabled"); a.removeAttribute("aria-disabled");
    a.removeAttribute("data-locked"); a.title = "";
  });
  setStatus("eligibility", "Academy: Unlocked");
}
(function wireGateIntercepts(){
  academyLinks.forEach(a=>{
    const c=a.cloneNode(true); a.replaceWith(c);
    c.addEventListener("click",(e)=>{
      const locked = c.getAttribute("data-locked")==="true" || c.classList.contains("is-disabled") || c.getAttribute("aria-disabled")==="true";
      if(locked){ e.preventDefault(); toast(`Insufficient KLY — you need ${KLY_THRESHOLD_HUMAN}+ to unlock the Academy.`,"err"); }
    });
    c.addEventListener("keydown",(e)=>{
      const locked = c.getAttribute("data-locked")==="true" || c.classList.contains("is-disabled") || c.getAttribute("aria-disabled")==="true";
      if((e.key===" "||e.key==="Enter") && locked){ e.preventDefault(); toast(`Insufficient KLY — you need ${KLY_THRESHOLD_HUMAN}+ to unlock the Academy.`,"err"); }
    });
  });
})();
lockAcademy();

/* State */
let web3Modal, extProvider, provider, signer, me, kly;
let klyDec = 18, klySym = "KLY";

/* Helpers */
function hasEthereum(){ return typeof window !== "undefined" && window.ethereum; }
function pickInjected(){
  const eth = window.ethereum;
  if(!eth) return null;
  if(eth.providers?.length){
    const mm = eth.providers.find(p => p.isMetaMask);
    return mm || eth.providers[0];
  }
  return eth;
}
async function ensureBsc(){
  const hex = "0x"+BSC_CHAIN_ID.toString(16);
  try{
    await provider.send("wallet_switchEthereumChain", [{ chainId: hex }]);
    return true;
  }catch(e){
    if(e?.code===4902 || e?.data?.originalError?.code===4902){
      try{
        await provider.send("wallet_addEthereumChain",[{
          chainId: hex,
          chainName: "BNB Smart Chain",
          nativeCurrency:{ name:"BNB", symbol:"BNB", decimals:18 },
          rpcUrls:[RPC_URL],
          blockExplorerUrls:[EXPLORER]
        }]);
        return true;
      }catch{ return false; }
    }
    return false;
  }
}
async function loadAll(){
  if(!me || !kly) return;
  try{
    try{ klyDec = await kly.decimals(); }catch{ klyDec = 18; }
    try{ klySym = await kly.symbol();   }catch{ klySym = "KLY"; }
    const balRaw = await kly.balanceOf(me);
    const bal    = ethers.utils.formatUnits(balRaw, klyDec);
    setStatus("message", `Balance: ${bal} ${klySym}`);
    const need = ethers.utils.parseUnits(KLY_THRESHOLD_HUMAN, klyDec);
    if(ethers.BigNumber.from(balRaw).gte(need)) unlockAcademy(); else lockAcademy();
  }catch(e){
    console.error(e); toast("Failed to load balance","err");
  }
}
function resetDisconnected(){
  walletLabel && (walletLabel.textContent = "Not connected");
  setStatus("message","Connect wallet to continue.");
  setStatus("eligibility", `Academy: ${KLY_THRESHOLD_HUMAN}+ KLY required`);
  connectText && (connectText.textContent = "Connect Wallet");
  lockAcademy();
}

/* Web3Modal (with WalletConnect v2 option) */
function setupWeb3Modal(){
  const W3M = window.Web3Modal && (window.Web3Modal.default || window.Web3Modal);
  if(!W3M){
    console.warn("[KLY] Web3Modal global missing — will use injected fallback.");
    return null;
  }

  // WalletConnect v2 option for Web3Modal v1
  const walletconnectV2 = {
    display: {
      name: "WalletConnect",
      description: "Scan with Trust, MetaMask, Rainbow, etc."
    },
    package: window.WalletConnectEthereumProvider, // UMD global
    options: {
      projectId: WC_PROJECT_ID,
      chains: [BSC_CHAIN_ID],
      rpcMap: { [BSC_CHAIN_ID]: RPC_URL },
      showQrModal: true,
      qrModalOptions: { themeMode: "dark" },
      optionalChains: [BSC_CHAIN_ID],
      methods: ["eth_sendTransaction","eth_sign","personal_sign","eth_signTypedData","eth_signTypedData_v4"],
      events: ["chainChanged","accountsChanged","disconnect"],
      metadata: {
        name: "KLY Portal",
        description: "KLY — Build Wealth. Own Legacy.",
        url: location.origin,
        icons: ["https://kellylegacyestates.com/favicon.ico"]
      }
    },
    // init v2 for W3M v1
    connector: async (ProviderPackage, opts) => {
      const provider = await ProviderPackage.init(opts);
      await provider.enable();
      return provider;
    }
  };

  web3Modal = new W3M({
    cacheProvider: true,
    theme: "dark",
    providerOptions: { walletconnectv2: walletconnectV2 }
  });
  return web3Modal;
}

/* Connect flows */
async function connectViaWeb3Modal(){
  extProvider = await web3Modal.connect();
  provider = new ethers.providers.Web3Provider(extProvider);
  signer   = provider.getSigner();
  me       = await signer.getAddress();

  const net = await provider.getNetwork();
  if(net.chainId !== BSC_CHAIN_ID){
    const ok = await ensureBsc();
    if(!ok){ toast("Please switch to BNB Smart Chain (56)","err"); resetDisconnected(); return false; }
  }

  kly = new ethers.Contract(CONTRACT_ADDRESS, ERC20_ABI_MIN, provider);

  if(extProvider.on){
    extProvider.on("accountsChanged", (acc)=>{
      if(!acc?.length){ handleDisconnect(); return; }
      me = acc[0]; loadAll(); toast("Account switched","warn");
    });
    extProvider.on("chainChanged", ()=>window.location.reload());
    extProvider.on("disconnect", handleDisconnect);
  }
  return true;
}

async function connectFallbackInjected(){
  const injected = pickInjected();
  if(!injected) throw new Error("No injected provider");
  await injected.request?.({ method: "eth_requestAccounts" });
  provider = new ethers.providers.Web3Provider(injected);
  signer   = provider.getSigner();
  me       = await signer.getAddress();

  const net = await provider.getNetwork();
  if(net.chainId !== BSC_CHAIN_ID){
    const ok = await ensureBsc();
    if(!ok){ toast("Please switch to BNB Smart Chain (56)","err"); resetDisconnected(); return false; }
  }

  kly = new ethers.Contract(CONTRACT_ADDRESS, ERC20_ABI_MIN, provider);

  injected.removeListener?.("accountsChanged", onAccounts);
  injected.removeListener?.("chainChanged", onChain);
  injected.on?.("accountsChanged", onAccounts);
  injected.on?.("chainChanged", onChain);
  return true;

  async function onAccounts(acc){
    if(!acc?.length){ handleDisconnect(); return; }
    me = ethers.utils.getAddress(acc[0]);
    walletLabel && (walletLabel.textContent = short(me));
    await loadAll();
  }
  async function onChain(){ window.location.reload(); }
}

/* Direct WalletConnect v2 (for mobile Safari/Chrome) */
async function connectViaWalletConnectV2Direct(){
  if(!window.WalletConnectEthereumProvider){
    throw new Error("WalletConnect v2 script missing");
  }
  const wc = await window.WalletConnectEthereumProvider.init({
    projectId: WC_PROJECT_ID,
    chains: [BSC_CHAIN_ID],
    rpcMap: { [BSC_CHAIN_ID]: RPC_URL },
    showQrModal: true,
    qrModalOptions: { themeMode: "dark" },
    metadata: {
      name: "KLY Portal",
      description: "KLY — Build Wealth. Own Legacy.",
      url: location.origin,
      icons: ["https://kellylegacyestates.com/favicon.ico"]
    }
  });
  await wc.enable();

  extProvider = wc;
  provider = new ethers.providers.Web3Provider(wc);
  signer   = provider.getSigner();
  me       = await signer.getAddress();

  const net = await provider.getNetwork();
  if(net.chainId !== BSC_CHAIN_ID){
    toast("Please switch to BNB Smart Chain (56) in your wallet","err");
    return false;
  }
  kly = new ethers.Contract(CONTRACT_ADDRESS, ERC20_ABI_MIN, provider);

  wc.on?.("accountsChanged", (acc)=>{
    if(!acc?.length){ handleDisconnect(); return; }
    me = acc[0]; loadAll(); toast("Account switched","warn");
  });
  wc.on?.("chainChanged", ()=>window.location.reload());
  wc.on?.("disconnect", handleDisconnect);

  return true;
}

/* Public connect handler (mobile-first) */
async function connect(){
  try{
    if(location.protocol !== "https:" && location.hostname !== "localhost"){
      toast("Open this site over HTTPS for wallet connect.","warn",5000);
    }

    connectBtn.disabled = true;
    connectText.innerHTML = '<span class="spinner" aria-hidden="true"></span><span>Connecting…</span>';
    toast("Connecting wallet…","warn");

    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    let ok = false;

    if(isMobile){
      if(hasEthereum()){
        // In-app wallet browsers (Trust, MetaMask, SafePal, Brave)
        ok = await connectFallbackInjected();
      }else{
        // Mobile Safari/Chrome → deep-link via WalletConnect v2
        ok = await connectViaWalletConnectV2Direct();
      }
    } else {
      // Desktop → Web3Modal (with WC v2 option), then injected fallback
      const modalReady = setupWeb3Modal();
      if(modalReady){
        try{ ok = await connectViaWeb3Modal(); }
        catch(e){ console.warn("[KLY] Web3Modal failed, trying injected fallback", e); }
      }
      if(!ok && hasEthereum()) ok = await connectFallbackInjected();
    }

    if(!ok) return;

    walletLabel && (walletLabel.textContent = short(me));
    setStatus("message","Connected on BNB Smart Chain");
    connectText && (connectText.textContent = "Connected");
    await loadAll();
    toast("Wallet connected","ok");

  }catch(err){
    console.error(err);
    toast("Connection failed","err");
    resetDisconnected();
  }finally{
    connectBtn.disabled = false;
  }
}
function handleDisconnect(){
  try{ web3Modal?.clearCachedProvider?.(); }catch{}
  resetDisconnected();
  toast("Wallet disconnected","err");
}

/* Wire button + auto-reconnect */
connectBtn?.addEventListener("click", connect);

// Auto-connect if cached
(function autoConnect(){
  const W3M = window.Web3Modal && (window.Web3Modal.default || window.Web3Modal);
  if(W3M){
    try{
      const m = new (window.Web3Modal.default || window.Web3Modal)({ cacheProvider:true });
      if(m.cachedProvider){ connect(); }
    }catch{}
  } else if(hasEthereum()){
    window.ethereum.request({ method: "eth_accounts" })
      .then(acc => { if(acc && acc[0]) connect(); })
      .catch(()=>{});
  }
})();

/* Contract bar utilities */
(function contractBar(){
  const shortEl = document.getElementById("contractShort");
  const copyBtn = document.getElementById("copyContract");
  if(shortEl) shortEl.textContent = short(CONTRACT_ADDRESS);
  copyBtn?.addEventListener("click", async ()=>{
    try{ await navigator.clipboard.writeText(CONTRACT_ADDRESS); toast("Contract copied","ok"); }
    catch{ toast("Failed to copy","err"); }
  });
})();

/* ================================
   Ecosystem dropdown (accessible)
================================ */
(function dropdownNav(){
  const btn   = document.getElementById('ecosysBtn');
  const menu  = document.getElementById('ecosysMenu');
  if(!btn || !menu) return;

  const items = Array.from(menu.querySelectorAll('a[role="menuitem"]'));
  let open = false;

  function openMenu(){
    if(open) return;
    open = true;
    btn.setAttribute('aria-expanded','true');
    menu.hidden = false;
  }
  function closeMenu(){
    if(!open) return;
    open = false;
    btn.setAttribute('aria-expanded','false');
    menu.hidden = true;
  }
  function toggleMenu(){ open ? closeMenu() : openMenu(); }

  // Button interactions
  btn.addEventListener('click', (e)=>{ e.preventDefault(); toggleMenu(); });
  btn.addEventListener('keydown', (e)=>{
    if(e.key === 'ArrowDown'){ e.preventDefault(); openMenu(); items[0]?.focus(); }
    if(e.key === 'ArrowUp'){   e.preventDefault(); openMenu(); items[items.length-1]?.focus(); }
    if(e.key === 'Escape'){ closeMenu(); btn.focus(); }
  });

  // Menu keyboard navigation
  menu.addEventListener('keydown', (e)=>{
    const i = items.indexOf(document.activeElement);
    if(e.key === 'Escape'){ e.preventDefault(); closeMenu(); btn.focus(); }
    if(e.key === 'ArrowDown'){ e.preventDefault(); items[(i + 1) % items.length]?.focus(); }
    if(e.key === 'ArrowUp'){   e.preventDefault(); items[(i - 1 + items.length) % items.length]?.focus(); }
    if(e.key === 'Home'){ e.preventDefault(); items[0]?.focus(); }
    if(e.key === 'End'){  e.preventDefault(); items[items.length-1]?.focus(); }
  });

  // Close on click outside or focus loss
  document.addEventListener('click', (e)=>{
    if(open && !menu.contains(e.target) && !btn.contains(e.target)){ closeMenu(); }
  });
  window.addEventListener('blur', closeMenu);
  window.addEventListener('scroll', ()=>{ if(open) closeMenu(); }, { passive:true });
})();
</script>
</body>
</html>
