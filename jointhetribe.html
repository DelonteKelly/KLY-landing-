<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Join the Tribe | KLY Legacy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Claim your legacy and join the KLY Tribe through sacred pathways of ascension." />
  <link rel="canonical" href="https://yourdomain.com/join" />

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="Join the KLY Legacy Tribe" />
  <meta property="og:description" content="Claim your legacy and join the KLY Tribe through sacred pathways of ascension." />
  <meta property="og:image" content="https://yourdomain.com/images/social-preview.jpg" />
  <meta property="og:url" content="https://yourdomain.com/join" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet" />

  <!-- Icons + Favicon -->
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-JQZ..." crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <style>
    :root{
      --bg:#0A0A0B; --bg2:#0f0f12; --panel:rgba(255,255,255,.06);
      --txt:#F2F4F8; --muted:rgba(242,244,248,.75);
      --gold:#FFD98A; --gold2:#D4AF37; --gold-faint:rgba(255,217,138,.12);
      --good:#00c853; --warn:#ffab00; --bad:#ff3860;
      --border:rgba(255,217,138,.22);
      --radius:14px; --radius-lg:18px; --radius-xl:24px;
      --tr: all .35s cubic-bezier(.165,.84,.44,1);
      --shadow: 0 12px 28px rgba(0,0,0,.35);
      --glow: 0 0 22px rgba(255,217,138,.28);
      --max: 1200px;
    }
    *{box-sizing:border-box} html{scroll-behavior:smooth}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:'Cinzel',serif;line-height:1.55;overflow-x:hidden}

    /* Top glass header */
    header{position:fixed;inset:0 0 auto 0;display:flex;gap:1rem;align-items:center;justify-content:space-between;
      padding:.9rem 1.25rem;background:rgba(10,10,11,.55);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,217,138,.08);
      z-index:40; transition:var(--tr)}
    header.is-scrolled{background:rgba(10,10,11,.85)}
    .brand{display:flex;align-items:center;gap:.75rem}
    .brand-icon{width:40px;height:40px;display:grid;place-items:center;border-radius:50%;
      background:var(--gold-faint);border:1px solid var(--border)}
    .brand-name{font-family:'Cinzel Decorative',serif;font-weight:700;letter-spacing:.5px}
    .brand-name span{color:var(--gold)}
    .nav{display:flex;gap:1.25rem;align-items:center}
    .nav a{color:var(--muted);font-family:'Montserrat',sans-serif;text-decoration:none;position:relative}
    .nav a:after{content:"";position:absolute;left:0;right:100%;bottom:-6px;height:2px;background:var(--gold);transition:var(--tr)}
    .nav a:hover{color:var(--txt)} .nav a:hover:after{right:0}
    .nav-toggle{display:none;background:none;border:none;color:var(--txt);font-size:1.35rem}

    .btn-wallet{display:flex;align-items:center;gap:.5rem;padding:.55rem 1rem;border-radius:999px;border:1px solid var(--border);
      background:var(--gold-faint);color:var(--gold);font-family:'Montserrat',sans-serif;cursor:pointer;transition:var(--tr)}
    .btn-wallet:hover{box-shadow:var(--glow);transform:translateY(-1px)}
    .btn-wallet.connected{border-color:rgba(255,255,255,.35);color:var(--txt)}

    /* Hero */
    .hero{min-height:100svh;display:grid;place-items:center;padding:130px 1.25rem 80px;position:relative;overflow:hidden}
    .hero::before{
      /* soft radial aura */
      content:"";position:absolute;inset:-15% -10% auto -10%;height:70%;
      background:radial-gradient(60% 60% at 50% 50%, rgba(255,217,138,.12), transparent 60%);
      pointer-events:none;filter:blur(10px)
    }
    .hero-inner{max-width:var(--max);width:100%;display:grid;gap:1.25rem;justify-items:center;text-align:center}
    h1{font-family:'Cinzel Decorative',serif;font-weight:800;font-size:clamp(2.4rem,6vw,4.6rem);margin:0;text-shadow:0 0 14px rgba(255,217,138,.2)}
    .lead{font-family:'Montserrat',sans-serif;color:var(--muted);max-width:760px}
    .cta-row{display:flex;gap:.75rem;flex-wrap:wrap;justify-content:center;margin-top:.5rem}
    .btn{display:inline-flex;align-items:center;gap:.6rem;padding:1rem 1.35rem;border-radius:999px;border:1px solid var(--border);
      font-weight:700;font-family:'Montserrat',sans-serif;cursor:pointer;transition:var(--tr)}
    .btn-primary{background:linear-gradient(135deg,var(--gold),var(--gold2));color:#171717;box-shadow:var(--glow)}
    .btn-primary:hover{transform:translateY(-2px)}
    .btn-ghost{background:transparent;color:var(--gold)} .btn-ghost:hover{background:var(--gold-faint)}

    /* Subtle sparkles (CSS only) */
    .sparkles{position:absolute;inset:0;pointer-events:none;mask-image:radial-gradient(closest-side at 50% 60%, #000 60%, transparent 100%)}
    .sparkles i{position:absolute;width:3px;height:3px;border-radius:50%;background:var(--gold);opacity:.25;animation:rise linear infinite}
    @keyframes rise{from{transform:translateY(10svh)} to{transform:translateY(-110svh)}}

    /* Sections */
    .section{padding:80px 1.25rem}
    .container{max-width:var(--max);margin:0 auto}
    .title{font-family:'Cinzel Decorative',serif;font-size:clamp(1.8rem,3.2vw,2.4rem);text-align:center;margin:0 0 28px}
    .title em{color:var(--gold);font-style:normal}

    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:22px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius-lg);padding:22px;box-shadow:var(--shadow);
      transition:var(--tr);text-align:left;display:grid;gap:10px}
    .card:hover{transform:translateY(-6px)}
    .card .icon{font-size:1.8rem;color:var(--gold)}
    .card h3{margin:0;font-size:1.25rem}
    .card p{margin:0;color:var(--muted);font-family:'Montserrat',sans-serif}
    .card .card-cta{justify-self:start;margin-top:4px}

    /* Quote */
    .quote{background:var(--bg2);border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
    blockquote{max-width:880px;margin:0 auto;font-family:'Montserrat',sans-serif;color:var(--muted);font-style:italic;padding:10px 0}
    .cite{display:block;margin-top:10px;color:var(--gold)}

    /* CTA final */
    .cta{display:grid;gap:10px;place-items:center;text-align:center}
    .cta p{color:var(--muted);font-family:'Montserrat',sans-serif}

    /* Footer */
    footer{padding:40px 1.25rem;border-top:1px solid var(--border);background:var(--bg2)}
    .f-nav,.f-social{display:flex;gap:14px;flex-wrap:wrap;justify-content:center}
    .f-nav a{color:var(--muted);text-decoration:none}
    .f-nav a:hover{color:var(--gold)}
    .f-social a{width:44px;height:44px;display:grid;place-items:center;border-radius:50%;background:rgba(255,255,255,.06);color:var(--txt);transition:var(--tr)}
    .f-social a:hover{transform:translateY(-3px);color:var(--gold);box-shadow:var(--glow)}
    .copy{margin-top:14px;text-align:center;color:var(--muted);font-family:'Montserrat',sans-serif}

    /* Toast */
    .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%) translateY(16px);
      background:rgba(15,15,18,.95);border:1px solid var(--border);border-radius:var(--radius);
      box-shadow:var(--glow);padding:.85rem 1.1rem;display:flex;gap:.6rem;align-items:center;z-index:60;
      opacity:0;transition:var(--tr);max-width:92%;backdrop-filter:blur(8px)}
    .toast.show{opacity:1;transform:translateX(-50%)}
    .toast.success{border-color:rgba(0,200,83,.45)} .toast.warn{border-color:rgba(255,171,0,.45)} .toast.error{border-color:rgba(255,56,96,.45)}

    /* Mobile */
    @media (max-width:992px){ .grid{grid-template-columns:1fr 1fr} .nav{display:none} .nav-toggle{display:block} }
    @media (max-width:640px){ .grid{grid-template-columns:1fr} .btn{width:100%} }

    /* Respect motion prefs */
    @media (prefers-reduced-motion:reduce){
      *{animation:none!important;transition:none!important;scroll-behavior:auto!important}
      .sparkles{display:none}
    }
  </style>

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"KLY Legacy",
    "url":"https://yourdomain.com",
    "logo":"https://yourdomain.com/images/logo.png",
    "sameAs":["https://twitter.com/klyofficial","https://www.instagram.com/kly_official1","https://medium.com/kly-legacy","https://discord.gg/QZ6tecpF"]
  }
  </script>
</head>
<body>
  <header id="header">
    <div class="brand">
      <div class="brand-icon" aria-hidden="true"><i class="fas fa-star"></i></div>
      <div class="brand-name">KLY <span>Legacy</span></div>
    </div>

    <nav class="nav" aria-label="Primary">
      <a href="#hero">Home</a>
      <a href="#pathways">Pathways</a>
      <a href="#wisdom">Wisdom</a>
      <a href="#initiation">Initiation</a>
    </nav>

    <button class="nav-toggle" id="navToggle" aria-label="Toggle menu"><i class="fas fa-bars"></i></button>
    <button class="btn-wallet" id="btnWallet"><i class="fas fa-wallet"></i><span>Connect Wallet</span></button>
  </header>

  <main id="hero" class="hero">
    <div class="sparkles" id="sparkles" aria-hidden="true"></div>

    <div class="hero-inner">
      <h1>You Were Called Here For A Reason</h1>
      <p class="lead">Claim your legacy. Join the Tribe. Begin your ascension.</p>
      <div class="cta-row">
        <button class="btn btn-primary" data-scroll="#pathways">Start Your Journey <i class="fas fa-arrow-right"></i></button>
        <button class="btn btn-ghost" data-scroll="#initiation">Initiation <i class="fas fa-unlock"></i></button>
      </div>
    </div>
  </main>

  <section id="pathways" class="section">
    <div class="container">
      <h2 class="title">Three <em>Sacred Pathways</em> to Ascension</h2>
      <div class="grid">
        <article class="card">
          <div class="icon"><i class="fas fa-key"></i></div>
          <h3>Claim Your NFT</h3>
          <p>Own your proof of ascension and unlock sacred access to the KLY Legacy. Each NFT is a key to higher consciousness.</p>
          <button class="btn card-cta btn-ghost" data-open="nftModal">Learn More <i class="fas fa-arrow-right"></i></button>
        </article>

        <article class="card">
          <div class="icon"><i class="fas fa-book-open"></i></div>
          <h3>Begin Your Awakening</h3>
          <p>Access our private course <em>The Path of Awakening</em> — ancient wisdom for modern seekers.</p>
          <button class="btn card-cta btn-ghost" id="btnKlyAccess">Begin Your Path <i class="fas fa-arrow-right"></i></button>
        </article>

        <article class="card">
          <div class="icon"><i class="fas fa-lock-open"></i></div>
          <h3>Unlock the Vault</h3>
          <p>Stake KLY, claim sacred relics, and enter the Chamber of Secrets where true transformation begins.</p>
          <button class="btn card-cta btn-ghost" id="btnNftAccess">Enter the Vault <i class="fas fa-arrow-right"></i></button>
        </article>
      </div>
    </div>
  </section>

  <section id="wisdom" class="section quote">
    <div class="container">
      <h2 class="title">Wisdom of the Tribe</h2>
      <blockquote>
        “Joining the KLY Tribe was the turning point in my spiritual journey. The wisdom and community transformed my life.”
        <span class="cite">— Marcus A., Initiate since 2025</span>
      </blockquote>
    </div>
  </section>

  <section id="initiation" class="section cta">
    <div class="container">
      <h2 class="title">Ready to Join the Tribe?</h2>
      <p>Step into your divine role. This isn't just a movement — it's a Return to your true essence.</p>
      <button class="btn btn-primary" onclick="location.href='/launchpad.html'">Begin Your Ascension <i class="fas fa-arrow-right"></i></button>
    </div>
  </section>

  <footer>
    <div class="container">
      <nav class="f-nav" aria-label="Footer">
        <a href="#hero">Home</a>
        <a href="#pathways">Pathways</a>
        <a href="#wisdom">Wisdom</a>
        <a href="#initiation">Initiation</a>
        <a href="/privacy">Privacy</a>
        <a href="/terms">Terms</a>
      </nav>
      <div class="f-social">
        <a href="https://discord.gg/QZ6tecpF" target="_blank" rel="noopener" aria-label="Discord"><i class="fab fa-discord"></i></a>
        <a href="https://www.instagram.com/kly_official1" target="_blank" rel="noopener" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="https://twitter.com/klyofficial" target="_blank" rel="noopener" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
        <a href="https://medium.com/kly-legacy" target="_blank" rel="noopener" aria-label="Medium"><i class="fab fa-medium"></i></a>
      </div>
      <div class="copy">© 2025 KLY Legacy. All rights reserved.</div>
    </div>
  </footer>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite">
    <i id="toastIcon" class="fas fa-info-circle"></i><span id="toastText"></span>
  </div>

  <!-- NFT Modal -->
  <dialog id="nftModal" class="nft-modal">
    <form method="dialog" style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:22px;max-width:520px;width:min(92vw,520px);box-shadow:var(--shadow)">
      <button value="close" aria-label="Close" style="position:absolute;right:12px;top:12px;background:none;border:none;color:var(--muted);font-size:1.2rem"><i class="fas fa-times"></i></button>
      <h3 style="margin-top:0;color:var(--gold)">Claim Your Key of Ascension</h3>
      <p style="color:var(--muted);font-family:'Montserrat',sans-serif">Your Key unlocks:</p>
      <ul style="text-align:left;margin:.6rem 0 1rem 1rem;font-family:'Montserrat',sans-serif;color:var(--muted)">
        <li>The Sacred Vault of Knowledge</li>
        <li>Private Tribe Gatherings</li>
        <li>Ancient Wisdom Teachings</li>
        <li>Exclusive Meditation Practices</li>
      </ul>
      <p style="color:var(--muted);font-family:'Montserrat',sans-serif">Requirements:</p>
      <ul style="text-align:left;margin:.6rem 0 1.1rem 1rem;font-family:'Montserrat',sans-serif;color:var(--muted)">
        <li>MetaMask / Trust Wallet</li>
        <li>BNB for gas</li>
        <li>0.1 <b>BNB</b> initiation fee</li>
      </ul>
      <div style="display:flex;gap:.5rem;flex-wrap:wrap">
        <button class="btn btn-primary" id="btnVerifyNft" type="button">Verify Eligibility <i class="fas fa-arrow-right"></i></button>
        <button class="btn btn-ghost" onclick="location.href='/launchpad.html'" type="button">Go to Mint <i class="fas fa-meteor"></i></button>
      </div>
    </form>
  </dialog>

  <!-- Scripts: ethers v5 + Web3Modal v1 + WalletConnect v2 (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
  <script src="https://unpkg.com/@walletconnect/ethereum-provider@2.12.1/dist/umd/index.min.js"></script>

  <script>
  /********** CONFIG **********/
  const KLY_TOKEN_ADDRESS   = "0x2e4fEB2Fe668c8Ebe84f19e6c8fE8Cf8131B4E52";
  const NFT_CONTRACT_ADDRESS= "0xDA76d35742190283E340dbeE2038ecc978a56950";
  const NFT_TOKEN_ID        = 2;
  const REQUIRED_KLY        = 100;

  const BSC = {
    idHex: "0x38",
    idDec: 56,
    name: "BNB Smart Chain",
    rpc:  "https://bsc-dataseed.binance.org/",
    explorer: "https://bscscan.com"
  };

  // Your WalletConnect v2 Project ID
  const WC_PROJECT_ID = "df8063092ef3c627437d698df0977bc1";

  /********** DOM **********/
  const header = document.getElementById('header');
  const navToggle = document.getElementById('navToggle');
  const btnWallet = document.getElementById('btnWallet');
  const toast = document.getElementById('toast');
  const toastText = document.getElementById('toastText');
  const toastIcon = document.getElementById('toastIcon');
  const nftModal = document.getElementById('nftModal');
  const btnVerifyNft = document.getElementById('btnVerifyNft');

  /********** Web3 State **********/
  let web3Modal, extProvider, provider, signer, account;

  function showToast(msg, type='info'){
    toast.classList.remove('success','warn','error');
    if(type==='success') toast.classList.add('success');
    if(type==='warn')    toast.classList.add('warn');
    if(type==='error')   toast.classList.add('error');

    toastIcon.className = 'fas ' + (type==='success'?'fa-check-circle':type==='warn'?'fa-exclamation-triangle':type==='error'?'fa-exclamation-circle':'fa-info-circle');
    toastText.textContent = msg;
    toast.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.remove('show'), 4500);
  }

  function shorten(addr){ return addr ? addr.slice(0,6)+'...'+addr.slice(-4) : ''; }
  function updateWalletBtn(connected){
    if(connected){ btnWallet.classList.add('connected'); btnWallet.innerHTML = '<i class="fas fa-check-circle"></i> '+shorten(account); }
    else{ btnWallet.classList.remove('connected'); btnWallet.innerHTML = '<i class="fas fa-wallet"></i> Connect Wallet'; }
  }

  function pickInjected(){
    const eth = window.ethereum; if(!eth) return null;
    if(eth.providers && Array.isArray(eth.providers)){
      return eth.providers.find(p=>p.isMetaMask) || eth.providers.find(p=>p.isTrust || p.isTrustWallet) || eth.providers[0];
    }
    return eth;
  }

  function initWeb3Modal(){
    const WCEthereumProvider = window.WalletConnectEthereumProvider?.default || window.WalletConnectEthereumProvider;
    const providerOptions = {};

    if (WCEthereumProvider) {
      providerOptions.walletconnect = {
        package: WCEthereumProvider,
        options: {
          projectId: WC_PROJECT_ID,
          showQrModal: true,
          chains: [BSC.idDec],
          optionalChains: [BSC.idDec],
          rpcMap: { [BSC.idDec]: BSC.rpc },
          methods: ['eth_sendTransaction','personal_sign','eth_signTypedData_v4'],
          optionalMethods: [],
          events: ['chainChanged','accountsChanged','disconnect'],
          metadata:{ name:'KLY Legacy', description:'Ascension Portal', url:location.origin, icons:[] }
        }
      };
    }
    const WM = window.Web3Modal?.default || window.Web3Modal;
    web3Modal = WM ? new WM({ cacheProvider:false, providerOptions }) : null;
  }

  async function ensureBSC(){
    const chainId = await provider.send('eth_chainId', []);
    if (String(chainId).toLowerCase() === BSC.idHex.toLowerCase()) return;
    try{
      await provider.send('wallet_switchEthereumChain', [{ chainId: BSC.idHex }]);
    }catch(err){
      if (err?.code === 4902){
        await provider.send('wallet_addEthereumChain', [{
          chainId: BSC.idHex, chainName: BSC.name,
          nativeCurrency:{ name:'BNB', symbol:'BNB', decimals:18 },
          rpcUrls:[BSC.rpc], blockExplorerUrls:[BSC.explorer]
        }]);
      } else if (err?.code === -32002){
        showToast('Confirm network switch in your wallet.', 'warn'); throw err;
      } else {
        showToast('Please switch to BNB Smart Chain in your wallet.', 'error'); throw err;
      }
    }
  }

  function bindProviderEvents(p){
    if(!p?.on) return;
    p.on('accountsChanged', (accs)=>{ if(!accs?.length){ account=null; updateWalletBtn(false); showToast('Wallet disconnected','warn'); } else { account = accs[0]; updateWalletBtn(true); }});
    p.on('chainChanged', async ()=>{ try{ await ensureBSC(); }catch(_){} });
    p.on('disconnect', ()=>{ account=null; updateWalletBtn(false); showToast('Disconnected','warn'); });
  }

  async function connectWallet(){
    try{
      const injected = pickInjected();
      if(injected){
        extProvider = injected;
        await injected.request({ method:'eth_requestAccounts' });
        provider = new ethers.providers.Web3Provider(injected, 'any');
      } else {
        if(!web3Modal) initWeb3Modal();
        extProvider = await web3Modal.connect();
        provider = new ethers.providers.Web3Provider(extProvider, 'any');
      }
      signer = provider.getSigner();
      account = await signer.getAddress();
      bindProviderEvents(extProvider);
      updateWalletBtn(true);
      showToast('Wallet connected', 'success');
      await ensureBSC();
    }catch(e){
      if(String(e?.message).match(/closed|cancel/i)) return showToast('Connection cancelled', 'warn');
      if(e?.code === -32002) return showToast('Open your wallet to approve connection', 'warn');
      console.error(e); showToast('Could not connect wallet', 'error');
    }
  }

  async function withWalletReady(){
    if(!account) await connectWallet();
    if(!account) throw new Error('No wallet');
    await ensureBSC();
    return provider;
  }

  /********** GATES **********/
  async function checkKlyAccess(){
    showToast('Checking KLY balance…');
    try{
      const provider = await withWalletReady();
      const user = await provider.getSigner().getAddress();
      const abi = ["function balanceOf(address) view returns (uint256)","function decimals() view returns (uint8)"];
      const kly = new ethers.Contract(KLY_TOKEN_ADDRESS, abi, provider);
      let dec = 18; try { dec = await kly.decimals(); } catch(_){}
      const bal = await kly.balanceOf(user);
      const need = ethers.utils.parseUnits(String(REQUIRED_KLY), dec);
      if (bal.gte(need)){ showToast('Access granted. Redirecting…','success'); setTimeout(()=>location.href='/course.html', 800); }
      else {
        const human = Number(ethers.utils.formatUnits(bal, dec)).toFixed(2);
        showToast(`Need ≥ ${REQUIRED_KLY} KLY. You have ${human}.`, 'warn');
        nftModal?.showModal?.();
      }
    }catch(e){ console.error(e); showToast('Could not verify KLY balance','error'); }
  }

  async function checkNftAccess(){
    showToast('Verifying NFT ownership…');
    try{
      const provider = await withWalletReady();
      const user = await provider.getSigner().getAddress();
      let holds = false;
      // Try 1155
      try{
        const abi1155 = ["function balanceOf(address,uint256) view returns (uint256)"];
        const c1155 = new ethers.Contract(NFT_CONTRACT_ADDRESS, abi1155, provider);
        const b = await c1155.balanceOf(user, NFT_TOKEN_ID);
        holds = ethers.BigNumber.isBigNumber(b) ? b.gt(0) : Number(b) > 0;
      }catch(_){}
      // Then 721 (collection-wide)
      if(!holds){
        try{
          const abi721 = ["function balanceOf(address) view returns (uint256)"];
          const c721 = new ethers.Contract(NFT_CONTRACT_ADDRESS, abi721, provider);
          const b = await c721.balanceOf(user);
          holds = ethers.BigNumber.isBigNumber(b) ? b.gt(0) : Number(b) > 0;
        }catch(_){}
      }
      if(holds){ showToast('NFT verified. Unlocking Vault…','success'); setTimeout(()=>location.href='/KLY-vault.html', 800); }
      else { showToast('No Key detected. Taking you to mint…','warn'); setTimeout(()=>location.href='/launchpad.html', 800); }
    }catch(e){ console.error(e); showToast('NFT verification failed','error'); }
  }

  /********** UI wiring **********/
  function seedSparkles(){
    const wrap = document.getElementById('sparkles');
    if(!wrap || window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
    const count = Math.min(28, Math.max(12, Math.floor(window.innerWidth/50)));
    for(let i=0;i<count;i++){
      const dot = document.createElement('i');
      const left = Math.random()*100;
      const dur  = 12 + Math.random()*16;
      const delay = Math.random()*-dur;
      dot.style.left = left+'%';
      dot.style.bottom = (-10 + Math.random()*10)+'svh';
      dot.style.animationDuration = dur+'s';
      dot.style.animationDelay = delay+'s';
      wrap.appendChild(dot);
    }
  }

  function attachHandlers(){
    // Header shrink
    addEventListener('scroll',()=>{ if(scrollY>24) header.classList.add('is-scrolled'); else header.classList.remove('is-scrolled'); });

    // Smooth scroll buttons
    document.querySelectorAll('[data-scroll]').forEach(el=>{
      el.addEventListener('click', ()=>{
        const target = document.querySelector(el.dataset.scroll);
        target?.scrollIntoView({ behavior:'smooth', block:'start' });
      });
    });

    // Mobile menu (simple show/hide of primary nav)
    navToggle.addEventListener('click', ()=>{
      const nav = document.querySelector('.nav');
      const open = nav.style.display !== 'flex';
      nav.style.display = open ? 'flex' : 'none';
      navToggle.innerHTML = open ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
    });

    btnWallet.addEventListener('click', connectWallet);
    document.getElementById('btnKlyAccess').addEventListener('click', checkKlyAccess);
    document.getElementById('btnNftAccess').addEventListener('click', checkNftAccess);
    btnVerifyNft?.addEventListener('click', checkNftAccess);
  }

  // Expose to inline uses if needed
  window.checkKLYAccess = checkKlyAccess;
  window.checkNFTAccess = checkNftAccess;

  // Init
  (function init(){
    initWeb3Modal();
    seedSparkles();
    attachHandlers();
    // prefill button if wallet already injected
    if(window.ethereum?.selectedAddress){ account = window.ethereum.selectedAddress; updateWalletBtn(true); }
  })();
  </script>
</body>
</html>
